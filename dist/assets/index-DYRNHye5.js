var ak=Object.defineProperty;var Jb=e=>{throw TypeError(e)};var Ck=(e,t,n)=>t in e?ak(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Se=(e,t,n)=>Ck(e,typeof t!="symbol"?t+"":t,n),tc=(e,t,n)=>t.has(e)||Jb("Cannot "+n);var E=(e,t,n)=>(tc(e,t,"read from private field"),n?n.call(e):t.get(e)),Te=(e,t,n)=>t.has(e)?Jb("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),ve=(e,t,n,g)=>(tc(e,t,"write to private field"),g?g.call(e,n):t.set(e,n),n),We=(e,t,n)=>(tc(e,t,"access private method"),n);var Ml=(e,t,n,g)=>({set _(i){ve(e,t,i,n)},get _(){return E(e,t,g)}});function ck(e,t){for(var n=0;n<t.length;n++){const g=t[n];if(typeof g!="string"&&!Array.isArray(g)){for(const i in g)if(i!=="default"&&!(i in e)){const o=Object.getOwnPropertyDescriptor(g,i);o&&Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:()=>g[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))g(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&g(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function g(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var bg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ah(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ky={exports:{}},gC={},Ey={exports:{}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gl=Symbol.for("react.element"),dk=Symbol.for("react.portal"),uk=Symbol.for("react.fragment"),Ak=Symbol.for("react.strict_mode"),hk=Symbol.for("react.profiler"),mk=Symbol.for("react.provider"),bk=Symbol.for("react.context"),pk=Symbol.for("react.forward_ref"),fk=Symbol.for("react.suspense"),Zk=Symbol.for("react.memo"),yk=Symbol.for("react.lazy"),Yb=Symbol.iterator;function Gk(e){return e===null||typeof e!="object"?null:(e=Yb&&e[Yb]||e["@@iterator"],typeof e=="function"?e:null)}var My={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ty=Object.assign,Ly={};function Fs(e,t,n){this.props=e,this.context=t,this.refs=Ly,this.updater=n||My}Fs.prototype.isReactComponent={};Fs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Fs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Uy(){}Uy.prototype=Fs.prototype;function hh(e,t,n){this.props=e,this.context=t,this.refs=Ly,this.updater=n||My}var mh=hh.prototype=new Uy;mh.constructor=hh;Ty(mh,Fs.prototype);mh.isPureReactComponent=!0;var Hb=Array.isArray,zy=Object.prototype.hasOwnProperty,bh={current:null},Dy={key:!0,ref:!0,__self:!0,__source:!0};function Qy(e,t,n){var g,i={},o=null,s=null;if(t!=null)for(g in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(o=""+t.key),t)zy.call(t,g)&&!Dy.hasOwnProperty(g)&&(i[g]=t[g]);var r=arguments.length-2;if(r===1)i.children=n;else if(1<r){for(var l=Array(r),I=0;I<r;I++)l[I]=arguments[I+2];i.children=l}if(e&&e.defaultProps)for(g in r=e.defaultProps,r)i[g]===void 0&&(i[g]=r[g]);return{$$typeof:Gl,type:e,key:o,ref:s,props:i,_owner:bh.current}}function Bk(e,t){return{$$typeof:Gl,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ph(e){return typeof e=="object"&&e!==null&&e.$$typeof===Gl}function Sk(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Nb=/\/+/g;function nc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Sk(""+e.key):t.toString(36)}function RI(e,t,n,g,i){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case Gl:case dk:s=!0}}if(s)return s=e,i=i(s),e=g===""?"."+nc(s,0):g,Hb(i)?(n="",e!=null&&(n=e.replace(Nb,"$&/")+"/"),RI(i,t,n,"",function(I){return I})):i!=null&&(ph(i)&&(i=Bk(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(Nb,"$&/")+"/")+e)),t.push(i)),1;if(s=0,g=g===""?".":g+":",Hb(e))for(var r=0;r<e.length;r++){o=e[r];var l=g+nc(o,r);s+=RI(o,t,n,l,i)}else if(l=Gk(e),typeof l=="function")for(e=l.call(e),r=0;!(o=e.next()).done;)o=o.value,l=g+nc(o,r++),s+=RI(o,t,n,l,i);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function Tl(e,t,n){if(e==null)return e;var g=[],i=0;return RI(e,g,"","",function(o){return t.call(n,o,i++)}),g}function Vk(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ln={current:null},vI={transition:null},Wk={ReactCurrentDispatcher:ln,ReactCurrentBatchConfig:vI,ReactCurrentOwner:bh};function jy(){throw Error("act(...) is not supported in production builds of React.")}Ke.Children={map:Tl,forEach:function(e,t,n){Tl(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Tl(e,function(){t++}),t},toArray:function(e){return Tl(e,function(t){return t})||[]},only:function(e){if(!ph(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ke.Component=Fs;Ke.Fragment=uk;Ke.Profiler=hk;Ke.PureComponent=hh;Ke.StrictMode=Ak;Ke.Suspense=fk;Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wk;Ke.act=jy;Ke.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var g=Ty({},e.props),i=e.key,o=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,s=bh.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var r=e.type.defaultProps;for(l in t)zy.call(t,l)&&!Dy.hasOwnProperty(l)&&(g[l]=t[l]===void 0&&r!==void 0?r[l]:t[l])}var l=arguments.length-2;if(l===1)g.children=n;else if(1<l){r=Array(l);for(var I=0;I<l;I++)r[I]=arguments[I+2];g.children=r}return{$$typeof:Gl,type:e.type,key:i,ref:o,props:g,_owner:s}};Ke.createContext=function(e){return e={$$typeof:bk,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:mk,_context:e},e.Consumer=e};Ke.createElement=Qy;Ke.createFactory=function(e){var t=Qy.bind(null,e);return t.type=e,t};Ke.createRef=function(){return{current:null}};Ke.forwardRef=function(e){return{$$typeof:pk,render:e}};Ke.isValidElement=ph;Ke.lazy=function(e){return{$$typeof:yk,_payload:{_status:-1,_result:e},_init:Vk}};Ke.memo=function(e,t){return{$$typeof:Zk,type:e,compare:t===void 0?null:t}};Ke.startTransition=function(e){var t=vI.transition;vI.transition={};try{e()}finally{vI.transition=t}};Ke.unstable_act=jy;Ke.useCallback=function(e,t){return ln.current.useCallback(e,t)};Ke.useContext=function(e){return ln.current.useContext(e)};Ke.useDebugValue=function(){};Ke.useDeferredValue=function(e){return ln.current.useDeferredValue(e)};Ke.useEffect=function(e,t){return ln.current.useEffect(e,t)};Ke.useId=function(){return ln.current.useId()};Ke.useImperativeHandle=function(e,t,n){return ln.current.useImperativeHandle(e,t,n)};Ke.useInsertionEffect=function(e,t){return ln.current.useInsertionEffect(e,t)};Ke.useLayoutEffect=function(e,t){return ln.current.useLayoutEffect(e,t)};Ke.useMemo=function(e,t){return ln.current.useMemo(e,t)};Ke.useReducer=function(e,t,n){return ln.current.useReducer(e,t,n)};Ke.useRef=function(e){return ln.current.useRef(e)};Ke.useState=function(e){return ln.current.useState(e)};Ke.useSyncExternalStore=function(e,t,n){return ln.current.useSyncExternalStore(e,t,n)};Ke.useTransition=function(){return ln.current.useTransition()};Ke.version="18.3.1";Ey.exports=Ke;var H=Ey.exports;const sn=Ah(H),Rk=ck({__proto__:null,default:sn},[H]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vk=H,kk=Symbol.for("react.element"),Xk=Symbol.for("react.fragment"),wk=Object.prototype.hasOwnProperty,Jk=vk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Yk={key:!0,ref:!0,__self:!0,__source:!0};function Py(e,t,n){var g,i={},o=null,s=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref);for(g in t)wk.call(t,g)&&!Yk.hasOwnProperty(g)&&(i[g]=t[g]);if(e&&e.defaultProps)for(g in t=e.defaultProps,t)i[g]===void 0&&(i[g]=t[g]);return{$$typeof:kk,type:e,key:o,ref:s,props:i,_owner:Jk.current}}gC.Fragment=Xk;gC.jsx=Py;gC.jsxs=Py;Ky.exports=gC;var G=Ky.exports;function Hk(e={}){const{nonce:t,onScriptLoadSuccess:n,onScriptLoadError:g}=e,[i,o]=H.useState(!1),s=H.useRef(n);s.current=n;const r=H.useRef(g);return r.current=g,H.useEffect(()=>{const l=document.createElement("script");return l.src="https://accounts.google.com/gsi/client",l.async=!0,l.defer=!0,l.nonce=t,l.onload=()=>{var I;o(!0),(I=s.current)===null||I===void 0||I.call(s)},l.onerror=()=>{var I;o(!1),(I=r.current)===null||I===void 0||I.call(r)},document.body.appendChild(l),()=>{document.body.removeChild(l)}},[t]),i}const Oy=H.createContext(null);function Nk({clientId:e,nonce:t,onScriptLoadSuccess:n,onScriptLoadError:g,children:i}){const o=Hk({nonce:t,onScriptLoadSuccess:n,onScriptLoadError:g}),s=H.useMemo(()=>({clientId:e,scriptLoadedSuccessfully:o}),[e,o]);return sn.createElement(Oy.Provider,{value:s},i)}function Fk(){const e=H.useContext(Oy);if(!e)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return e}function xk({flow:e="implicit",scope:t="",onSuccess:n,onError:g,onNonOAuthError:i,overrideScope:o,state:s,...r}){const{clientId:l,scriptLoadedSuccessfully:I}=Fk(),a=H.useRef(),C=H.useRef(n);C.current=n;const c=H.useRef(g);c.current=g;const d=H.useRef(i);d.current=i,H.useEffect(()=>{var f,y;if(!I)return;const Z=e==="implicit"?"initTokenClient":"initCodeClient",p=(y=(f=window==null?void 0:window.google)===null||f===void 0?void 0:f.accounts)===null||y===void 0?void 0:y.oauth2[Z]({client_id:l,scope:o?t:`openid profile email ${t}`,callback:B=>{var W,S;if(B.error)return(W=c.current)===null||W===void 0?void 0:W.call(c,B);(S=C.current)===null||S===void 0||S.call(C,B)},error_callback:B=>{var W;(W=d.current)===null||W===void 0||W.call(d,B)},state:s,...r});a.current=p},[l,I,e,t,s]);const u=H.useCallback(f=>{var y;return(y=a.current)===null||y===void 0?void 0:y.requestAccessToken(f)},[]),h=H.useCallback(()=>{var f;return(f=a.current)===null||f===void 0?void 0:f.requestCode()},[]);return e==="implicit"?u:h}const fh=H.createContext(),Kk=({children:e})=>{const[t,n]=H.useState(null);return H.useEffect(()=>{const g=localStorage.getItem("user");g&&n(JSON.parse(g))},[]),G.jsx(fh.Provider,{value:{user:t,setUser:n},children:e})};var bd={},_y={exports:{}},vn={},qy={exports:{}},$y={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(N,te){var q=N.length;N.push(te);e:for(;0<q;){var me=q-1>>>1,v=N[me];if(0<i(v,te))N[me]=te,N[q]=v,q=me;else break e}}function n(N){return N.length===0?null:N[0]}function g(N){if(N.length===0)return null;var te=N[0],q=N.pop();if(q!==te){N[0]=q;e:for(var me=0,v=N.length,$=v>>>1;me<$;){var Ce=2*(me+1)-1,Be=N[Ce],Ie=Ce+1,K=N[Ie];if(0>i(Be,q))Ie<v&&0>i(K,Be)?(N[me]=K,N[Ie]=q,me=Ie):(N[me]=Be,N[Ce]=q,me=Ce);else if(Ie<v&&0>i(K,q))N[me]=K,N[Ie]=q,me=Ie;else break e}}return te}function i(N,te){var q=N.sortIndex-te.sortIndex;return q!==0?q:N.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,r=s.now();e.unstable_now=function(){return s.now()-r}}var l=[],I=[],a=1,C=null,c=3,d=!1,u=!1,h=!1,f=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function p(N){for(var te=n(I);te!==null;){if(te.callback===null)g(I);else if(te.startTime<=N)g(I),te.sortIndex=te.expirationTime,t(l,te);else break;te=n(I)}}function B(N){if(h=!1,p(N),!u)if(n(l)!==null)u=!0,ie(W);else{var te=n(I);te!==null&&ge(B,te.startTime-N)}}function W(N,te){u=!1,h&&(h=!1,y(R),R=-1),d=!0;var q=c;try{for(p(te),C=n(l);C!==null&&(!(C.expirationTime>te)||N&&!P());){var me=C.callback;if(typeof me=="function"){C.callback=null,c=C.priorityLevel;var v=me(C.expirationTime<=te);te=e.unstable_now(),typeof v=="function"?C.callback=v:C===n(l)&&g(l),p(te)}else g(l);C=n(l)}if(C!==null)var $=!0;else{var Ce=n(I);Ce!==null&&ge(B,Ce.startTime-te),$=!1}return $}finally{C=null,c=q,d=!1}}var S=!1,V=null,R=-1,J=5,M=-1;function P(){return!(e.unstable_now()-M<J)}function X(){if(V!==null){var N=e.unstable_now();M=N;var te=!0;try{te=V(!0,N)}finally{te?L():(S=!1,V=null)}}else S=!1}var L;if(typeof Z=="function")L=function(){Z(X)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,D=ne.port2;ne.port1.onmessage=X,L=function(){D.postMessage(null)}}else L=function(){f(X,0)};function ie(N){V=N,S||(S=!0,L())}function ge(N,te){R=f(function(){N(e.unstable_now())},te)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(N){N.callback=null},e.unstable_continueExecution=function(){u||d||(u=!0,ie(W))},e.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<N?Math.floor(1e3/N):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(N){switch(c){case 1:case 2:case 3:var te=3;break;default:te=c}var q=c;c=te;try{return N()}finally{c=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(N,te){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var q=c;c=N;try{return te()}finally{c=q}},e.unstable_scheduleCallback=function(N,te,q){var me=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?me+q:me):q=me,N){case 1:var v=-1;break;case 2:v=250;break;case 5:v=1073741823;break;case 4:v=1e4;break;default:v=5e3}return v=q+v,N={id:a++,callback:te,priorityLevel:N,startTime:q,expirationTime:v,sortIndex:-1},q>me?(N.sortIndex=q,t(I,N),n(l)===null&&N===n(I)&&(h?(y(R),R=-1):h=!0,ge(B,q-me))):(N.sortIndex=v,t(l,N),u||d||(u=!0,ie(W))),N},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(N){var te=c;return function(){var q=c;c=te;try{return N.apply(this,arguments)}finally{c=q}}}})($y);qy.exports=$y;var Ek=qy.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mk=H,Wn=Ek;function Ge(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var eG=new Set,Ur={};function No(e,t){Ss(e,t),Ss(e+"Capture",t)}function Ss(e,t){for(Ur[e]=t,e=0;e<t.length;e++)eG.add(t[e])}var Eg=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pd=Object.prototype.hasOwnProperty,Tk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Fb={},xb={};function Lk(e){return pd.call(xb,e)?!0:pd.call(Fb,e)?!1:Tk.test(e)?xb[e]=!0:(Fb[e]=!0,!1)}function Uk(e,t,n,g){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return g?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function zk(e,t,n,g){if(t===null||typeof t>"u"||Uk(e,t,n,g))return!0;if(g)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function In(e,t,n,g,i,o,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=g,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var Mt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Mt[e]=new In(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Mt[t]=new In(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Mt[e]=new In(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Mt[e]=new In(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Mt[e]=new In(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Mt[e]=new In(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Mt[e]=new In(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Mt[e]=new In(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Mt[e]=new In(e,5,!1,e.toLowerCase(),null,!1,!1)});var Zh=/[\-:]([a-z])/g;function yh(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Zh,yh);Mt[t]=new In(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Zh,yh);Mt[t]=new In(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Zh,yh);Mt[t]=new In(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Mt[e]=new In(e,1,!1,e.toLowerCase(),null,!1,!1)});Mt.xlinkHref=new In("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Mt[e]=new In(e,1,!1,e.toLowerCase(),null,!0,!0)});function Gh(e,t,n,g){var i=Mt.hasOwnProperty(t)?Mt[t]:null;(i!==null?i.type!==0:g||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(zk(t,n,i,g)&&(n=null),g||i===null?Lk(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:"":n:(t=i.attributeName,g=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,g?e.setAttributeNS(g,t,n):e.setAttribute(t,n))))}var jg=Mk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ll=Symbol.for("react.element"),qo=Symbol.for("react.portal"),$o=Symbol.for("react.fragment"),Bh=Symbol.for("react.strict_mode"),fd=Symbol.for("react.profiler"),tG=Symbol.for("react.provider"),nG=Symbol.for("react.context"),Sh=Symbol.for("react.forward_ref"),Zd=Symbol.for("react.suspense"),yd=Symbol.for("react.suspense_list"),Vh=Symbol.for("react.memo"),li=Symbol.for("react.lazy"),gG=Symbol.for("react.offscreen"),Kb=Symbol.iterator;function Qs(e){return e===null||typeof e!="object"?null:(e=Kb&&e[Kb]||e["@@iterator"],typeof e=="function"?e:null)}var ut=Object.assign,gc;function dr(e){if(gc===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);gc=t&&t[1]||""}return`
`+gc+e}var ic=!1;function oc(e,t){if(!e||ic)return"";ic=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(I){var g=I}Reflect.construct(e,[],t)}else{try{t.call()}catch(I){g=I}e.call(t.prototype)}else{try{throw Error()}catch(I){g=I}e()}}catch(I){if(I&&g&&typeof I.stack=="string"){for(var i=I.stack.split(`
`),o=g.stack.split(`
`),s=i.length-1,r=o.length-1;1<=s&&0<=r&&i[s]!==o[r];)r--;for(;1<=s&&0<=r;s--,r--)if(i[s]!==o[r]){if(s!==1||r!==1)do if(s--,r--,0>r||i[s]!==o[r]){var l=`
`+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=s&&0<=r);break}}}finally{ic=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?dr(e):""}function Dk(e){switch(e.tag){case 5:return dr(e.type);case 16:return dr("Lazy");case 13:return dr("Suspense");case 19:return dr("SuspenseList");case 0:case 2:case 15:return e=oc(e.type,!1),e;case 11:return e=oc(e.type.render,!1),e;case 1:return e=oc(e.type,!0),e;default:return""}}function Gd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case $o:return"Fragment";case qo:return"Portal";case fd:return"Profiler";case Bh:return"StrictMode";case Zd:return"Suspense";case yd:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case nG:return(e.displayName||"Context")+".Consumer";case tG:return(e._context.displayName||"Context")+".Provider";case Sh:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Vh:return t=e.displayName||null,t!==null?t:Gd(e.type)||"Memo";case li:t=e._payload,e=e._init;try{return Gd(e(t))}catch{}}return null}function Qk(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gd(t);case 8:return t===Bh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function wi(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function iG(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function jk(e){var t=iG(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),g=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(s){g=""+s,o.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return g},setValue:function(s){g=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ul(e){e._valueTracker||(e._valueTracker=jk(e))}function oG(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),g="";return e&&(g=iG(e)?e.checked?"true":"false":e.value),e=g,e!==n?(t.setValue(e),!0):!1}function ia(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Bd(e,t){var n=t.checked;return ut({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Eb(e,t){var n=t.defaultValue==null?"":t.defaultValue,g=t.checked!=null?t.checked:t.defaultChecked;n=wi(t.value!=null?t.value:n),e._wrapperState={initialChecked:g,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function sG(e,t){t=t.checked,t!=null&&Gh(e,"checked",t,!1)}function Sd(e,t){sG(e,t);var n=wi(t.value),g=t.type;if(n!=null)g==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(g==="submit"||g==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Vd(e,t.type,n):t.hasOwnProperty("defaultValue")&&Vd(e,t.type,wi(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Mb(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var g=t.type;if(!(g!=="submit"&&g!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Vd(e,t,n){(t!=="number"||ia(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ur=Array.isArray;function ms(e,t,n,g){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&g&&(e[n].defaultSelected=!0)}else{for(n=""+wi(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,g&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function Wd(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ge(91));return ut({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Tb(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Ge(92));if(ur(n)){if(1<n.length)throw Error(Ge(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:wi(n)}}function rG(e,t){var n=wi(t.value),g=wi(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),g!=null&&(e.defaultValue=""+g)}function Lb(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function lG(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Rd(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?lG(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var zl,IG=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,g,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,g,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(zl=zl||document.createElement("div"),zl.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=zl.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function zr(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Vr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Pk=["Webkit","ms","Moz","O"];Object.keys(Vr).forEach(function(e){Pk.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Vr[t]=Vr[e]})});function aG(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Vr.hasOwnProperty(e)&&Vr[e]?(""+t).trim():t+"px"}function CG(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var g=n.indexOf("--")===0,i=aG(n,t[n],g);n==="float"&&(n="cssFloat"),g?e.setProperty(n,i):e[n]=i}}var Ok=ut({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vd(e,t){if(t){if(Ok[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ge(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ge(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Ge(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ge(62))}}function kd(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xd=null;function Wh(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var wd=null,bs=null,ps=null;function Ub(e){if(e=Vl(e)){if(typeof wd!="function")throw Error(Ge(280));var t=e.stateNode;t&&(t=lC(t),wd(e.stateNode,e.type,t))}}function cG(e){bs?ps?ps.push(e):ps=[e]:bs=e}function dG(){if(bs){var e=bs,t=ps;if(ps=bs=null,Ub(e),t)for(e=0;e<t.length;e++)Ub(t[e])}}function uG(e,t){return e(t)}function AG(){}var sc=!1;function hG(e,t,n){if(sc)return e(t,n);sc=!0;try{return uG(e,t,n)}finally{sc=!1,(bs!==null||ps!==null)&&(AG(),dG())}}function Dr(e,t){var n=e.stateNode;if(n===null)return null;var g=lC(n);if(g===null)return null;n=g[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(e=e.type,g=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!g;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Ge(231,t,typeof n));return n}var Jd=!1;if(Eg)try{var js={};Object.defineProperty(js,"passive",{get:function(){Jd=!0}}),window.addEventListener("test",js,js),window.removeEventListener("test",js,js)}catch{Jd=!1}function _k(e,t,n,g,i,o,s,r,l){var I=Array.prototype.slice.call(arguments,3);try{t.apply(n,I)}catch(a){this.onError(a)}}var Wr=!1,oa=null,sa=!1,Yd=null,qk={onError:function(e){Wr=!0,oa=e}};function $k(e,t,n,g,i,o,s,r,l){Wr=!1,oa=null,_k.apply(qk,arguments)}function eX(e,t,n,g,i,o,s,r,l){if($k.apply(this,arguments),Wr){if(Wr){var I=oa;Wr=!1,oa=null}else throw Error(Ge(198));sa||(sa=!0,Yd=I)}}function Fo(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function mG(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function zb(e){if(Fo(e)!==e)throw Error(Ge(188))}function tX(e){var t=e.alternate;if(!t){if(t=Fo(e),t===null)throw Error(Ge(188));return t!==e?null:e}for(var n=e,g=t;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(g=i.return,g!==null){n=g;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return zb(i),e;if(o===g)return zb(i),t;o=o.sibling}throw Error(Ge(188))}if(n.return!==g.return)n=i,g=o;else{for(var s=!1,r=i.child;r;){if(r===n){s=!0,n=i,g=o;break}if(r===g){s=!0,g=i,n=o;break}r=r.sibling}if(!s){for(r=o.child;r;){if(r===n){s=!0,n=o,g=i;break}if(r===g){s=!0,g=o,n=i;break}r=r.sibling}if(!s)throw Error(Ge(189))}}if(n.alternate!==g)throw Error(Ge(190))}if(n.tag!==3)throw Error(Ge(188));return n.stateNode.current===n?e:t}function bG(e){return e=tX(e),e!==null?pG(e):null}function pG(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=pG(e);if(t!==null)return t;e=e.sibling}return null}var fG=Wn.unstable_scheduleCallback,Db=Wn.unstable_cancelCallback,nX=Wn.unstable_shouldYield,gX=Wn.unstable_requestPaint,yt=Wn.unstable_now,iX=Wn.unstable_getCurrentPriorityLevel,Rh=Wn.unstable_ImmediatePriority,ZG=Wn.unstable_UserBlockingPriority,ra=Wn.unstable_NormalPriority,oX=Wn.unstable_LowPriority,yG=Wn.unstable_IdlePriority,iC=null,Ag=null;function sX(e){if(Ag&&typeof Ag.onCommitFiberRoot=="function")try{Ag.onCommitFiberRoot(iC,e,void 0,(e.current.flags&128)===128)}catch{}}var $n=Math.clz32?Math.clz32:IX,rX=Math.log,lX=Math.LN2;function IX(e){return e>>>=0,e===0?32:31-(rX(e)/lX|0)|0}var Dl=64,Ql=4194304;function Ar(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function la(e,t){var n=e.pendingLanes;if(n===0)return 0;var g=0,i=e.suspendedLanes,o=e.pingedLanes,s=n&268435455;if(s!==0){var r=s&~i;r!==0?g=Ar(r):(o&=s,o!==0&&(g=Ar(o)))}else s=n&~i,s!==0?g=Ar(s):o!==0&&(g=Ar(o));if(g===0)return 0;if(t!==0&&t!==g&&!(t&i)&&(i=g&-g,o=t&-t,i>=o||i===16&&(o&4194240)!==0))return t;if(g&4&&(g|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=g;0<t;)n=31-$n(t),i=1<<n,g|=e[n],t&=~i;return g}function aX(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CX(e,t){for(var n=e.suspendedLanes,g=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-$n(o),r=1<<s,l=i[s];l===-1?(!(r&n)||r&g)&&(i[s]=aX(r,t)):l<=t&&(e.expiredLanes|=r),o&=~r}}function Hd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function GG(){var e=Dl;return Dl<<=1,!(Dl&4194240)&&(Dl=64),e}function rc(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Bl(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-$n(t),e[t]=n}function cX(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var g=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-$n(n),o=1<<i;t[i]=0,g[i]=-1,e[i]=-1,n&=~o}}function vh(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var g=31-$n(n),i=1<<g;i&t|e[g]&t&&(e[g]|=t),n&=~i}}var je=0;function BG(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var SG,kh,VG,WG,RG,Nd=!1,jl=[],pi=null,fi=null,Zi=null,Qr=new Map,jr=new Map,Ci=[],dX="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Qb(e,t){switch(e){case"focusin":case"focusout":pi=null;break;case"dragenter":case"dragleave":fi=null;break;case"mouseover":case"mouseout":Zi=null;break;case"pointerover":case"pointerout":Qr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":jr.delete(t.pointerId)}}function Ps(e,t,n,g,i,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:g,nativeEvent:o,targetContainers:[i]},t!==null&&(t=Vl(t),t!==null&&kh(t)),e):(e.eventSystemFlags|=g,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function uX(e,t,n,g,i){switch(t){case"focusin":return pi=Ps(pi,e,t,n,g,i),!0;case"dragenter":return fi=Ps(fi,e,t,n,g,i),!0;case"mouseover":return Zi=Ps(Zi,e,t,n,g,i),!0;case"pointerover":var o=i.pointerId;return Qr.set(o,Ps(Qr.get(o)||null,e,t,n,g,i)),!0;case"gotpointercapture":return o=i.pointerId,jr.set(o,Ps(jr.get(o)||null,e,t,n,g,i)),!0}return!1}function vG(e){var t=ro(e.target);if(t!==null){var n=Fo(t);if(n!==null){if(t=n.tag,t===13){if(t=mG(n),t!==null){e.blockedOn=t,RG(e.priority,function(){VG(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function kI(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Fd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var g=new n.constructor(n.type,n);Xd=g,n.target.dispatchEvent(g),Xd=null}else return t=Vl(n),t!==null&&kh(t),e.blockedOn=n,!1;t.shift()}return!0}function jb(e,t,n){kI(e)&&n.delete(t)}function AX(){Nd=!1,pi!==null&&kI(pi)&&(pi=null),fi!==null&&kI(fi)&&(fi=null),Zi!==null&&kI(Zi)&&(Zi=null),Qr.forEach(jb),jr.forEach(jb)}function Os(e,t){e.blockedOn===t&&(e.blockedOn=null,Nd||(Nd=!0,Wn.unstable_scheduleCallback(Wn.unstable_NormalPriority,AX)))}function Pr(e){function t(i){return Os(i,e)}if(0<jl.length){Os(jl[0],e);for(var n=1;n<jl.length;n++){var g=jl[n];g.blockedOn===e&&(g.blockedOn=null)}}for(pi!==null&&Os(pi,e),fi!==null&&Os(fi,e),Zi!==null&&Os(Zi,e),Qr.forEach(t),jr.forEach(t),n=0;n<Ci.length;n++)g=Ci[n],g.blockedOn===e&&(g.blockedOn=null);for(;0<Ci.length&&(n=Ci[0],n.blockedOn===null);)vG(n),n.blockedOn===null&&Ci.shift()}var fs=jg.ReactCurrentBatchConfig,Ia=!0;function hX(e,t,n,g){var i=je,o=fs.transition;fs.transition=null;try{je=1,Xh(e,t,n,g)}finally{je=i,fs.transition=o}}function mX(e,t,n,g){var i=je,o=fs.transition;fs.transition=null;try{je=4,Xh(e,t,n,g)}finally{je=i,fs.transition=o}}function Xh(e,t,n,g){if(Ia){var i=Fd(e,t,n,g);if(i===null)mc(e,t,g,aa,n),Qb(e,g);else if(uX(i,e,t,n,g))g.stopPropagation();else if(Qb(e,g),t&4&&-1<dX.indexOf(e)){for(;i!==null;){var o=Vl(i);if(o!==null&&SG(o),o=Fd(e,t,n,g),o===null&&mc(e,t,g,aa,n),o===i)break;i=o}i!==null&&g.stopPropagation()}else mc(e,t,g,null,n)}}var aa=null;function Fd(e,t,n,g){if(aa=null,e=Wh(g),e=ro(e),e!==null)if(t=Fo(e),t===null)e=null;else if(n=t.tag,n===13){if(e=mG(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return aa=e,null}function kG(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(iX()){case Rh:return 1;case ZG:return 4;case ra:case oX:return 16;case yG:return 536870912;default:return 16}default:return 16}}var di=null,wh=null,XI=null;function XG(){if(XI)return XI;var e,t=wh,n=t.length,g,i="value"in di?di.value:di.textContent,o=i.length;for(e=0;e<n&&t[e]===i[e];e++);var s=n-e;for(g=1;g<=s&&t[n-g]===i[o-g];g++);return XI=i.slice(e,1<g?1-g:void 0)}function wI(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Pl(){return!0}function Pb(){return!1}function kn(e){function t(n,g,i,o,s){this._reactName=n,this._targetInst=i,this.type=g,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var r in e)e.hasOwnProperty(r)&&(n=e[r],this[r]=n?n(o):o[r]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Pl:Pb,this.isPropagationStopped=Pb,this}return ut(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Pl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Pl)},persist:function(){},isPersistent:Pl}),t}var xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jh=kn(xs),Sl=ut({},xs,{view:0,detail:0}),bX=kn(Sl),lc,Ic,_s,oC=ut({},Sl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yh,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==_s&&(_s&&e.type==="mousemove"?(lc=e.screenX-_s.screenX,Ic=e.screenY-_s.screenY):Ic=lc=0,_s=e),lc)},movementY:function(e){return"movementY"in e?e.movementY:Ic}}),Ob=kn(oC),pX=ut({},oC,{dataTransfer:0}),fX=kn(pX),ZX=ut({},Sl,{relatedTarget:0}),ac=kn(ZX),yX=ut({},xs,{animationName:0,elapsedTime:0,pseudoElement:0}),GX=kn(yX),BX=ut({},xs,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),SX=kn(BX),VX=ut({},xs,{data:0}),_b=kn(VX),WX={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RX={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vX={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kX(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=vX[e])?!!t[e]:!1}function Yh(){return kX}var XX=ut({},Sl,{key:function(e){if(e.key){var t=WX[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=wI(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?RX[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yh,charCode:function(e){return e.type==="keypress"?wI(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?wI(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),wX=kn(XX),JX=ut({},oC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qb=kn(JX),YX=ut({},Sl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yh}),HX=kn(YX),NX=ut({},xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),FX=kn(NX),xX=ut({},oC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),KX=kn(xX),EX=[9,13,27,32],Hh=Eg&&"CompositionEvent"in window,Rr=null;Eg&&"documentMode"in document&&(Rr=document.documentMode);var MX=Eg&&"TextEvent"in window&&!Rr,wG=Eg&&(!Hh||Rr&&8<Rr&&11>=Rr),$b=" ",ep=!1;function JG(e,t){switch(e){case"keyup":return EX.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function YG(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var es=!1;function TX(e,t){switch(e){case"compositionend":return YG(t);case"keypress":return t.which!==32?null:(ep=!0,$b);case"textInput":return e=t.data,e===$b&&ep?null:e;default:return null}}function LX(e,t){if(es)return e==="compositionend"||!Hh&&JG(e,t)?(e=XG(),XI=wh=di=null,es=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return wG&&t.locale!=="ko"?null:t.data;default:return null}}var UX={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!UX[e.type]:t==="textarea"}function HG(e,t,n,g){cG(g),t=Ca(t,"onChange"),0<t.length&&(n=new Jh("onChange","change",null,n,g),e.push({event:n,listeners:t}))}var vr=null,Or=null;function zX(e){DG(e,0)}function sC(e){var t=gs(e);if(oG(t))return e}function DX(e,t){if(e==="change")return t}var NG=!1;if(Eg){var Cc;if(Eg){var cc="oninput"in document;if(!cc){var np=document.createElement("div");np.setAttribute("oninput","return;"),cc=typeof np.oninput=="function"}Cc=cc}else Cc=!1;NG=Cc&&(!document.documentMode||9<document.documentMode)}function gp(){vr&&(vr.detachEvent("onpropertychange",FG),Or=vr=null)}function FG(e){if(e.propertyName==="value"&&sC(Or)){var t=[];HG(t,Or,e,Wh(e)),hG(zX,t)}}function QX(e,t,n){e==="focusin"?(gp(),vr=t,Or=n,vr.attachEvent("onpropertychange",FG)):e==="focusout"&&gp()}function jX(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return sC(Or)}function PX(e,t){if(e==="click")return sC(t)}function OX(e,t){if(e==="input"||e==="change")return sC(t)}function _X(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ng=typeof Object.is=="function"?Object.is:_X;function _r(e,t){if(ng(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),g=Object.keys(t);if(n.length!==g.length)return!1;for(g=0;g<n.length;g++){var i=n[g];if(!pd.call(t,i)||!ng(e[i],t[i]))return!1}return!0}function ip(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function op(e,t){var n=ip(e);e=0;for(var g;n;){if(n.nodeType===3){if(g=e+n.textContent.length,e<=t&&g>=t)return{node:n,offset:t-e};e=g}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ip(n)}}function xG(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?xG(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function KG(){for(var e=window,t=ia();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=ia(e.document)}return t}function Nh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function qX(e){var t=KG(),n=e.focusedElem,g=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&xG(n.ownerDocument.documentElement,n)){if(g!==null&&Nh(n)){if(t=g.start,e=g.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(g.start,i);g=g.end===void 0?o:Math.min(g.end,i),!e.extend&&o>g&&(i=g,g=o,o=i),i=op(n,o);var s=op(n,g);i&&s&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),o>g?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var $X=Eg&&"documentMode"in document&&11>=document.documentMode,ts=null,xd=null,kr=null,Kd=!1;function sp(e,t,n){var g=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Kd||ts==null||ts!==ia(g)||(g=ts,"selectionStart"in g&&Nh(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),kr&&_r(kr,g)||(kr=g,g=Ca(xd,"onSelect"),0<g.length&&(t=new Jh("onSelect","select",null,t,n),e.push({event:t,listeners:g}),t.target=ts)))}function Ol(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ns={animationend:Ol("Animation","AnimationEnd"),animationiteration:Ol("Animation","AnimationIteration"),animationstart:Ol("Animation","AnimationStart"),transitionend:Ol("Transition","TransitionEnd")},dc={},EG={};Eg&&(EG=document.createElement("div").style,"AnimationEvent"in window||(delete ns.animationend.animation,delete ns.animationiteration.animation,delete ns.animationstart.animation),"TransitionEvent"in window||delete ns.transitionend.transition);function rC(e){if(dc[e])return dc[e];if(!ns[e])return e;var t=ns[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in EG)return dc[e]=t[n];return e}var MG=rC("animationend"),TG=rC("animationiteration"),LG=rC("animationstart"),UG=rC("transitionend"),zG=new Map,rp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fi(e,t){zG.set(e,t),No(t,[e])}for(var uc=0;uc<rp.length;uc++){var Ac=rp[uc],e2=Ac.toLowerCase(),t2=Ac[0].toUpperCase()+Ac.slice(1);Fi(e2,"on"+t2)}Fi(MG,"onAnimationEnd");Fi(TG,"onAnimationIteration");Fi(LG,"onAnimationStart");Fi("dblclick","onDoubleClick");Fi("focusin","onFocus");Fi("focusout","onBlur");Fi(UG,"onTransitionEnd");Ss("onMouseEnter",["mouseout","mouseover"]);Ss("onMouseLeave",["mouseout","mouseover"]);Ss("onPointerEnter",["pointerout","pointerover"]);Ss("onPointerLeave",["pointerout","pointerover"]);No("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));No("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));No("onBeforeInput",["compositionend","keypress","textInput","paste"]);No("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));No("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));No("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n2=new Set("cancel close invalid load scroll toggle".split(" ").concat(hr));function lp(e,t,n){var g=e.type||"unknown-event";e.currentTarget=n,eX(g,t,void 0,e),e.currentTarget=null}function DG(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var g=e[n],i=g.event;g=g.listeners;e:{var o=void 0;if(t)for(var s=g.length-1;0<=s;s--){var r=g[s],l=r.instance,I=r.currentTarget;if(r=r.listener,l!==o&&i.isPropagationStopped())break e;lp(i,r,I),o=l}else for(s=0;s<g.length;s++){if(r=g[s],l=r.instance,I=r.currentTarget,r=r.listener,l!==o&&i.isPropagationStopped())break e;lp(i,r,I),o=l}}}if(sa)throw e=Yd,sa=!1,Yd=null,e}function gt(e,t){var n=t[Ud];n===void 0&&(n=t[Ud]=new Set);var g=e+"__bubble";n.has(g)||(QG(t,e,2,!1),n.add(g))}function hc(e,t,n){var g=0;t&&(g|=4),QG(n,e,g,t)}var _l="_reactListening"+Math.random().toString(36).slice(2);function qr(e){if(!e[_l]){e[_l]=!0,eG.forEach(function(n){n!=="selectionchange"&&(n2.has(n)||hc(n,!1,e),hc(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[_l]||(t[_l]=!0,hc("selectionchange",!1,t))}}function QG(e,t,n,g){switch(kG(t)){case 1:var i=hX;break;case 4:i=mX;break;default:i=Xh}n=i.bind(null,t,n,e),i=void 0,!Jd||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),g?i!==void 0?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):i!==void 0?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function mc(e,t,n,g,i){var o=g;if(!(t&1)&&!(t&2)&&g!==null)e:for(;;){if(g===null)return;var s=g.tag;if(s===3||s===4){var r=g.stateNode.containerInfo;if(r===i||r.nodeType===8&&r.parentNode===i)break;if(s===4)for(s=g.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;r!==null;){if(s=ro(r),s===null)return;if(l=s.tag,l===5||l===6){g=o=s;continue e}r=r.parentNode}}g=g.return}hG(function(){var I=o,a=Wh(n),C=[];e:{var c=zG.get(e);if(c!==void 0){var d=Jh,u=e;switch(e){case"keypress":if(wI(n)===0)break e;case"keydown":case"keyup":d=wX;break;case"focusin":u="focus",d=ac;break;case"focusout":u="blur",d=ac;break;case"beforeblur":case"afterblur":d=ac;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Ob;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=fX;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=HX;break;case MG:case TG:case LG:d=GX;break;case UG:d=FX;break;case"scroll":d=bX;break;case"wheel":d=KX;break;case"copy":case"cut":case"paste":d=SX;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=qb}var h=(t&4)!==0,f=!h&&e==="scroll",y=h?c!==null?c+"Capture":null:c;h=[];for(var Z=I,p;Z!==null;){p=Z;var B=p.stateNode;if(p.tag===5&&B!==null&&(p=B,y!==null&&(B=Dr(Z,y),B!=null&&h.push($r(Z,B,p)))),f)break;Z=Z.return}0<h.length&&(c=new d(c,u,null,n,a),C.push({event:c,listeners:h}))}}if(!(t&7)){e:{if(c=e==="mouseover"||e==="pointerover",d=e==="mouseout"||e==="pointerout",c&&n!==Xd&&(u=n.relatedTarget||n.fromElement)&&(ro(u)||u[Mg]))break e;if((d||c)&&(c=a.window===a?a:(c=a.ownerDocument)?c.defaultView||c.parentWindow:window,d?(u=n.relatedTarget||n.toElement,d=I,u=u?ro(u):null,u!==null&&(f=Fo(u),u!==f||u.tag!==5&&u.tag!==6)&&(u=null)):(d=null,u=I),d!==u)){if(h=Ob,B="onMouseLeave",y="onMouseEnter",Z="mouse",(e==="pointerout"||e==="pointerover")&&(h=qb,B="onPointerLeave",y="onPointerEnter",Z="pointer"),f=d==null?c:gs(d),p=u==null?c:gs(u),c=new h(B,Z+"leave",d,n,a),c.target=f,c.relatedTarget=p,B=null,ro(a)===I&&(h=new h(y,Z+"enter",u,n,a),h.target=p,h.relatedTarget=f,B=h),f=B,d&&u)t:{for(h=d,y=u,Z=0,p=h;p;p=Do(p))Z++;for(p=0,B=y;B;B=Do(B))p++;for(;0<Z-p;)h=Do(h),Z--;for(;0<p-Z;)y=Do(y),p--;for(;Z--;){if(h===y||y!==null&&h===y.alternate)break t;h=Do(h),y=Do(y)}h=null}else h=null;d!==null&&Ip(C,c,d,h,!1),u!==null&&f!==null&&Ip(C,f,u,h,!0)}}e:{if(c=I?gs(I):window,d=c.nodeName&&c.nodeName.toLowerCase(),d==="select"||d==="input"&&c.type==="file")var W=DX;else if(tp(c))if(NG)W=OX;else{W=jX;var S=QX}else(d=c.nodeName)&&d.toLowerCase()==="input"&&(c.type==="checkbox"||c.type==="radio")&&(W=PX);if(W&&(W=W(e,I))){HG(C,W,n,a);break e}S&&S(e,c,I),e==="focusout"&&(S=c._wrapperState)&&S.controlled&&c.type==="number"&&Vd(c,"number",c.value)}switch(S=I?gs(I):window,e){case"focusin":(tp(S)||S.contentEditable==="true")&&(ts=S,xd=I,kr=null);break;case"focusout":kr=xd=ts=null;break;case"mousedown":Kd=!0;break;case"contextmenu":case"mouseup":case"dragend":Kd=!1,sp(C,n,a);break;case"selectionchange":if($X)break;case"keydown":case"keyup":sp(C,n,a)}var V;if(Hh)e:{switch(e){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else es?JG(e,n)&&(R="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(R="onCompositionStart");R&&(wG&&n.locale!=="ko"&&(es||R!=="onCompositionStart"?R==="onCompositionEnd"&&es&&(V=XG()):(di=a,wh="value"in di?di.value:di.textContent,es=!0)),S=Ca(I,R),0<S.length&&(R=new _b(R,e,null,n,a),C.push({event:R,listeners:S}),V?R.data=V:(V=YG(n),V!==null&&(R.data=V)))),(V=MX?TX(e,n):LX(e,n))&&(I=Ca(I,"onBeforeInput"),0<I.length&&(a=new _b("onBeforeInput","beforeinput",null,n,a),C.push({event:a,listeners:I}),a.data=V))}DG(C,t)})}function $r(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ca(e,t){for(var n=t+"Capture",g=[];e!==null;){var i=e,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Dr(e,n),o!=null&&g.unshift($r(e,o,i)),o=Dr(e,t),o!=null&&g.push($r(e,o,i))),e=e.return}return g}function Do(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Ip(e,t,n,g,i){for(var o=t._reactName,s=[];n!==null&&n!==g;){var r=n,l=r.alternate,I=r.stateNode;if(l!==null&&l===g)break;r.tag===5&&I!==null&&(r=I,i?(l=Dr(n,o),l!=null&&s.unshift($r(n,l,r))):i||(l=Dr(n,o),l!=null&&s.push($r(n,l,r)))),n=n.return}s.length!==0&&e.push({event:t,listeners:s})}var g2=/\r\n?/g,i2=/\u0000|\uFFFD/g;function ap(e){return(typeof e=="string"?e:""+e).replace(g2,`
`).replace(i2,"")}function ql(e,t,n){if(t=ap(t),ap(e)!==t&&n)throw Error(Ge(425))}function ca(){}var Ed=null,Md=null;function Td(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ld=typeof setTimeout=="function"?setTimeout:void 0,o2=typeof clearTimeout=="function"?clearTimeout:void 0,Cp=typeof Promise=="function"?Promise:void 0,s2=typeof queueMicrotask=="function"?queueMicrotask:typeof Cp<"u"?function(e){return Cp.resolve(null).then(e).catch(r2)}:Ld;function r2(e){setTimeout(function(){throw e})}function bc(e,t){var n=t,g=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(g===0){e.removeChild(i),Pr(t);return}g--}else n!=="$"&&n!=="$?"&&n!=="$!"||g++;n=i}while(n);Pr(t)}function yi(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function cp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Ks=Math.random().toString(36).slice(2),Cg="__reactFiber$"+Ks,el="__reactProps$"+Ks,Mg="__reactContainer$"+Ks,Ud="__reactEvents$"+Ks,l2="__reactListeners$"+Ks,I2="__reactHandles$"+Ks;function ro(e){var t=e[Cg];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Mg]||n[Cg]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=cp(e);e!==null;){if(n=e[Cg])return n;e=cp(e)}return t}e=n,n=e.parentNode}return null}function Vl(e){return e=e[Cg]||e[Mg],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function gs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Ge(33))}function lC(e){return e[el]||null}var zd=[],is=-1;function xi(e){return{current:e}}function it(e){0>is||(e.current=zd[is],zd[is]=null,is--)}function nt(e,t){is++,zd[is]=e.current,e.current=t}var Ji={},$t=xi(Ji),hn=xi(!1),So=Ji;function Vs(e,t){var n=e.type.contextTypes;if(!n)return Ji;var g=e.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===t)return g.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=t[o];return g&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function mn(e){return e=e.childContextTypes,e!=null}function da(){it(hn),it($t)}function dp(e,t,n){if($t.current!==Ji)throw Error(Ge(168));nt($t,t),nt(hn,n)}function jG(e,t,n){var g=e.stateNode;if(t=t.childContextTypes,typeof g.getChildContext!="function")return n;g=g.getChildContext();for(var i in g)if(!(i in t))throw Error(Ge(108,Qk(e)||"Unknown",i));return ut({},n,g)}function ua(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ji,So=$t.current,nt($t,e),nt(hn,hn.current),!0}function up(e,t,n){var g=e.stateNode;if(!g)throw Error(Ge(169));n?(e=jG(e,t,So),g.__reactInternalMemoizedMergedChildContext=e,it(hn),it($t),nt($t,e)):it(hn),nt(hn,n)}var Rg=null,IC=!1,pc=!1;function PG(e){Rg===null?Rg=[e]:Rg.push(e)}function a2(e){IC=!0,PG(e)}function Ki(){if(!pc&&Rg!==null){pc=!0;var e=0,t=je;try{var n=Rg;for(je=1;e<n.length;e++){var g=n[e];do g=g(!0);while(g!==null)}Rg=null,IC=!1}catch(i){throw Rg!==null&&(Rg=Rg.slice(e+1)),fG(Rh,Ki),i}finally{je=t,pc=!1}}return null}var os=[],ss=0,Aa=null,ha=0,Fn=[],xn=0,Vo=null,Xg=1,wg="";function eo(e,t){os[ss++]=ha,os[ss++]=Aa,Aa=e,ha=t}function OG(e,t,n){Fn[xn++]=Xg,Fn[xn++]=wg,Fn[xn++]=Vo,Vo=e;var g=Xg;e=wg;var i=32-$n(g)-1;g&=~(1<<i),n+=1;var o=32-$n(t)+i;if(30<o){var s=i-i%5;o=(g&(1<<s)-1).toString(32),g>>=s,i-=s,Xg=1<<32-$n(t)+i|n<<i|g,wg=o+e}else Xg=1<<o|n<<i|g,wg=e}function Fh(e){e.return!==null&&(eo(e,1),OG(e,1,0))}function xh(e){for(;e===Aa;)Aa=os[--ss],os[ss]=null,ha=os[--ss],os[ss]=null;for(;e===Vo;)Vo=Fn[--xn],Fn[xn]=null,wg=Fn[--xn],Fn[xn]=null,Xg=Fn[--xn],Fn[xn]=null}var Vn=null,Sn=null,lt=!1,qn=null;function _G(e,t){var n=Kn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Ap(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Vn=e,Sn=yi(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Vn=e,Sn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Vo!==null?{id:Xg,overflow:wg}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Kn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Vn=e,Sn=null,!0):!1;default:return!1}}function Dd(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Qd(e){if(lt){var t=Sn;if(t){var n=t;if(!Ap(e,t)){if(Dd(e))throw Error(Ge(418));t=yi(n.nextSibling);var g=Vn;t&&Ap(e,t)?_G(g,n):(e.flags=e.flags&-4097|2,lt=!1,Vn=e)}}else{if(Dd(e))throw Error(Ge(418));e.flags=e.flags&-4097|2,lt=!1,Vn=e}}}function hp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Vn=e}function $l(e){if(e!==Vn)return!1;if(!lt)return hp(e),lt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Td(e.type,e.memoizedProps)),t&&(t=Sn)){if(Dd(e))throw qG(),Error(Ge(418));for(;t;)_G(e,t),t=yi(t.nextSibling)}if(hp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Ge(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Sn=yi(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Sn=null}}else Sn=Vn?yi(e.stateNode.nextSibling):null;return!0}function qG(){for(var e=Sn;e;)e=yi(e.nextSibling)}function Ws(){Sn=Vn=null,lt=!1}function Kh(e){qn===null?qn=[e]:qn.push(e)}var C2=jg.ReactCurrentBatchConfig;function qs(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ge(309));var g=n.stateNode}if(!g)throw Error(Ge(147,e));var i=g,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(s){var r=i.refs;s===null?delete r[o]:r[o]=s},t._stringRef=o,t)}if(typeof e!="string")throw Error(Ge(284));if(!n._owner)throw Error(Ge(290,e))}return e}function eI(e,t){throw e=Object.prototype.toString.call(t),Error(Ge(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function mp(e){var t=e._init;return t(e._payload)}function $G(e){function t(y,Z){if(e){var p=y.deletions;p===null?(y.deletions=[Z],y.flags|=16):p.push(Z)}}function n(y,Z){if(!e)return null;for(;Z!==null;)t(y,Z),Z=Z.sibling;return null}function g(y,Z){for(y=new Map;Z!==null;)Z.key!==null?y.set(Z.key,Z):y.set(Z.index,Z),Z=Z.sibling;return y}function i(y,Z){return y=Vi(y,Z),y.index=0,y.sibling=null,y}function o(y,Z,p){return y.index=p,e?(p=y.alternate,p!==null?(p=p.index,p<Z?(y.flags|=2,Z):p):(y.flags|=2,Z)):(y.flags|=1048576,Z)}function s(y){return e&&y.alternate===null&&(y.flags|=2),y}function r(y,Z,p,B){return Z===null||Z.tag!==6?(Z=Vc(p,y.mode,B),Z.return=y,Z):(Z=i(Z,p),Z.return=y,Z)}function l(y,Z,p,B){var W=p.type;return W===$o?a(y,Z,p.props.children,B,p.key):Z!==null&&(Z.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===li&&mp(W)===Z.type)?(B=i(Z,p.props),B.ref=qs(y,Z,p),B.return=y,B):(B=KI(p.type,p.key,p.props,null,y.mode,B),B.ref=qs(y,Z,p),B.return=y,B)}function I(y,Z,p,B){return Z===null||Z.tag!==4||Z.stateNode.containerInfo!==p.containerInfo||Z.stateNode.implementation!==p.implementation?(Z=Wc(p,y.mode,B),Z.return=y,Z):(Z=i(Z,p.children||[]),Z.return=y,Z)}function a(y,Z,p,B,W){return Z===null||Z.tag!==7?(Z=ho(p,y.mode,B,W),Z.return=y,Z):(Z=i(Z,p),Z.return=y,Z)}function C(y,Z,p){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return Z=Vc(""+Z,y.mode,p),Z.return=y,Z;if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case Ll:return p=KI(Z.type,Z.key,Z.props,null,y.mode,p),p.ref=qs(y,null,Z),p.return=y,p;case qo:return Z=Wc(Z,y.mode,p),Z.return=y,Z;case li:var B=Z._init;return C(y,B(Z._payload),p)}if(ur(Z)||Qs(Z))return Z=ho(Z,y.mode,p,null),Z.return=y,Z;eI(y,Z)}return null}function c(y,Z,p,B){var W=Z!==null?Z.key:null;if(typeof p=="string"&&p!==""||typeof p=="number")return W!==null?null:r(y,Z,""+p,B);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Ll:return p.key===W?l(y,Z,p,B):null;case qo:return p.key===W?I(y,Z,p,B):null;case li:return W=p._init,c(y,Z,W(p._payload),B)}if(ur(p)||Qs(p))return W!==null?null:a(y,Z,p,B,null);eI(y,p)}return null}function d(y,Z,p,B,W){if(typeof B=="string"&&B!==""||typeof B=="number")return y=y.get(p)||null,r(Z,y,""+B,W);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case Ll:return y=y.get(B.key===null?p:B.key)||null,l(Z,y,B,W);case qo:return y=y.get(B.key===null?p:B.key)||null,I(Z,y,B,W);case li:var S=B._init;return d(y,Z,p,S(B._payload),W)}if(ur(B)||Qs(B))return y=y.get(p)||null,a(Z,y,B,W,null);eI(Z,B)}return null}function u(y,Z,p,B){for(var W=null,S=null,V=Z,R=Z=0,J=null;V!==null&&R<p.length;R++){V.index>R?(J=V,V=null):J=V.sibling;var M=c(y,V,p[R],B);if(M===null){V===null&&(V=J);break}e&&V&&M.alternate===null&&t(y,V),Z=o(M,Z,R),S===null?W=M:S.sibling=M,S=M,V=J}if(R===p.length)return n(y,V),lt&&eo(y,R),W;if(V===null){for(;R<p.length;R++)V=C(y,p[R],B),V!==null&&(Z=o(V,Z,R),S===null?W=V:S.sibling=V,S=V);return lt&&eo(y,R),W}for(V=g(y,V);R<p.length;R++)J=d(V,y,R,p[R],B),J!==null&&(e&&J.alternate!==null&&V.delete(J.key===null?R:J.key),Z=o(J,Z,R),S===null?W=J:S.sibling=J,S=J);return e&&V.forEach(function(P){return t(y,P)}),lt&&eo(y,R),W}function h(y,Z,p,B){var W=Qs(p);if(typeof W!="function")throw Error(Ge(150));if(p=W.call(p),p==null)throw Error(Ge(151));for(var S=W=null,V=Z,R=Z=0,J=null,M=p.next();V!==null&&!M.done;R++,M=p.next()){V.index>R?(J=V,V=null):J=V.sibling;var P=c(y,V,M.value,B);if(P===null){V===null&&(V=J);break}e&&V&&P.alternate===null&&t(y,V),Z=o(P,Z,R),S===null?W=P:S.sibling=P,S=P,V=J}if(M.done)return n(y,V),lt&&eo(y,R),W;if(V===null){for(;!M.done;R++,M=p.next())M=C(y,M.value,B),M!==null&&(Z=o(M,Z,R),S===null?W=M:S.sibling=M,S=M);return lt&&eo(y,R),W}for(V=g(y,V);!M.done;R++,M=p.next())M=d(V,y,R,M.value,B),M!==null&&(e&&M.alternate!==null&&V.delete(M.key===null?R:M.key),Z=o(M,Z,R),S===null?W=M:S.sibling=M,S=M);return e&&V.forEach(function(X){return t(y,X)}),lt&&eo(y,R),W}function f(y,Z,p,B){if(typeof p=="object"&&p!==null&&p.type===$o&&p.key===null&&(p=p.props.children),typeof p=="object"&&p!==null){switch(p.$$typeof){case Ll:e:{for(var W=p.key,S=Z;S!==null;){if(S.key===W){if(W=p.type,W===$o){if(S.tag===7){n(y,S.sibling),Z=i(S,p.props.children),Z.return=y,y=Z;break e}}else if(S.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===li&&mp(W)===S.type){n(y,S.sibling),Z=i(S,p.props),Z.ref=qs(y,S,p),Z.return=y,y=Z;break e}n(y,S);break}else t(y,S);S=S.sibling}p.type===$o?(Z=ho(p.props.children,y.mode,B,p.key),Z.return=y,y=Z):(B=KI(p.type,p.key,p.props,null,y.mode,B),B.ref=qs(y,Z,p),B.return=y,y=B)}return s(y);case qo:e:{for(S=p.key;Z!==null;){if(Z.key===S)if(Z.tag===4&&Z.stateNode.containerInfo===p.containerInfo&&Z.stateNode.implementation===p.implementation){n(y,Z.sibling),Z=i(Z,p.children||[]),Z.return=y,y=Z;break e}else{n(y,Z);break}else t(y,Z);Z=Z.sibling}Z=Wc(p,y.mode,B),Z.return=y,y=Z}return s(y);case li:return S=p._init,f(y,Z,S(p._payload),B)}if(ur(p))return u(y,Z,p,B);if(Qs(p))return h(y,Z,p,B);eI(y,p)}return typeof p=="string"&&p!==""||typeof p=="number"?(p=""+p,Z!==null&&Z.tag===6?(n(y,Z.sibling),Z=i(Z,p),Z.return=y,y=Z):(n(y,Z),Z=Vc(p,y.mode,B),Z.return=y,y=Z),s(y)):n(y,Z)}return f}var Rs=$G(!0),eB=$G(!1),ma=xi(null),ba=null,rs=null,Eh=null;function Mh(){Eh=rs=ba=null}function Th(e){var t=ma.current;it(ma),e._currentValue=t}function jd(e,t,n){for(;e!==null;){var g=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,g!==null&&(g.childLanes|=t)):g!==null&&(g.childLanes&t)!==t&&(g.childLanes|=t),e===n)break;e=e.return}}function Zs(e,t){ba=e,Eh=rs=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(un=!0),e.firstContext=null)}function Ln(e){var t=e._currentValue;if(Eh!==e)if(e={context:e,memoizedValue:t,next:null},rs===null){if(ba===null)throw Error(Ge(308));rs=e,ba.dependencies={lanes:0,firstContext:e}}else rs=rs.next=e;return t}var lo=null;function Lh(e){lo===null?lo=[e]:lo.push(e)}function tB(e,t,n,g){var i=t.interleaved;return i===null?(n.next=n,Lh(t)):(n.next=i.next,i.next=n),t.interleaved=n,Tg(e,g)}function Tg(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Ii=!1;function Uh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function nB(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ng(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Gi(e,t,n){var g=e.updateQueue;if(g===null)return null;if(g=g.shared,Ee&2){var i=g.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),g.pending=t,Tg(e,n)}return i=g.interleaved,i===null?(t.next=t,Lh(g)):(t.next=i.next,i.next=t),g.interleaved=t,Tg(e,n)}function JI(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var g=t.lanes;g&=e.pendingLanes,n|=g,t.lanes=n,vh(e,n)}}function bp(e,t){var n=e.updateQueue,g=e.alternate;if(g!==null&&(g=g.updateQueue,n===g)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?i=o=t:o=o.next=t}else i=o=t;n={baseState:g.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:g.shared,effects:g.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function pa(e,t,n,g){var i=e.updateQueue;Ii=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,r=i.shared.pending;if(r!==null){i.shared.pending=null;var l=r,I=l.next;l.next=null,s===null?o=I:s.next=I,s=l;var a=e.alternate;a!==null&&(a=a.updateQueue,r=a.lastBaseUpdate,r!==s&&(r===null?a.firstBaseUpdate=I:r.next=I,a.lastBaseUpdate=l))}if(o!==null){var C=i.baseState;s=0,a=I=l=null,r=o;do{var c=r.lane,d=r.eventTime;if((g&c)===c){a!==null&&(a=a.next={eventTime:d,lane:0,tag:r.tag,payload:r.payload,callback:r.callback,next:null});e:{var u=e,h=r;switch(c=t,d=n,h.tag){case 1:if(u=h.payload,typeof u=="function"){C=u.call(d,C,c);break e}C=u;break e;case 3:u.flags=u.flags&-65537|128;case 0:if(u=h.payload,c=typeof u=="function"?u.call(d,C,c):u,c==null)break e;C=ut({},C,c);break e;case 2:Ii=!0}}r.callback!==null&&r.lane!==0&&(e.flags|=64,c=i.effects,c===null?i.effects=[r]:c.push(r))}else d={eventTime:d,lane:c,tag:r.tag,payload:r.payload,callback:r.callback,next:null},a===null?(I=a=d,l=C):a=a.next=d,s|=c;if(r=r.next,r===null){if(r=i.shared.pending,r===null)break;c=r,r=c.next,c.next=null,i.lastBaseUpdate=c,i.shared.pending=null}}while(!0);if(a===null&&(l=C),i.baseState=l,i.firstBaseUpdate=I,i.lastBaseUpdate=a,t=i.shared.interleaved,t!==null){i=t;do s|=i.lane,i=i.next;while(i!==t)}else o===null&&(i.shared.lanes=0);Ro|=s,e.lanes=s,e.memoizedState=C}}function pp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var g=e[t],i=g.callback;if(i!==null){if(g.callback=null,g=n,typeof i!="function")throw Error(Ge(191,i));i.call(g)}}}var Wl={},hg=xi(Wl),tl=xi(Wl),nl=xi(Wl);function Io(e){if(e===Wl)throw Error(Ge(174));return e}function zh(e,t){switch(nt(nl,t),nt(tl,e),nt(hg,Wl),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Rd(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Rd(t,e)}it(hg),nt(hg,t)}function vs(){it(hg),it(tl),it(nl)}function gB(e){Io(nl.current);var t=Io(hg.current),n=Rd(t,e.type);t!==n&&(nt(tl,e),nt(hg,n))}function Dh(e){tl.current===e&&(it(hg),it(tl))}var at=xi(0);function fa(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var fc=[];function Qh(){for(var e=0;e<fc.length;e++)fc[e]._workInProgressVersionPrimary=null;fc.length=0}var YI=jg.ReactCurrentDispatcher,Zc=jg.ReactCurrentBatchConfig,Wo=0,dt=null,Vt=null,Jt=null,Za=!1,Xr=!1,gl=0,c2=0;function zt(){throw Error(Ge(321))}function jh(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ng(e[n],t[n]))return!1;return!0}function Ph(e,t,n,g,i,o){if(Wo=o,dt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,YI.current=e===null||e.memoizedState===null?h2:m2,e=n(g,i),Xr){o=0;do{if(Xr=!1,gl=0,25<=o)throw Error(Ge(301));o+=1,Jt=Vt=null,t.updateQueue=null,YI.current=b2,e=n(g,i)}while(Xr)}if(YI.current=ya,t=Vt!==null&&Vt.next!==null,Wo=0,Jt=Vt=dt=null,Za=!1,t)throw Error(Ge(300));return e}function Oh(){var e=gl!==0;return gl=0,e}function lg(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jt===null?dt.memoizedState=Jt=e:Jt=Jt.next=e,Jt}function Un(){if(Vt===null){var e=dt.alternate;e=e!==null?e.memoizedState:null}else e=Vt.next;var t=Jt===null?dt.memoizedState:Jt.next;if(t!==null)Jt=t,Vt=e;else{if(e===null)throw Error(Ge(310));Vt=e,e={memoizedState:Vt.memoizedState,baseState:Vt.baseState,baseQueue:Vt.baseQueue,queue:Vt.queue,next:null},Jt===null?dt.memoizedState=Jt=e:Jt=Jt.next=e}return Jt}function il(e,t){return typeof t=="function"?t(e):t}function yc(e){var t=Un(),n=t.queue;if(n===null)throw Error(Ge(311));n.lastRenderedReducer=e;var g=Vt,i=g.baseQueue,o=n.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}g.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,g=g.baseState;var r=s=null,l=null,I=o;do{var a=I.lane;if((Wo&a)===a)l!==null&&(l=l.next={lane:0,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null}),g=I.hasEagerState?I.eagerState:e(g,I.action);else{var C={lane:a,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null};l===null?(r=l=C,s=g):l=l.next=C,dt.lanes|=a,Ro|=a}I=I.next}while(I!==null&&I!==o);l===null?s=g:l.next=r,ng(g,t.memoizedState)||(un=!0),t.memoizedState=g,t.baseState=s,t.baseQueue=l,n.lastRenderedState=g}if(e=n.interleaved,e!==null){i=e;do o=i.lane,dt.lanes|=o,Ro|=o,i=i.next;while(i!==e)}else i===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Gc(e){var t=Un(),n=t.queue;if(n===null)throw Error(Ge(311));n.lastRenderedReducer=e;var g=n.dispatch,i=n.pending,o=t.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do o=e(o,s.action),s=s.next;while(s!==i);ng(o,t.memoizedState)||(un=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,g]}function iB(){}function oB(e,t){var n=dt,g=Un(),i=t(),o=!ng(g.memoizedState,i);if(o&&(g.memoizedState=i,un=!0),g=g.queue,_h(lB.bind(null,n,g,e),[e]),g.getSnapshot!==t||o||Jt!==null&&Jt.memoizedState.tag&1){if(n.flags|=2048,ol(9,rB.bind(null,n,g,i,t),void 0,null),Ht===null)throw Error(Ge(349));Wo&30||sB(n,t,i)}return i}function sB(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=dt.updateQueue,t===null?(t={lastEffect:null,stores:null},dt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function rB(e,t,n,g){t.value=n,t.getSnapshot=g,IB(t)&&aB(e)}function lB(e,t,n){return n(function(){IB(t)&&aB(e)})}function IB(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ng(e,n)}catch{return!0}}function aB(e){var t=Tg(e,1);t!==null&&eg(t,e,1,-1)}function fp(e){var t=lg();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:il,lastRenderedState:e},t.queue=e,e=e.dispatch=A2.bind(null,dt,e),[t.memoizedState,e]}function ol(e,t,n,g){return e={tag:e,create:t,destroy:n,deps:g,next:null},t=dt.updateQueue,t===null?(t={lastEffect:null,stores:null},dt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(g=n.next,n.next=e,e.next=g,t.lastEffect=e)),e}function CB(){return Un().memoizedState}function HI(e,t,n,g){var i=lg();dt.flags|=e,i.memoizedState=ol(1|t,n,void 0,g===void 0?null:g)}function aC(e,t,n,g){var i=Un();g=g===void 0?null:g;var o=void 0;if(Vt!==null){var s=Vt.memoizedState;if(o=s.destroy,g!==null&&jh(g,s.deps)){i.memoizedState=ol(t,n,o,g);return}}dt.flags|=e,i.memoizedState=ol(1|t,n,o,g)}function Zp(e,t){return HI(8390656,8,e,t)}function _h(e,t){return aC(2048,8,e,t)}function cB(e,t){return aC(4,2,e,t)}function dB(e,t){return aC(4,4,e,t)}function uB(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function AB(e,t,n){return n=n!=null?n.concat([e]):null,aC(4,4,uB.bind(null,t,e),n)}function qh(){}function hB(e,t){var n=Un();t=t===void 0?null:t;var g=n.memoizedState;return g!==null&&t!==null&&jh(t,g[1])?g[0]:(n.memoizedState=[e,t],e)}function mB(e,t){var n=Un();t=t===void 0?null:t;var g=n.memoizedState;return g!==null&&t!==null&&jh(t,g[1])?g[0]:(e=e(),n.memoizedState=[e,t],e)}function bB(e,t,n){return Wo&21?(ng(n,t)||(n=GG(),dt.lanes|=n,Ro|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,un=!0),e.memoizedState=n)}function d2(e,t){var n=je;je=n!==0&&4>n?n:4,e(!0);var g=Zc.transition;Zc.transition={};try{e(!1),t()}finally{je=n,Zc.transition=g}}function pB(){return Un().memoizedState}function u2(e,t,n){var g=Si(e);if(n={lane:g,action:n,hasEagerState:!1,eagerState:null,next:null},fB(e))ZB(t,n);else if(n=tB(e,t,n,g),n!==null){var i=rn();eg(n,e,g,i),yB(n,t,g)}}function A2(e,t,n){var g=Si(e),i={lane:g,action:n,hasEagerState:!1,eagerState:null,next:null};if(fB(e))ZB(t,i);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,r=o(s,n);if(i.hasEagerState=!0,i.eagerState=r,ng(r,s)){var l=t.interleaved;l===null?(i.next=i,Lh(t)):(i.next=l.next,l.next=i),t.interleaved=i;return}}catch{}finally{}n=tB(e,t,i,g),n!==null&&(i=rn(),eg(n,e,g,i),yB(n,t,g))}}function fB(e){var t=e.alternate;return e===dt||t!==null&&t===dt}function ZB(e,t){Xr=Za=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function yB(e,t,n){if(n&4194240){var g=t.lanes;g&=e.pendingLanes,n|=g,t.lanes=n,vh(e,n)}}var ya={readContext:Ln,useCallback:zt,useContext:zt,useEffect:zt,useImperativeHandle:zt,useInsertionEffect:zt,useLayoutEffect:zt,useMemo:zt,useReducer:zt,useRef:zt,useState:zt,useDebugValue:zt,useDeferredValue:zt,useTransition:zt,useMutableSource:zt,useSyncExternalStore:zt,useId:zt,unstable_isNewReconciler:!1},h2={readContext:Ln,useCallback:function(e,t){return lg().memoizedState=[e,t===void 0?null:t],e},useContext:Ln,useEffect:Zp,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,HI(4194308,4,uB.bind(null,t,e),n)},useLayoutEffect:function(e,t){return HI(4194308,4,e,t)},useInsertionEffect:function(e,t){return HI(4,2,e,t)},useMemo:function(e,t){var n=lg();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var g=lg();return t=n!==void 0?n(t):t,g.memoizedState=g.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},g.queue=e,e=e.dispatch=u2.bind(null,dt,e),[g.memoizedState,e]},useRef:function(e){var t=lg();return e={current:e},t.memoizedState=e},useState:fp,useDebugValue:qh,useDeferredValue:function(e){return lg().memoizedState=e},useTransition:function(){var e=fp(!1),t=e[0];return e=d2.bind(null,e[1]),lg().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var g=dt,i=lg();if(lt){if(n===void 0)throw Error(Ge(407));n=n()}else{if(n=t(),Ht===null)throw Error(Ge(349));Wo&30||sB(g,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Zp(lB.bind(null,g,o,e),[e]),g.flags|=2048,ol(9,rB.bind(null,g,o,n,t),void 0,null),n},useId:function(){var e=lg(),t=Ht.identifierPrefix;if(lt){var n=wg,g=Xg;n=(g&~(1<<32-$n(g)-1)).toString(32)+n,t=":"+t+"R"+n,n=gl++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=c2++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},m2={readContext:Ln,useCallback:hB,useContext:Ln,useEffect:_h,useImperativeHandle:AB,useInsertionEffect:cB,useLayoutEffect:dB,useMemo:mB,useReducer:yc,useRef:CB,useState:function(){return yc(il)},useDebugValue:qh,useDeferredValue:function(e){var t=Un();return bB(t,Vt.memoizedState,e)},useTransition:function(){var e=yc(il)[0],t=Un().memoizedState;return[e,t]},useMutableSource:iB,useSyncExternalStore:oB,useId:pB,unstable_isNewReconciler:!1},b2={readContext:Ln,useCallback:hB,useContext:Ln,useEffect:_h,useImperativeHandle:AB,useInsertionEffect:cB,useLayoutEffect:dB,useMemo:mB,useReducer:Gc,useRef:CB,useState:function(){return Gc(il)},useDebugValue:qh,useDeferredValue:function(e){var t=Un();return Vt===null?t.memoizedState=e:bB(t,Vt.memoizedState,e)},useTransition:function(){var e=Gc(il)[0],t=Un().memoizedState;return[e,t]},useMutableSource:iB,useSyncExternalStore:oB,useId:pB,unstable_isNewReconciler:!1};function Pn(e,t){if(e&&e.defaultProps){t=ut({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Pd(e,t,n,g){t=e.memoizedState,n=n(g,t),n=n==null?t:ut({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var CC={isMounted:function(e){return(e=e._reactInternals)?Fo(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var g=rn(),i=Si(e),o=Ng(g,i);o.payload=t,n!=null&&(o.callback=n),t=Gi(e,o,i),t!==null&&(eg(t,e,i,g),JI(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var g=rn(),i=Si(e),o=Ng(g,i);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=Gi(e,o,i),t!==null&&(eg(t,e,i,g),JI(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=rn(),g=Si(e),i=Ng(n,g);i.tag=2,t!=null&&(i.callback=t),t=Gi(e,i,g),t!==null&&(eg(t,e,g,n),JI(t,e,g))}};function yp(e,t,n,g,i,o,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(g,o,s):t.prototype&&t.prototype.isPureReactComponent?!_r(n,g)||!_r(i,o):!0}function GB(e,t,n){var g=!1,i=Ji,o=t.contextType;return typeof o=="object"&&o!==null?o=Ln(o):(i=mn(t)?So:$t.current,g=t.contextTypes,o=(g=g!=null)?Vs(e,i):Ji),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=CC,e.stateNode=t,t._reactInternals=e,g&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Gp(e,t,n,g){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,g),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,g),t.state!==e&&CC.enqueueReplaceState(t,t.state,null)}function Od(e,t,n,g){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Uh(e);var o=t.contextType;typeof o=="object"&&o!==null?i.context=Ln(o):(o=mn(t)?So:$t.current,i.context=Vs(e,o)),i.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Pd(e,t,o,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&CC.enqueueReplaceState(i,i.state,null),pa(e,n,i,g),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function ks(e,t){try{var n="",g=t;do n+=Dk(g),g=g.return;while(g);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:i,digest:null}}function Bc(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function _d(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var p2=typeof WeakMap=="function"?WeakMap:Map;function BB(e,t,n){n=Ng(-1,n),n.tag=3,n.payload={element:null};var g=t.value;return n.callback=function(){Ba||(Ba=!0,ru=g),_d(e,t)},n}function SB(e,t,n){n=Ng(-1,n),n.tag=3;var g=e.type.getDerivedStateFromError;if(typeof g=="function"){var i=t.value;n.payload=function(){return g(i)},n.callback=function(){_d(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){_d(e,t),typeof g!="function"&&(Bi===null?Bi=new Set([this]):Bi.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}function Bp(e,t,n){var g=e.pingCache;if(g===null){g=e.pingCache=new p2;var i=new Set;g.set(t,i)}else i=g.get(t),i===void 0&&(i=new Set,g.set(t,i));i.has(n)||(i.add(n),e=J2.bind(null,e,t,n),t.then(e,e))}function Sp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Vp(e,t,n,g,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Ng(-1,1),t.tag=2,Gi(n,t,1))),n.lanes|=1),e)}var f2=jg.ReactCurrentOwner,un=!1;function gn(e,t,n,g){t.child=e===null?eB(t,null,n,g):Rs(t,e.child,n,g)}function Wp(e,t,n,g,i){n=n.render;var o=t.ref;return Zs(t,i),g=Ph(e,t,n,g,o,i),n=Oh(),e!==null&&!un?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Lg(e,t,i)):(lt&&n&&Fh(t),t.flags|=1,gn(e,t,g,i),t.child)}function Rp(e,t,n,g,i){if(e===null){var o=n.type;return typeof o=="function"&&!sm(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,VB(e,t,o,g,i)):(e=KI(n.type,null,g,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&i)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:_r,n(s,g)&&e.ref===t.ref)return Lg(e,t,i)}return t.flags|=1,e=Vi(o,g),e.ref=t.ref,e.return=t,t.child=e}function VB(e,t,n,g,i){if(e!==null){var o=e.memoizedProps;if(_r(o,g)&&e.ref===t.ref)if(un=!1,t.pendingProps=g=o,(e.lanes&i)!==0)e.flags&131072&&(un=!0);else return t.lanes=e.lanes,Lg(e,t,i)}return qd(e,t,n,g,i)}function WB(e,t,n){var g=t.pendingProps,i=g.children,o=e!==null?e.memoizedState:null;if(g.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},nt(Is,Bn),Bn|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,nt(Is,Bn),Bn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=o!==null?o.baseLanes:n,nt(Is,Bn),Bn|=g}else o!==null?(g=o.baseLanes|n,t.memoizedState=null):g=n,nt(Is,Bn),Bn|=g;return gn(e,t,i,n),t.child}function RB(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function qd(e,t,n,g,i){var o=mn(n)?So:$t.current;return o=Vs(t,o),Zs(t,i),n=Ph(e,t,n,g,o,i),g=Oh(),e!==null&&!un?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Lg(e,t,i)):(lt&&g&&Fh(t),t.flags|=1,gn(e,t,n,i),t.child)}function vp(e,t,n,g,i){if(mn(n)){var o=!0;ua(t)}else o=!1;if(Zs(t,i),t.stateNode===null)NI(e,t),GB(t,n,g),Od(t,n,g,i),g=!0;else if(e===null){var s=t.stateNode,r=t.memoizedProps;s.props=r;var l=s.context,I=n.contextType;typeof I=="object"&&I!==null?I=Ln(I):(I=mn(n)?So:$t.current,I=Vs(t,I));var a=n.getDerivedStateFromProps,C=typeof a=="function"||typeof s.getSnapshotBeforeUpdate=="function";C||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(r!==g||l!==I)&&Gp(t,s,g,I),Ii=!1;var c=t.memoizedState;s.state=c,pa(t,g,s,i),l=t.memoizedState,r!==g||c!==l||hn.current||Ii?(typeof a=="function"&&(Pd(t,n,a,g),l=t.memoizedState),(r=Ii||yp(t,n,r,g,c,l,I))?(C||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=g,t.memoizedState=l),s.props=g,s.state=l,s.context=I,g=r):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),g=!1)}else{s=t.stateNode,nB(e,t),r=t.memoizedProps,I=t.type===t.elementType?r:Pn(t.type,r),s.props=I,C=t.pendingProps,c=s.context,l=n.contextType,typeof l=="object"&&l!==null?l=Ln(l):(l=mn(n)?So:$t.current,l=Vs(t,l));var d=n.getDerivedStateFromProps;(a=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(r!==C||c!==l)&&Gp(t,s,g,l),Ii=!1,c=t.memoizedState,s.state=c,pa(t,g,s,i);var u=t.memoizedState;r!==C||c!==u||hn.current||Ii?(typeof d=="function"&&(Pd(t,n,d,g),u=t.memoizedState),(I=Ii||yp(t,n,I,g,c,u,l)||!1)?(a||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(g,u,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(g,u,l)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||r===e.memoizedProps&&c===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||r===e.memoizedProps&&c===e.memoizedState||(t.flags|=1024),t.memoizedProps=g,t.memoizedState=u),s.props=g,s.state=u,s.context=l,g=I):(typeof s.componentDidUpdate!="function"||r===e.memoizedProps&&c===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||r===e.memoizedProps&&c===e.memoizedState||(t.flags|=1024),g=!1)}return $d(e,t,n,g,o,i)}function $d(e,t,n,g,i,o){RB(e,t);var s=(t.flags&128)!==0;if(!g&&!s)return i&&up(t,n,!1),Lg(e,t,o);g=t.stateNode,f2.current=t;var r=s&&typeof n.getDerivedStateFromError!="function"?null:g.render();return t.flags|=1,e!==null&&s?(t.child=Rs(t,e.child,null,o),t.child=Rs(t,null,r,o)):gn(e,t,r,o),t.memoizedState=g.state,i&&up(t,n,!0),t.child}function vB(e){var t=e.stateNode;t.pendingContext?dp(e,t.pendingContext,t.pendingContext!==t.context):t.context&&dp(e,t.context,!1),zh(e,t.containerInfo)}function kp(e,t,n,g,i){return Ws(),Kh(i),t.flags|=256,gn(e,t,n,g),t.child}var eu={dehydrated:null,treeContext:null,retryLane:0};function tu(e){return{baseLanes:e,cachePool:null,transitions:null}}function kB(e,t,n){var g=t.pendingProps,i=at.current,o=!1,s=(t.flags&128)!==0,r;if((r=s)||(r=e!==null&&e.memoizedState===null?!1:(i&2)!==0),r?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),nt(at,i&1),e===null)return Qd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=g.children,e=g.fallback,o?(g=t.mode,o=t.child,s={mode:"hidden",children:s},!(g&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=uC(s,g,0,null),e=ho(e,g,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=tu(n),t.memoizedState=eu,e):$h(t,s));if(i=e.memoizedState,i!==null&&(r=i.dehydrated,r!==null))return Z2(e,t,s,g,r,i,n);if(o){o=g.fallback,s=t.mode,i=e.child,r=i.sibling;var l={mode:"hidden",children:g.children};return!(s&1)&&t.child!==i?(g=t.child,g.childLanes=0,g.pendingProps=l,t.deletions=null):(g=Vi(i,l),g.subtreeFlags=i.subtreeFlags&14680064),r!==null?o=Vi(r,o):(o=ho(o,s,n,null),o.flags|=2),o.return=t,g.return=t,g.sibling=o,t.child=g,g=o,o=t.child,s=e.child.memoizedState,s=s===null?tu(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~n,t.memoizedState=eu,g}return o=e.child,e=o.sibling,g=Vi(o,{mode:"visible",children:g.children}),!(t.mode&1)&&(g.lanes=n),g.return=t,g.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=g,t.memoizedState=null,g}function $h(e,t){return t=uC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function tI(e,t,n,g){return g!==null&&Kh(g),Rs(t,e.child,null,n),e=$h(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Z2(e,t,n,g,i,o,s){if(n)return t.flags&256?(t.flags&=-257,g=Bc(Error(Ge(422))),tI(e,t,s,g)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=g.fallback,i=t.mode,g=uC({mode:"visible",children:g.children},i,0,null),o=ho(o,i,s,null),o.flags|=2,g.return=t,o.return=t,g.sibling=o,t.child=g,t.mode&1&&Rs(t,e.child,null,s),t.child.memoizedState=tu(s),t.memoizedState=eu,o);if(!(t.mode&1))return tI(e,t,s,null);if(i.data==="$!"){if(g=i.nextSibling&&i.nextSibling.dataset,g)var r=g.dgst;return g=r,o=Error(Ge(419)),g=Bc(o,g,void 0),tI(e,t,s,g)}if(r=(s&e.childLanes)!==0,un||r){if(g=Ht,g!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(g.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Tg(e,i),eg(g,e,i,-1))}return om(),g=Bc(Error(Ge(421))),tI(e,t,s,g)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=Y2.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,Sn=yi(i.nextSibling),Vn=t,lt=!0,qn=null,e!==null&&(Fn[xn++]=Xg,Fn[xn++]=wg,Fn[xn++]=Vo,Xg=e.id,wg=e.overflow,Vo=t),t=$h(t,g.children),t.flags|=4096,t)}function Xp(e,t,n){e.lanes|=t;var g=e.alternate;g!==null&&(g.lanes|=t),jd(e.return,t,n)}function Sc(e,t,n,g,i){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:g,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=g,o.tail=n,o.tailMode=i)}function XB(e,t,n){var g=t.pendingProps,i=g.revealOrder,o=g.tail;if(gn(e,t,g.children,n),g=at.current,g&2)g=g&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Xp(e,n,t);else if(e.tag===19)Xp(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}g&=1}if(nt(at,g),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&fa(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Sc(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&fa(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Sc(t,!0,n,null,o);break;case"together":Sc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function NI(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Lg(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Ro|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Ge(153));if(t.child!==null){for(e=t.child,n=Vi(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Vi(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function y2(e,t,n){switch(t.tag){case 3:vB(t),Ws();break;case 5:gB(t);break;case 1:mn(t.type)&&ua(t);break;case 4:zh(t,t.stateNode.containerInfo);break;case 10:var g=t.type._context,i=t.memoizedProps.value;nt(ma,g._currentValue),g._currentValue=i;break;case 13:if(g=t.memoizedState,g!==null)return g.dehydrated!==null?(nt(at,at.current&1),t.flags|=128,null):n&t.child.childLanes?kB(e,t,n):(nt(at,at.current&1),e=Lg(e,t,n),e!==null?e.sibling:null);nt(at,at.current&1);break;case 19:if(g=(n&t.childLanes)!==0,e.flags&128){if(g)return XB(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),nt(at,at.current),g)break;return null;case 22:case 23:return t.lanes=0,WB(e,t,n)}return Lg(e,t,n)}var wB,nu,JB,YB;wB=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};nu=function(){};JB=function(e,t,n,g){var i=e.memoizedProps;if(i!==g){e=t.stateNode,Io(hg.current);var o=null;switch(n){case"input":i=Bd(e,i),g=Bd(e,g),o=[];break;case"select":i=ut({},i,{value:void 0}),g=ut({},g,{value:void 0}),o=[];break;case"textarea":i=Wd(e,i),g=Wd(e,g),o=[];break;default:typeof i.onClick!="function"&&typeof g.onClick=="function"&&(e.onclick=ca)}vd(n,g);var s;n=null;for(I in i)if(!g.hasOwnProperty(I)&&i.hasOwnProperty(I)&&i[I]!=null)if(I==="style"){var r=i[I];for(s in r)r.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(Ur.hasOwnProperty(I)?o||(o=[]):(o=o||[]).push(I,null));for(I in g){var l=g[I];if(r=i!=null?i[I]:void 0,g.hasOwnProperty(I)&&l!==r&&(l!=null||r!=null))if(I==="style")if(r){for(s in r)!r.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in l)l.hasOwnProperty(s)&&r[s]!==l[s]&&(n||(n={}),n[s]=l[s])}else n||(o||(o=[]),o.push(I,n)),n=l;else I==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,r=r?r.__html:void 0,l!=null&&r!==l&&(o=o||[]).push(I,l)):I==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(I,""+l):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&(Ur.hasOwnProperty(I)?(l!=null&&I==="onScroll"&&gt("scroll",e),o||r===l||(o=[])):(o=o||[]).push(I,l))}n&&(o=o||[]).push("style",n);var I=o;(t.updateQueue=I)&&(t.flags|=4)}};YB=function(e,t,n,g){n!==g&&(t.flags|=4)};function $s(e,t){if(!lt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var g=null;n!==null;)n.alternate!==null&&(g=n),n=n.sibling;g===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:g.sibling=null}}function Dt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,g=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,g|=i.subtreeFlags&14680064,g|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,g|=i.subtreeFlags,g|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=g,e.childLanes=n,t}function G2(e,t,n){var g=t.pendingProps;switch(xh(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dt(t),null;case 1:return mn(t.type)&&da(),Dt(t),null;case 3:return g=t.stateNode,vs(),it(hn),it($t),Qh(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(e===null||e.child===null)&&($l(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,qn!==null&&(au(qn),qn=null))),nu(e,t),Dt(t),null;case 5:Dh(t);var i=Io(nl.current);if(n=t.type,e!==null&&t.stateNode!=null)JB(e,t,n,g,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!g){if(t.stateNode===null)throw Error(Ge(166));return Dt(t),null}if(e=Io(hg.current),$l(t)){g=t.stateNode,n=t.type;var o=t.memoizedProps;switch(g[Cg]=t,g[el]=o,e=(t.mode&1)!==0,n){case"dialog":gt("cancel",g),gt("close",g);break;case"iframe":case"object":case"embed":gt("load",g);break;case"video":case"audio":for(i=0;i<hr.length;i++)gt(hr[i],g);break;case"source":gt("error",g);break;case"img":case"image":case"link":gt("error",g),gt("load",g);break;case"details":gt("toggle",g);break;case"input":Eb(g,o),gt("invalid",g);break;case"select":g._wrapperState={wasMultiple:!!o.multiple},gt("invalid",g);break;case"textarea":Tb(g,o),gt("invalid",g)}vd(n,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var r=o[s];s==="children"?typeof r=="string"?g.textContent!==r&&(o.suppressHydrationWarning!==!0&&ql(g.textContent,r,e),i=["children",r]):typeof r=="number"&&g.textContent!==""+r&&(o.suppressHydrationWarning!==!0&&ql(g.textContent,r,e),i=["children",""+r]):Ur.hasOwnProperty(s)&&r!=null&&s==="onScroll"&&gt("scroll",g)}switch(n){case"input":Ul(g),Mb(g,o,!0);break;case"textarea":Ul(g),Lb(g);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(g.onclick=ca)}g=i,t.updateQueue=g,g!==null&&(t.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=lG(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof g.is=="string"?e=s.createElement(n,{is:g.is}):(e=s.createElement(n),n==="select"&&(s=e,g.multiple?s.multiple=!0:g.size&&(s.size=g.size))):e=s.createElementNS(e,n),e[Cg]=t,e[el]=g,wB(e,t,!1,!1),t.stateNode=e;e:{switch(s=kd(n,g),n){case"dialog":gt("cancel",e),gt("close",e),i=g;break;case"iframe":case"object":case"embed":gt("load",e),i=g;break;case"video":case"audio":for(i=0;i<hr.length;i++)gt(hr[i],e);i=g;break;case"source":gt("error",e),i=g;break;case"img":case"image":case"link":gt("error",e),gt("load",e),i=g;break;case"details":gt("toggle",e),i=g;break;case"input":Eb(e,g),i=Bd(e,g),gt("invalid",e);break;case"option":i=g;break;case"select":e._wrapperState={wasMultiple:!!g.multiple},i=ut({},g,{value:void 0}),gt("invalid",e);break;case"textarea":Tb(e,g),i=Wd(e,g),gt("invalid",e);break;default:i=g}vd(n,i),r=i;for(o in r)if(r.hasOwnProperty(o)){var l=r[o];o==="style"?CG(e,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&IG(e,l)):o==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&zr(e,l):typeof l=="number"&&zr(e,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Ur.hasOwnProperty(o)?l!=null&&o==="onScroll"&&gt("scroll",e):l!=null&&Gh(e,o,l,s))}switch(n){case"input":Ul(e),Mb(e,g,!1);break;case"textarea":Ul(e),Lb(e);break;case"option":g.value!=null&&e.setAttribute("value",""+wi(g.value));break;case"select":e.multiple=!!g.multiple,o=g.value,o!=null?ms(e,!!g.multiple,o,!1):g.defaultValue!=null&&ms(e,!!g.multiple,g.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=ca)}switch(n){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}}g&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Dt(t),null;case 6:if(e&&t.stateNode!=null)YB(e,t,e.memoizedProps,g);else{if(typeof g!="string"&&t.stateNode===null)throw Error(Ge(166));if(n=Io(nl.current),Io(hg.current),$l(t)){if(g=t.stateNode,n=t.memoizedProps,g[Cg]=t,(o=g.nodeValue!==n)&&(e=Vn,e!==null))switch(e.tag){case 3:ql(g.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ql(g.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else g=(n.nodeType===9?n:n.ownerDocument).createTextNode(g),g[Cg]=t,t.stateNode=g}return Dt(t),null;case 13:if(it(at),g=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(lt&&Sn!==null&&t.mode&1&&!(t.flags&128))qG(),Ws(),t.flags|=98560,o=!1;else if(o=$l(t),g!==null&&g.dehydrated!==null){if(e===null){if(!o)throw Error(Ge(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Ge(317));o[Cg]=t}else Ws(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Dt(t),o=!1}else qn!==null&&(au(qn),qn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(g=g!==null,g!==(e!==null&&e.memoizedState!==null)&&g&&(t.child.flags|=8192,t.mode&1&&(e===null||at.current&1?Wt===0&&(Wt=3):om())),t.updateQueue!==null&&(t.flags|=4),Dt(t),null);case 4:return vs(),nu(e,t),e===null&&qr(t.stateNode.containerInfo),Dt(t),null;case 10:return Th(t.type._context),Dt(t),null;case 17:return mn(t.type)&&da(),Dt(t),null;case 19:if(it(at),o=t.memoizedState,o===null)return Dt(t),null;if(g=(t.flags&128)!==0,s=o.rendering,s===null)if(g)$s(o,!1);else{if(Wt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=fa(e),s!==null){for(t.flags|=128,$s(o,!1),g=s.updateQueue,g!==null&&(t.updateQueue=g,t.flags|=4),t.subtreeFlags=0,g=n,n=t.child;n!==null;)o=n,e=g,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return nt(at,at.current&1|2),t.child}e=e.sibling}o.tail!==null&&yt()>Xs&&(t.flags|=128,g=!0,$s(o,!1),t.lanes=4194304)}else{if(!g)if(e=fa(s),e!==null){if(t.flags|=128,g=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),$s(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!lt)return Dt(t),null}else 2*yt()-o.renderingStartTime>Xs&&n!==1073741824&&(t.flags|=128,g=!0,$s(o,!1),t.lanes=4194304);o.isBackwards?(s.sibling=t.child,t.child=s):(n=o.last,n!==null?n.sibling=s:t.child=s,o.last=s)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=yt(),t.sibling=null,n=at.current,nt(at,g?n&1|2:n&1),t):(Dt(t),null);case 22:case 23:return im(),g=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==g&&(t.flags|=8192),g&&t.mode&1?Bn&1073741824&&(Dt(t),t.subtreeFlags&6&&(t.flags|=8192)):Dt(t),null;case 24:return null;case 25:return null}throw Error(Ge(156,t.tag))}function B2(e,t){switch(xh(t),t.tag){case 1:return mn(t.type)&&da(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return vs(),it(hn),it($t),Qh(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Dh(t),null;case 13:if(it(at),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Ge(340));Ws()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return it(at),null;case 4:return vs(),null;case 10:return Th(t.type._context),null;case 22:case 23:return im(),null;case 24:return null;default:return null}}var nI=!1,Ot=!1,S2=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function ls(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(g){ht(e,t,g)}else n.current=null}function gu(e,t,n){try{n()}catch(g){ht(e,t,g)}}var wp=!1;function V2(e,t){if(Ed=Ia,e=KG(),Nh(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var g=n.getSelection&&n.getSelection();if(g&&g.rangeCount!==0){n=g.anchorNode;var i=g.anchorOffset,o=g.focusNode;g=g.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,r=-1,l=-1,I=0,a=0,C=e,c=null;t:for(;;){for(var d;C!==n||i!==0&&C.nodeType!==3||(r=s+i),C!==o||g!==0&&C.nodeType!==3||(l=s+g),C.nodeType===3&&(s+=C.nodeValue.length),(d=C.firstChild)!==null;)c=C,C=d;for(;;){if(C===e)break t;if(c===n&&++I===i&&(r=s),c===o&&++a===g&&(l=s),(d=C.nextSibling)!==null)break;C=c,c=C.parentNode}C=d}n=r===-1||l===-1?null:{start:r,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Md={focusedElem:e,selectionRange:n},Ia=!1,Ve=t;Ve!==null;)if(t=Ve,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ve=e;else for(;Ve!==null;){t=Ve;try{var u=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(u!==null){var h=u.memoizedProps,f=u.memoizedState,y=t.stateNode,Z=y.getSnapshotBeforeUpdate(t.elementType===t.type?h:Pn(t.type,h),f);y.__reactInternalSnapshotBeforeUpdate=Z}break;case 3:var p=t.stateNode.containerInfo;p.nodeType===1?p.textContent="":p.nodeType===9&&p.documentElement&&p.removeChild(p.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ge(163))}}catch(B){ht(t,t.return,B)}if(e=t.sibling,e!==null){e.return=t.return,Ve=e;break}Ve=t.return}return u=wp,wp=!1,u}function wr(e,t,n){var g=t.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var i=g=g.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,o!==void 0&&gu(t,n,o)}i=i.next}while(i!==g)}}function cC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var g=n.create;n.destroy=g()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function HB(e){var t=e.alternate;t!==null&&(e.alternate=null,HB(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Cg],delete t[el],delete t[Ud],delete t[l2],delete t[I2])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function NB(e){return e.tag===5||e.tag===3||e.tag===4}function Jp(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||NB(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ou(e,t,n){var g=e.tag;if(g===5||g===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=ca));else if(g!==4&&(e=e.child,e!==null))for(ou(e,t,n),e=e.sibling;e!==null;)ou(e,t,n),e=e.sibling}function su(e,t,n){var g=e.tag;if(g===5||g===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(g!==4&&(e=e.child,e!==null))for(su(e,t,n),e=e.sibling;e!==null;)su(e,t,n),e=e.sibling}var xt=null,On=!1;function ei(e,t,n){for(n=n.child;n!==null;)FB(e,t,n),n=n.sibling}function FB(e,t,n){if(Ag&&typeof Ag.onCommitFiberUnmount=="function")try{Ag.onCommitFiberUnmount(iC,n)}catch{}switch(n.tag){case 5:Ot||ls(n,t);case 6:var g=xt,i=On;xt=null,ei(e,t,n),xt=g,On=i,xt!==null&&(On?(e=xt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):xt.removeChild(n.stateNode));break;case 18:xt!==null&&(On?(e=xt,n=n.stateNode,e.nodeType===8?bc(e.parentNode,n):e.nodeType===1&&bc(e,n),Pr(e)):bc(xt,n.stateNode));break;case 4:g=xt,i=On,xt=n.stateNode.containerInfo,On=!0,ei(e,t,n),xt=g,On=i;break;case 0:case 11:case 14:case 15:if(!Ot&&(g=n.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){i=g=g.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&gu(n,t,s),i=i.next}while(i!==g)}ei(e,t,n);break;case 1:if(!Ot&&(ls(n,t),g=n.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=n.memoizedProps,g.state=n.memoizedState,g.componentWillUnmount()}catch(r){ht(n,t,r)}ei(e,t,n);break;case 21:ei(e,t,n);break;case 22:n.mode&1?(Ot=(g=Ot)||n.memoizedState!==null,ei(e,t,n),Ot=g):ei(e,t,n);break;default:ei(e,t,n)}}function Yp(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new S2),t.forEach(function(g){var i=H2.bind(null,e,g);n.has(g)||(n.add(g),g.then(i,i))})}}function zn(e,t){var n=t.deletions;if(n!==null)for(var g=0;g<n.length;g++){var i=n[g];try{var o=e,s=t,r=s;e:for(;r!==null;){switch(r.tag){case 5:xt=r.stateNode,On=!1;break e;case 3:xt=r.stateNode.containerInfo,On=!0;break e;case 4:xt=r.stateNode.containerInfo,On=!0;break e}r=r.return}if(xt===null)throw Error(Ge(160));FB(o,s,i),xt=null,On=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(I){ht(i,t,I)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)xB(t,e),t=t.sibling}function xB(e,t){var n=e.alternate,g=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(zn(t,e),ig(e),g&4){try{wr(3,e,e.return),cC(3,e)}catch(h){ht(e,e.return,h)}try{wr(5,e,e.return)}catch(h){ht(e,e.return,h)}}break;case 1:zn(t,e),ig(e),g&512&&n!==null&&ls(n,n.return);break;case 5:if(zn(t,e),ig(e),g&512&&n!==null&&ls(n,n.return),e.flags&32){var i=e.stateNode;try{zr(i,"")}catch(h){ht(e,e.return,h)}}if(g&4&&(i=e.stateNode,i!=null)){var o=e.memoizedProps,s=n!==null?n.memoizedProps:o,r=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{r==="input"&&o.type==="radio"&&o.name!=null&&sG(i,o),kd(r,s);var I=kd(r,o);for(s=0;s<l.length;s+=2){var a=l[s],C=l[s+1];a==="style"?CG(i,C):a==="dangerouslySetInnerHTML"?IG(i,C):a==="children"?zr(i,C):Gh(i,a,C,I)}switch(r){case"input":Sd(i,o);break;case"textarea":rG(i,o);break;case"select":var c=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var d=o.value;d!=null?ms(i,!!o.multiple,d,!1):c!==!!o.multiple&&(o.defaultValue!=null?ms(i,!!o.multiple,o.defaultValue,!0):ms(i,!!o.multiple,o.multiple?[]:"",!1))}i[el]=o}catch(h){ht(e,e.return,h)}}break;case 6:if(zn(t,e),ig(e),g&4){if(e.stateNode===null)throw Error(Ge(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(h){ht(e,e.return,h)}}break;case 3:if(zn(t,e),ig(e),g&4&&n!==null&&n.memoizedState.isDehydrated)try{Pr(t.containerInfo)}catch(h){ht(e,e.return,h)}break;case 4:zn(t,e),ig(e);break;case 13:zn(t,e),ig(e),i=e.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(nm=yt())),g&4&&Yp(e);break;case 22:if(a=n!==null&&n.memoizedState!==null,e.mode&1?(Ot=(I=Ot)||a,zn(t,e),Ot=I):zn(t,e),ig(e),g&8192){if(I=e.memoizedState!==null,(e.stateNode.isHidden=I)&&!a&&e.mode&1)for(Ve=e,a=e.child;a!==null;){for(C=Ve=a;Ve!==null;){switch(c=Ve,d=c.child,c.tag){case 0:case 11:case 14:case 15:wr(4,c,c.return);break;case 1:ls(c,c.return);var u=c.stateNode;if(typeof u.componentWillUnmount=="function"){g=c,n=c.return;try{t=g,u.props=t.memoizedProps,u.state=t.memoizedState,u.componentWillUnmount()}catch(h){ht(g,n,h)}}break;case 5:ls(c,c.return);break;case 22:if(c.memoizedState!==null){Np(C);continue}}d!==null?(d.return=c,Ve=d):Np(C)}a=a.sibling}e:for(a=null,C=e;;){if(C.tag===5){if(a===null){a=C;try{i=C.stateNode,I?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(r=C.stateNode,l=C.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,r.style.display=aG("display",s))}catch(h){ht(e,e.return,h)}}}else if(C.tag===6){if(a===null)try{C.stateNode.nodeValue=I?"":C.memoizedProps}catch(h){ht(e,e.return,h)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===e)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===e)break e;for(;C.sibling===null;){if(C.return===null||C.return===e)break e;a===C&&(a=null),C=C.return}a===C&&(a=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:zn(t,e),ig(e),g&4&&Yp(e);break;case 21:break;default:zn(t,e),ig(e)}}function ig(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(NB(n)){var g=n;break e}n=n.return}throw Error(Ge(160))}switch(g.tag){case 5:var i=g.stateNode;g.flags&32&&(zr(i,""),g.flags&=-33);var o=Jp(e);su(e,o,i);break;case 3:case 4:var s=g.stateNode.containerInfo,r=Jp(e);ou(e,r,s);break;default:throw Error(Ge(161))}}catch(l){ht(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function W2(e,t,n){Ve=e,KB(e)}function KB(e,t,n){for(var g=(e.mode&1)!==0;Ve!==null;){var i=Ve,o=i.child;if(i.tag===22&&g){var s=i.memoizedState!==null||nI;if(!s){var r=i.alternate,l=r!==null&&r.memoizedState!==null||Ot;r=nI;var I=Ot;if(nI=s,(Ot=l)&&!I)for(Ve=i;Ve!==null;)s=Ve,l=s.child,s.tag===22&&s.memoizedState!==null?Fp(i):l!==null?(l.return=s,Ve=l):Fp(i);for(;o!==null;)Ve=o,KB(o),o=o.sibling;Ve=i,nI=r,Ot=I}Hp(e)}else i.subtreeFlags&8772&&o!==null?(o.return=i,Ve=o):Hp(e)}}function Hp(e){for(;Ve!==null;){var t=Ve;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ot||cC(5,t);break;case 1:var g=t.stateNode;if(t.flags&4&&!Ot)if(n===null)g.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:Pn(t.type,n.memoizedProps);g.componentDidUpdate(i,n.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&pp(t,o,g);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}pp(t,s,n)}break;case 5:var r=t.stateNode;if(n===null&&t.flags&4){n=r;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var I=t.alternate;if(I!==null){var a=I.memoizedState;if(a!==null){var C=a.dehydrated;C!==null&&Pr(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ge(163))}Ot||t.flags&512&&iu(t)}catch(c){ht(t,t.return,c)}}if(t===e){Ve=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ve=n;break}Ve=t.return}}function Np(e){for(;Ve!==null;){var t=Ve;if(t===e){Ve=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ve=n;break}Ve=t.return}}function Fp(e){for(;Ve!==null;){var t=Ve;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{cC(4,t)}catch(l){ht(t,n,l)}break;case 1:var g=t.stateNode;if(typeof g.componentDidMount=="function"){var i=t.return;try{g.componentDidMount()}catch(l){ht(t,i,l)}}var o=t.return;try{iu(t)}catch(l){ht(t,o,l)}break;case 5:var s=t.return;try{iu(t)}catch(l){ht(t,s,l)}}}catch(l){ht(t,t.return,l)}if(t===e){Ve=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Ve=r;break}Ve=t.return}}var R2=Math.ceil,Ga=jg.ReactCurrentDispatcher,em=jg.ReactCurrentOwner,Mn=jg.ReactCurrentBatchConfig,Ee=0,Ht=null,Bt=null,Et=0,Bn=0,Is=xi(0),Wt=0,sl=null,Ro=0,dC=0,tm=0,Jr=null,cn=null,nm=0,Xs=1/0,Sg=null,Ba=!1,ru=null,Bi=null,gI=!1,ui=null,Sa=0,Yr=0,lu=null,FI=-1,xI=0;function rn(){return Ee&6?yt():FI!==-1?FI:FI=yt()}function Si(e){return e.mode&1?Ee&2&&Et!==0?Et&-Et:C2.transition!==null?(xI===0&&(xI=GG()),xI):(e=je,e!==0||(e=window.event,e=e===void 0?16:kG(e.type)),e):1}function eg(e,t,n,g){if(50<Yr)throw Yr=0,lu=null,Error(Ge(185));Bl(e,n,g),(!(Ee&2)||e!==Ht)&&(e===Ht&&(!(Ee&2)&&(dC|=n),Wt===4&&ci(e,Et)),bn(e,g),n===1&&Ee===0&&!(t.mode&1)&&(Xs=yt()+500,IC&&Ki()))}function bn(e,t){var n=e.callbackNode;CX(e,t);var g=la(e,e===Ht?Et:0);if(g===0)n!==null&&Db(n),e.callbackNode=null,e.callbackPriority=0;else if(t=g&-g,e.callbackPriority!==t){if(n!=null&&Db(n),t===1)e.tag===0?a2(xp.bind(null,e)):PG(xp.bind(null,e)),s2(function(){!(Ee&6)&&Ki()}),n=null;else{switch(BG(g)){case 1:n=Rh;break;case 4:n=ZG;break;case 16:n=ra;break;case 536870912:n=yG;break;default:n=ra}n=QB(n,EB.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function EB(e,t){if(FI=-1,xI=0,Ee&6)throw Error(Ge(327));var n=e.callbackNode;if(ys()&&e.callbackNode!==n)return null;var g=la(e,e===Ht?Et:0);if(g===0)return null;if(g&30||g&e.expiredLanes||t)t=Va(e,g);else{t=g;var i=Ee;Ee|=2;var o=TB();(Ht!==e||Et!==t)&&(Sg=null,Xs=yt()+500,Ao(e,t));do try{X2();break}catch(r){MB(e,r)}while(!0);Mh(),Ga.current=o,Ee=i,Bt!==null?t=0:(Ht=null,Et=0,t=Wt)}if(t!==0){if(t===2&&(i=Hd(e),i!==0&&(g=i,t=Iu(e,i))),t===1)throw n=sl,Ao(e,0),ci(e,g),bn(e,yt()),n;if(t===6)ci(e,g);else{if(i=e.current.alternate,!(g&30)&&!v2(i)&&(t=Va(e,g),t===2&&(o=Hd(e),o!==0&&(g=o,t=Iu(e,o))),t===1))throw n=sl,Ao(e,0),ci(e,g),bn(e,yt()),n;switch(e.finishedWork=i,e.finishedLanes=g,t){case 0:case 1:throw Error(Ge(345));case 2:to(e,cn,Sg);break;case 3:if(ci(e,g),(g&130023424)===g&&(t=nm+500-yt(),10<t)){if(la(e,0)!==0)break;if(i=e.suspendedLanes,(i&g)!==g){rn(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Ld(to.bind(null,e,cn,Sg),t);break}to(e,cn,Sg);break;case 4:if(ci(e,g),(g&4194240)===g)break;for(t=e.eventTimes,i=-1;0<g;){var s=31-$n(g);o=1<<s,s=t[s],s>i&&(i=s),g&=~o}if(g=i,g=yt()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*R2(g/1960))-g,10<g){e.timeoutHandle=Ld(to.bind(null,e,cn,Sg),g);break}to(e,cn,Sg);break;case 5:to(e,cn,Sg);break;default:throw Error(Ge(329))}}}return bn(e,yt()),e.callbackNode===n?EB.bind(null,e):null}function Iu(e,t){var n=Jr;return e.current.memoizedState.isDehydrated&&(Ao(e,t).flags|=256),e=Va(e,t),e!==2&&(t=cn,cn=n,t!==null&&au(t)),e}function au(e){cn===null?cn=e:cn.push.apply(cn,e)}function v2(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var g=0;g<n.length;g++){var i=n[g],o=i.getSnapshot;i=i.value;try{if(!ng(o(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ci(e,t){for(t&=~tm,t&=~dC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-$n(t),g=1<<n;e[n]=-1,t&=~g}}function xp(e){if(Ee&6)throw Error(Ge(327));ys();var t=la(e,0);if(!(t&1))return bn(e,yt()),null;var n=Va(e,t);if(e.tag!==0&&n===2){var g=Hd(e);g!==0&&(t=g,n=Iu(e,g))}if(n===1)throw n=sl,Ao(e,0),ci(e,t),bn(e,yt()),n;if(n===6)throw Error(Ge(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,to(e,cn,Sg),bn(e,yt()),null}function gm(e,t){var n=Ee;Ee|=1;try{return e(t)}finally{Ee=n,Ee===0&&(Xs=yt()+500,IC&&Ki())}}function vo(e){ui!==null&&ui.tag===0&&!(Ee&6)&&ys();var t=Ee;Ee|=1;var n=Mn.transition,g=je;try{if(Mn.transition=null,je=1,e)return e()}finally{je=g,Mn.transition=n,Ee=t,!(Ee&6)&&Ki()}}function im(){Bn=Is.current,it(Is)}function Ao(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,o2(n)),Bt!==null)for(n=Bt.return;n!==null;){var g=n;switch(xh(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&da();break;case 3:vs(),it(hn),it($t),Qh();break;case 5:Dh(g);break;case 4:vs();break;case 13:it(at);break;case 19:it(at);break;case 10:Th(g.type._context);break;case 22:case 23:im()}n=n.return}if(Ht=e,Bt=e=Vi(e.current,null),Et=Bn=t,Wt=0,sl=null,tm=dC=Ro=0,cn=Jr=null,lo!==null){for(t=0;t<lo.length;t++)if(n=lo[t],g=n.interleaved,g!==null){n.interleaved=null;var i=g.next,o=n.pending;if(o!==null){var s=o.next;o.next=i,g.next=s}n.pending=g}lo=null}return e}function MB(e,t){do{var n=Bt;try{if(Mh(),YI.current=ya,Za){for(var g=dt.memoizedState;g!==null;){var i=g.queue;i!==null&&(i.pending=null),g=g.next}Za=!1}if(Wo=0,Jt=Vt=dt=null,Xr=!1,gl=0,em.current=null,n===null||n.return===null){Wt=1,sl=t,Bt=null;break}e:{var o=e,s=n.return,r=n,l=t;if(t=Et,r.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var I=l,a=r,C=a.tag;if(!(a.mode&1)&&(C===0||C===11||C===15)){var c=a.alternate;c?(a.updateQueue=c.updateQueue,a.memoizedState=c.memoizedState,a.lanes=c.lanes):(a.updateQueue=null,a.memoizedState=null)}var d=Sp(s);if(d!==null){d.flags&=-257,Vp(d,s,r,o,t),d.mode&1&&Bp(o,I,t),t=d,l=I;var u=t.updateQueue;if(u===null){var h=new Set;h.add(l),t.updateQueue=h}else u.add(l);break e}else{if(!(t&1)){Bp(o,I,t),om();break e}l=Error(Ge(426))}}else if(lt&&r.mode&1){var f=Sp(s);if(f!==null){!(f.flags&65536)&&(f.flags|=256),Vp(f,s,r,o,t),Kh(ks(l,r));break e}}o=l=ks(l,r),Wt!==4&&(Wt=2),Jr===null?Jr=[o]:Jr.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var y=BB(o,l,t);bp(o,y);break e;case 1:r=l;var Z=o.type,p=o.stateNode;if(!(o.flags&128)&&(typeof Z.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(Bi===null||!Bi.has(p)))){o.flags|=65536,t&=-t,o.lanes|=t;var B=SB(o,r,t);bp(o,B);break e}}o=o.return}while(o!==null)}UB(n)}catch(W){t=W,Bt===n&&n!==null&&(Bt=n=n.return);continue}break}while(!0)}function TB(){var e=Ga.current;return Ga.current=ya,e===null?ya:e}function om(){(Wt===0||Wt===3||Wt===2)&&(Wt=4),Ht===null||!(Ro&268435455)&&!(dC&268435455)||ci(Ht,Et)}function Va(e,t){var n=Ee;Ee|=2;var g=TB();(Ht!==e||Et!==t)&&(Sg=null,Ao(e,t));do try{k2();break}catch(i){MB(e,i)}while(!0);if(Mh(),Ee=n,Ga.current=g,Bt!==null)throw Error(Ge(261));return Ht=null,Et=0,Wt}function k2(){for(;Bt!==null;)LB(Bt)}function X2(){for(;Bt!==null&&!nX();)LB(Bt)}function LB(e){var t=DB(e.alternate,e,Bn);e.memoizedProps=e.pendingProps,t===null?UB(e):Bt=t,em.current=null}function UB(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=B2(n,t),n!==null){n.flags&=32767,Bt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Wt=6,Bt=null;return}}else if(n=G2(n,t,Bn),n!==null){Bt=n;return}if(t=t.sibling,t!==null){Bt=t;return}Bt=t=e}while(t!==null);Wt===0&&(Wt=5)}function to(e,t,n){var g=je,i=Mn.transition;try{Mn.transition=null,je=1,w2(e,t,n,g)}finally{Mn.transition=i,je=g}return null}function w2(e,t,n,g){do ys();while(ui!==null);if(Ee&6)throw Error(Ge(327));n=e.finishedWork;var i=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Ge(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(cX(e,o),e===Ht&&(Bt=Ht=null,Et=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||gI||(gI=!0,QB(ra,function(){return ys(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Mn.transition,Mn.transition=null;var s=je;je=1;var r=Ee;Ee|=4,em.current=null,V2(e,n),xB(n,e),qX(Md),Ia=!!Ed,Md=Ed=null,e.current=n,W2(n),gX(),Ee=r,je=s,Mn.transition=o}else e.current=n;if(gI&&(gI=!1,ui=e,Sa=i),o=e.pendingLanes,o===0&&(Bi=null),sX(n.stateNode),bn(e,yt()),t!==null)for(g=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],g(i.value,{componentStack:i.stack,digest:i.digest});if(Ba)throw Ba=!1,e=ru,ru=null,e;return Sa&1&&e.tag!==0&&ys(),o=e.pendingLanes,o&1?e===lu?Yr++:(Yr=0,lu=e):Yr=0,Ki(),null}function ys(){if(ui!==null){var e=BG(Sa),t=Mn.transition,n=je;try{if(Mn.transition=null,je=16>e?16:e,ui===null)var g=!1;else{if(e=ui,ui=null,Sa=0,Ee&6)throw Error(Ge(331));var i=Ee;for(Ee|=4,Ve=e.current;Ve!==null;){var o=Ve,s=o.child;if(Ve.flags&16){var r=o.deletions;if(r!==null){for(var l=0;l<r.length;l++){var I=r[l];for(Ve=I;Ve!==null;){var a=Ve;switch(a.tag){case 0:case 11:case 15:wr(8,a,o)}var C=a.child;if(C!==null)C.return=a,Ve=C;else for(;Ve!==null;){a=Ve;var c=a.sibling,d=a.return;if(HB(a),a===I){Ve=null;break}if(c!==null){c.return=d,Ve=c;break}Ve=d}}}var u=o.alternate;if(u!==null){var h=u.child;if(h!==null){u.child=null;do{var f=h.sibling;h.sibling=null,h=f}while(h!==null)}}Ve=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,Ve=s;else e:for(;Ve!==null;){if(o=Ve,o.flags&2048)switch(o.tag){case 0:case 11:case 15:wr(9,o,o.return)}var y=o.sibling;if(y!==null){y.return=o.return,Ve=y;break e}Ve=o.return}}var Z=e.current;for(Ve=Z;Ve!==null;){s=Ve;var p=s.child;if(s.subtreeFlags&2064&&p!==null)p.return=s,Ve=p;else e:for(s=Z;Ve!==null;){if(r=Ve,r.flags&2048)try{switch(r.tag){case 0:case 11:case 15:cC(9,r)}}catch(W){ht(r,r.return,W)}if(r===s){Ve=null;break e}var B=r.sibling;if(B!==null){B.return=r.return,Ve=B;break e}Ve=r.return}}if(Ee=i,Ki(),Ag&&typeof Ag.onPostCommitFiberRoot=="function")try{Ag.onPostCommitFiberRoot(iC,e)}catch{}g=!0}return g}finally{je=n,Mn.transition=t}}return!1}function Kp(e,t,n){t=ks(n,t),t=BB(e,t,1),e=Gi(e,t,1),t=rn(),e!==null&&(Bl(e,1,t),bn(e,t))}function ht(e,t,n){if(e.tag===3)Kp(e,e,n);else for(;t!==null;){if(t.tag===3){Kp(t,e,n);break}else if(t.tag===1){var g=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Bi===null||!Bi.has(g))){e=ks(n,e),e=SB(t,e,1),t=Gi(t,e,1),e=rn(),t!==null&&(Bl(t,1,e),bn(t,e));break}}t=t.return}}function J2(e,t,n){var g=e.pingCache;g!==null&&g.delete(t),t=rn(),e.pingedLanes|=e.suspendedLanes&n,Ht===e&&(Et&n)===n&&(Wt===4||Wt===3&&(Et&130023424)===Et&&500>yt()-nm?Ao(e,0):tm|=n),bn(e,t)}function zB(e,t){t===0&&(e.mode&1?(t=Ql,Ql<<=1,!(Ql&130023424)&&(Ql=4194304)):t=1);var n=rn();e=Tg(e,t),e!==null&&(Bl(e,t,n),bn(e,n))}function Y2(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),zB(e,n)}function H2(e,t){var n=0;switch(e.tag){case 13:var g=e.stateNode,i=e.memoizedState;i!==null&&(n=i.retryLane);break;case 19:g=e.stateNode;break;default:throw Error(Ge(314))}g!==null&&g.delete(t),zB(e,n)}var DB;DB=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||hn.current)un=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return un=!1,y2(e,t,n);un=!!(e.flags&131072)}else un=!1,lt&&t.flags&1048576&&OG(t,ha,t.index);switch(t.lanes=0,t.tag){case 2:var g=t.type;NI(e,t),e=t.pendingProps;var i=Vs(t,$t.current);Zs(t,n),i=Ph(null,t,g,e,i,n);var o=Oh();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,mn(g)?(o=!0,ua(t)):o=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Uh(t),i.updater=CC,t.stateNode=i,i._reactInternals=t,Od(t,g,e,n),t=$d(null,t,g,!0,o,n)):(t.tag=0,lt&&o&&Fh(t),gn(null,t,i,n),t=t.child),t;case 16:g=t.elementType;e:{switch(NI(e,t),e=t.pendingProps,i=g._init,g=i(g._payload),t.type=g,i=t.tag=F2(g),e=Pn(g,e),i){case 0:t=qd(null,t,g,e,n);break e;case 1:t=vp(null,t,g,e,n);break e;case 11:t=Wp(null,t,g,e,n);break e;case 14:t=Rp(null,t,g,Pn(g.type,e),n);break e}throw Error(Ge(306,g,""))}return t;case 0:return g=t.type,i=t.pendingProps,i=t.elementType===g?i:Pn(g,i),qd(e,t,g,i,n);case 1:return g=t.type,i=t.pendingProps,i=t.elementType===g?i:Pn(g,i),vp(e,t,g,i,n);case 3:e:{if(vB(t),e===null)throw Error(Ge(387));g=t.pendingProps,o=t.memoizedState,i=o.element,nB(e,t),pa(t,g,null,n);var s=t.memoizedState;if(g=s.element,o.isDehydrated)if(o={element:g,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){i=ks(Error(Ge(423)),t),t=kp(e,t,g,n,i);break e}else if(g!==i){i=ks(Error(Ge(424)),t),t=kp(e,t,g,n,i);break e}else for(Sn=yi(t.stateNode.containerInfo.firstChild),Vn=t,lt=!0,qn=null,n=eB(t,null,g,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ws(),g===i){t=Lg(e,t,n);break e}gn(e,t,g,n)}t=t.child}return t;case 5:return gB(t),e===null&&Qd(t),g=t.type,i=t.pendingProps,o=e!==null?e.memoizedProps:null,s=i.children,Td(g,i)?s=null:o!==null&&Td(g,o)&&(t.flags|=32),RB(e,t),gn(e,t,s,n),t.child;case 6:return e===null&&Qd(t),null;case 13:return kB(e,t,n);case 4:return zh(t,t.stateNode.containerInfo),g=t.pendingProps,e===null?t.child=Rs(t,null,g,n):gn(e,t,g,n),t.child;case 11:return g=t.type,i=t.pendingProps,i=t.elementType===g?i:Pn(g,i),Wp(e,t,g,i,n);case 7:return gn(e,t,t.pendingProps,n),t.child;case 8:return gn(e,t,t.pendingProps.children,n),t.child;case 12:return gn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(g=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,nt(ma,g._currentValue),g._currentValue=s,o!==null)if(ng(o.value,s)){if(o.children===i.children&&!hn.current){t=Lg(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var r=o.dependencies;if(r!==null){s=o.child;for(var l=r.firstContext;l!==null;){if(l.context===g){if(o.tag===1){l=Ng(-1,n&-n),l.tag=2;var I=o.updateQueue;if(I!==null){I=I.shared;var a=I.pending;a===null?l.next=l:(l.next=a.next,a.next=l),I.pending=l}}o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),jd(o.return,n,t),r.lanes|=n;break}l=l.next}}else if(o.tag===10)s=o.type===t.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Ge(341));s.lanes|=n,r=s.alternate,r!==null&&(r.lanes|=n),jd(s,n,t),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===t){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}gn(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,g=t.pendingProps.children,Zs(t,n),i=Ln(i),g=g(i),t.flags|=1,gn(e,t,g,n),t.child;case 14:return g=t.type,i=Pn(g,t.pendingProps),i=Pn(g.type,i),Rp(e,t,g,i,n);case 15:return VB(e,t,t.type,t.pendingProps,n);case 17:return g=t.type,i=t.pendingProps,i=t.elementType===g?i:Pn(g,i),NI(e,t),t.tag=1,mn(g)?(e=!0,ua(t)):e=!1,Zs(t,n),GB(t,g,i),Od(t,g,i,n),$d(null,t,g,!0,e,n);case 19:return XB(e,t,n);case 22:return WB(e,t,n)}throw Error(Ge(156,t.tag))};function QB(e,t){return fG(e,t)}function N2(e,t,n,g){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kn(e,t,n,g){return new N2(e,t,n,g)}function sm(e){return e=e.prototype,!(!e||!e.isReactComponent)}function F2(e){if(typeof e=="function")return sm(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Sh)return 11;if(e===Vh)return 14}return 2}function Vi(e,t){var n=e.alternate;return n===null?(n=Kn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function KI(e,t,n,g,i,o){var s=2;if(g=e,typeof e=="function")sm(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case $o:return ho(n.children,i,o,t);case Bh:s=8,i|=8;break;case fd:return e=Kn(12,n,t,i|2),e.elementType=fd,e.lanes=o,e;case Zd:return e=Kn(13,n,t,i),e.elementType=Zd,e.lanes=o,e;case yd:return e=Kn(19,n,t,i),e.elementType=yd,e.lanes=o,e;case gG:return uC(n,i,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case tG:s=10;break e;case nG:s=9;break e;case Sh:s=11;break e;case Vh:s=14;break e;case li:s=16,g=null;break e}throw Error(Ge(130,e==null?e:typeof e,""))}return t=Kn(s,n,t,i),t.elementType=e,t.type=g,t.lanes=o,t}function ho(e,t,n,g){return e=Kn(7,e,g,t),e.lanes=n,e}function uC(e,t,n,g){return e=Kn(22,e,g,t),e.elementType=gG,e.lanes=n,e.stateNode={isHidden:!1},e}function Vc(e,t,n){return e=Kn(6,e,null,t),e.lanes=n,e}function Wc(e,t,n){return t=Kn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function x2(e,t,n,g,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rc(0),this.expirationTimes=rc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rc(0),this.identifierPrefix=g,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function rm(e,t,n,g,i,o,s,r,l){return e=new x2(e,t,n,r,l),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Kn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:g,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uh(o),e}function K2(e,t,n){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:qo,key:g==null?null:""+g,children:e,containerInfo:t,implementation:n}}function jB(e){if(!e)return Ji;e=e._reactInternals;e:{if(Fo(e)!==e||e.tag!==1)throw Error(Ge(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(mn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Ge(171))}if(e.tag===1){var n=e.type;if(mn(n))return jG(e,n,t)}return t}function PB(e,t,n,g,i,o,s,r,l){return e=rm(n,g,!0,e,i,o,s,r,l),e.context=jB(null),n=e.current,g=rn(),i=Si(n),o=Ng(g,i),o.callback=t??null,Gi(n,o,i),e.current.lanes=i,Bl(e,i,g),bn(e,g),e}function AC(e,t,n,g){var i=t.current,o=rn(),s=Si(i);return n=jB(n),t.context===null?t.context=n:t.pendingContext=n,t=Ng(o,s),t.payload={element:e},g=g===void 0?null:g,g!==null&&(t.callback=g),e=Gi(i,t,s),e!==null&&(eg(e,i,s,o),JI(e,i,s)),s}function Wa(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Ep(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function lm(e,t){Ep(e,t),(e=e.alternate)&&Ep(e,t)}function E2(){return null}var OB=typeof reportError=="function"?reportError:function(e){console.error(e)};function Im(e){this._internalRoot=e}hC.prototype.render=Im.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Ge(409));AC(e,t,null,null)};hC.prototype.unmount=Im.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;vo(function(){AC(null,e,null,null)}),t[Mg]=null}};function hC(e){this._internalRoot=e}hC.prototype.unstable_scheduleHydration=function(e){if(e){var t=WG();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ci.length&&t!==0&&t<Ci[n].priority;n++);Ci.splice(n,0,e),n===0&&vG(e)}};function am(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function mC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Mp(){}function M2(e,t,n,g,i){if(i){if(typeof g=="function"){var o=g;g=function(){var I=Wa(s);o.call(I)}}var s=PB(t,g,e,0,null,!1,!1,"",Mp);return e._reactRootContainer=s,e[Mg]=s.current,qr(e.nodeType===8?e.parentNode:e),vo(),s}for(;i=e.lastChild;)e.removeChild(i);if(typeof g=="function"){var r=g;g=function(){var I=Wa(l);r.call(I)}}var l=rm(e,0,!1,null,null,!1,!1,"",Mp);return e._reactRootContainer=l,e[Mg]=l.current,qr(e.nodeType===8?e.parentNode:e),vo(function(){AC(t,l,n,g)}),l}function bC(e,t,n,g,i){var o=n._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var r=i;i=function(){var l=Wa(s);r.call(l)}}AC(t,s,e,i)}else s=M2(n,t,e,i,g);return Wa(s)}SG=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ar(t.pendingLanes);n!==0&&(vh(t,n|1),bn(t,yt()),!(Ee&6)&&(Xs=yt()+500,Ki()))}break;case 13:vo(function(){var g=Tg(e,1);if(g!==null){var i=rn();eg(g,e,1,i)}}),lm(e,1)}};kh=function(e){if(e.tag===13){var t=Tg(e,134217728);if(t!==null){var n=rn();eg(t,e,134217728,n)}lm(e,134217728)}};VG=function(e){if(e.tag===13){var t=Si(e),n=Tg(e,t);if(n!==null){var g=rn();eg(n,e,t,g)}lm(e,t)}};WG=function(){return je};RG=function(e,t){var n=je;try{return je=e,t()}finally{je=n}};wd=function(e,t,n){switch(t){case"input":if(Sd(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var g=n[t];if(g!==e&&g.form===e.form){var i=lC(g);if(!i)throw Error(Ge(90));oG(g),Sd(g,i)}}}break;case"textarea":rG(e,n);break;case"select":t=n.value,t!=null&&ms(e,!!n.multiple,t,!1)}};uG=gm;AG=vo;var T2={usingClientEntryPoint:!1,Events:[Vl,gs,lC,cG,dG,gm]},er={findFiberByHostInstance:ro,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},L2={bundleType:er.bundleType,version:er.version,rendererPackageName:er.rendererPackageName,rendererConfig:er.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jg.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=bG(e),e===null?null:e.stateNode},findFiberByHostInstance:er.findFiberByHostInstance||E2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var iI=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iI.isDisabled&&iI.supportsFiber)try{iC=iI.inject(L2),Ag=iI}catch{}}vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T2;vn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!am(t))throw Error(Ge(200));return K2(e,t,null,n)};vn.createRoot=function(e,t){if(!am(e))throw Error(Ge(299));var n=!1,g="",i=OB;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(g=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=rm(e,1,!1,null,null,n,!1,g,i),e[Mg]=t.current,qr(e.nodeType===8?e.parentNode:e),new Im(t)};vn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Ge(188)):(e=Object.keys(e).join(","),Error(Ge(268,e)));return e=bG(t),e=e===null?null:e.stateNode,e};vn.flushSync=function(e){return vo(e)};vn.hydrate=function(e,t,n){if(!mC(t))throw Error(Ge(200));return bC(null,e,t,!0,n)};vn.hydrateRoot=function(e,t,n){if(!am(e))throw Error(Ge(405));var g=n!=null&&n.hydratedSources||null,i=!1,o="",s=OB;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=PB(t,null,e,1,n??null,i,!1,o,s),e[Mg]=t.current,qr(e),g)for(e=0;e<g.length;e++)n=g[e],i=n._getVersion,i=i(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new hC(t)};vn.render=function(e,t,n){if(!mC(t))throw Error(Ge(200));return bC(null,e,t,!1,n)};vn.unmountComponentAtNode=function(e){if(!mC(e))throw Error(Ge(40));return e._reactRootContainer?(vo(function(){bC(null,null,e,!1,function(){e._reactRootContainer=null,e[Mg]=null})}),!0):!1};vn.unstable_batchedUpdates=gm;vn.unstable_renderSubtreeIntoContainer=function(e,t,n,g){if(!mC(n))throw Error(Ge(200));if(e==null||e._reactInternals===void 0)throw Error(Ge(38));return bC(e,t,n,!1,g)};vn.version="18.3.1-next-f1338f8080-20240426";function _B(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_B)}catch(e){console.error(e)}}_B(),_y.exports=vn;var U2=_y.exports,Tp=U2;bd.createRoot=Tp.createRoot,bd.hydrateRoot=Tp.hydrateRoot;/**
 * @remix-run/router v1.16.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rl(){return rl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var g in n)Object.prototype.hasOwnProperty.call(n,g)&&(e[g]=n[g])}return e},rl.apply(this,arguments)}var Ai;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Ai||(Ai={}));const Lp="popstate";function z2(e){e===void 0&&(e={});function t(g,i){let{pathname:o,search:s,hash:r}=g.location;return Cu("",{pathname:o,search:s,hash:r},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(g,i){return typeof i=="string"?i:$B(i)}return Q2(t,n,null,e)}function St(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function qB(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function D2(){return Math.random().toString(36).substr(2,8)}function Up(e,t){return{usr:e.state,key:e.key,idx:t}}function Cu(e,t,n,g){return n===void 0&&(n=null),rl({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Es(t):t,{state:n,key:t&&t.key||g||D2()})}function $B(e){let{pathname:t="/",search:n="",hash:g=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),g&&g!=="#"&&(t+=g.charAt(0)==="#"?g:"#"+g),t}function Es(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let g=e.indexOf("?");g>=0&&(t.search=e.substr(g),e=e.substr(0,g)),e&&(t.pathname=e)}return t}function Q2(e,t,n,g){g===void 0&&(g={});let{window:i=document.defaultView,v5Compat:o=!1}=g,s=i.history,r=Ai.Pop,l=null,I=a();I==null&&(I=0,s.replaceState(rl({},s.state,{idx:I}),""));function a(){return(s.state||{idx:null}).idx}function C(){r=Ai.Pop;let f=a(),y=f==null?null:f-I;I=f,l&&l({action:r,location:h.location,delta:y})}function c(f,y){r=Ai.Push;let Z=Cu(h.location,f,y);I=a()+1;let p=Up(Z,I),B=h.createHref(Z);try{s.pushState(p,"",B)}catch(W){if(W instanceof DOMException&&W.name==="DataCloneError")throw W;i.location.assign(B)}o&&l&&l({action:r,location:h.location,delta:1})}function d(f,y){r=Ai.Replace;let Z=Cu(h.location,f,y);I=a();let p=Up(Z,I),B=h.createHref(Z);s.replaceState(p,"",B),o&&l&&l({action:r,location:h.location,delta:0})}function u(f){let y=i.location.origin!=="null"?i.location.origin:i.location.href,Z=typeof f=="string"?f:$B(f);return Z=Z.replace(/ $/,"%20"),St(y,"No window.location.(origin|href) available to create URL for href: "+Z),new URL(Z,y)}let h={get action(){return r},get location(){return e(i,s)},listen(f){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(Lp,C),l=f,()=>{i.removeEventListener(Lp,C),l=null}},createHref(f){return t(i,f)},createURL:u,encodeLocation(f){let y=u(f);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:c,replace:d,go(f){return s.go(f)}};return h}var zp;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(zp||(zp={}));function j2(e,t,n){n===void 0&&(n="/");let g=typeof t=="string"?Es(t):t,i=nS(g.pathname||"/",n);if(i==null)return null;let o=eS(e);P2(o);let s=null;for(let r=0;s==null&&r<o.length;++r){let l=rw(i);s=iw(o[r],l)}return s}function eS(e,t,n,g){t===void 0&&(t=[]),n===void 0&&(n=[]),g===void 0&&(g="");let i=(o,s,r)=>{let l={relativePath:r===void 0?o.path||"":r,caseSensitive:o.caseSensitive===!0,childrenIndex:s,route:o};l.relativePath.startsWith("/")&&(St(l.relativePath.startsWith(g),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+g+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(g.length));let I=mo([g,l.relativePath]),a=n.concat(l);o.children&&o.children.length>0&&(St(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),eS(o.children,t,a,I)),!(o.path==null&&!o.index)&&t.push({path:I,score:nw(I,o.index),routesMeta:a})};return e.forEach((o,s)=>{var r;if(o.path===""||!((r=o.path)!=null&&r.includes("?")))i(o,s);else for(let l of tS(o.path))i(o,s,l)}),t}function tS(e){let t=e.split("/");if(t.length===0)return[];let[n,...g]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(g.length===0)return i?[o,""]:[o];let s=tS(g.join("/")),r=[];return r.push(...s.map(l=>l===""?o:[o,l].join("/"))),i&&r.push(...s),r.map(l=>e.startsWith("/")&&l===""?"/":l)}function P2(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:gw(t.routesMeta.map(g=>g.childrenIndex),n.routesMeta.map(g=>g.childrenIndex)))}const O2=/^:[\w-]+$/,_2=3,q2=2,$2=1,ew=10,tw=-2,Dp=e=>e==="*";function nw(e,t){let n=e.split("/"),g=n.length;return n.some(Dp)&&(g+=tw),t&&(g+=q2),n.filter(i=>!Dp(i)).reduce((i,o)=>i+(O2.test(o)?_2:o===""?$2:ew),g)}function gw(e,t){return e.length===t.length&&e.slice(0,-1).every((g,i)=>g===t[i])?e[e.length-1]-t[t.length-1]:0}function iw(e,t){let{routesMeta:n}=e,g={},i="/",o=[];for(let s=0;s<n.length;++s){let r=n[s],l=s===n.length-1,I=i==="/"?t:t.slice(i.length)||"/",a=ow({path:r.relativePath,caseSensitive:r.caseSensitive,end:l},I);if(!a)return null;Object.assign(g,a.params);let C=r.route;o.push({params:g,pathname:mo([i,a.pathname]),pathnameBase:Cw(mo([i,a.pathnameBase])),route:C}),a.pathnameBase!=="/"&&(i=mo([i,a.pathnameBase]))}return o}function ow(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,g]=sw(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),r=i.slice(1);return{params:g.reduce((I,a,C)=>{let{paramName:c,isOptional:d}=a;if(c==="*"){let h=r[C]||"";s=o.slice(0,o.length-h.length).replace(/(.)\/+$/,"$1")}const u=r[C];return d&&!u?I[c]=void 0:I[c]=(u||"").replace(/%2F/g,"/"),I},{}),pathname:o,pathnameBase:s,pattern:e}}function sw(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),qB(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let g=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,r,l)=>(g.push({paramName:r,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(g.push({paramName:"*"}),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),g]}function rw(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return qB(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function nS(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,g=e.charAt(n);return g&&g!=="/"?null:e.slice(n)||"/"}function lw(e,t){t===void 0&&(t="/");let{pathname:n,search:g="",hash:i=""}=typeof e=="string"?Es(e):e;return{pathname:n?n.startsWith("/")?n:Iw(n,t):t,search:cw(g),hash:dw(i)}}function Iw(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Rc(e,t,n,g){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(g)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function aw(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function gS(e,t){let n=aw(e);return t?n.map((g,i)=>i===e.length-1?g.pathname:g.pathnameBase):n.map(g=>g.pathnameBase)}function iS(e,t,n,g){g===void 0&&(g=!1);let i;typeof e=="string"?i=Es(e):(i=rl({},e),St(!i.pathname||!i.pathname.includes("?"),Rc("?","pathname","search",i)),St(!i.pathname||!i.pathname.includes("#"),Rc("#","pathname","hash",i)),St(!i.search||!i.search.includes("#"),Rc("#","search","hash",i)));let o=e===""||i.pathname==="",s=o?"/":i.pathname,r;if(s==null)r=n;else{let C=t.length-1;if(!g&&s.startsWith("..")){let c=s.split("/");for(;c[0]==="..";)c.shift(),C-=1;i.pathname=c.join("/")}r=C>=0?t[C]:"/"}let l=lw(i,r),I=s&&s!=="/"&&s.endsWith("/"),a=(o||s===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(I||a)&&(l.pathname+="/"),l}const mo=e=>e.join("/").replace(/\/\/+/g,"/"),Cw=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),cw=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,dw=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function uw(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const oS=["post","put","patch","delete"];new Set(oS);const Aw=["get",...oS];new Set(Aw);/**
 * React Router v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ll(){return ll=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var g in n)Object.prototype.hasOwnProperty.call(n,g)&&(e[g]=n[g])}return e},ll.apply(this,arguments)}const Cm=H.createContext(null),hw=H.createContext(null),Rl=H.createContext(null),pC=H.createContext(null),Pg=H.createContext({outlet:null,matches:[],isDataRoute:!1}),sS=H.createContext(null);function vl(){return H.useContext(pC)!=null}function cm(){return vl()||St(!1),H.useContext(pC).location}function rS(e){H.useContext(Rl).static||H.useLayoutEffect(e)}function Ei(){let{isDataRoute:e}=H.useContext(Pg);return e?Xw():mw()}function mw(){vl()||St(!1);let e=H.useContext(Cm),{basename:t,future:n,navigator:g}=H.useContext(Rl),{matches:i}=H.useContext(Pg),{pathname:o}=cm(),s=JSON.stringify(gS(i,n.v7_relativeSplatPath)),r=H.useRef(!1);return rS(()=>{r.current=!0}),H.useCallback(function(I,a){if(a===void 0&&(a={}),!r.current)return;if(typeof I=="number"){g.go(I);return}let C=iS(I,JSON.parse(s),o,a.relative==="path");e==null&&t!=="/"&&(C.pathname=C.pathname==="/"?t:mo([t,C.pathname])),(a.replace?g.replace:g.push)(C,a.state,a)},[t,g,s,o,e])}const bw=H.createContext(null);function pw(e){let t=H.useContext(Pg).outlet;return t&&H.createElement(bw.Provider,{value:e},t)}function lS(){let{matches:e}=H.useContext(Pg),t=e[e.length-1];return t?t.params:{}}function fw(e,t){return Zw(e,t)}function Zw(e,t,n,g){vl()||St(!1);let{navigator:i}=H.useContext(Rl),{matches:o}=H.useContext(Pg),s=o[o.length-1],r=s?s.params:{};s&&s.pathname;let l=s?s.pathnameBase:"/";s&&s.route;let I=cm(),a;if(t){var C;let f=typeof t=="string"?Es(t):t;l==="/"||(C=f.pathname)!=null&&C.startsWith(l)||St(!1),a=f}else a=I;let c=a.pathname||"/",d=c;if(l!=="/"){let f=l.replace(/^\//,"").split("/");d="/"+c.replace(/^\//,"").split("/").slice(f.length).join("/")}let u=j2(e,{pathname:d}),h=Vw(u&&u.map(f=>Object.assign({},f,{params:Object.assign({},r,f.params),pathname:mo([l,i.encodeLocation?i.encodeLocation(f.pathname).pathname:f.pathname]),pathnameBase:f.pathnameBase==="/"?l:mo([l,i.encodeLocation?i.encodeLocation(f.pathnameBase).pathname:f.pathnameBase])})),o,n,g);return t&&h?H.createElement(pC.Provider,{value:{location:ll({pathname:"/",search:"",hash:"",state:null,key:"default"},a),navigationType:Ai.Pop}},h):h}function yw(){let e=kw(),t=uw(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},t),n?H.createElement("pre",{style:i},n):null,null)}const Gw=H.createElement(yw,null);class Bw extends H.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?H.createElement(Pg.Provider,{value:this.props.routeContext},H.createElement(sS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Sw(e){let{routeContext:t,match:n,children:g}=e,i=H.useContext(Cm);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),H.createElement(Pg.Provider,{value:t},g)}function Vw(e,t,n,g){var i;if(t===void 0&&(t=[]),n===void 0&&(n=null),g===void 0&&(g=null),e==null){var o;if((o=n)!=null&&o.errors)e=n.matches;else return null}let s=e,r=(i=n)==null?void 0:i.errors;if(r!=null){let a=s.findIndex(C=>C.route.id&&(r==null?void 0:r[C.route.id])!==void 0);a>=0||St(!1),s=s.slice(0,Math.min(s.length,a+1))}let l=!1,I=-1;if(n&&g&&g.v7_partialHydration)for(let a=0;a<s.length;a++){let C=s[a];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(I=a),C.route.id){let{loaderData:c,errors:d}=n,u=C.route.loader&&c[C.route.id]===void 0&&(!d||d[C.route.id]===void 0);if(C.route.lazy||u){l=!0,I>=0?s=s.slice(0,I+1):s=[s[0]];break}}}return s.reduceRight((a,C,c)=>{let d,u=!1,h=null,f=null;n&&(d=r&&C.route.id?r[C.route.id]:void 0,h=C.route.errorElement||Gw,l&&(I<0&&c===0?(u=!0,f=null):I===c&&(u=!0,f=C.route.hydrateFallbackElement||null)));let y=t.concat(s.slice(0,c+1)),Z=()=>{let p;return d?p=h:u?p=f:C.route.Component?p=H.createElement(C.route.Component,null):C.route.element?p=C.route.element:p=a,H.createElement(Sw,{match:C,routeContext:{outlet:a,matches:y,isDataRoute:n!=null},children:p})};return n&&(C.route.ErrorBoundary||C.route.errorElement||c===0)?H.createElement(Bw,{location:n.location,revalidation:n.revalidation,component:h,error:d,children:Z(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):Z()},null)}var IS=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(IS||{}),Ra=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ra||{});function Ww(e){let t=H.useContext(Cm);return t||St(!1),t}function Rw(e){let t=H.useContext(hw);return t||St(!1),t}function vw(e){let t=H.useContext(Pg);return t||St(!1),t}function aS(e){let t=vw(),n=t.matches[t.matches.length-1];return n.route.id||St(!1),n.route.id}function kw(){var e;let t=H.useContext(sS),n=Rw(Ra.UseRouteError),g=aS(Ra.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[g]}function Xw(){let{router:e}=Ww(IS.UseNavigateStable),t=aS(Ra.UseNavigateStable),n=H.useRef(!1);return rS(()=>{n.current=!0}),H.useCallback(function(i,o){o===void 0&&(o={}),n.current&&(typeof i=="number"?e.navigate(i):e.navigate(i,ll({fromRouteId:t},o)))},[e,t])}function Wi(e){let{to:t,replace:n,state:g,relative:i}=e;vl()||St(!1);let{future:o,static:s}=H.useContext(Rl),{matches:r}=H.useContext(Pg),{pathname:l}=cm(),I=Ei(),a=iS(t,gS(r,o.v7_relativeSplatPath),l,i==="path"),C=JSON.stringify(a);return H.useEffect(()=>I(JSON.parse(C),{replace:n,state:g,relative:i}),[I,C,i,n,g]),null}function ww(e){return pw(e.context)}function Ye(e){St(!1)}function Jw(e){let{basename:t="/",children:n=null,location:g,navigationType:i=Ai.Pop,navigator:o,static:s=!1,future:r}=e;vl()&&St(!1);let l=t.replace(/^\/*/,"/"),I=H.useMemo(()=>({basename:l,navigator:o,static:s,future:ll({v7_relativeSplatPath:!1},r)}),[l,r,o,s]);typeof g=="string"&&(g=Es(g));let{pathname:a="/",search:C="",hash:c="",state:d=null,key:u="default"}=g,h=H.useMemo(()=>{let f=nS(a,l);return f==null?null:{location:{pathname:f,search:C,hash:c,state:d,key:u},navigationType:i}},[l,a,C,c,d,u,i]);return h==null?null:H.createElement(Rl.Provider,{value:I},H.createElement(pC.Provider,{children:n,value:h}))}function Ms(e){let{children:t,location:n}=e;return fw(cu(t),n)}new Promise(()=>{});function cu(e,t){t===void 0&&(t=[]);let n=[];return H.Children.forEach(e,(g,i)=>{if(!H.isValidElement(g))return;let o=[...t,i];if(g.type===H.Fragment){n.push.apply(n,cu(g.props.children,o));return}g.type!==Ye&&St(!1),!g.props.index||!g.props.children||St(!1);let s={id:g.props.id||o.join("-"),caseSensitive:g.props.caseSensitive,element:g.props.element,Component:g.props.Component,index:g.props.index,path:g.props.path,loader:g.props.loader,action:g.props.action,errorElement:g.props.errorElement,ErrorBoundary:g.props.ErrorBoundary,hasErrorBoundary:g.props.ErrorBoundary!=null||g.props.errorElement!=null,shouldRevalidate:g.props.shouldRevalidate,handle:g.props.handle,lazy:g.props.lazy};g.props.children&&(s.children=cu(g.props.children,o)),n.push(s)}),n}/**
 * React Router DOM v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Yw="6";try{window.__reactRouterVersion=Yw}catch{}const Hw="startTransition",Qp=Rk[Hw];function Nw(e){let{basename:t,children:n,future:g,window:i}=e,o=H.useRef();o.current==null&&(o.current=z2({window:i,v5Compat:!0}));let s=o.current,[r,l]=H.useState({action:s.action,location:s.location}),{v7_startTransition:I}=g||{},a=H.useCallback(C=>{I&&Qp?Qp(()=>l(C)):l(C)},[l,I]);return H.useLayoutEffect(()=>s.listen(a),[s,a]),H.createElement(Jw,{basename:t,children:n,location:r.location,navigationType:r.action,navigator:s,future:g})}var jp;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(jp||(jp={}));var Pp;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Pp||(Pp={}));const tr=({canActivate:e,requiredRole:t})=>{const n=localStorage.getItem("access_token"),g=localStorage.getItem("role");return console.log("Verificando acceso con token:",n),console.log("Verificando acceso con rol:",g),!n||!g?G.jsx(Wi,{to:"/"}):t&&g!==t?G.jsx(Wi,{to:"/"}):e?G.jsx(ww,{}):G.jsx(Wi,{to:"/"})},Fw="/assets/google-KGMh1rWy.svg",xw="/assets/Logo-DN3Dznic.png";function CS(e,t){return function(){return e.apply(t,arguments)}}const{toString:Kw}=Object.prototype,{getPrototypeOf:dm}=Object,fC=(e=>t=>{const n=Kw.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),gg=e=>(e=e.toLowerCase(),t=>fC(t)===e),ZC=e=>t=>typeof t===e,{isArray:Ts}=Array,Il=ZC("undefined");function Ew(e){return e!==null&&!Il(e)&&e.constructor!==null&&!Il(e.constructor)&&Tn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const cS=gg("ArrayBuffer");function Mw(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&cS(e.buffer),t}const Tw=ZC("string"),Tn=ZC("function"),dS=ZC("number"),yC=e=>e!==null&&typeof e=="object",Lw=e=>e===!0||e===!1,EI=e=>{if(fC(e)!=="object")return!1;const t=dm(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Uw=gg("Date"),zw=gg("File"),Dw=gg("Blob"),Qw=gg("FileList"),jw=e=>yC(e)&&Tn(e.pipe),Pw=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Tn(e.append)&&((t=fC(e))==="formdata"||t==="object"&&Tn(e.toString)&&e.toString()==="[object FormData]"))},Ow=gg("URLSearchParams"),[_w,qw,$w,eJ]=["ReadableStream","Request","Response","Headers"].map(gg),tJ=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function kl(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let g,i;if(typeof e!="object"&&(e=[e]),Ts(e))for(g=0,i=e.length;g<i;g++)t.call(null,e[g],g,e);else{const o=n?Object.getOwnPropertyNames(e):Object.keys(e),s=o.length;let r;for(g=0;g<s;g++)r=o[g],t.call(null,e[r],r,e)}}function uS(e,t){t=t.toLowerCase();const n=Object.keys(e);let g=n.length,i;for(;g-- >0;)if(i=n[g],t===i.toLowerCase())return i;return null}const AS=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,hS=e=>!Il(e)&&e!==AS;function du(){const{caseless:e}=hS(this)&&this||{},t={},n=(g,i)=>{const o=e&&uS(t,i)||i;EI(t[o])&&EI(g)?t[o]=du(t[o],g):EI(g)?t[o]=du({},g):Ts(g)?t[o]=g.slice():t[o]=g};for(let g=0,i=arguments.length;g<i;g++)arguments[g]&&kl(arguments[g],n);return t}const nJ=(e,t,n,{allOwnKeys:g}={})=>(kl(t,(i,o)=>{n&&Tn(i)?e[o]=CS(i,n):e[o]=i},{allOwnKeys:g}),e),gJ=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),iJ=(e,t,n,g)=>{e.prototype=Object.create(t.prototype,g),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},oJ=(e,t,n,g)=>{let i,o,s;const r={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)s=i[o],(!g||g(s,e,t))&&!r[s]&&(t[s]=e[s],r[s]=!0);e=n!==!1&&dm(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},sJ=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const g=e.indexOf(t,n);return g!==-1&&g===n},rJ=e=>{if(!e)return null;if(Ts(e))return e;let t=e.length;if(!dS(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},lJ=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&dm(Uint8Array)),IJ=(e,t)=>{const g=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=g.next())&&!i.done;){const o=i.value;t.call(e,o[0],o[1])}},aJ=(e,t)=>{let n;const g=[];for(;(n=e.exec(t))!==null;)g.push(n);return g},CJ=gg("HTMLFormElement"),cJ=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,g,i){return g.toUpperCase()+i}),Op=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),dJ=gg("RegExp"),mS=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),g={};kl(n,(i,o)=>{let s;(s=t(i,o,e))!==!1&&(g[o]=s||i)}),Object.defineProperties(e,g)},uJ=e=>{mS(e,(t,n)=>{if(Tn(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const g=e[n];if(Tn(g)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},AJ=(e,t)=>{const n={},g=i=>{i.forEach(o=>{n[o]=!0})};return Ts(e)?g(e):g(String(e).split(t)),n},hJ=()=>{},mJ=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,vc="abcdefghijklmnopqrstuvwxyz",_p="0123456789",bS={DIGIT:_p,ALPHA:vc,ALPHA_DIGIT:vc+vc.toUpperCase()+_p},bJ=(e=16,t=bS.ALPHA_DIGIT)=>{let n="";const{length:g}=t;for(;e--;)n+=t[Math.random()*g|0];return n};function pJ(e){return!!(e&&Tn(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const fJ=e=>{const t=new Array(10),n=(g,i)=>{if(yC(g)){if(t.indexOf(g)>=0)return;if(!("toJSON"in g)){t[i]=g;const o=Ts(g)?[]:{};return kl(g,(s,r)=>{const l=n(s,i+1);!Il(l)&&(o[r]=l)}),t[i]=void 0,o}}return g};return n(e,0)},ZJ=gg("AsyncFunction"),yJ=e=>e&&(yC(e)||Tn(e))&&Tn(e.then)&&Tn(e.catch),oe={isArray:Ts,isArrayBuffer:cS,isBuffer:Ew,isFormData:Pw,isArrayBufferView:Mw,isString:Tw,isNumber:dS,isBoolean:Lw,isObject:yC,isPlainObject:EI,isReadableStream:_w,isRequest:qw,isResponse:$w,isHeaders:eJ,isUndefined:Il,isDate:Uw,isFile:zw,isBlob:Dw,isRegExp:dJ,isFunction:Tn,isStream:jw,isURLSearchParams:Ow,isTypedArray:lJ,isFileList:Qw,forEach:kl,merge:du,extend:nJ,trim:tJ,stripBOM:gJ,inherits:iJ,toFlatObject:oJ,kindOf:fC,kindOfTest:gg,endsWith:sJ,toArray:rJ,forEachEntry:IJ,matchAll:aJ,isHTMLForm:CJ,hasOwnProperty:Op,hasOwnProp:Op,reduceDescriptors:mS,freezeMethods:uJ,toObjectSet:AJ,toCamelCase:cJ,noop:hJ,toFiniteNumber:mJ,findKey:uS,global:AS,isContextDefined:hS,ALPHABET:bS,generateString:bJ,isSpecCompliantForm:pJ,toJSONObject:fJ,isAsyncFn:ZJ,isThenable:yJ};function He(e,t,n,g,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),g&&(this.request=g),i&&(this.response=i)}oe.inherits(He,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:oe.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const pS=He.prototype,fS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{fS[e]={value:e}});Object.defineProperties(He,fS);Object.defineProperty(pS,"isAxiosError",{value:!0});He.from=(e,t,n,g,i,o)=>{const s=Object.create(pS);return oe.toFlatObject(e,s,function(l){return l!==Error.prototype},r=>r!=="isAxiosError"),He.call(s,e.message,t,n,g,i),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const GJ=null;function uu(e){return oe.isPlainObject(e)||oe.isArray(e)}function ZS(e){return oe.endsWith(e,"[]")?e.slice(0,-2):e}function qp(e,t,n){return e?e.concat(t).map(function(i,o){return i=ZS(i),!n&&o?"["+i+"]":i}).join(n?".":""):t}function BJ(e){return oe.isArray(e)&&!e.some(uu)}const SJ=oe.toFlatObject(oe,{},null,function(t){return/^is[A-Z]/.test(t)});function GC(e,t,n){if(!oe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=oe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,f){return!oe.isUndefined(f[h])});const g=n.metaTokens,i=n.visitor||a,o=n.dots,s=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&oe.isSpecCompliantForm(t);if(!oe.isFunction(i))throw new TypeError("visitor must be a function");function I(u){if(u===null)return"";if(oe.isDate(u))return u.toISOString();if(!l&&oe.isBlob(u))throw new He("Blob is not supported. Use a Buffer instead.");return oe.isArrayBuffer(u)||oe.isTypedArray(u)?l&&typeof Blob=="function"?new Blob([u]):Buffer.from(u):u}function a(u,h,f){let y=u;if(u&&!f&&typeof u=="object"){if(oe.endsWith(h,"{}"))h=g?h:h.slice(0,-2),u=JSON.stringify(u);else if(oe.isArray(u)&&BJ(u)||(oe.isFileList(u)||oe.endsWith(h,"[]"))&&(y=oe.toArray(u)))return h=ZS(h),y.forEach(function(p,B){!(oe.isUndefined(p)||p===null)&&t.append(s===!0?qp([h],B,o):s===null?h:h+"[]",I(p))}),!1}return uu(u)?!0:(t.append(qp(f,h,o),I(u)),!1)}const C=[],c=Object.assign(SJ,{defaultVisitor:a,convertValue:I,isVisitable:uu});function d(u,h){if(!oe.isUndefined(u)){if(C.indexOf(u)!==-1)throw Error("Circular reference detected in "+h.join("."));C.push(u),oe.forEach(u,function(y,Z){(!(oe.isUndefined(y)||y===null)&&i.call(t,y,oe.isString(Z)?Z.trim():Z,h,c))===!0&&d(y,h?h.concat(Z):[Z])}),C.pop()}}if(!oe.isObject(e))throw new TypeError("data must be an object");return d(e),t}function $p(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(g){return t[g]})}function um(e,t){this._pairs=[],e&&GC(e,this,t)}const yS=um.prototype;yS.append=function(t,n){this._pairs.push([t,n])};yS.toString=function(t){const n=t?function(g){return t.call(this,g,$p)}:$p;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};function VJ(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function GS(e,t,n){if(!t)return e;const g=n&&n.encode||VJ,i=n&&n.serialize;let o;if(i?o=i(t,n):o=oe.isURLSearchParams(t)?t.toString():new um(t,n).toString(g),o){const s=e.indexOf("#");s!==-1&&(e=e.slice(0,s)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}class e0{constructor(){this.handlers=[]}use(t,n,g){return this.handlers.push({fulfilled:t,rejected:n,synchronous:g?g.synchronous:!1,runWhen:g?g.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){oe.forEach(this.handlers,function(g){g!==null&&t(g)})}}const BS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},WJ=typeof URLSearchParams<"u"?URLSearchParams:um,RJ=typeof FormData<"u"?FormData:null,vJ=typeof Blob<"u"?Blob:null,kJ={isBrowser:!0,classes:{URLSearchParams:WJ,FormData:RJ,Blob:vJ},protocols:["http","https","file","blob","url","data"]},Am=typeof window<"u"&&typeof document<"u",XJ=(e=>Am&&["ReactNative","NativeScript","NS"].indexOf(e)<0)(typeof navigator<"u"&&navigator.product),wJ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",JJ=Am&&window.location.href||"http://localhost",YJ=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Am,hasStandardBrowserEnv:XJ,hasStandardBrowserWebWorkerEnv:wJ,origin:JJ},Symbol.toStringTag,{value:"Module"})),tg={...YJ,...kJ};function HJ(e,t){return GC(e,new tg.classes.URLSearchParams,Object.assign({visitor:function(n,g,i,o){return tg.isNode&&oe.isBuffer(n)?(this.append(g,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}function NJ(e){return oe.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function FJ(e){const t={},n=Object.keys(e);let g;const i=n.length;let o;for(g=0;g<i;g++)o=n[g],t[o]=e[o];return t}function SS(e){function t(n,g,i,o){let s=n[o++];if(s==="__proto__")return!0;const r=Number.isFinite(+s),l=o>=n.length;return s=!s&&oe.isArray(i)?i.length:s,l?(oe.hasOwnProp(i,s)?i[s]=[i[s],g]:i[s]=g,!r):((!i[s]||!oe.isObject(i[s]))&&(i[s]=[]),t(n,g,i[s],o)&&oe.isArray(i[s])&&(i[s]=FJ(i[s])),!r)}if(oe.isFormData(e)&&oe.isFunction(e.entries)){const n={};return oe.forEachEntry(e,(g,i)=>{t(NJ(g),i,n,0)}),n}return null}function xJ(e,t,n){if(oe.isString(e))try{return(t||JSON.parse)(e),oe.trim(e)}catch(g){if(g.name!=="SyntaxError")throw g}return(n||JSON.stringify)(e)}const Xl={transitional:BS,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const g=n.getContentType()||"",i=g.indexOf("application/json")>-1,o=oe.isObject(t);if(o&&oe.isHTMLForm(t)&&(t=new FormData(t)),oe.isFormData(t))return i?JSON.stringify(SS(t)):t;if(oe.isArrayBuffer(t)||oe.isBuffer(t)||oe.isStream(t)||oe.isFile(t)||oe.isBlob(t)||oe.isReadableStream(t))return t;if(oe.isArrayBufferView(t))return t.buffer;if(oe.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let r;if(o){if(g.indexOf("application/x-www-form-urlencoded")>-1)return HJ(t,this.formSerializer).toString();if((r=oe.isFileList(t))||g.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return GC(r?{"files[]":t}:t,l&&new l,this.formSerializer)}}return o||i?(n.setContentType("application/json",!1),xJ(t)):t}],transformResponse:[function(t){const n=this.transitional||Xl.transitional,g=n&&n.forcedJSONParsing,i=this.responseType==="json";if(oe.isResponse(t)||oe.isReadableStream(t))return t;if(t&&oe.isString(t)&&(g&&!this.responseType||i)){const s=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(r){if(s)throw r.name==="SyntaxError"?He.from(r,He.ERR_BAD_RESPONSE,this,null,this.response):r}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:tg.classes.FormData,Blob:tg.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};oe.forEach(["delete","get","head","post","put","patch"],e=>{Xl.headers[e]={}});const KJ=oe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),EJ=e=>{const t={};let n,g,i;return e&&e.split(`
`).forEach(function(s){i=s.indexOf(":"),n=s.substring(0,i).trim().toLowerCase(),g=s.substring(i+1).trim(),!(!n||t[n]&&KJ[n])&&(n==="set-cookie"?t[n]?t[n].push(g):t[n]=[g]:t[n]=t[n]?t[n]+", "+g:g)}),t},t0=Symbol("internals");function nr(e){return e&&String(e).trim().toLowerCase()}function MI(e){return e===!1||e==null?e:oe.isArray(e)?e.map(MI):String(e)}function MJ(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=n.exec(e);)t[g[1]]=g[2];return t}const TJ=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function kc(e,t,n,g,i){if(oe.isFunction(g))return g.call(this,t,n);if(i&&(t=n),!!oe.isString(t)){if(oe.isString(g))return t.indexOf(g)!==-1;if(oe.isRegExp(g))return g.test(t)}}function LJ(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,g)=>n.toUpperCase()+g)}function UJ(e,t){const n=oe.toCamelCase(" "+t);["get","set","has"].forEach(g=>{Object.defineProperty(e,g+n,{value:function(i,o,s){return this[g].call(this,t,i,o,s)},configurable:!0})})}class pn{constructor(t){t&&this.set(t)}set(t,n,g){const i=this;function o(r,l,I){const a=nr(l);if(!a)throw new Error("header name must be a non-empty string");const C=oe.findKey(i,a);(!C||i[C]===void 0||I===!0||I===void 0&&i[C]!==!1)&&(i[C||l]=MI(r))}const s=(r,l)=>oe.forEach(r,(I,a)=>o(I,a,l));if(oe.isPlainObject(t)||t instanceof this.constructor)s(t,n);else if(oe.isString(t)&&(t=t.trim())&&!TJ(t))s(EJ(t),n);else if(oe.isHeaders(t))for(const[r,l]of t.entries())o(l,r,g);else t!=null&&o(n,t,g);return this}get(t,n){if(t=nr(t),t){const g=oe.findKey(this,t);if(g){const i=this[g];if(!n)return i;if(n===!0)return MJ(i);if(oe.isFunction(n))return n.call(this,i,g);if(oe.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=nr(t),t){const g=oe.findKey(this,t);return!!(g&&this[g]!==void 0&&(!n||kc(this,this[g],g,n)))}return!1}delete(t,n){const g=this;let i=!1;function o(s){if(s=nr(s),s){const r=oe.findKey(g,s);r&&(!n||kc(g,g[r],r,n))&&(delete g[r],i=!0)}}return oe.isArray(t)?t.forEach(o):o(t),i}clear(t){const n=Object.keys(this);let g=n.length,i=!1;for(;g--;){const o=n[g];(!t||kc(this,this[o],o,t,!0))&&(delete this[o],i=!0)}return i}normalize(t){const n=this,g={};return oe.forEach(this,(i,o)=>{const s=oe.findKey(g,o);if(s){n[s]=MI(i),delete n[o];return}const r=t?LJ(o):String(o).trim();r!==o&&delete n[o],n[r]=MI(i),g[r]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return oe.forEach(this,(g,i)=>{g!=null&&g!==!1&&(n[i]=t&&oe.isArray(g)?g.join(", "):g)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const g=new this(t);return n.forEach(i=>g.set(i)),g}static accessor(t){const g=(this[t0]=this[t0]={accessors:{}}).accessors,i=this.prototype;function o(s){const r=nr(s);g[r]||(UJ(i,s),g[r]=!0)}return oe.isArray(t)?t.forEach(o):o(t),this}}pn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);oe.reduceDescriptors(pn.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(g){this[n]=g}}});oe.freezeMethods(pn);function Xc(e,t){const n=this||Xl,g=t||n,i=pn.from(g.headers);let o=g.data;return oe.forEach(e,function(r){o=r.call(n,o,i.normalize(),t?t.status:void 0)}),i.normalize(),o}function VS(e){return!!(e&&e.__CANCEL__)}function Ls(e,t,n){He.call(this,e??"canceled",He.ERR_CANCELED,t,n),this.name="CanceledError"}oe.inherits(Ls,He,{__CANCEL__:!0});function WS(e,t,n){const g=n.config.validateStatus;!n.status||!g||g(n.status)?e(n):t(new He("Request failed with status code "+n.status,[He.ERR_BAD_REQUEST,He.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function zJ(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function DJ(e,t){e=e||10;const n=new Array(e),g=new Array(e);let i=0,o=0,s;return t=t!==void 0?t:1e3,function(l){const I=Date.now(),a=g[o];s||(s=I),n[i]=l,g[i]=I;let C=o,c=0;for(;C!==i;)c+=n[C++],C=C%e;if(i=(i+1)%e,i===o&&(o=(o+1)%e),I-s<t)return;const d=a&&I-a;return d?Math.round(c*1e3/d):void 0}}function QJ(e,t){let n=0;const g=1e3/t;let i=null;return function(){const s=this===!0,r=Date.now();if(s||r-n>g)return i&&(clearTimeout(i),i=null),n=r,e.apply(null,arguments);i||(i=setTimeout(()=>(i=null,n=Date.now(),e.apply(null,arguments)),g-(r-n)))}}const va=(e,t,n=3)=>{let g=0;const i=DJ(50,250);return QJ(o=>{const s=o.loaded,r=o.lengthComputable?o.total:void 0,l=s-g,I=i(l),a=s<=r;g=s;const C={loaded:s,total:r,progress:r?s/r:void 0,bytes:l,rate:I||void 0,estimated:I&&r&&a?(r-s)/I:void 0,event:o,lengthComputable:r!=null};C[t?"download":"upload"]=!0,e(C)},n)},jJ=tg.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");let g;function i(o){let s=o;return t&&(n.setAttribute("href",s),s=n.href),n.setAttribute("href",s),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return g=i(window.location.href),function(s){const r=oe.isString(s)?i(s):s;return r.protocol===g.protocol&&r.host===g.host}}():function(){return function(){return!0}}(),PJ=tg.hasStandardBrowserEnv?{write(e,t,n,g,i,o){const s=[e+"="+encodeURIComponent(t)];oe.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),oe.isString(g)&&s.push("path="+g),oe.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function OJ(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function _J(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function RS(e,t){return e&&!OJ(t)?_J(e,t):t}const n0=e=>e instanceof pn?{...e}:e;function ko(e,t){t=t||{};const n={};function g(I,a,C){return oe.isPlainObject(I)&&oe.isPlainObject(a)?oe.merge.call({caseless:C},I,a):oe.isPlainObject(a)?oe.merge({},a):oe.isArray(a)?a.slice():a}function i(I,a,C){if(oe.isUndefined(a)){if(!oe.isUndefined(I))return g(void 0,I,C)}else return g(I,a,C)}function o(I,a){if(!oe.isUndefined(a))return g(void 0,a)}function s(I,a){if(oe.isUndefined(a)){if(!oe.isUndefined(I))return g(void 0,I)}else return g(void 0,a)}function r(I,a,C){if(C in t)return g(I,a);if(C in e)return g(void 0,I)}const l={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:r,headers:(I,a)=>i(n0(I),n0(a),!0)};return oe.forEach(Object.keys(Object.assign({},e,t)),function(a){const C=l[a]||i,c=C(e[a],t[a],a);oe.isUndefined(c)&&C!==r||(n[a]=c)}),n}const vS=e=>{const t=ko({},e);let{data:n,withXSRFToken:g,xsrfHeaderName:i,xsrfCookieName:o,headers:s,auth:r}=t;t.headers=s=pn.from(s),t.url=GS(RS(t.baseURL,t.url),e.params,e.paramsSerializer),r&&s.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):"")));let l;if(oe.isFormData(n)){if(tg.hasStandardBrowserEnv||tg.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if((l=s.getContentType())!==!1){const[I,...a]=l?l.split(";").map(C=>C.trim()).filter(Boolean):[];s.setContentType([I||"multipart/form-data",...a].join("; "))}}if(tg.hasStandardBrowserEnv&&(g&&oe.isFunction(g)&&(g=g(t)),g||g!==!1&&jJ(t.url))){const I=i&&o&&PJ.read(o);I&&s.set(i,I)}return t},qJ=typeof XMLHttpRequest<"u",$J=qJ&&function(e){return new Promise(function(n,g){const i=vS(e);let o=i.data;const s=pn.from(i.headers).normalize();let{responseType:r}=i,l;function I(){i.cancelToken&&i.cancelToken.unsubscribe(l),i.signal&&i.signal.removeEventListener("abort",l)}let a=new XMLHttpRequest;a.open(i.method.toUpperCase(),i.url,!0),a.timeout=i.timeout;function C(){if(!a)return;const d=pn.from("getAllResponseHeaders"in a&&a.getAllResponseHeaders()),h={data:!r||r==="text"||r==="json"?a.responseText:a.response,status:a.status,statusText:a.statusText,headers:d,config:e,request:a};WS(function(y){n(y),I()},function(y){g(y),I()},h),a=null}"onloadend"in a?a.onloadend=C:a.onreadystatechange=function(){!a||a.readyState!==4||a.status===0&&!(a.responseURL&&a.responseURL.indexOf("file:")===0)||setTimeout(C)},a.onabort=function(){a&&(g(new He("Request aborted",He.ECONNABORTED,i,a)),a=null)},a.onerror=function(){g(new He("Network Error",He.ERR_NETWORK,i,a)),a=null},a.ontimeout=function(){let u=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const h=i.transitional||BS;i.timeoutErrorMessage&&(u=i.timeoutErrorMessage),g(new He(u,h.clarifyTimeoutError?He.ETIMEDOUT:He.ECONNABORTED,i,a)),a=null},o===void 0&&s.setContentType(null),"setRequestHeader"in a&&oe.forEach(s.toJSON(),function(u,h){a.setRequestHeader(h,u)}),oe.isUndefined(i.withCredentials)||(a.withCredentials=!!i.withCredentials),r&&r!=="json"&&(a.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&a.addEventListener("progress",va(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&a.upload&&a.upload.addEventListener("progress",va(i.onUploadProgress)),(i.cancelToken||i.signal)&&(l=d=>{a&&(g(!d||d.type?new Ls(null,e,a):d),a.abort(),a=null)},i.cancelToken&&i.cancelToken.subscribe(l),i.signal&&(i.signal.aborted?l():i.signal.addEventListener("abort",l)));const c=zJ(i.url);if(c&&tg.protocols.indexOf(c)===-1){g(new He("Unsupported protocol "+c+":",He.ERR_BAD_REQUEST,e));return}a.send(o||null)})},eY=(e,t)=>{let n=new AbortController,g;const i=function(l){if(!g){g=!0,s();const I=l instanceof Error?l:this.reason;n.abort(I instanceof He?I:new Ls(I instanceof Error?I.message:I))}};let o=t&&setTimeout(()=>{i(new He(`timeout ${t} of ms exceeded`,He.ETIMEDOUT))},t);const s=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(l=>{l&&(l.removeEventListener?l.removeEventListener("abort",i):l.unsubscribe(i))}),e=null)};e.forEach(l=>l&&l.addEventListener&&l.addEventListener("abort",i));const{signal:r}=n;return r.unsubscribe=s,[r,()=>{o&&clearTimeout(o),o=null}]},tY=function*(e,t){let n=e.byteLength;if(!t||n<t){yield e;return}let g=0,i;for(;g<n;)i=g+t,yield e.slice(g,i),g=i},nY=async function*(e,t,n){for await(const g of e)yield*tY(ArrayBuffer.isView(g)?g:await n(String(g)),t)},g0=(e,t,n,g,i)=>{const o=nY(e,t,i);let s=0;return new ReadableStream({type:"bytes",async pull(r){const{done:l,value:I}=await o.next();if(l){r.close(),g();return}let a=I.byteLength;n&&n(s+=a),r.enqueue(new Uint8Array(I))},cancel(r){return g(r),o.return()}},{highWaterMark:2})},i0=(e,t)=>{const n=e!=null;return g=>setTimeout(()=>t({lengthComputable:n,total:e,loaded:g}))},BC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",kS=BC&&typeof ReadableStream=="function",Au=BC&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),gY=kS&&(()=>{let e=!1;const t=new Request(tg.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})(),o0=64*1024,hu=kS&&!!(()=>{try{return oe.isReadableStream(new Response("").body)}catch{}})(),ka={stream:hu&&(e=>e.body)};BC&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!ka[t]&&(ka[t]=oe.isFunction(e[t])?n=>n[t]():(n,g)=>{throw new He(`Response type '${t}' is not supported`,He.ERR_NOT_SUPPORT,g)})})})(new Response);const iY=async e=>{if(e==null)return 0;if(oe.isBlob(e))return e.size;if(oe.isSpecCompliantForm(e))return(await new Request(e).arrayBuffer()).byteLength;if(oe.isArrayBufferView(e))return e.byteLength;if(oe.isURLSearchParams(e)&&(e=e+""),oe.isString(e))return(await Au(e)).byteLength},oY=async(e,t)=>{const n=oe.toFiniteNumber(e.getContentLength());return n??iY(t)},sY=BC&&(async e=>{let{url:t,method:n,data:g,signal:i,cancelToken:o,timeout:s,onDownloadProgress:r,onUploadProgress:l,responseType:I,headers:a,withCredentials:C="same-origin",fetchOptions:c}=vS(e);I=I?(I+"").toLowerCase():"text";let[d,u]=i||o||s?eY([i,o],s):[],h,f;const y=()=>{!h&&setTimeout(()=>{d&&d.unsubscribe()}),h=!0};let Z;try{if(l&&gY&&n!=="get"&&n!=="head"&&(Z=await oY(a,g))!==0){let S=new Request(t,{method:"POST",body:g,duplex:"half"}),V;oe.isFormData(g)&&(V=S.headers.get("content-type"))&&a.setContentType(V),S.body&&(g=g0(S.body,o0,i0(Z,va(l)),null,Au))}oe.isString(C)||(C=C?"cors":"omit"),f=new Request(t,{...c,signal:d,method:n.toUpperCase(),headers:a.normalize().toJSON(),body:g,duplex:"half",withCredentials:C});let p=await fetch(f);const B=hu&&(I==="stream"||I==="response");if(hu&&(r||B)){const S={};["status","statusText","headers"].forEach(R=>{S[R]=p[R]});const V=oe.toFiniteNumber(p.headers.get("content-length"));p=new Response(g0(p.body,o0,r&&i0(V,va(r,!0)),B&&y,Au),S)}I=I||"text";let W=await ka[oe.findKey(ka,I)||"text"](p,e);return!B&&y(),u&&u(),await new Promise((S,V)=>{WS(S,V,{data:W,headers:pn.from(p.headers),status:p.status,statusText:p.statusText,config:e,request:f})})}catch(p){throw y(),p&&p.name==="TypeError"&&/fetch/i.test(p.message)?Object.assign(new He("Network Error",He.ERR_NETWORK,e,f),{cause:p.cause||p}):He.from(p,p&&p.code,e,f)}}),mu={http:GJ,xhr:$J,fetch:sY};oe.forEach(mu,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const s0=e=>`- ${e}`,rY=e=>oe.isFunction(e)||e===null||e===!1,XS={getAdapter:e=>{e=oe.isArray(e)?e:[e];const{length:t}=e;let n,g;const i={};for(let o=0;o<t;o++){n=e[o];let s;if(g=n,!rY(n)&&(g=mu[(s=String(n)).toLowerCase()],g===void 0))throw new He(`Unknown adapter '${s}'`);if(g)break;i[s||"#"+o]=g}if(!g){const o=Object.entries(i).map(([r,l])=>`adapter ${r} `+(l===!1?"is not supported by the environment":"is not available in the build"));let s=t?o.length>1?`since :
`+o.map(s0).join(`
`):" "+s0(o[0]):"as no adapter specified";throw new He("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return g},adapters:mu};function wc(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ls(null,e)}function r0(e){return wc(e),e.headers=pn.from(e.headers),e.data=Xc.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),XS.getAdapter(e.adapter||Xl.adapter)(e).then(function(g){return wc(e),g.data=Xc.call(e,e.transformResponse,g),g.headers=pn.from(g.headers),g},function(g){return VS(g)||(wc(e),g&&g.response&&(g.response.data=Xc.call(e,e.transformResponse,g.response),g.response.headers=pn.from(g.response.headers))),Promise.reject(g)})}const wS="1.7.2",hm={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{hm[e]=function(g){return typeof g===e||"a"+(t<1?"n ":" ")+e}});const l0={};hm.transitional=function(t,n,g){function i(o,s){return"[Axios v"+wS+"] Transitional option '"+o+"'"+s+(g?". "+g:"")}return(o,s,r)=>{if(t===!1)throw new He(i(s," has been removed"+(n?" in "+n:"")),He.ERR_DEPRECATED);return n&&!l0[s]&&(l0[s]=!0,console.warn(i(s," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(o,s,r):!0}};function lY(e,t,n){if(typeof e!="object")throw new He("options must be an object",He.ERR_BAD_OPTION_VALUE);const g=Object.keys(e);let i=g.length;for(;i-- >0;){const o=g[i],s=t[o];if(s){const r=e[o],l=r===void 0||s(r,o,e);if(l!==!0)throw new He("option "+o+" must be "+l,He.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new He("Unknown option "+o,He.ERR_BAD_OPTION)}}const bu={assertOptions:lY,validators:hm},ti=bu.validators;class bo{constructor(t){this.defaults=t,this.interceptors={request:new e0,response:new e0}}async request(t,n){try{return await this._request(t,n)}catch(g){if(g instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{g.stack?o&&!String(g.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(g.stack+=`
`+o):g.stack=o}catch{}}throw g}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=ko(this.defaults,n);const{transitional:g,paramsSerializer:i,headers:o}=n;g!==void 0&&bu.assertOptions(g,{silentJSONParsing:ti.transitional(ti.boolean),forcedJSONParsing:ti.transitional(ti.boolean),clarifyTimeoutError:ti.transitional(ti.boolean)},!1),i!=null&&(oe.isFunction(i)?n.paramsSerializer={serialize:i}:bu.assertOptions(i,{encode:ti.function,serialize:ti.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let s=o&&oe.merge(o.common,o[n.method]);o&&oe.forEach(["delete","get","head","post","put","patch","common"],u=>{delete o[u]}),n.headers=pn.concat(s,o);const r=[];let l=!0;this.interceptors.request.forEach(function(h){typeof h.runWhen=="function"&&h.runWhen(n)===!1||(l=l&&h.synchronous,r.unshift(h.fulfilled,h.rejected))});const I=[];this.interceptors.response.forEach(function(h){I.push(h.fulfilled,h.rejected)});let a,C=0,c;if(!l){const u=[r0.bind(this),void 0];for(u.unshift.apply(u,r),u.push.apply(u,I),c=u.length,a=Promise.resolve(n);C<c;)a=a.then(u[C++],u[C++]);return a}c=r.length;let d=n;for(C=0;C<c;){const u=r[C++],h=r[C++];try{d=u(d)}catch(f){h.call(this,f);break}}try{a=r0.call(this,d)}catch(u){return Promise.reject(u)}for(C=0,c=I.length;C<c;)a=a.then(I[C++],I[C++]);return a}getUri(t){t=ko(this.defaults,t);const n=RS(t.baseURL,t.url);return GS(n,t.params,t.paramsSerializer)}}oe.forEach(["delete","get","head","options"],function(t){bo.prototype[t]=function(n,g){return this.request(ko(g||{},{method:t,url:n,data:(g||{}).data}))}});oe.forEach(["post","put","patch"],function(t){function n(g){return function(o,s,r){return this.request(ko(r||{},{method:t,headers:g?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}bo.prototype[t]=n(),bo.prototype[t+"Form"]=n(!0)});class mm{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(o){n=o});const g=this;this.promise.then(i=>{if(!g._listeners)return;let o=g._listeners.length;for(;o-- >0;)g._listeners[o](i);g._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(r=>{g.subscribe(r),o=r}).then(i);return s.cancel=function(){g.unsubscribe(o)},s},t(function(o,s,r){g.reason||(g.reason=new Ls(o,s,r),n(g.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}static source(){let t;return{token:new mm(function(i){t=i}),cancel:t}}}function IY(e){return function(n){return e.apply(null,n)}}function aY(e){return oe.isObject(e)&&e.isAxiosError===!0}const pu={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(pu).forEach(([e,t])=>{pu[t]=e});function JS(e){const t=new bo(e),n=CS(bo.prototype.request,t);return oe.extend(n,bo.prototype,t,{allOwnKeys:!0}),oe.extend(n,t,null,{allOwnKeys:!0}),n.create=function(i){return JS(ko(e,i))},n}const Je=JS(Xl);Je.Axios=bo;Je.CanceledError=Ls;Je.CancelToken=mm;Je.isCancel=VS;Je.VERSION=wS;Je.toFormData=GC;Je.AxiosError=He;Je.Cancel=Je.CanceledError;Je.all=function(t){return Promise.all(t)};Je.spread=IY;Je.isAxiosError=aY;Je.mergeConfig=ko;Je.AxiosHeaders=pn;Je.formToJSON=e=>SS(oe.isHTMLForm(e)?new FormData(e):e);Je.getAdapter=XS.getAdapter;Je.HttpStatusCode=pu;Je.default=Je;const wl=()=>localStorage.getItem("access_token"),CY=e=>{localStorage.setItem("access_token",e)};Je.interceptors.request.use(e=>{const t=wl();return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));const bm="https://securityflow.onrender.com/auth",cY=async e=>{try{return(await Je.get(`${bm}/exists/${e}`)).data}catch(t){throw t}},dY=async e=>{try{return(await Je.post(`${bm}/register`,e)).data}catch(t){throw t}},I0=async e=>{try{const t=await Je.post(`${bm}/login`,e);return t.data.token&&(CY(t.data.token),localStorage.setItem("role",t.data.role),localStorage.setItem("picture",t.data.picture),localStorage.setItem("houseNumber",t.data.houseNumber)),t.data}catch(t){throw t}},uY="https://securityflow.onrender.com",Xn=Je.create({baseURL:uY,headers:{Authorization:`Bearer ${wl()}`}});Xn.interceptors.request.use(e=>{const t=wl();return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));const SC="/user",AY=async e=>{try{return(await Xn.post(`${SC}/change-username/${e}`)).data}catch(t){throw t}},hY=async e=>{try{return(await Xn.post(`${SC}/change-dui/${e}`)).data}catch(t){throw t}},fu=async()=>{try{return(await Xn.get(`${SC}/profile`)).data}catch(e){throw e}},mY=async()=>{try{return(await Xn.get(`${SC}/get-role`)).data}catch(e){throw e}},bY=()=>{const e=Ei(),{setUser:t}=H.useContext(fh),n=o=>{switch(o){case"ADMN":return"/admon";case"RSDT":return"/resident";case"RSNR":return"/normal";case"GRDA":return"/security";case"VSTT":default:return"/visits"}},g=xk({onSuccess:async o=>{try{const s=o.access_token;localStorage.setItem("access_token",s),console.log("Google access token:",s);const r=await i(s);console.log("User info from Google:",r);const l=await cY(r.email);let I;if(l)I=await I0({identifier:r.email});else{const f={email:r.email,username:r.name};await dY(f),I=await I0({identifier:r.email})}console.log("Backend response after login:",I);const a=await mY();console.log("Roles obtained:",a);let C="VSTT";a&&a.length>0&&(C=a[0].role||"VSTT");const c=r.picture,d=I.houseNumber||"No asignado",u={name:r.name,email:r.email,houseNumber:d,picture:c,id:I.id};localStorage.setItem("user",JSON.stringify(u)),localStorage.setItem("role",C),localStorage.setItem("houseNumber",d),localStorage.setItem("picture",c),t(u);const h=n(C);console.log("Redirigiendo a:",h),e(h)}catch(s){console.error("Error during Google login process:",s)}},onError:o=>console.log("Fallo al iniciar sesin",o)}),i=async o=>{const r=await(await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${o}`}})).json();return console.log("User info from Google:",r),{name:r.name,email:r.email,sub:r.sub,picture:r.picture}};return G.jsxs("div",{className:"flex items-center justify-center h-screen flex-col lg:flex-row",children:[G.jsxs("div",{className:"flex flex-col items-center justify-center w-1/2 mx-auto text-center",children:[G.jsx("h1",{className:"font-bold text-5xl m-4",children:"Bienvenido"}),G.jsx("img",{src:xw,className:"w-auto h-auto",alt:"Logo de la compaa"}),G.jsx("h2",{className:"lg:text-2xl text-base m-4",children:"Acceso protegido: tu seguridad, nuestra prioridad"})]}),G.jsxs("div",{className:"flex flex-col items-center justify-center w-1/2 lg:h-screen px-4 bg-blue-900 rounded-lg relative p-6",children:[G.jsx("p",{className:"text-white m-4 text-center",children:"Ingresar al sistema"}),G.jsxs("button",{className:"bg-white text-blue rounded-md py-2 px-4 flex items-center space-xy-2",onClick:()=>g(),children:[G.jsx("img",{src:Fw,alt:"Google icon",className:"h-6 w-6"}),G.jsx("span",{children:"Sign in with Google"})]})]})]})},pY=({columnas:e,datos:t,handleEliminar:n})=>G.jsxs("div",{className:"w-full h-full mt-6 mr-6 ml-auto pl-5 pr-5",children:[G.jsx("div",{className:"m-6 flex justify-center"}),G.jsx("div",{className:"overflow-x-auto",children:G.jsxs("table",{className:"min-w-full divide-y border-separate border-spacing-0.5 border border-gray-500",children:[G.jsx("thead",{children:G.jsxs("tr",{className:"bg-[#F8BD0D] bg-opacity-70 font-semibold font-roboto_mono",children:[e.map(g=>G.jsx("th",{className:"px-4 py-2 text-center border border-gray-500",children:g.Header},g.accessor)),G.jsx("th",{className:"px-4 py-2 text-center border border-gray-500",children:"Acciones"})]})}),G.jsx("tbody",{className:"text-center bg-gray-100 border-stone-500 font-roboto_mono",children:t.map((g,i)=>G.jsxs("tr",{className:"hover:bg-gray-100 border-black",children:[e.map(o=>G.jsx("td",{className:"border px-4 py-2 border-gray-500",children:g[o.accessor]},o.accessor)),G.jsx("td",{className:"border px-4 py-2 border-gray-500",children:G.jsx("button",{onClick:()=>{console.log(`Removing guard with ID: ${g.code}`),n(g.code)},className:"bg-red-300 py-1 px-3 rounded-md font-roboto_mono",children:"Quitar rol"})})]},i))})]})})]}),pm="/api/guards",fY=async e=>{try{return(await Xn.post(`${pm}/assign`,null,{params:{email:e}})).data}catch(t){throw t}},ZY=async()=>{try{return(await Xn.get(`${pm}/list`)).data}catch(e){throw e}},yY=async e=>{try{return(await Xn.post(`${pm}/remove`,null,{params:{userId:e}})).data}catch(t){throw t}},GY="/assets/error-csJoMxGL.png",BY="/assets/check-CBXK7Dh5.png",SY=({message:e,isVisible:t,duration:n=3e3,onClose:g,type:i})=>{if(H.useEffect(()=>{if(t){const l=setTimeout(()=>{g()},n);return()=>clearTimeout(l)}},[t,n,g]),!t)return null;const o=()=>i?"text-green-600 p-8":"text-red-600 p-8",s=()=>i?BY:GY,r=()=>i?"Success icon":"Error icon";return G.jsxs("div",{className:"font-roboto_mono flex flex-row items-center fixed bottom-4 right-4 bg-slate-100 rounded shadow-lg animate-bounce",children:[G.jsx("p",{className:o(),children:e}),G.jsx("img",{src:s(),alt:r(),className:"h-12 w-12 mr-8"})]})},YS=H.createContext(),Og=()=>H.useContext(YS),VY=({children:e})=>{const[t,n]=H.useState(!1),[g,i]=H.useState(""),[o,s]=H.useState(""),r=H.useCallback((l,I)=>{i(l),s(I),n(!0),setTimeout(()=>{n(!1)},3e3)},[]);return G.jsxs(YS.Provider,{value:{showPopup:r},children:[e,G.jsx(SY,{message:g,isVisible:t,type:o,onClose:()=>n(!1)})]})};var HS={},ws={};Object.defineProperty(ws,"__esModule",{value:!0});ws.cssValue=ws.parseLengthAndUnit=void 0;var WY={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function NS(e){if(typeof e=="number")return{value:e,unit:"px"};var t,n=(e.match(/^[0-9.]*/)||"").toString();n.includes(".")?t=parseFloat(n):t=parseInt(n,10);var g=(e.match(/[^0-9]*$/)||"").toString();return WY[g]?{value:t,unit:g}:(console.warn("React Spinners: ".concat(e," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}ws.parseLengthAndUnit=NS;function RY(e){var t=NS(e);return"".concat(t.value).concat(t.unit)}ws.cssValue=RY;var VC={};Object.defineProperty(VC,"__esModule",{value:!0});VC.createAnimation=void 0;var vY=function(e,t,n){var g="react-spinners-".concat(e,"-").concat(n);if(typeof window>"u"||!window.document)return g;var i=document.createElement("style");document.head.appendChild(i);var o=i.sheet,s=`
    @keyframes `.concat(g,` {
      `).concat(t,`
    }
  `);return o&&o.insertRule(s,0),g};VC.createAnimation=vY;var Xa=bg&&bg.__assign||function(){return Xa=Object.assign||function(e){for(var t,n=1,g=arguments.length;n<g;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Xa.apply(this,arguments)},kY=bg&&bg.__createBinding||(Object.create?function(e,t,n,g){g===void 0&&(g=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,g,i)}:function(e,t,n,g){g===void 0&&(g=n),e[g]=t[n]}),XY=bg&&bg.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),wY=bg&&bg.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&kY(t,e,n);return XY(t,e),t},JY=bg&&bg.__rest||function(e,t){var n={};for(var g in e)Object.prototype.hasOwnProperty.call(e,g)&&t.indexOf(g)<0&&(n[g]=e[g]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,g=Object.getOwnPropertySymbols(e);i<g.length;i++)t.indexOf(g[i])<0&&Object.prototype.propertyIsEnumerable.call(e,g[i])&&(n[g[i]]=e[g[i]]);return n};Object.defineProperty(HS,"__esModule",{value:!0});var YY=wY(H),a0=ws,HY=VC,NY=(0,HY.createAnimation)("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function FY(e){var t=e.loading,n=t===void 0?!0:t,g=e.color,i=g===void 0?"#000000":g,o=e.speedMultiplier,s=o===void 0?1:o,r=e.cssOverride,l=r===void 0?{}:r,I=e.size,a=I===void 0?35:I,C=JY(e,["loading","color","speedMultiplier","cssOverride","size"]),c=Xa({background:"transparent !important",width:(0,a0.cssValue)(a),height:(0,a0.cssValue)(a),borderRadius:"100%",border:"2px solid",borderTopColor:i,borderBottomColor:"transparent",borderLeftColor:i,borderRightColor:i,display:"inline-block",animation:"".concat(NY," ").concat(.75/s,"s 0s infinite linear"),animationFillMode:"both"},l);return n?YY.createElement("span",Xa({style:c},C)):null}var al=HS.default=FY;const xY=()=>{const[e,t]=H.useState([]),[n,g]=H.useState(""),{showPopup:i}=Og(),[o,s]=H.useState(!1);H.useEffect(()=>{r()},[]);const r=async()=>{try{s(!0);const C=await ZY();t(C)}catch(C){console.error("Error fetching guards:",C),t([])}finally{s(!1)}},l=async()=>{if(n)try{s(!0),await fY(n)==="Guardia ya asignado"?i("Usuario ya asignado como guardia.",!0):(r(),i("Guardia registrado exitosamente!",!0)),g("")}catch(C){i("Error: "+(C.response?C.response.data:C.message),!1)}finally{s(!1)}else i("Ingrese correo vlido.",!1)},I=async C=>{try{s(!0),await yY(C),r(),i("Guardia removido exitosamente!",!0)}catch(c){console.error("Error removing guard role:",c),i("Error: "+(c.response?c.response.data:c.message),!1)}finally{s(!1)}},a=[{Header:"Nombre",accessor:"username"},{Header:"Correo electrnico",accessor:"email"},{Header:"Documento",accessor:"dui"},{Header:"Acciones",Cell:({row:C})=>G.jsx("button",{className:"bg-red-300 py-1 px-3 rounded-md font-roboto_mono",onClick:()=>I(C.original.userId),children:"Quitar rol"})}];return G.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4",children:[G.jsx("h1",{className:"text-2xl font-bold text-center text-azul-principal m-3 font-roboto_mono",children:"Agregar Vigilante"}),G.jsxs("div",{className:"flex flex-col mt-2 w-[150px] sm:w-[332px]",children:[G.jsx("label",{htmlFor:"email",className:"text-base m-2 font-roboto_mono",children:"Correo electrnico:"}),G.jsx("input",{type:"text",id:"email",placeholder:"Ingrese el correo electrnico",className:"border border-gray-300 p-2 rounded-md",value:n,onChange:C=>g(C.target.value)}),G.jsx("button",{className:"bg-amarillo-principal text-black m-2 w-20 py-2 rounded-md font-roboto_mono",onClick:l,disabled:o,children:o?G.jsx(al,{color:"#000",size:20}):"Agregar"})]}),G.jsx("h1",{className:"text-2xl font-bold text-center text-azul-principal m-3 font-roboto_mono mt-5 mb-1",children:"Lista de vigilantes"}),o?G.jsx(al,{color:"#F8BD0D",loading:o,size:50}):G.jsx(pY,{columnas:a,datos:e,handleEliminar:I})]})};/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function Jl(e){return e+.5|0}const hi=(e,t,n)=>Math.max(Math.min(e,n),t);function mr(e){return hi(Jl(e*2.55),0,255)}function Ri(e){return hi(Jl(e*255),0,255)}function vg(e){return hi(Jl(e/2.55)/100,0,1)}function C0(e){return hi(Jl(e*100),0,100)}const Jn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Zu=[..."0123456789ABCDEF"],KY=e=>Zu[e&15],EY=e=>Zu[(e&240)>>4]+Zu[e&15],oI=e=>(e&240)>>4===(e&15),MY=e=>oI(e.r)&&oI(e.g)&&oI(e.b)&&oI(e.a);function TY(e){var t=e.length,n;return e[0]==="#"&&(t===4||t===5?n={r:255&Jn[e[1]]*17,g:255&Jn[e[2]]*17,b:255&Jn[e[3]]*17,a:t===5?Jn[e[4]]*17:255}:(t===7||t===9)&&(n={r:Jn[e[1]]<<4|Jn[e[2]],g:Jn[e[3]]<<4|Jn[e[4]],b:Jn[e[5]]<<4|Jn[e[6]],a:t===9?Jn[e[7]]<<4|Jn[e[8]]:255})),n}const LY=(e,t)=>e<255?t(e):"";function UY(e){var t=MY(e)?KY:EY;return e?"#"+t(e.r)+t(e.g)+t(e.b)+LY(e.a,t):void 0}const zY=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function FS(e,t,n){const g=t*Math.min(n,1-n),i=(o,s=(o+e/30)%12)=>n-g*Math.max(Math.min(s-3,9-s,1),-1);return[i(0),i(8),i(4)]}function DY(e,t,n){const g=(i,o=(i+e/60)%6)=>n-n*t*Math.max(Math.min(o,4-o,1),0);return[g(5),g(3),g(1)]}function QY(e,t,n){const g=FS(e,1,.5);let i;for(t+n>1&&(i=1/(t+n),t*=i,n*=i),i=0;i<3;i++)g[i]*=1-t-n,g[i]+=t;return g}function jY(e,t,n,g,i){return e===i?(t-n)/g+(t<n?6:0):t===i?(n-e)/g+2:(e-t)/g+4}function fm(e){const n=e.r/255,g=e.g/255,i=e.b/255,o=Math.max(n,g,i),s=Math.min(n,g,i),r=(o+s)/2;let l,I,a;return o!==s&&(a=o-s,I=r>.5?a/(2-o-s):a/(o+s),l=jY(n,g,i,a,o),l=l*60+.5),[l|0,I||0,r]}function Zm(e,t,n,g){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,g)).map(Ri)}function ym(e,t,n){return Zm(FS,e,t,n)}function PY(e,t,n){return Zm(QY,e,t,n)}function OY(e,t,n){return Zm(DY,e,t,n)}function xS(e){return(e%360+360)%360}function _Y(e){const t=zY.exec(e);let n=255,g;if(!t)return;t[5]!==g&&(n=t[6]?mr(+t[5]):Ri(+t[5]));const i=xS(+t[2]),o=+t[3]/100,s=+t[4]/100;return t[1]==="hwb"?g=PY(i,o,s):t[1]==="hsv"?g=OY(i,o,s):g=ym(i,o,s),{r:g[0],g:g[1],b:g[2],a:n}}function qY(e,t){var n=fm(e);n[0]=xS(n[0]+t),n=ym(n),e.r=n[0],e.g=n[1],e.b=n[2]}function $Y(e){if(!e)return;const t=fm(e),n=t[0],g=C0(t[1]),i=C0(t[2]);return e.a<255?`hsla(${n}, ${g}%, ${i}%, ${vg(e.a)})`:`hsl(${n}, ${g}%, ${i}%)`}const c0={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},d0={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function e1(){const e={},t=Object.keys(d0),n=Object.keys(c0);let g,i,o,s,r;for(g=0;g<t.length;g++){for(s=r=t[g],i=0;i<n.length;i++)o=n[i],r=r.replace(o,c0[o]);o=parseInt(d0[s],16),e[r]=[o>>16&255,o>>8&255,o&255]}return e}let sI;function t1(e){sI||(sI=e1(),sI.transparent=[0,0,0,0]);const t=sI[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const n1=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function g1(e){const t=n1.exec(e);let n=255,g,i,o;if(t){if(t[7]!==g){const s=+t[7];n=t[8]?mr(s):hi(s*255,0,255)}return g=+t[1],i=+t[3],o=+t[5],g=255&(t[2]?mr(g):hi(g,0,255)),i=255&(t[4]?mr(i):hi(i,0,255)),o=255&(t[6]?mr(o):hi(o,0,255)),{r:g,g:i,b:o,a:n}}}function i1(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${vg(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}const Jc=e=>e<=.0031308?e*12.92:Math.pow(e,1/2.4)*1.055-.055,Qo=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function o1(e,t,n){const g=Qo(vg(e.r)),i=Qo(vg(e.g)),o=Qo(vg(e.b));return{r:Ri(Jc(g+n*(Qo(vg(t.r))-g))),g:Ri(Jc(i+n*(Qo(vg(t.g))-i))),b:Ri(Jc(o+n*(Qo(vg(t.b))-o))),a:e.a+n*(t.a-e.a)}}function rI(e,t,n){if(e){let g=fm(e);g[t]=Math.max(0,Math.min(g[t]+g[t]*n,t===0?360:1)),g=ym(g),e.r=g[0],e.g=g[1],e.b=g[2]}}function KS(e,t){return e&&Object.assign(t||{},e)}function u0(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Ri(e[3]))):(t=KS(e,{r:0,g:0,b:0,a:1}),t.a=Ri(t.a)),t}function s1(e){return e.charAt(0)==="r"?g1(e):_Y(e)}class Cl{constructor(t){if(t instanceof Cl)return t;const n=typeof t;let g;n==="object"?g=u0(t):n==="string"&&(g=TY(t)||t1(t)||s1(t)),this._rgb=g,this._valid=!!g}get valid(){return this._valid}get rgb(){var t=KS(this._rgb);return t&&(t.a=vg(t.a)),t}set rgb(t){this._rgb=u0(t)}rgbString(){return this._valid?i1(this._rgb):void 0}hexString(){return this._valid?UY(this._rgb):void 0}hslString(){return this._valid?$Y(this._rgb):void 0}mix(t,n){if(t){const g=this.rgb,i=t.rgb;let o;const s=n===o?.5:n,r=2*s-1,l=g.a-i.a,I=((r*l===-1?r:(r+l)/(1+r*l))+1)/2;o=1-I,g.r=255&I*g.r+o*i.r+.5,g.g=255&I*g.g+o*i.g+.5,g.b=255&I*g.b+o*i.b+.5,g.a=s*g.a+(1-s)*i.a,this.rgb=g}return this}interpolate(t,n){return t&&(this._rgb=o1(this._rgb,t._rgb,n)),this}clone(){return new Cl(this.rgb)}alpha(t){return this._rgb.a=Ri(t),this}clearer(t){const n=this._rgb;return n.a*=1-t,this}greyscale(){const t=this._rgb,n=Jl(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=n,this}opaquer(t){const n=this._rgb;return n.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return rI(this._rgb,2,t),this}darken(t){return rI(this._rgb,2,-t),this}saturate(t){return rI(this._rgb,1,t),this}desaturate(t){return rI(this._rgb,1,-t),this}rotate(t){return qY(this._rgb,t),this}}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function pg(){}const r1=(()=>{let e=0;return()=>e++})();function _e(e){return e===null||typeof e>"u"}function Ct(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function Me(e){return e!==null&&Object.prototype.toString.call(e)==="[object Object]"}function Yt(e){return(typeof e=="number"||e instanceof Number)&&isFinite(+e)}function yn(e,t){return Yt(e)?e:t}function Le(e,t){return typeof e>"u"?t:e}const l1=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100:+e/t,ES=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100*t:+e;function tt(e,t,n){if(e&&typeof e.call=="function")return e.apply(n,t)}function De(e,t,n,g){let i,o,s;if(Ct(e))for(o=e.length,i=0;i<o;i++)t.call(n,e[i],i);else if(Me(e))for(s=Object.keys(e),o=s.length,i=0;i<o;i++)t.call(n,e[s[i]],s[i])}function wa(e,t){let n,g,i,o;if(!e||!t||e.length!==t.length)return!1;for(n=0,g=e.length;n<g;++n)if(i=e[n],o=t[n],i.datasetIndex!==o.datasetIndex||i.index!==o.index)return!1;return!0}function Ja(e){if(Ct(e))return e.map(Ja);if(Me(e)){const t=Object.create(null),n=Object.keys(e),g=n.length;let i=0;for(;i<g;++i)t[n[i]]=Ja(e[n[i]]);return t}return e}function MS(e){return["__proto__","prototype","constructor"].indexOf(e)===-1}function I1(e,t,n,g){if(!MS(e))return;const i=t[e],o=n[e];Me(i)&&Me(o)?cl(i,o,g):t[e]=Ja(o)}function cl(e,t,n){const g=Ct(t)?t:[t],i=g.length;if(!Me(e))return e;n=n||{};const o=n.merger||I1;let s;for(let r=0;r<i;++r){if(s=g[r],!Me(s))continue;const l=Object.keys(s);for(let I=0,a=l.length;I<a;++I)o(l[I],e,s,n)}return e}function Hr(e,t){return cl(e,t,{merger:a1})}function a1(e,t,n){if(!MS(e))return;const g=t[e],i=n[e];Me(g)&&Me(i)?Hr(g,i):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=Ja(i))}const A0={"":e=>e,x:e=>e.x,y:e=>e.y};function C1(e){const t=e.split("."),n=[];let g="";for(const i of t)g+=i,g.endsWith("\\")?g=g.slice(0,-1)+".":(n.push(g),g="");return n}function c1(e){const t=C1(e);return n=>{for(const g of t){if(g==="")break;n=n&&n[g]}return n}}function Xo(e,t){return(A0[t]||(A0[t]=c1(t)))(e)}function Gm(e){return e.charAt(0).toUpperCase()+e.slice(1)}const dl=e=>typeof e<"u",Yi=e=>typeof e=="function",h0=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};function d1(e){return e.type==="mouseup"||e.type==="click"||e.type==="contextmenu"}const pt=Math.PI,mt=2*pt,Ya=Number.POSITIVE_INFINITY,u1=pt/180,Gt=pt/2,Li=pt/4,m0=pt*2/3,mi=Math.log10,vi=Math.sign;function TI(e,t,n){return Math.abs(e-t)<n}function b0(e){const t=Math.round(e);e=TI(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(mi(e))),g=e/n;return(g<=1?1:g<=2?2:g<=5?5:10)*n}function A1(e){const t=[],n=Math.sqrt(e);let g;for(g=1;g<n;g++)e%g===0&&(t.push(g),t.push(e/g));return n===(n|0)&&t.push(n),t.sort((i,o)=>i-o).pop(),t}function Ha(e){return!isNaN(parseFloat(e))&&isFinite(e)}function h1(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}function TS(e,t,n){let g,i,o;for(g=0,i=e.length;g<i;g++)o=e[g][n],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function cg(e){return e*(pt/180)}function Bm(e){return e*(180/pt)}function p0(e){if(!Yt(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function LS(e,t){const n=t.x-e.x,g=t.y-e.y,i=Math.sqrt(n*n+g*g);let o=Math.atan2(g,n);return o<-.5*pt&&(o+=mt),{angle:o,distance:i}}function m1(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function ag(e){return(e%mt+mt)%mt}function Na(e,t,n,g){const i=ag(e),o=ag(t),s=ag(n),r=ag(o-i),l=ag(s-i),I=ag(i-o),a=ag(i-s);return i===o||i===s||g&&o===s||r>l&&I<a}function An(e,t,n){return Math.max(t,Math.min(n,e))}function b1(e){return An(e,-32768,32767)}function ao(e,t,n,g=1e-6){return e>=Math.min(t,n)-g&&e<=Math.max(t,n)+g}function Sm(e,t,n){n=n||(s=>e[s]<t);let g=e.length-1,i=0,o;for(;g-i>1;)o=i+g>>1,n(o)?i=o:g=o;return{lo:i,hi:g}}const yu=(e,t,n,g)=>Sm(e,n,g?i=>{const o=e[i][t];return o<n||o===n&&e[i+1][t]===n}:i=>e[i][t]<n),p1=(e,t,n)=>Sm(e,n,g=>e[g][t]>=n);function f1(e,t,n){let g=0,i=e.length;for(;g<i&&e[g]<t;)g++;for(;i>g&&e[i-1]>n;)i--;return g>0||i<e.length?e.slice(g,i):e}const US=["push","pop","shift","splice","unshift"];function Z1(e,t){if(e._chartjs){e._chartjs.listeners.push(t);return}Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),US.forEach(n=>{const g="_onData"+Gm(n),i=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value(...o){const s=i.apply(this,o);return e._chartjs.listeners.forEach(r=>{typeof r[g]=="function"&&r[g](...o)}),s}})})}function f0(e,t){const n=e._chartjs;if(!n)return;const g=n.listeners,i=g.indexOf(t);i!==-1&&g.splice(i,1),!(g.length>0)&&(US.forEach(o=>{delete e[o]}),delete e._chartjs)}function zS(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const DS=function(){return typeof window>"u"?function(e){return e()}:window.requestAnimationFrame}();function QS(e,t){let n=[],g=!1;return function(...i){n=i,g||(g=!0,DS.call(window,()=>{g=!1,e.apply(t,n)}))}}function y1(e,t){let n;return function(...g){return t?(clearTimeout(n),n=setTimeout(e,t,g)):e.apply(this,g),t}}const Vm=e=>e==="start"?"left":e==="end"?"right":"center",jt=(e,t,n)=>e==="start"?t:e==="end"?n:(t+n)/2,G1=(e,t,n,g)=>e===(g?"left":"right")?n:e==="center"?(t+n)/2:t,lI=e=>e===0||e===1,Z0=(e,t,n)=>-(Math.pow(2,10*(e-=1))*Math.sin((e-t)*mt/n)),y0=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*mt/n)+1,Nr={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>-Math.cos(e*Gt)+1,easeOutSine:e=>Math.sin(e*Gt),easeInOutSine:e=>-.5*(Math.cos(pt*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>lI(e)?e:e<.5?.5*Math.pow(2,10*(e*2-1)):.5*(-Math.pow(2,-10*(e*2-1))+2),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>lI(e)?e:Z0(e,.075,.3),easeOutElastic:e=>lI(e)?e:y0(e,.075,.3),easeInOutElastic(e){return lI(e)?e:e<.5?.5*Z0(e*2,.1125,.45):.5+.5*y0(e*2-1,.1125,.45)},easeInBack(e){return e*e*((1.70158+1)*e-1.70158)},easeOutBack(e){return(e-=1)*e*((1.70158+1)*e+1.70158)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:e=>1-Nr.easeOutBounce(1-e),easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInOutBounce:e=>e<.5?Nr.easeInBounce(e*2)*.5:Nr.easeOutBounce(e*2-1)*.5+.5};function jS(e){if(e&&typeof e=="object"){const t=e.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function G0(e){return jS(e)?e:new Cl(e)}function Yc(e){return jS(e)?e:new Cl(e).saturate(.5).darken(.1).hexString()}const B1=["x","y","borderWidth","radius","tension"],S1=["color","borderColor","backgroundColor"];function V1(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),e.set("animations",{colors:{type:"color",properties:S1},numbers:{type:"number",properties:B1}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function W1(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const B0=new Map;function R1(e,t){t=t||{};const n=e+JSON.stringify(t);let g=B0.get(n);return g||(g=new Intl.NumberFormat(e,t),B0.set(n,g)),g}function WC(e,t,n){return R1(t,n).format(e)}const PS={values(e){return Ct(e)?e:""+e},numeric(e,t,n){if(e===0)return"0";const g=this.chart.options.locale;let i,o=e;if(n.length>1){const I=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(I<1e-4||I>1e15)&&(i="scientific"),o=v1(e,n)}const s=mi(Math.abs(o)),r=isNaN(s)?1:Math.max(Math.min(-1*Math.floor(s),20),0),l={notation:i,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(l,this.options.ticks.format),WC(e,g,l)},logarithmic(e,t,n){if(e===0)return"0";const g=n[t].significand||e/Math.pow(10,Math.floor(mi(e)));return[1,2,3,5,10,15].includes(g)||t>.8*n.length?PS.numeric.call(this,e,t,n):""}};function v1(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e)),n}var RC={formatters:PS};function k1(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,n)=>n.lineWidth,tickColor:(t,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:RC.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const wo=Object.create(null),Gu=Object.create(null);function Fr(e,t){if(!t)return e;const n=t.split(".");for(let g=0,i=n.length;g<i;++g){const o=n[g];e=e[o]||(e[o]=Object.create(null))}return e}function Hc(e,t,n){return typeof t=="string"?cl(Fr(e,t),n):cl(Fr(e,""),t)}class X1{constructor(t,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=g=>g.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(g,i)=>Yc(i.backgroundColor),this.hoverBorderColor=(g,i)=>Yc(i.borderColor),this.hoverColor=(g,i)=>Yc(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(n)}set(t,n){return Hc(this,t,n)}get(t){return Fr(this,t)}describe(t,n){return Hc(Gu,t,n)}override(t,n){return Hc(wo,t,n)}route(t,n,g,i){const o=Fr(this,t),s=Fr(this,g),r="_"+n;Object.defineProperties(o,{[r]:{value:o[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[r],I=s[i];return Me(l)?Object.assign({},I,l):Le(l,I)},set(l){this[r]=l}}})}apply(t){t.forEach(n=>n(this))}}var bt=new X1({_scriptable:e=>!e.startsWith("on"),_indexable:e=>e!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[V1,W1,k1]);function w1(e){return!e||_e(e.size)||_e(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}function Fa(e,t,n,g,i){let o=t[i];return o||(o=t[i]=e.measureText(i).width,n.push(i)),o>g&&(g=o),g}function J1(e,t,n,g){g=g||{};let i=g.data=g.data||{},o=g.garbageCollect=g.garbageCollect||[];g.font!==t&&(i=g.data={},o=g.garbageCollect=[],g.font=t),e.save(),e.font=t;let s=0;const r=n.length;let l,I,a,C,c;for(l=0;l<r;l++)if(C=n[l],C!=null&&!Ct(C))s=Fa(e,i,o,s,C);else if(Ct(C))for(I=0,a=C.length;I<a;I++)c=C[I],c!=null&&!Ct(c)&&(s=Fa(e,i,o,s,c));e.restore();const d=o.length/2;if(d>n.length){for(l=0;l<d;l++)delete i[o[l]];o.splice(0,d)}return s}function Ui(e,t,n){const g=e.currentDevicePixelRatio,i=n!==0?Math.max(n/2,.5):0;return Math.round((t-i)*g)/g+i}function S0(e,t){!t&&!e||(t=t||e.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function V0(e,t,n,g){OS(e,t,n,g,null)}function OS(e,t,n,g,i){let o,s,r,l,I,a,C,c;const d=t.pointStyle,u=t.rotation,h=t.radius;let f=(u||0)*u1;if(d&&typeof d=="object"&&(o=d.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){e.save(),e.translate(n,g),e.rotate(f),e.drawImage(d,-d.width/2,-d.height/2,d.width,d.height),e.restore();return}if(!(isNaN(h)||h<=0)){switch(e.beginPath(),d){default:i?e.ellipse(n,g,i/2,h,0,0,mt):e.arc(n,g,h,0,mt),e.closePath();break;case"triangle":a=i?i/2:h,e.moveTo(n+Math.sin(f)*a,g-Math.cos(f)*h),f+=m0,e.lineTo(n+Math.sin(f)*a,g-Math.cos(f)*h),f+=m0,e.lineTo(n+Math.sin(f)*a,g-Math.cos(f)*h),e.closePath();break;case"rectRounded":I=h*.516,l=h-I,s=Math.cos(f+Li)*l,C=Math.cos(f+Li)*(i?i/2-I:l),r=Math.sin(f+Li)*l,c=Math.sin(f+Li)*(i?i/2-I:l),e.arc(n-C,g-r,I,f-pt,f-Gt),e.arc(n+c,g-s,I,f-Gt,f),e.arc(n+C,g+r,I,f,f+Gt),e.arc(n-c,g+s,I,f+Gt,f+pt),e.closePath();break;case"rect":if(!u){l=Math.SQRT1_2*h,a=i?i/2:l,e.rect(n-a,g-l,2*a,2*l);break}f+=Li;case"rectRot":C=Math.cos(f)*(i?i/2:h),s=Math.cos(f)*h,r=Math.sin(f)*h,c=Math.sin(f)*(i?i/2:h),e.moveTo(n-C,g-r),e.lineTo(n+c,g-s),e.lineTo(n+C,g+r),e.lineTo(n-c,g+s),e.closePath();break;case"crossRot":f+=Li;case"cross":C=Math.cos(f)*(i?i/2:h),s=Math.cos(f)*h,r=Math.sin(f)*h,c=Math.sin(f)*(i?i/2:h),e.moveTo(n-C,g-r),e.lineTo(n+C,g+r),e.moveTo(n+c,g-s),e.lineTo(n-c,g+s);break;case"star":C=Math.cos(f)*(i?i/2:h),s=Math.cos(f)*h,r=Math.sin(f)*h,c=Math.sin(f)*(i?i/2:h),e.moveTo(n-C,g-r),e.lineTo(n+C,g+r),e.moveTo(n+c,g-s),e.lineTo(n-c,g+s),f+=Li,C=Math.cos(f)*(i?i/2:h),s=Math.cos(f)*h,r=Math.sin(f)*h,c=Math.sin(f)*(i?i/2:h),e.moveTo(n-C,g-r),e.lineTo(n+C,g+r),e.moveTo(n+c,g-s),e.lineTo(n-c,g+s);break;case"line":s=i?i/2:Math.cos(f)*h,r=Math.sin(f)*h,e.moveTo(n-s,g-r),e.lineTo(n+s,g+r);break;case"dash":e.moveTo(n,g),e.lineTo(n+Math.cos(f)*(i?i/2:h),g+Math.sin(f)*h);break;case!1:e.closePath();break}e.fill(),t.borderWidth>0&&e.stroke()}}function as(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function Wm(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function Rm(e){e.restore()}function Y1(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),_e(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}function H1(e,t,n,g,i){if(i.strikethrough||i.underline){const o=e.measureText(g),s=t-o.actualBoundingBoxLeft,r=t+o.actualBoundingBoxRight,l=n-o.actualBoundingBoxAscent,I=n+o.actualBoundingBoxDescent,a=i.strikethrough?(l+I)/2:I;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=i.decorationWidth||2,e.moveTo(s,a),e.lineTo(r,a),e.stroke()}}function N1(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function Jo(e,t,n,g,i,o={}){const s=Ct(t)?t:[t],r=o.strokeWidth>0&&o.strokeColor!=="";let l,I;for(e.save(),e.font=i.string,Y1(e,o),l=0;l<s.length;++l)I=s[l],o.backdrop&&N1(e,o.backdrop),r&&(o.strokeColor&&(e.strokeStyle=o.strokeColor),_e(o.strokeWidth)||(e.lineWidth=o.strokeWidth),e.strokeText(I,n,g,o.maxWidth)),e.fillText(I,n,g,o.maxWidth),H1(e,n,g,I,o),g+=Number(i.lineHeight);e.restore()}function ul(e,t){const{x:n,y:g,w:i,h:o,radius:s}=t;e.arc(n+s.topLeft,g+s.topLeft,s.topLeft,1.5*pt,pt,!0),e.lineTo(n,g+o-s.bottomLeft),e.arc(n+s.bottomLeft,g+o-s.bottomLeft,s.bottomLeft,pt,Gt,!0),e.lineTo(n+i-s.bottomRight,g+o),e.arc(n+i-s.bottomRight,g+o-s.bottomRight,s.bottomRight,Gt,0,!0),e.lineTo(n+i,g+s.topRight),e.arc(n+i-s.topRight,g+s.topRight,s.topRight,0,-Gt,!0),e.lineTo(n+s.topLeft,g)}const F1=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,x1=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function K1(e,t){const n=(""+e).match(F1);if(!n||n[1]==="normal")return t*1.2;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100;break}return t*e}const E1=e=>+e||0;function vm(e,t){const n={},g=Me(t),i=g?Object.keys(t):t,o=Me(e)?g?s=>Le(e[s],e[t[s]]):s=>e[s]:()=>e;for(const s of i)n[s]=E1(o(s));return n}function _S(e){return vm(e,{top:"y",right:"x",bottom:"y",left:"x"})}function po(e){return vm(e,["topLeft","topRight","bottomLeft","bottomRight"])}function en(e){const t=_S(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Rt(e,t){e=e||{},t=t||bt.font;let n=Le(e.size,t.size);typeof n=="string"&&(n=parseInt(n,10));let g=Le(e.style,t.style);g&&!(""+g).match(x1)&&(console.warn('Invalid font style specified: "'+g+'"'),g=void 0);const i={family:Le(e.family,t.family),lineHeight:K1(Le(e.lineHeight,t.lineHeight),n),size:n,style:g,weight:Le(e.weight,t.weight),string:""};return i.string=w1(i),i}function II(e,t,n,g){let i,o,s;for(i=0,o=e.length;i<o;++i)if(s=e[i],s!==void 0&&s!==void 0)return s}function M1(e,t,n){const{min:g,max:i}=e,o=ES(t,(i-g)/2),s=(r,l)=>n&&r===0?0:r+l;return{min:s(g,-Math.abs(o)),max:s(i,o)}}function xo(e,t){return Object.assign(Object.create(e),t)}function km(e,t=[""],n,g,i=()=>e[0]){const o=n||e;typeof g>"u"&&(g=tV("_fallback",e));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:o,_fallback:g,_getTarget:i,override:r=>km([r,...e],t,o,g)};return new Proxy(s,{deleteProperty(r,l){return delete r[l],delete r._keys,delete e[0][l],!0},get(r,l){return $S(r,l,()=>P1(l,t,e,r))},getOwnPropertyDescriptor(r,l){return Reflect.getOwnPropertyDescriptor(r._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(e[0])},has(r,l){return R0(r).includes(l)},ownKeys(r){return R0(r)},set(r,l,I){const a=r._storage||(r._storage=i());return r[l]=a[l]=I,delete r._keys,!0}})}function Js(e,t,n,g){const i={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:qS(e,g),setContext:o=>Js(e,o,n,g),override:o=>Js(e.override(o),t,n,g)};return new Proxy(i,{deleteProperty(o,s){return delete o[s],delete e[s],!0},get(o,s,r){return $S(o,s,()=>L1(o,s,r))},getOwnPropertyDescriptor(o,s){return o._descriptors.allKeys?Reflect.has(e,s)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,s)},getPrototypeOf(){return Reflect.getPrototypeOf(e)},has(o,s){return Reflect.has(e,s)},ownKeys(){return Reflect.ownKeys(e)},set(o,s,r){return e[s]=r,delete o[s],!0}})}function qS(e,t={scriptable:!0,indexable:!0}){const{_scriptable:n=t.scriptable,_indexable:g=t.indexable,_allKeys:i=t.allKeys}=e;return{allKeys:i,scriptable:n,indexable:g,isScriptable:Yi(n)?n:()=>n,isIndexable:Yi(g)?g:()=>g}}const T1=(e,t)=>e?e+Gm(t):t,Xm=(e,t)=>Me(t)&&e!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function $S(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||t==="constructor")return e[t];const g=n();return e[t]=g,g}function L1(e,t,n){const{_proxy:g,_context:i,_subProxy:o,_descriptors:s}=e;let r=g[t];return Yi(r)&&s.isScriptable(t)&&(r=U1(t,r,e,n)),Ct(r)&&r.length&&(r=z1(t,r,e,s.isIndexable)),Xm(t,r)&&(r=Js(r,i,o&&o[t],s)),r}function U1(e,t,n,g){const{_proxy:i,_context:o,_subProxy:s,_stack:r}=n;if(r.has(e))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+e);r.add(e);let l=t(o,s||g);return r.delete(e),Xm(e,l)&&(l=wm(i._scopes,i,e,l)),l}function z1(e,t,n,g){const{_proxy:i,_context:o,_subProxy:s,_descriptors:r}=n;if(typeof o.index<"u"&&g(e))return t[o.index%t.length];if(Me(t[0])){const l=t,I=i._scopes.filter(a=>a!==l);t=[];for(const a of l){const C=wm(I,i,e,a);t.push(Js(C,o,s&&s[e],r))}}return t}function eV(e,t,n){return Yi(e)?e(t,n):e}const D1=(e,t)=>e===!0?t:typeof e=="string"?Xo(t,e):void 0;function Q1(e,t,n,g,i){for(const o of t){const s=D1(n,o);if(s){e.add(s);const r=eV(s._fallback,n,i);if(typeof r<"u"&&r!==n&&r!==g)return r}else if(s===!1&&typeof g<"u"&&n!==g)return null}return!1}function wm(e,t,n,g){const i=t._rootScopes,o=eV(t._fallback,n,g),s=[...e,...i],r=new Set;r.add(g);let l=W0(r,s,n,o||n,g);return l===null||typeof o<"u"&&o!==n&&(l=W0(r,s,o,l,g),l===null)?!1:km(Array.from(r),[""],i,o,()=>j1(t,n,g))}function W0(e,t,n,g,i){for(;n;)n=Q1(e,t,n,g,i);return n}function j1(e,t,n){const g=e._getTarget();t in g||(g[t]={});const i=g[t];return Ct(i)&&Me(n)?n:i||{}}function P1(e,t,n,g){let i;for(const o of t)if(i=tV(T1(o,e),n),typeof i<"u")return Xm(e,i)?wm(n,g,e,i):i}function tV(e,t){for(const n of t){if(!n)continue;const g=n[e];if(typeof g<"u")return g}}function R0(e){let t=e._keys;return t||(t=e._keys=O1(e._scopes)),t}function O1(e){const t=new Set;for(const n of e)for(const g of Object.keys(n).filter(i=>!i.startsWith("_")))t.add(g);return Array.from(t)}function Jm(){return typeof window<"u"&&typeof document<"u"}function Ym(e){let t=e.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function xa(e,t,n){let g;return typeof e=="string"?(g=parseInt(e,10),e.indexOf("%")!==-1&&(g=g/100*t.parentNode[n])):g=e,g}const vC=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);function _1(e,t){return vC(e).getPropertyValue(t)}const q1=["top","right","bottom","left"];function fo(e,t,n){const g={};n=n?"-"+n:"";for(let i=0;i<4;i++){const o=q1[i];g[o]=parseFloat(e[t+"-"+o+n])||0}return g.width=g.left+g.right,g.height=g.top+g.bottom,g}const $1=(e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot);function eH(e,t){const n=e.touches,g=n&&n.length?n[0]:e,{offsetX:i,offsetY:o}=g;let s=!1,r,l;if($1(i,o,e.target))r=i,l=o;else{const I=t.getBoundingClientRect();r=g.clientX-I.left,l=g.clientY-I.top,s=!0}return{x:r,y:l,box:s}}function no(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:g}=t,i=vC(n),o=i.boxSizing==="border-box",s=fo(i,"padding"),r=fo(i,"border","width"),{x:l,y:I,box:a}=eH(e,n),C=s.left+(a&&r.left),c=s.top+(a&&r.top);let{width:d,height:u}=t;return o&&(d-=s.width+r.width,u-=s.height+r.height),{x:Math.round((l-C)/d*n.width/g),y:Math.round((I-c)/u*n.height/g)}}function tH(e,t,n){let g,i;if(t===void 0||n===void 0){const o=e&&Ym(e);if(!o)t=e.clientWidth,n=e.clientHeight;else{const s=o.getBoundingClientRect(),r=vC(o),l=fo(r,"border","width"),I=fo(r,"padding");t=s.width-I.width-l.width,n=s.height-I.height-l.height,g=xa(r.maxWidth,o,"clientWidth"),i=xa(r.maxHeight,o,"clientHeight")}}return{width:t,height:n,maxWidth:g||Ya,maxHeight:i||Ya}}const aI=e=>Math.round(e*10)/10;function nH(e,t,n,g){const i=vC(e),o=fo(i,"margin"),s=xa(i.maxWidth,e,"clientWidth")||Ya,r=xa(i.maxHeight,e,"clientHeight")||Ya,l=tH(e,t,n);let{width:I,height:a}=l;if(i.boxSizing==="content-box"){const c=fo(i,"border","width"),d=fo(i,"padding");I-=d.width+c.width,a-=d.height+c.height}return I=Math.max(0,I-o.width),a=Math.max(0,g?I/g:a-o.height),I=aI(Math.min(I,s,l.maxWidth)),a=aI(Math.min(a,r,l.maxHeight)),I&&!a&&(a=aI(I/2)),(t!==void 0||n!==void 0)&&g&&l.height&&a>l.height&&(a=l.height,I=aI(Math.floor(a*g))),{width:I,height:a}}function v0(e,t,n){const g=t||1,i=Math.floor(e.height*g),o=Math.floor(e.width*g);e.height=Math.floor(e.height),e.width=Math.floor(e.width);const s=e.canvas;return s.style&&(n||!s.style.height&&!s.style.width)&&(s.style.height=`${e.height}px`,s.style.width=`${e.width}px`),e.currentDevicePixelRatio!==g||s.height!==i||s.width!==o?(e.currentDevicePixelRatio=g,s.height=i,s.width=o,e.ctx.setTransform(g,0,0,g,0,0),!0):!1}const gH=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};Jm()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return e}();function k0(e,t){const n=_1(e,t),g=n&&n.match(/^(\d+)(\.\d+)?px$/);return g?+g[1]:void 0}const iH=function(e,t){return{x(n){return e+e+t-n},setWidth(n){t=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,g){return n-g},leftForLtr(n,g){return n-g}}},oH=function(){return{x(e){return e},setWidth(e){},textAlign(e){return e},xPlus(e,t){return e+t},leftForLtr(e,t){return e}}};function Gs(e,t,n){return e?iH(t,n):oH()}function nV(e,t){let n,g;(t==="ltr"||t==="rtl")&&(n=e.canvas.style,g=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=g)}function gV(e,t){t!==void 0&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class sH{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,n,g,i){const o=n.listeners[i],s=n.duration;o.forEach(r=>r({chart:t,initial:n.initial,numSteps:s,currentStep:Math.min(g-n.start,s)}))}_refresh(){this._request||(this._running=!0,this._request=DS.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let n=0;this._charts.forEach((g,i)=>{if(!g.running||!g.items.length)return;const o=g.items;let s=o.length-1,r=!1,l;for(;s>=0;--s)l=o[s],l._active?(l._total>g.duration&&(g.duration=l._total),l.tick(t),r=!0):(o[s]=o[o.length-1],o.pop());r&&(i.draw(),this._notify(i,g,t,"progress")),o.length||(g.running=!1,this._notify(i,g,t,"complete"),g.initial=!1),n+=o.length}),this._lastDate=t,n===0&&(this._running=!1)}_getAnims(t){const n=this._charts;let g=n.get(t);return g||(g={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(t,g)),g}listen(t,n,g){this._getAnims(t).listeners[n].push(g)}add(t,n){!n||!n.length||this._getAnims(t).items.push(...n)}has(t){return this._getAnims(t).items.length>0}start(t){const n=this._charts.get(t);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((g,i)=>Math.max(g,i._duration),0),this._refresh())}running(t){if(!this._running)return!1;const n=this._charts.get(t);return!(!n||!n.running||!n.items.length)}stop(t){const n=this._charts.get(t);if(!n||!n.items.length)return;const g=n.items;let i=g.length-1;for(;i>=0;--i)g[i].cancel();n.items=[],this._notify(t,n,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Zg=new sH;const X0="transparent",rH={boolean(e,t,n){return n>.5?t:e},color(e,t,n){const g=G0(e||X0),i=g.valid&&G0(t||X0);return i&&i.valid?i.mix(g,n).hexString():t},number(e,t,n){return e+(t-e)*n}};class lH{constructor(t,n,g,i){const o=n[g];i=II([t.to,i,o,t.from]);const s=II([t.from,o,i]);this._active=!0,this._fn=t.fn||rH[t.type||typeof s],this._easing=Nr[t.easing]||Nr.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=n,this._prop=g,this._from=s,this._to=i,this._promises=void 0}active(){return this._active}update(t,n,g){if(this._active){this._notify(!1);const i=this._target[this._prop],o=g-this._start,s=this._duration-o;this._start=g,this._duration=Math.floor(Math.max(s,t.duration)),this._total+=o,this._loop=!!t.loop,this._to=II([t.to,n,i,t.from]),this._from=II([t.from,i,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const n=t-this._start,g=this._duration,i=this._prop,o=this._from,s=this._loop,r=this._to;let l;if(this._active=o!==r&&(s||n<g),!this._active){this._target[i]=r,this._notify(!0);return}if(n<0){this._target[i]=o;return}l=n/g%2,l=s&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[i]=this._fn(o,r,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((n,g)=>{t.push({res:n,rej:g})})}_notify(t){const n=t?"res":"rej",g=this._promises||[];for(let i=0;i<g.length;i++)g[i][n]()}}class iV{constructor(t,n){this._chart=t,this._properties=new Map,this.configure(n)}configure(t){if(!Me(t))return;const n=Object.keys(bt.animation),g=this._properties;Object.getOwnPropertyNames(t).forEach(i=>{const o=t[i];if(!Me(o))return;const s={};for(const r of n)s[r]=o[r];(Ct(o.properties)&&o.properties||[i]).forEach(r=>{(r===i||!g.has(r))&&g.set(r,s)})})}_animateOptions(t,n){const g=n.options,i=aH(t,g);if(!i)return[];const o=this._createAnimations(i,g);return g.$shared&&IH(t.options.$animations,g).then(()=>{t.options=g},()=>{}),o}_createAnimations(t,n){const g=this._properties,i=[],o=t.$animations||(t.$animations={}),s=Object.keys(n),r=Date.now();let l;for(l=s.length-1;l>=0;--l){const I=s[l];if(I.charAt(0)==="$")continue;if(I==="options"){i.push(...this._animateOptions(t,n));continue}const a=n[I];let C=o[I];const c=g.get(I);if(C)if(c&&C.active()){C.update(c,a,r);continue}else C.cancel();if(!c||!c.duration){t[I]=a;continue}o[I]=C=new lH(c,t,I,a),i.push(C)}return i}update(t,n){if(this._properties.size===0){Object.assign(t,n);return}const g=this._createAnimations(t,n);if(g.length)return Zg.add(this._chart,g),!0}}function IH(e,t){const n=[],g=Object.keys(t);for(let i=0;i<g.length;i++){const o=e[g[i]];o&&o.active()&&n.push(o.wait())}return Promise.all(n)}function aH(e,t){if(!t)return;let n=e.options;if(!n){e.options=t;return}return n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function w0(e,t){const n=e&&e.options||{},g=n.reverse,i=n.min===void 0?t:0,o=n.max===void 0?t:0;return{start:g?o:i,end:g?i:o}}function CH(e,t,n){if(n===!1)return!1;const g=w0(e,n),i=w0(t,n);return{top:i.end,right:g.end,bottom:i.start,left:g.start}}function cH(e){let t,n,g,i;return Me(e)?(t=e.top,n=e.right,g=e.bottom,i=e.left):t=n=g=i=e,{top:t,right:n,bottom:g,left:i,disabled:e===!1}}function oV(e,t){const n=[],g=e._getSortedDatasetMetas(t);let i,o;for(i=0,o=g.length;i<o;++i)n.push(g[i].index);return n}function J0(e,t,n,g={}){const i=e.keys,o=g.mode==="single";let s,r,l,I;if(t!==null){for(s=0,r=i.length;s<r;++s){if(l=+i[s],l===n){if(g.all)continue;break}I=e.values[l],Yt(I)&&(o||t===0||vi(t)===vi(I))&&(t+=I)}return t}}function dH(e,t){const{iScale:n,vScale:g}=t,i=n.axis==="x"?"x":"y",o=g.axis==="x"?"x":"y",s=Object.keys(e),r=new Array(s.length);let l,I,a;for(l=0,I=s.length;l<I;++l)a=s[l],r[l]={[i]:a,[o]:e[a]};return r}function Y0(e,t){const n=e&&e.options.stacked;return n||n===void 0&&t.stack!==void 0}function uH(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}function AH(e){const{min:t,max:n,minDefined:g,maxDefined:i}=e.getUserBounds();return{min:g?t:Number.NEGATIVE_INFINITY,max:i?n:Number.POSITIVE_INFINITY}}function hH(e,t,n){const g=e[t]||(e[t]={});return g[n]||(g[n]={})}function H0(e,t,n,g){for(const i of t.getMatchingVisibleMetas(g).reverse()){const o=e[i.index];if(n&&o>0||!n&&o<0)return i.index}return null}function N0(e,t){const{chart:n,_cachedMeta:g}=e,i=n._stacks||(n._stacks={}),{iScale:o,vScale:s,index:r}=g,l=o.axis,I=s.axis,a=uH(o,s,g),C=t.length;let c;for(let d=0;d<C;++d){const u=t[d],{[l]:h,[I]:f}=u,y=u._stacks||(u._stacks={});c=y[I]=hH(i,a,h),c[r]=f,c._top=H0(c,s,!0,g.type),c._bottom=H0(c,s,!1,g.type);const Z=c._visualValues||(c._visualValues={});Z[r]=f}}function Nc(e,t){const n=e.scales;return Object.keys(n).filter(g=>n[g].axis===t).shift()}function mH(e,t){return xo(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function bH(e,t,n){return xo(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}function gr(e,t){const n=e.controller.index,g=e.vScale&&e.vScale.axis;if(g){t=t||e._parsed;for(const i of t){const o=i._stacks;if(!o||o[g]===void 0||o[g][n]===void 0)return;delete o[g][n],o[g]._visualValues!==void 0&&o[g]._visualValues[n]!==void 0&&delete o[g]._visualValues[n]}}}const Fc=e=>e==="reset"||e==="none",F0=(e,t)=>t?e:Object.assign({},e),pH=(e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:oV(n,!0),values:null};class Bs{constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Y0(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&gr(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,n=this._cachedMeta,g=this.getDataset(),i=(C,c,d,u)=>C==="x"?c:C==="r"?u:d,o=n.xAxisID=Le(g.xAxisID,Nc(t,"x")),s=n.yAxisID=Le(g.yAxisID,Nc(t,"y")),r=n.rAxisID=Le(g.rAxisID,Nc(t,"r")),l=n.indexAxis,I=n.iAxisID=i(l,o,s,r),a=n.vAxisID=i(l,s,o,r);n.xScale=this.getScaleForId(o),n.yScale=this.getScaleForId(s),n.rScale=this.getScaleForId(r),n.iScale=this.getScaleForId(I),n.vScale=this.getScaleForId(a)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&f0(this._data,this),t._stacked&&gr(t)}_dataCheck(){const t=this.getDataset(),n=t.data||(t.data=[]),g=this._data;if(Me(n)){const i=this._cachedMeta;this._data=dH(n,i)}else if(g!==n){if(g){f0(g,this);const i=this._cachedMeta;gr(i),i._parsed=[]}n&&Object.isExtensible(n)&&Z1(n,this),this._syncList=[],this._data=n}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const n=this._cachedMeta,g=this.getDataset();let i=!1;this._dataCheck();const o=n._stacked;n._stacked=Y0(n.vScale,n),n.stack!==g.stack&&(i=!0,gr(n),n.stack=g.stack),this._resyncElements(t),(i||o!==n._stacked)&&N0(this,n._parsed)}configure(){const t=this.chart.config,n=t.datasetScopeKeys(this._type),g=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(g,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){const{_cachedMeta:g,_data:i}=this,{iScale:o,_stacked:s}=g,r=o.axis;let l=t===0&&n===i.length?!0:g._sorted,I=t>0&&g._parsed[t-1],a,C,c;if(this._parsing===!1)g._parsed=i,g._sorted=!0,c=i;else{Ct(i[t])?c=this.parseArrayData(g,i,t,n):Me(i[t])?c=this.parseObjectData(g,i,t,n):c=this.parsePrimitiveData(g,i,t,n);const d=()=>C[r]===null||I&&C[r]<I[r];for(a=0;a<n;++a)g._parsed[a+t]=C=c[a],l&&(d()&&(l=!1),I=C);g._sorted=l}s&&N0(this,c)}parsePrimitiveData(t,n,g,i){const{iScale:o,vScale:s}=t,r=o.axis,l=s.axis,I=o.getLabels(),a=o===s,C=new Array(i);let c,d,u;for(c=0,d=i;c<d;++c)u=c+g,C[c]={[r]:a||o.parse(I[u],u),[l]:s.parse(n[u],u)};return C}parseArrayData(t,n,g,i){const{xScale:o,yScale:s}=t,r=new Array(i);let l,I,a,C;for(l=0,I=i;l<I;++l)a=l+g,C=n[a],r[l]={x:o.parse(C[0],a),y:s.parse(C[1],a)};return r}parseObjectData(t,n,g,i){const{xScale:o,yScale:s}=t,{xAxisKey:r="x",yAxisKey:l="y"}=this._parsing,I=new Array(i);let a,C,c,d;for(a=0,C=i;a<C;++a)c=a+g,d=n[c],I[a]={x:o.parse(Xo(d,r),c),y:s.parse(Xo(d,l),c)};return I}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,g){const i=this.chart,o=this._cachedMeta,s=n[t.axis],r={keys:oV(i,!0),values:n._stacks[t.axis]._visualValues};return J0(r,s,o.index,{mode:g})}updateRangeFromParsed(t,n,g,i){const o=g[n.axis];let s=o===null?NaN:o;const r=i&&g._stacks[n.axis];i&&r&&(i.values=r,s=J0(i,o,this._cachedMeta.index)),t.min=Math.min(t.min,s),t.max=Math.max(t.max,s)}getMinMax(t,n){const g=this._cachedMeta,i=g._parsed,o=g._sorted&&t===g.iScale,s=i.length,r=this._getOtherScale(t),l=pH(n,g,this.chart),I={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:a,max:C}=AH(r);let c,d;function u(){d=i[c];const h=d[r.axis];return!Yt(d[t.axis])||a>h||C<h}for(c=0;c<s&&!(!u()&&(this.updateRangeFromParsed(I,t,d,l),o));++c);if(o){for(c=s-1;c>=0;--c)if(!u()){this.updateRangeFromParsed(I,t,d,l);break}}return I}getAllParsedValues(t){const n=this._cachedMeta._parsed,g=[];let i,o,s;for(i=0,o=n.length;i<o;++i)s=n[i][t.axis],Yt(s)&&g.push(s);return g}getMaxOverflow(){return!1}getLabelAndValue(t){const n=this._cachedMeta,g=n.iScale,i=n.vScale,o=this.getParsed(t);return{label:g?""+g.getLabelForValue(o[g.axis]):"",value:i?""+i.getLabelForValue(o[i.axis]):""}}_update(t){const n=this._cachedMeta;this.update(t||"default"),n._clip=cH(Le(this.options.clip,CH(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,n=this.chart,g=this._cachedMeta,i=g.data||[],o=n.chartArea,s=[],r=this._drawStart||0,l=this._drawCount||i.length-r,I=this.options.drawActiveElementsOnTop;let a;for(g.dataset&&g.dataset.draw(t,o,r,l),a=r;a<r+l;++a){const C=i[a];C.hidden||(C.active&&I?s.push(C):C.draw(t,o))}for(a=0;a<s.length;++a)s[a].draw(t,o)}getStyle(t,n){const g=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(g):this.resolveDataElementOptions(t||0,g)}getContext(t,n,g){const i=this.getDataset();let o;if(t>=0&&t<this._cachedMeta.data.length){const s=this._cachedMeta.data[t];o=s.$context||(s.$context=bH(this.getContext(),t,s)),o.parsed=this.getParsed(t),o.raw=i.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=mH(this.chart.getContext(),this.index)),o.dataset=i,o.index=o.datasetIndex=this.index;return o.active=!!n,o.mode=g,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",g){const i=n==="active",o=this._cachedDataOpts,s=t+"-"+n,r=o[s],l=this.enableOptionSharing&&dl(g);if(r)return F0(r,l);const I=this.chart.config,a=I.datasetElementScopeKeys(this._type,t),C=i?[`${t}Hover`,"hover",t,""]:[t,""],c=I.getOptionScopes(this.getDataset(),a),d=Object.keys(bt.elements[t]),u=()=>this.getContext(g,i,n),h=I.resolveNamedOptions(c,d,u,C);return h.$shared&&(h.$shared=l,o[s]=Object.freeze(F0(h,l))),h}_resolveAnimations(t,n,g){const i=this.chart,o=this._cachedDataOpts,s=`animation-${n}`,r=o[s];if(r)return r;let l;if(i.options.animation!==!1){const a=this.chart.config,C=a.datasetAnimationScopeKeys(this._type,n),c=a.getOptionScopes(this.getDataset(),C);l=a.createResolver(c,this.getContext(t,g,n))}const I=new iV(i,l&&l.animations);return l&&l._cacheable&&(o[s]=Object.freeze(I)),I}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||Fc(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){const g=this.resolveDataElementOptions(t,n),i=this._sharedOptions,o=this.getSharedOptions(g),s=this.includeOptions(n,o)||o!==i;return this.updateSharedOptions(o,n,g),{sharedOptions:o,includeOptions:s}}updateElement(t,n,g,i){Fc(i)?Object.assign(t,g):this._resolveAnimations(n,i).update(t,g)}updateSharedOptions(t,n,g){t&&!Fc(n)&&this._resolveAnimations(void 0,n).update(t,g)}_setStyle(t,n,g,i){t.active=i;const o=this.getStyle(n,i);this._resolveAnimations(n,g,i).update(t,{options:!i&&this.getSharedOptions(o)||o})}removeHoverStyle(t,n,g){this._setStyle(t,g,"active",!1)}setHoverStyle(t,n,g){this._setStyle(t,g,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const n=this._data,g=this._cachedMeta.data;for(const[r,l,I]of this._syncList)this[r](l,I);this._syncList=[];const i=g.length,o=n.length,s=Math.min(o,i);s&&this.parse(0,s),o>i?this._insertElements(i,o-i,t):o<i&&this._removeElements(o,i-o)}_insertElements(t,n,g=!0){const i=this._cachedMeta,o=i.data,s=t+n;let r;const l=I=>{for(I.length+=n,r=I.length-1;r>=s;r--)I[r]=I[r-n]};for(l(o),r=t;r<s;++r)o[r]=new this.dataElementType;this._parsing&&l(i._parsed),this.parse(t,n),g&&this.updateElements(o,t,n,"reset")}updateElements(t,n,g,i){}_removeElements(t,n){const g=this._cachedMeta;if(this._parsing){const i=g._parsed.splice(t,n);g._stacked&&gr(g,i)}g.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[n,g,i]=t;this[n](g,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);const g=arguments.length-2;g&&this._sync(["_insertElements",t,g])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Se(Bs,"defaults",{}),Se(Bs,"datasetElementType",null),Se(Bs,"dataElementType",null);function fH(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let g=[];for(let i=0,o=n.length;i<o;i++)g=g.concat(n[i].controller.getAllParsedValues(e));e._cache.$bar=zS(g.sort((i,o)=>i-o))}return e._cache.$bar}function ZH(e){const t=e.iScale,n=fH(t,e.type);let g=t._length,i,o,s,r;const l=()=>{s===32767||s===-32768||(dl(r)&&(g=Math.min(g,Math.abs(s-r)||g)),r=s)};for(i=0,o=n.length;i<o;++i)s=t.getPixelForValue(n[i]),l();for(r=void 0,i=0,o=t.ticks.length;i<o;++i)s=t.getPixelForTick(i),l();return g}function yH(e,t,n,g){const i=n.barThickness;let o,s;return _e(i)?(o=t.min*n.categoryPercentage,s=n.barPercentage):(o=i*g,s=1),{chunk:o/g,ratio:s,start:t.pixels[e]-o/2}}function GH(e,t,n,g){const i=t.pixels,o=i[e];let s=e>0?i[e-1]:null,r=e<i.length-1?i[e+1]:null;const l=n.categoryPercentage;s===null&&(s=o-(r===null?t.end-t.start:r-o)),r===null&&(r=o+o-s);const I=o-(o-Math.min(s,r))/2*l;return{chunk:Math.abs(r-s)/2*l/g,ratio:n.barPercentage,start:I}}function BH(e,t,n,g){const i=n.parse(e[0],g),o=n.parse(e[1],g),s=Math.min(i,o),r=Math.max(i,o);let l=s,I=r;Math.abs(s)>Math.abs(r)&&(l=r,I=s),t[n.axis]=I,t._custom={barStart:l,barEnd:I,start:i,end:o,min:s,max:r}}function sV(e,t,n,g){return Ct(e)?BH(e,t,n,g):t[n.axis]=n.parse(e,g),t}function x0(e,t,n,g){const i=e.iScale,o=e.vScale,s=i.getLabels(),r=i===o,l=[];let I,a,C,c;for(I=n,a=n+g;I<a;++I)c=t[I],C={},C[i.axis]=r||i.parse(s[I],I),l.push(sV(c,C,o,I));return l}function xc(e){return e&&e.barStart!==void 0&&e.barEnd!==void 0}function SH(e,t,n){return e!==0?vi(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}function VH(e){let t,n,g,i,o;return e.horizontal?(t=e.base>e.x,n="left",g="right"):(t=e.base<e.y,n="bottom",g="top"),t?(i="end",o="start"):(i="start",o="end"),{start:n,end:g,reverse:t,top:i,bottom:o}}function WH(e,t,n,g){let i=t.borderSkipped;const o={};if(!i){e.borderSkipped=o;return}if(i===!0){e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:s,end:r,reverse:l,top:I,bottom:a}=VH(e);i==="middle"&&n&&(e.enableBorderRadius=!0,(n._top||0)===g?i=I:(n._bottom||0)===g?i=a:(o[K0(a,s,r,l)]=!0,i=I)),o[K0(i,s,r,l)]=!0,e.borderSkipped=o}function K0(e,t,n,g){return g?(e=RH(e,t,n),e=E0(e,n,t)):e=E0(e,t,n),e}function RH(e,t,n){return e===t?n:e===n?t:e}function E0(e,t,n){return e==="start"?t:e==="end"?n:e}function vH(e,{inflateAmount:t},n){e.inflateAmount=t==="auto"?n===1?.33:0:t}class LI extends Bs{parsePrimitiveData(t,n,g,i){return x0(t,n,g,i)}parseArrayData(t,n,g,i){return x0(t,n,g,i)}parseObjectData(t,n,g,i){const{iScale:o,vScale:s}=t,{xAxisKey:r="x",yAxisKey:l="y"}=this._parsing,I=o.axis==="x"?r:l,a=s.axis==="x"?r:l,C=[];let c,d,u,h;for(c=g,d=g+i;c<d;++c)h=n[c],u={},u[o.axis]=o.parse(Xo(h,I),c),C.push(sV(Xo(h,a),u,s,c));return C}updateRangeFromParsed(t,n,g,i){super.updateRangeFromParsed(t,n,g,i);const o=g._custom;o&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const n=this._cachedMeta,{iScale:g,vScale:i}=n,o=this.getParsed(t),s=o._custom,r=xc(s)?"["+s.start+", "+s.end+"]":""+i.getLabelForValue(o[i.axis]);return{label:""+g.getLabelForValue(o[g.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,g,i){const o=i==="reset",{index:s,_cachedMeta:{vScale:r}}=this,l=r.getBasePixel(),I=r.isHorizontal(),a=this._getRuler(),{sharedOptions:C,includeOptions:c}=this._getSharedOptions(n,i);for(let d=n;d<n+g;d++){const u=this.getParsed(d),h=o||_e(u[r.axis])?{base:l,head:l}:this._calculateBarValuePixels(d),f=this._calculateBarIndexPixels(d,a),y=(u._stacks||{})[r.axis],Z={horizontal:I,base:h.base,enableBorderRadius:!y||xc(u._custom)||s===y._top||s===y._bottom,x:I?h.head:f.center,y:I?f.center:h.head,height:I?f.size:Math.abs(h.size),width:I?Math.abs(h.size):f.size};c&&(Z.options=C||this.resolveDataElementOptions(d,t[d].active?"active":i));const p=Z.options||t[d].options;WH(Z,p,y,s),vH(Z,p,a.ratio),this.updateElement(t[d],d,Z,i)}}_getStacks(t,n){const{iScale:g}=this._cachedMeta,i=g.getMatchingVisibleMetas(this._type).filter(l=>l.controller.options.grouped),o=g.options.stacked,s=[],r=l=>{const I=l.controller.getParsed(n),a=I&&I[l.vScale.axis];if(_e(a)||isNaN(a))return!0};for(const l of i)if(!(n!==void 0&&r(l))&&((o===!1||s.indexOf(l.stack)===-1||o===void 0&&l.stack===void 0)&&s.push(l.stack),l.index===t))break;return s.length||s.push(void 0),s}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,n,g){const i=this._getStacks(t,g),o=n!==void 0?i.indexOf(n):-1;return o===-1?i.length-1:o}_getRuler(){const t=this.options,n=this._cachedMeta,g=n.iScale,i=[];let o,s;for(o=0,s=n.data.length;o<s;++o)i.push(g.getPixelForValue(this.getParsed(o)[g.axis],o));const r=t.barThickness;return{min:r||ZH(n),pixels:i,start:g._startPixel,end:g._endPixel,stackCount:this._getStackCount(),scale:g,grouped:t.grouped,ratio:r?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:n,_stacked:g,index:i},options:{base:o,minBarLength:s}}=this,r=o||0,l=this.getParsed(t),I=l._custom,a=xc(I);let C=l[n.axis],c=0,d=g?this.applyStack(n,l,g):C,u,h;d!==C&&(c=d-C,d=C),a&&(C=I.barStart,d=I.barEnd-I.barStart,C!==0&&vi(C)!==vi(I.barEnd)&&(c=0),c+=C);const f=!_e(o)&&!a?o:c;let y=n.getPixelForValue(f);if(this.chart.getDataVisibility(t)?u=n.getPixelForValue(c+d):u=y,h=u-y,Math.abs(h)<s){h=SH(h,n,r)*s,C===r&&(y-=h/2);const Z=n.getPixelForDecimal(0),p=n.getPixelForDecimal(1),B=Math.min(Z,p),W=Math.max(Z,p);y=Math.max(Math.min(y,W),B),u=y+h,g&&!a&&(l._stacks[n.axis]._visualValues[i]=n.getValueForPixel(u)-n.getValueForPixel(y))}if(y===n.getPixelForValue(r)){const Z=vi(h)*n.getLineWidthForValue(r)/2;y+=Z,h-=Z}return{size:h,base:y,head:u,center:u+h/2}}_calculateBarIndexPixels(t,n){const g=n.scale,i=this.options,o=i.skipNull,s=Le(i.maxBarThickness,1/0);let r,l;if(n.grouped){const I=o?this._getStackCount(t):n.stackCount,a=i.barThickness==="flex"?GH(t,n,i,I):yH(t,n,i,I),C=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0);r=a.start+a.chunk*C+a.chunk/2,l=Math.min(s,a.chunk*a.ratio)}else r=g.getPixelForValue(this.getParsed(t)[g.axis],t),l=Math.min(s,n.min*n.ratio);return{base:r-l/2,head:r+l/2,center:r,size:l}}draw(){const t=this._cachedMeta,n=t.vScale,g=t.data,i=g.length;let o=0;for(;o<i;++o)this.getParsed(o)[n.axis]!==null&&!g[o].hidden&&g[o].draw(this._ctx)}}Se(LI,"id","bar"),Se(LI,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Se(LI,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});function kH(e,t,n){let g=1,i=1,o=0,s=0;if(t<mt){const r=e,l=r+t,I=Math.cos(r),a=Math.sin(r),C=Math.cos(l),c=Math.sin(l),d=(p,B,W)=>Na(p,r,l,!0)?1:Math.max(B,B*n,W,W*n),u=(p,B,W)=>Na(p,r,l,!0)?-1:Math.min(B,B*n,W,W*n),h=d(0,I,C),f=d(Gt,a,c),y=u(pt,I,C),Z=u(pt+Gt,a,c);g=(h-y)/2,i=(f-Z)/2,o=-(h+y)/2,s=-(f+Z)/2}return{ratioX:g,ratioY:i,offsetX:o,offsetY:s}}class br extends Bs{constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){const g=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=g;else{let o=l=>+g[l];if(Me(g[t])){const{key:l="value"}=this._parsing;o=I=>+Xo(g[I],l)}let s,r;for(s=t,r=t+n;s<r;++s)i._parsed[s]=o(s)}}_getRotation(){return cg(this.options.rotation-90)}_getCircumference(){return cg(this.options.circumference)}_getRotationExtents(){let t=mt,n=-mt;for(let g=0;g<this.chart.data.datasets.length;++g)if(this.chart.isDatasetVisible(g)&&this.chart.getDatasetMeta(g).type===this._type){const i=this.chart.getDatasetMeta(g).controller,o=i._getRotation(),s=i._getCircumference();t=Math.min(t,o),n=Math.max(n,o+s)}return{rotation:t,circumference:n-t}}update(t){const n=this.chart,{chartArea:g}=n,i=this._cachedMeta,o=i.data,s=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,r=Math.max((Math.min(g.width,g.height)-s)/2,0),l=Math.min(l1(this.options.cutout,r),1),I=this._getRingWeight(this.index),{circumference:a,rotation:C}=this._getRotationExtents(),{ratioX:c,ratioY:d,offsetX:u,offsetY:h}=kH(C,a,l),f=(g.width-s)/c,y=(g.height-s)/d,Z=Math.max(Math.min(f,y)/2,0),p=ES(this.options.radius,Z),B=Math.max(p*l,0),W=(p-B)/this._getVisibleDatasetWeightTotal();this.offsetX=u*p,this.offsetY=h*p,i.total=this.calculateTotal(),this.outerRadius=p-W*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-W*I,0),this.updateElements(o,0,o.length,t)}_circumference(t,n){const g=this.options,i=this._cachedMeta,o=this._getCircumference();return n&&g.animation.animateRotate||!this.chart.getDataVisibility(t)||i._parsed[t]===null||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*o/mt)}updateElements(t,n,g,i){const o=i==="reset",s=this.chart,r=s.chartArea,I=s.options.animation,a=(r.left+r.right)/2,C=(r.top+r.bottom)/2,c=o&&I.animateScale,d=c?0:this.innerRadius,u=c?0:this.outerRadius,{sharedOptions:h,includeOptions:f}=this._getSharedOptions(n,i);let y=this._getRotation(),Z;for(Z=0;Z<n;++Z)y+=this._circumference(Z,o);for(Z=n;Z<n+g;++Z){const p=this._circumference(Z,o),B=t[Z],W={x:a+this.offsetX,y:C+this.offsetY,startAngle:y,endAngle:y+p,circumference:p,outerRadius:u,innerRadius:d};f&&(W.options=h||this.resolveDataElementOptions(Z,B.active?"active":i)),y+=p,this.updateElement(B,Z,W,i)}}calculateTotal(){const t=this._cachedMeta,n=t.data;let g=0,i;for(i=0;i<n.length;i++){const o=t._parsed[i];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(i)&&!n[i].hidden&&(g+=Math.abs(o))}return g}calculateCircumference(t){const n=this._cachedMeta.total;return n>0&&!isNaN(t)?mt*(Math.abs(t)/n):0}getLabelAndValue(t){const n=this._cachedMeta,g=this.chart,i=g.data.labels||[],o=WC(n._parsed[t],g.options.locale);return{label:i[t]||"",value:o}}getMaxBorderWidth(t){let n=0;const g=this.chart;let i,o,s,r,l;if(!t){for(i=0,o=g.data.datasets.length;i<o;++i)if(g.isDatasetVisible(i)){s=g.getDatasetMeta(i),t=s.data,r=s.controller;break}}if(!t)return 0;for(i=0,o=t.length;i<o;++i)l=r.resolveDataElementOptions(i),l.borderAlign!=="inner"&&(n=Math.max(n,l.borderWidth||0,l.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let g=0,i=t.length;g<i;++g){const o=this.resolveDataElementOptions(g);n=Math.max(n,o.offset||0,o.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let g=0;g<t;++g)this.chart.isDatasetVisible(g)&&(n+=this._getRingWeight(g));return n}_getRingWeight(t){return Math.max(Le(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Se(br,"id","doughnut"),Se(br,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Se(br,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),Se(br,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:g,color:i}}=t.legend.options;return n.labels.map((o,s)=>{const l=t.getDatasetMeta(0).controller.getStyle(s);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:i,lineWidth:l.borderWidth,pointStyle:g,hidden:!t.getDataVisibility(s),index:s}})}return[]}},onClick(t,n,g){g.chart.toggleDataVisibility(n.index),g.chart.update()}}}});class Bu extends br{}Se(Bu,"id","pie"),Se(Bu,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});function zi(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Hm{constructor(t){Se(this,"options");this.options=t||{}}static override(t){Object.assign(Hm.prototype,t)}init(){}formats(){return zi()}parse(){return zi()}format(){return zi()}add(){return zi()}diff(){return zi()}startOf(){return zi()}endOf(){return zi()}}var XH={_date:Hm};function wH(e,t,n,g){const{controller:i,data:o,_sorted:s}=e,r=i._cachedMeta.iScale;if(r&&t===r.axis&&t!=="r"&&s&&o.length){const l=r._reversePixels?p1:yu;if(g){if(i._sharedOptions){const I=o[0],a=typeof I.getRange=="function"&&I.getRange(t);if(a){const C=l(o,t,n-a),c=l(o,t,n+a);return{lo:C.lo,hi:c.hi}}}}else return l(o,t,n)}return{lo:0,hi:o.length-1}}function Yl(e,t,n,g,i){const o=e.getSortedVisibleDatasetMetas(),s=n[t];for(let r=0,l=o.length;r<l;++r){const{index:I,data:a}=o[r],{lo:C,hi:c}=wH(o[r],t,s,i);for(let d=C;d<=c;++d){const u=a[d];u.skip||g(u,I,d)}}}function JH(e){const t=e.indexOf("x")!==-1,n=e.indexOf("y")!==-1;return function(g,i){const o=t?Math.abs(g.x-i.x):0,s=n?Math.abs(g.y-i.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(s,2))}}function Kc(e,t,n,g,i){const o=[];return!i&&!e.isPointInArea(t)||Yl(e,n,t,function(r,l,I){!i&&!as(r,e.chartArea,0)||r.inRange(t.x,t.y,g)&&o.push({element:r,datasetIndex:l,index:I})},!0),o}function YH(e,t,n,g){let i=[];function o(s,r,l){const{startAngle:I,endAngle:a}=s.getProps(["startAngle","endAngle"],g),{angle:C}=LS(s,{x:t.x,y:t.y});Na(C,I,a)&&i.push({element:s,datasetIndex:r,index:l})}return Yl(e,n,t,o),i}function HH(e,t,n,g,i,o){let s=[];const r=JH(n);let l=Number.POSITIVE_INFINITY;function I(a,C,c){const d=a.inRange(t.x,t.y,i);if(g&&!d)return;const u=a.getCenterPoint(i);if(!(!!o||e.isPointInArea(u))&&!d)return;const f=r(t,u);f<l?(s=[{element:a,datasetIndex:C,index:c}],l=f):f===l&&s.push({element:a,datasetIndex:C,index:c})}return Yl(e,n,t,I),s}function Ec(e,t,n,g,i,o){return!o&&!e.isPointInArea(t)?[]:n==="r"&&!g?YH(e,t,n,i):HH(e,t,n,g,i,o)}function M0(e,t,n,g,i){const o=[],s=n==="x"?"inXRange":"inYRange";let r=!1;return Yl(e,n,t,(l,I,a)=>{l[s](t[n],i)&&(o.push({element:l,datasetIndex:I,index:a}),r=r||l.inRange(t.x,t.y,i))}),g&&!r?[]:o}var NH={evaluateInteractionItems:Yl,modes:{index(e,t,n,g){const i=no(t,e),o=n.axis||"x",s=n.includeInvisible||!1,r=n.intersect?Kc(e,i,o,g,s):Ec(e,i,o,!1,g,s),l=[];return r.length?(e.getSortedVisibleDatasetMetas().forEach(I=>{const a=r[0].index,C=I.data[a];C&&!C.skip&&l.push({element:C,datasetIndex:I.index,index:a})}),l):[]},dataset(e,t,n,g){const i=no(t,e),o=n.axis||"xy",s=n.includeInvisible||!1;let r=n.intersect?Kc(e,i,o,g,s):Ec(e,i,o,!1,g,s);if(r.length>0){const l=r[0].datasetIndex,I=e.getDatasetMeta(l).data;r=[];for(let a=0;a<I.length;++a)r.push({element:I[a],datasetIndex:l,index:a})}return r},point(e,t,n,g){const i=no(t,e),o=n.axis||"xy",s=n.includeInvisible||!1;return Kc(e,i,o,g,s)},nearest(e,t,n,g){const i=no(t,e),o=n.axis||"xy",s=n.includeInvisible||!1;return Ec(e,i,o,n.intersect,g,s)},x(e,t,n,g){const i=no(t,e);return M0(e,i,"x",n.intersect,g)},y(e,t,n,g){const i=no(t,e);return M0(e,i,"y",n.intersect,g)}}};const rV=["left","top","right","bottom"];function ir(e,t){return e.filter(n=>n.pos===t)}function T0(e,t){return e.filter(n=>rV.indexOf(n.pos)===-1&&n.box.axis===t)}function or(e,t){return e.sort((n,g)=>{const i=t?g:n,o=t?n:g;return i.weight===o.weight?i.index-o.index:i.weight-o.weight})}function FH(e){const t=[];let n,g,i,o,s,r;for(n=0,g=(e||[]).length;n<g;++n)i=e[n],{position:o,options:{stack:s,stackWeight:r=1}}=i,t.push({index:n,box:i,pos:o,horizontal:i.isHorizontal(),weight:i.weight,stack:s&&o+s,stackWeight:r});return t}function xH(e){const t={};for(const n of e){const{stack:g,pos:i,stackWeight:o}=n;if(!g||!rV.includes(i))continue;const s=t[g]||(t[g]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=o}return t}function KH(e,t){const n=xH(e),{vBoxMaxWidth:g,hBoxMaxHeight:i}=t;let o,s,r;for(o=0,s=e.length;o<s;++o){r=e[o];const{fullSize:l}=r.box,I=n[r.stack],a=I&&r.stackWeight/I.weight;r.horizontal?(r.width=a?a*g:l&&t.availableWidth,r.height=i):(r.width=g,r.height=a?a*i:l&&t.availableHeight)}return n}function EH(e){const t=FH(e),n=or(t.filter(I=>I.box.fullSize),!0),g=or(ir(t,"left"),!0),i=or(ir(t,"right")),o=or(ir(t,"top"),!0),s=or(ir(t,"bottom")),r=T0(t,"x"),l=T0(t,"y");return{fullSize:n,leftAndTop:g.concat(o),rightAndBottom:i.concat(l).concat(s).concat(r),chartArea:ir(t,"chartArea"),vertical:g.concat(i).concat(l),horizontal:o.concat(s).concat(r)}}function L0(e,t,n,g){return Math.max(e[n],t[n])+Math.max(e[g],t[g])}function lV(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function MH(e,t,n,g){const{pos:i,box:o}=n,s=e.maxPadding;if(!Me(i)){n.size&&(e[i]-=n.size);const C=g[n.stack]||{size:0,count:1};C.size=Math.max(C.size,n.horizontal?o.height:o.width),n.size=C.size/C.count,e[i]+=n.size}o.getPadding&&lV(s,o.getPadding());const r=Math.max(0,t.outerWidth-L0(s,e,"left","right")),l=Math.max(0,t.outerHeight-L0(s,e,"top","bottom")),I=r!==e.w,a=l!==e.h;return e.w=r,e.h=l,n.horizontal?{same:I,other:a}:{same:a,other:I}}function TH(e){const t=e.maxPadding;function n(g){const i=Math.max(t[g]-e[g],0);return e[g]+=i,i}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}function LH(e,t){const n=t.maxPadding;function g(i){const o={left:0,top:0,right:0,bottom:0};return i.forEach(s=>{o[s]=Math.max(t[s],n[s])}),o}return g(e?["left","right"]:["top","bottom"])}function pr(e,t,n,g){const i=[];let o,s,r,l,I,a;for(o=0,s=e.length,I=0;o<s;++o){r=e[o],l=r.box,l.update(r.width||t.w,r.height||t.h,LH(r.horizontal,t));const{same:C,other:c}=MH(t,n,r,g);I|=C&&i.length,a=a||c,l.fullSize||i.push(r)}return I&&pr(i,t,n,g)||a}function CI(e,t,n,g,i){e.top=n,e.left=t,e.right=t+g,e.bottom=n+i,e.width=g,e.height=i}function U0(e,t,n,g){const i=n.padding;let{x:o,y:s}=t;for(const r of e){const l=r.box,I=g[r.stack]||{count:1,placed:0,weight:1},a=r.stackWeight/I.weight||1;if(r.horizontal){const C=t.w*a,c=I.size||l.height;dl(I.start)&&(s=I.start),l.fullSize?CI(l,i.left,s,n.outerWidth-i.right-i.left,c):CI(l,t.left+I.placed,s,C,c),I.start=s,I.placed+=C,s=l.bottom}else{const C=t.h*a,c=I.size||l.width;dl(I.start)&&(o=I.start),l.fullSize?CI(l,o,i.top,c,n.outerHeight-i.bottom-i.top):CI(l,o,t.top+I.placed,c,C),I.start=o,I.placed+=C,o=l.right}}t.x=o,t.y=s}var En={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(n){t.draw(n)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;n!==-1&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,g){if(!e)return;const i=en(e.options.layout.padding),o=Math.max(t-i.width,0),s=Math.max(n-i.height,0),r=EH(e.boxes),l=r.vertical,I=r.horizontal;De(e.boxes,h=>{typeof h.beforeLayout=="function"&&h.beforeLayout()});const a=l.reduce((h,f)=>f.box.options&&f.box.options.display===!1?h:h+1,0)||1,C=Object.freeze({outerWidth:t,outerHeight:n,padding:i,availableWidth:o,availableHeight:s,vBoxMaxWidth:o/2/a,hBoxMaxHeight:s/2}),c=Object.assign({},i);lV(c,en(g));const d=Object.assign({maxPadding:c,w:o,h:s,x:i.left,y:i.top},i),u=KH(l.concat(I),C);pr(r.fullSize,d,C,u),pr(l,d,C,u),pr(I,d,C,u)&&pr(l,d,C,u),TH(d),U0(r.leftAndTop,d,C,u),d.x+=d.w,d.y+=d.h,U0(r.rightAndBottom,d,C,u),e.chartArea={left:d.left,top:d.top,right:d.left+d.w,bottom:d.top+d.h,height:d.h,width:d.w},De(r.chartArea,h=>{const f=h.box;Object.assign(f,e.chartArea),f.update(d.w,d.h,{left:0,top:0,right:0,bottom:0})})}};class IV{acquireContext(t,n){}releaseContext(t){return!1}addEventListener(t,n,g){}removeEventListener(t,n,g){}getDevicePixelRatio(){return 1}getMaximumSize(t,n,g,i){return n=Math.max(0,n||t.width),g=g||t.height,{width:n,height:Math.max(0,i?Math.floor(n/i):g)}}isAttached(t){return!0}updateConfig(t){}}class UH extends IV{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const UI="$chartjs",zH={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},z0=e=>e===null||e==="";function DH(e,t){const n=e.style,g=e.getAttribute("height"),i=e.getAttribute("width");if(e[UI]={initial:{height:g,width:i,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",z0(i)){const o=k0(e,"width");o!==void 0&&(e.width=o)}if(z0(g))if(e.style.height==="")e.height=e.width/(t||2);else{const o=k0(e,"height");o!==void 0&&(e.height=o)}return e}const aV=gH?{passive:!0}:!1;function QH(e,t,n){e&&e.addEventListener(t,n,aV)}function jH(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,aV)}function PH(e,t){const n=zH[e.type]||e.type,{x:g,y:i}=no(e,t);return{type:n,chart:t,native:e,x:g!==void 0?g:null,y:i!==void 0?i:null}}function Ka(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function OH(e,t,n){const g=e.canvas,i=new MutationObserver(o=>{let s=!1;for(const r of o)s=s||Ka(r.addedNodes,g),s=s&&!Ka(r.removedNodes,g);s&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}function _H(e,t,n){const g=e.canvas,i=new MutationObserver(o=>{let s=!1;for(const r of o)s=s||Ka(r.removedNodes,g),s=s&&!Ka(r.addedNodes,g);s&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}const Al=new Map;let D0=0;function CV(){const e=window.devicePixelRatio;e!==D0&&(D0=e,Al.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function qH(e,t){Al.size||window.addEventListener("resize",CV),Al.set(e,t)}function $H(e){Al.delete(e),Al.size||window.removeEventListener("resize",CV)}function eN(e,t,n){const g=e.canvas,i=g&&Ym(g);if(!i)return;const o=QS((r,l)=>{const I=i.clientWidth;n(r,l),I<i.clientWidth&&n()},window),s=new ResizeObserver(r=>{const l=r[0],I=l.contentRect.width,a=l.contentRect.height;I===0&&a===0||o(I,a)});return s.observe(i),qH(e,o),s}function Mc(e,t,n){n&&n.disconnect(),t==="resize"&&$H(e)}function tN(e,t,n){const g=e.canvas,i=QS(o=>{e.ctx!==null&&n(PH(o,e))},e);return QH(g,t,i),i}class nN extends IV{acquireContext(t,n){const g=t&&t.getContext&&t.getContext("2d");return g&&g.canvas===t?(DH(t,n),g):null}releaseContext(t){const n=t.canvas;if(!n[UI])return!1;const g=n[UI].initial;["height","width"].forEach(o=>{const s=g[o];_e(s)?n.removeAttribute(o):n.setAttribute(o,s)});const i=g.style||{};return Object.keys(i).forEach(o=>{n.style[o]=i[o]}),n.width=n.width,delete n[UI],!0}addEventListener(t,n,g){this.removeEventListener(t,n);const i=t.$proxies||(t.$proxies={}),s={attach:OH,detach:_H,resize:eN}[n]||tN;i[n]=s(t,n,g)}removeEventListener(t,n){const g=t.$proxies||(t.$proxies={}),i=g[n];if(!i)return;({attach:Mc,detach:Mc,resize:Mc}[n]||jH)(t,n,i),g[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,n,g,i){return nH(t,n,g,i)}isAttached(t){const n=t&&Ym(t);return!!(n&&n.isConnected)}}function gN(e){return!Jm()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?UH:nN}var WI;let Ko=(WI=class{constructor(){Se(this,"x");Se(this,"y");Se(this,"active",!1);Se(this,"options");Se(this,"$animations")}tooltipPosition(t){const{x:n,y:g}=this.getProps(["x","y"],t);return{x:n,y:g}}hasValue(){return Ha(this.x)&&Ha(this.y)}getProps(t,n){const g=this.$animations;if(!n||!g)return this;const i={};return t.forEach(o=>{i[o]=g[o]&&g[o].active()?g[o]._to:this[o]}),i}},Se(WI,"defaults",{}),Se(WI,"defaultRoutes"),WI);function iN(e,t){const n=e.options.ticks,g=oN(e),i=Math.min(n.maxTicksLimit||g,g),o=n.major.enabled?rN(t):[],s=o.length,r=o[0],l=o[s-1],I=[];if(s>i)return lN(t,I,o,s/i),I;const a=sN(o,t,i);if(s>0){let C,c;const d=s>1?Math.round((l-r)/(s-1)):null;for(cI(t,I,a,_e(d)?0:r-d,r),C=0,c=s-1;C<c;C++)cI(t,I,a,o[C],o[C+1]);return cI(t,I,a,l,_e(d)?t.length:l+d),I}return cI(t,I,a),I}function oN(e){const t=e.options.offset,n=e._tickSize(),g=e._length/n+(t?0:1),i=e._maxLength/n;return Math.floor(Math.min(g,i))}function sN(e,t,n){const g=IN(e),i=t.length/n;if(!g)return Math.max(i,1);const o=A1(g);for(let s=0,r=o.length-1;s<r;s++){const l=o[s];if(l>i)return l}return Math.max(i,1)}function rN(e){const t=[];let n,g;for(n=0,g=e.length;n<g;n++)e[n].major&&t.push(n);return t}function lN(e,t,n,g){let i=0,o=n[0],s;for(g=Math.ceil(g),s=0;s<e.length;s++)s===o&&(t.push(e[s]),i++,o=n[i*g])}function cI(e,t,n,g,i){const o=Le(g,0),s=Math.min(Le(i,e.length),e.length);let r=0,l,I,a;for(n=Math.ceil(n),i&&(l=i-g,n=l/Math.floor(l/n)),a=o;a<0;)r++,a=Math.round(o+r*n);for(I=Math.max(o,0);I<s;I++)I===a&&(t.push(e[I]),r++,a=Math.round(o+r*n))}function IN(e){const t=e.length;let n,g;if(t<2)return!1;for(g=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==g)return!1;return g}const aN=e=>e==="left"?"right":e==="right"?"left":e,Q0=(e,t,n)=>t==="top"||t==="left"?e[t]+n:e[t]-n,j0=(e,t)=>Math.min(t||e,e);function P0(e,t){const n=[],g=e.length/t,i=e.length;let o=0;for(;o<i;o+=g)n.push(e[Math.floor(o)]);return n}function CN(e,t,n){const g=e.ticks.length,i=Math.min(t,g-1),o=e._startPixel,s=e._endPixel,r=1e-6;let l=e.getPixelForTick(i),I;if(!(n&&(g===1?I=Math.max(l-o,s-l):t===0?I=(e.getPixelForTick(1)-l)/2:I=(l-e.getPixelForTick(i-1))/2,l+=i<t?I:-I,l<o-r||l>s+r)))return l}function cN(e,t){De(e,n=>{const g=n.gc,i=g.length/2;let o;if(i>t){for(o=0;o<i;++o)delete n.data[g[o]];g.splice(0,i)}})}function sr(e){return e.drawTicks?e.tickLength:0}function O0(e,t){if(!e.display)return 0;const n=Rt(e.font,t),g=en(e.padding);return(Ct(e.text)?e.text.length:1)*n.lineHeight+g.height}function dN(e,t){return xo(e,{scale:t,type:"scale"})}function uN(e,t,n){return xo(e,{tick:n,index:t,type:"tick"})}function AN(e,t,n){let g=Vm(e);return(n&&t!=="right"||!n&&t==="right")&&(g=aN(g)),g}function hN(e,t,n,g){const{top:i,left:o,bottom:s,right:r,chart:l}=e,{chartArea:I,scales:a}=l;let C=0,c,d,u;const h=s-i,f=r-o;if(e.isHorizontal()){if(d=jt(g,o,r),Me(n)){const y=Object.keys(n)[0],Z=n[y];u=a[y].getPixelForValue(Z)+h-t}else n==="center"?u=(I.bottom+I.top)/2+h-t:u=Q0(e,n,t);c=r-o}else{if(Me(n)){const y=Object.keys(n)[0],Z=n[y];d=a[y].getPixelForValue(Z)-f+t}else n==="center"?d=(I.left+I.right)/2-f+t:d=Q0(e,n,t);u=jt(g,s,i),C=n==="left"?-Gt:Gt}return{titleX:d,titleY:u,maxWidth:c,rotation:C}}class Eo extends Ko{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,n){return t}getUserBounds(){let{_userMin:t,_userMax:n,_suggestedMin:g,_suggestedMax:i}=this;return t=yn(t,Number.POSITIVE_INFINITY),n=yn(n,Number.NEGATIVE_INFINITY),g=yn(g,Number.POSITIVE_INFINITY),i=yn(i,Number.NEGATIVE_INFINITY),{min:yn(t,g),max:yn(n,i),minDefined:Yt(t),maxDefined:Yt(n)}}getMinMax(t){let{min:n,max:g,minDefined:i,maxDefined:o}=this.getUserBounds(),s;if(i&&o)return{min:n,max:g};const r=this.getMatchingVisibleMetas();for(let l=0,I=r.length;l<I;++l)s=r[l].controller.getMinMax(this,t),i||(n=Math.min(n,s.min)),o||(g=Math.max(g,s.max));return n=o&&n>g?g:n,g=i&&n>g?n:g,{min:yn(n,yn(g,n)),max:yn(g,yn(n,g))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){tt(this.options.beforeUpdate,[this])}update(t,n,g){const{beginAtZero:i,grace:o,ticks:s}=this.options,r=s.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=n,this._margins=g=Object.assign({left:0,right:0,top:0,bottom:0},g),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+g.left+g.right:this.height+g.top+g.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=M1(this,o,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=r<this.ticks.length;this._convertTicksToLabels(l?P0(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||s.source==="auto")&&(this.ticks=iN(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,n,g;this.isHorizontal()?(n=this.left,g=this.right):(n=this.top,g=this.bottom,t=!t),this._startPixel=n,this._endPixel=g,this._reversePixels=t,this._length=g-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){tt(this.options.afterUpdate,[this])}beforeSetDimensions(){tt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){tt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),tt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){tt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const n=this.options.ticks;let g,i,o;for(g=0,i=t.length;g<i;g++)o=t[g],o.label=tt(n.callback,[o.value,g,t],this)}afterTickToLabelConversion(){tt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){tt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,n=t.ticks,g=j0(this.ticks.length,t.ticks.maxTicksLimit),i=n.minRotation||0,o=n.maxRotation;let s=i,r,l,I;if(!this._isVisible()||!n.display||i>=o||g<=1||!this.isHorizontal()){this.labelRotation=i;return}const a=this._getLabelSizes(),C=a.widest.width,c=a.highest.height,d=An(this.chart.width-C,0,this.maxWidth);r=t.offset?this.maxWidth/g:d/(g-1),C+6>r&&(r=d/(g-(t.offset?.5:1)),l=this.maxHeight-sr(t.grid)-n.padding-O0(t.title,this.chart.options.font),I=Math.sqrt(C*C+c*c),s=Bm(Math.min(Math.asin(An((a.highest.height+6)/r,-1,1)),Math.asin(An(l/I,-1,1))-Math.asin(An(c/I,-1,1)))),s=Math.max(i,Math.min(o,s))),this.labelRotation=s}afterCalculateLabelRotation(){tt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){tt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:n,options:{ticks:g,title:i,grid:o}}=this,s=this._isVisible(),r=this.isHorizontal();if(s){const l=O0(i,n.options.font);if(r?(t.width=this.maxWidth,t.height=sr(o)+l):(t.height=this.maxHeight,t.width=sr(o)+l),g.display&&this.ticks.length){const{first:I,last:a,widest:C,highest:c}=this._getLabelSizes(),d=g.padding*2,u=cg(this.labelRotation),h=Math.cos(u),f=Math.sin(u);if(r){const y=g.mirror?0:f*C.width+h*c.height;t.height=Math.min(this.maxHeight,t.height+y+d)}else{const y=g.mirror?0:h*C.width+f*c.height;t.width=Math.min(this.maxWidth,t.width+y+d)}this._calculatePadding(I,a,f,h)}}this._handleMargins(),r?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,n,g,i){const{ticks:{align:o,padding:s},position:r}=this.options,l=this.labelRotation!==0,I=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const a=this.getPixelForTick(0)-this.left,C=this.right-this.getPixelForTick(this.ticks.length-1);let c=0,d=0;l?I?(c=i*t.width,d=g*n.height):(c=g*t.height,d=i*n.width):o==="start"?d=n.width:o==="end"?c=t.width:o!=="inner"&&(c=t.width/2,d=n.width/2),this.paddingLeft=Math.max((c-a+s)*this.width/(this.width-a),0),this.paddingRight=Math.max((d-C+s)*this.width/(this.width-C),0)}else{let a=n.height/2,C=t.height/2;o==="start"?(a=0,C=t.height):o==="end"&&(a=n.height,C=0),this.paddingTop=a+s,this.paddingBottom=C+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){tt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:n}=this.options;return n==="top"||n==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let n,g;for(n=0,g=t.length;n<g;n++)_e(t[n].label)&&(t.splice(n,1),g--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const n=this.options.ticks.sampleSize;let g=this.ticks;n<g.length&&(g=P0(g,n)),this._labelSizes=t=this._computeLabelSizes(g,g.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,n,g){const{ctx:i,_longestTextCache:o}=this,s=[],r=[],l=Math.floor(n/j0(n,g));let I=0,a=0,C,c,d,u,h,f,y,Z,p,B,W;for(C=0;C<n;C+=l){if(u=t[C].label,h=this._resolveTickFontOptions(C),i.font=f=h.string,y=o[f]=o[f]||{data:{},gc:[]},Z=h.lineHeight,p=B=0,!_e(u)&&!Ct(u))p=Fa(i,y.data,y.gc,p,u),B=Z;else if(Ct(u))for(c=0,d=u.length;c<d;++c)W=u[c],!_e(W)&&!Ct(W)&&(p=Fa(i,y.data,y.gc,p,W),B+=Z);s.push(p),r.push(B),I=Math.max(p,I),a=Math.max(B,a)}cN(o,n);const S=s.indexOf(I),V=r.indexOf(a),R=J=>({width:s[J]||0,height:r[J]||0});return{first:R(0),last:R(n-1),widest:R(S),highest:R(V),widths:s,heights:r}}getLabelForValue(t){return t}getPixelForValue(t,n){return NaN}getValueForPixel(t){}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const n=this._startPixel+t*this._length;return b1(this._alignToPixels?Ui(this.chart,n,0):n)}getDecimalForPixel(t){const n=(t-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:n}=this;return t<0&&n<0?n:t>0&&n>0?t:0}getContext(t){const n=this.ticks||[];if(t>=0&&t<n.length){const g=n[t];return g.$context||(g.$context=uN(this.getContext(),t,g))}return this.$context||(this.$context=dN(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,n=cg(this.labelRotation),g=Math.abs(Math.cos(n)),i=Math.abs(Math.sin(n)),o=this._getLabelSizes(),s=t.autoSkipPadding||0,r=o?o.widest.width+s:0,l=o?o.highest.height+s:0;return this.isHorizontal()?l*g>r*i?r/g:l/i:l*i<r*g?l/g:r/i}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const n=this.axis,g=this.chart,i=this.options,{grid:o,position:s,border:r}=i,l=o.offset,I=this.isHorizontal(),C=this.ticks.length+(l?1:0),c=sr(o),d=[],u=r.setContext(this.getContext()),h=u.display?u.width:0,f=h/2,y=function(ie){return Ui(g,ie,h)};let Z,p,B,W,S,V,R,J,M,P,X,L;if(s==="top")Z=y(this.bottom),V=this.bottom-c,J=Z-f,P=y(t.top)+f,L=t.bottom;else if(s==="bottom")Z=y(this.top),P=t.top,L=y(t.bottom)-f,V=Z+f,J=this.top+c;else if(s==="left")Z=y(this.right),S=this.right-c,R=Z-f,M=y(t.left)+f,X=t.right;else if(s==="right")Z=y(this.left),M=t.left,X=y(t.right)-f,S=Z+f,R=this.left+c;else if(n==="x"){if(s==="center")Z=y((t.top+t.bottom)/2+.5);else if(Me(s)){const ie=Object.keys(s)[0],ge=s[ie];Z=y(this.chart.scales[ie].getPixelForValue(ge))}P=t.top,L=t.bottom,V=Z+f,J=V+c}else if(n==="y"){if(s==="center")Z=y((t.left+t.right)/2);else if(Me(s)){const ie=Object.keys(s)[0],ge=s[ie];Z=y(this.chart.scales[ie].getPixelForValue(ge))}S=Z-f,R=S-c,M=t.left,X=t.right}const ne=Le(i.ticks.maxTicksLimit,C),D=Math.max(1,Math.ceil(C/ne));for(p=0;p<C;p+=D){const ie=this.getContext(p),ge=o.setContext(ie),N=r.setContext(ie),te=ge.lineWidth,q=ge.color,me=N.dash||[],v=N.dashOffset,$=ge.tickWidth,Ce=ge.tickColor,Be=ge.tickBorderDash||[],Ie=ge.tickBorderDashOffset;B=CN(this,p,l),B!==void 0&&(W=Ui(g,B,te),I?S=R=M=X=W:V=J=P=L=W,d.push({tx1:S,ty1:V,tx2:R,ty2:J,x1:M,y1:P,x2:X,y2:L,width:te,color:q,borderDash:me,borderDashOffset:v,tickWidth:$,tickColor:Ce,tickBorderDash:Be,tickBorderDashOffset:Ie}))}return this._ticksLength=C,this._borderValue=Z,d}_computeLabelItems(t){const n=this.axis,g=this.options,{position:i,ticks:o}=g,s=this.isHorizontal(),r=this.ticks,{align:l,crossAlign:I,padding:a,mirror:C}=o,c=sr(g.grid),d=c+a,u=C?-a:d,h=-cg(this.labelRotation),f=[];let y,Z,p,B,W,S,V,R,J,M,P,X,L="middle";if(i==="top")S=this.bottom-u,V=this._getXAxisLabelAlignment();else if(i==="bottom")S=this.top+u,V=this._getXAxisLabelAlignment();else if(i==="left"){const D=this._getYAxisLabelAlignment(c);V=D.textAlign,W=D.x}else if(i==="right"){const D=this._getYAxisLabelAlignment(c);V=D.textAlign,W=D.x}else if(n==="x"){if(i==="center")S=(t.top+t.bottom)/2+d;else if(Me(i)){const D=Object.keys(i)[0],ie=i[D];S=this.chart.scales[D].getPixelForValue(ie)+d}V=this._getXAxisLabelAlignment()}else if(n==="y"){if(i==="center")W=(t.left+t.right)/2-d;else if(Me(i)){const D=Object.keys(i)[0],ie=i[D];W=this.chart.scales[D].getPixelForValue(ie)}V=this._getYAxisLabelAlignment(c).textAlign}n==="y"&&(l==="start"?L="top":l==="end"&&(L="bottom"));const ne=this._getLabelSizes();for(y=0,Z=r.length;y<Z;++y){p=r[y],B=p.label;const D=o.setContext(this.getContext(y));R=this.getPixelForTick(y)+o.labelOffset,J=this._resolveTickFontOptions(y),M=J.lineHeight,P=Ct(B)?B.length:1;const ie=P/2,ge=D.color,N=D.textStrokeColor,te=D.textStrokeWidth;let q=V;s?(W=R,V==="inner"&&(y===Z-1?q=this.options.reverse?"left":"right":y===0?q=this.options.reverse?"right":"left":q="center"),i==="top"?I==="near"||h!==0?X=-P*M+M/2:I==="center"?X=-ne.highest.height/2-ie*M+M:X=-ne.highest.height+M/2:I==="near"||h!==0?X=M/2:I==="center"?X=ne.highest.height/2-ie*M:X=ne.highest.height-P*M,C&&(X*=-1),h!==0&&!D.showLabelBackdrop&&(W+=M/2*Math.sin(h))):(S=R,X=(1-P)*M/2);let me;if(D.showLabelBackdrop){const v=en(D.backdropPadding),$=ne.heights[y],Ce=ne.widths[y];let Be=X-v.top,Ie=0-v.left;switch(L){case"middle":Be-=$/2;break;case"bottom":Be-=$;break}switch(V){case"center":Ie-=Ce/2;break;case"right":Ie-=Ce;break;case"inner":y===Z-1?Ie-=Ce:y>0&&(Ie-=Ce/2);break}me={left:Ie,top:Be,width:Ce+v.width,height:$+v.height,color:D.backdropColor}}f.push({label:B,font:J,textOffset:X,options:{rotation:h,color:ge,strokeColor:N,strokeWidth:te,textAlign:q,textBaseline:L,translation:[W,S],backdrop:me}})}return f}_getXAxisLabelAlignment(){const{position:t,ticks:n}=this.options;if(-cg(this.labelRotation))return t==="top"?"left":"right";let i="center";return n.align==="start"?i="left":n.align==="end"?i="right":n.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:n,ticks:{crossAlign:g,mirror:i,padding:o}}=this.options,s=this._getLabelSizes(),r=t+o,l=s.widest.width;let I,a;return n==="left"?i?(a=this.right+o,g==="near"?I="left":g==="center"?(I="center",a+=l/2):(I="right",a+=l)):(a=this.right-r,g==="near"?I="right":g==="center"?(I="center",a-=l/2):(I="left",a=this.left)):n==="right"?i?(a=this.left+o,g==="near"?I="right":g==="center"?(I="center",a-=l/2):(I="left",a-=l)):(a=this.left+r,g==="near"?I="left":g==="center"?(I="center",a+=l/2):(I="right",a=this.right)):I="right",{textAlign:I,x:a}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:n},left:g,top:i,width:o,height:s}=this;n&&(t.save(),t.fillStyle=n,t.fillRect(g,i,o,s),t.restore())}getLineWidthForValue(t){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const i=this.ticks.findIndex(o=>o.value===t);return i>=0?n.setContext(this.getContext(i)).lineWidth:0}drawGrid(t){const n=this.options.grid,g=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let o,s;const r=(l,I,a)=>{!a.width||!a.color||(g.save(),g.lineWidth=a.width,g.strokeStyle=a.color,g.setLineDash(a.borderDash||[]),g.lineDashOffset=a.borderDashOffset,g.beginPath(),g.moveTo(l.x,l.y),g.lineTo(I.x,I.y),g.stroke(),g.restore())};if(n.display)for(o=0,s=i.length;o<s;++o){const l=i[o];n.drawOnChartArea&&r({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&r({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:n,options:{border:g,grid:i}}=this,o=g.setContext(this.getContext()),s=g.display?o.width:0;if(!s)return;const r=i.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let I,a,C,c;this.isHorizontal()?(I=Ui(t,this.left,s)-s/2,a=Ui(t,this.right,r)+r/2,C=c=l):(C=Ui(t,this.top,s)-s/2,c=Ui(t,this.bottom,r)+r/2,I=a=l),n.save(),n.lineWidth=o.width,n.strokeStyle=o.color,n.beginPath(),n.moveTo(I,C),n.lineTo(a,c),n.stroke(),n.restore()}drawLabels(t){if(!this.options.ticks.display)return;const g=this.ctx,i=this._computeLabelArea();i&&Wm(g,i);const o=this.getLabelItems(t);for(const s of o){const r=s.options,l=s.font,I=s.label,a=s.textOffset;Jo(g,I,0,a,l,r)}i&&Rm(g)}drawTitle(){const{ctx:t,options:{position:n,title:g,reverse:i}}=this;if(!g.display)return;const o=Rt(g.font),s=en(g.padding),r=g.align;let l=o.lineHeight/2;n==="bottom"||n==="center"||Me(n)?(l+=s.bottom,Ct(g.text)&&(l+=o.lineHeight*(g.text.length-1))):l+=s.top;const{titleX:I,titleY:a,maxWidth:C,rotation:c}=hN(this,l,n,r);Jo(t,g.text,0,0,o,{color:g.color,maxWidth:C,rotation:c,textAlign:AN(r,n,i),textBaseline:"middle",translation:[I,a]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,n=t.ticks&&t.ticks.z||0,g=Le(t.grid&&t.grid.z,-1),i=Le(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Eo.prototype.draw?[{z:n,draw:o=>{this.draw(o)}}]:[{z:g,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:n,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(t){const n=this.chart.getSortedVisibleDatasetMetas(),g=this.axis+"AxisID",i=[];let o,s;for(o=0,s=n.length;o<s;++o){const r=n[o];r[g]===this.id&&(!t||r.type===t)&&i.push(r)}return i}_resolveTickFontOptions(t){const n=this.options.ticks.setContext(this.getContext(t));return Rt(n.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class dI{constructor(t,n,g){this.type=t,this.scope=n,this.override=g,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const n=Object.getPrototypeOf(t);let g;pN(n)&&(g=this.register(n));const i=this.items,o=t.id,s=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+t);return o in i||(i[o]=t,mN(t,s,g),this.override&&bt.override(t.id,t.overrides)),s}get(t){return this.items[t]}unregister(t){const n=this.items,g=t.id,i=this.scope;g in n&&delete n[g],i&&g in bt[i]&&(delete bt[i][g],this.override&&delete wo[g])}}function mN(e,t,n){const g=cl(Object.create(null),[n?bt.get(n):{},bt.get(t),e.defaults]);bt.set(t,g),e.defaultRoutes&&bN(t,e.defaultRoutes),e.descriptors&&bt.describe(t,e.descriptors)}function bN(e,t){Object.keys(t).forEach(n=>{const g=n.split("."),i=g.pop(),o=[e].concat(g).join("."),s=t[n].split("."),r=s.pop(),l=s.join(".");bt.route(o,i,l,r)})}function pN(e){return"id"in e&&"defaults"in e}class fN{constructor(){this.controllers=new dI(Bs,"datasets",!0),this.elements=new dI(Ko,"elements"),this.plugins=new dI(Object,"plugins"),this.scales=new dI(Eo,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,n,g){[...n].forEach(i=>{const o=g||this._getRegistryForType(i);g||o.isForType(i)||o===this.plugins&&i.id?this._exec(t,o,i):De(i,s=>{const r=g||this._getRegistryForType(s);this._exec(t,r,s)})})}_exec(t,n,g){const i=Gm(t);tt(g["before"+i],[],g),n[t](g),tt(g["after"+i],[],g)}_getRegistryForType(t){for(let n=0;n<this._typedRegistries.length;n++){const g=this._typedRegistries[n];if(g.isForType(t))return g}return this.plugins}_get(t,n,g){const i=n.get(t);if(i===void 0)throw new Error('"'+t+'" is not a registered '+g+".");return i}}var Ig=new fN;class ZN{constructor(){this._init=[]}notify(t,n,g,i){n==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const o=i?this._descriptors(t).filter(i):this._descriptors(t),s=this._notify(o,t,n,g);return n==="afterDestroy"&&(this._notify(o,t,"stop"),this._notify(this._init,t,"uninstall")),s}_notify(t,n,g,i){i=i||{};for(const o of t){const s=o.plugin,r=s[g],l=[n,i,o.options];if(tt(r,l,s)===!1&&i.cancelable)return!1}return!0}invalidate(){_e(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),n}_createDescriptors(t,n){const g=t&&t.config,i=Le(g.options&&g.options.plugins,{}),o=yN(g);return i===!1&&!n?[]:BN(t,o,i,n)}_notifyStateChanges(t){const n=this._oldCache||[],g=this._cache,i=(o,s)=>o.filter(r=>!s.some(l=>r.plugin.id===l.plugin.id));this._notify(i(n,g),t,"stop"),this._notify(i(g,n),t,"start")}}function yN(e){const t={},n=[],g=Object.keys(Ig.plugins.items);for(let o=0;o<g.length;o++)n.push(Ig.getPlugin(g[o]));const i=e.plugins||[];for(let o=0;o<i.length;o++){const s=i[o];n.indexOf(s)===-1&&(n.push(s),t[s.id]=!0)}return{plugins:n,localIds:t}}function GN(e,t){return!t&&e===!1?null:e===!0?{}:e}function BN(e,{plugins:t,localIds:n},g,i){const o=[],s=e.getContext();for(const r of t){const l=r.id,I=GN(g[l],i);I!==null&&o.push({plugin:r,options:SN(e.config,{plugin:r,local:n[l]},I,s)})}return o}function SN(e,{plugin:t,local:n},g,i){const o=e.pluginScopeKeys(t),s=e.getOptionScopes(g,o);return n&&t.defaults&&s.push(t.defaults),e.createResolver(s,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Su(e,t){const n=bt.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function VN(e,t){let n=e;return e==="_index_"?n=t:e==="_value_"&&(n=t==="x"?"y":"x"),n}function WN(e,t){return e===t?"_index_":"_value_"}function _0(e){if(e==="x"||e==="y"||e==="r")return e}function RN(e){if(e==="top"||e==="bottom")return"x";if(e==="left"||e==="right")return"y"}function Vu(e,...t){if(_0(e))return e;for(const n of t){const g=n.axis||RN(n.position)||e.length>1&&_0(e[0].toLowerCase());if(g)return g}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function q0(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function vN(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(g=>g.xAxisID===e||g.yAxisID===e);if(n.length)return q0(e,"x",n[0])||q0(e,"y",n[0])}return{}}function kN(e,t){const n=wo[e.type]||{scales:{}},g=t.scales||{},i=Su(e.type,t),o=Object.create(null);return Object.keys(g).forEach(s=>{const r=g[s];if(!Me(r))return console.error(`Invalid scale configuration for scale: ${s}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${s}`);const l=Vu(s,r,vN(s,e),bt.scales[r.type]),I=WN(l,i),a=n.scales||{};o[s]=Hr(Object.create(null),[{axis:l},r,a[l],a[I]])}),e.data.datasets.forEach(s=>{const r=s.type||e.type,l=s.indexAxis||Su(r,t),a=(wo[r]||{}).scales||{};Object.keys(a).forEach(C=>{const c=VN(C,l),d=s[c+"AxisID"]||c;o[d]=o[d]||Object.create(null),Hr(o[d],[{axis:c},g[d],a[C]])})}),Object.keys(o).forEach(s=>{const r=o[s];Hr(r,[bt.scales[r.type],bt.scale])}),o}function cV(e){const t=e.options||(e.options={});t.plugins=Le(t.plugins,{}),t.scales=kN(e,t)}function dV(e){return e=e||{},e.datasets=e.datasets||[],e.labels=e.labels||[],e}function XN(e){return e=e||{},e.data=dV(e.data),cV(e),e}const $0=new Map,uV=new Set;function uI(e,t){let n=$0.get(e);return n||(n=t(),$0.set(e,n),uV.add(n)),n}const rr=(e,t,n)=>{const g=Xo(t,n);g!==void 0&&e.add(g)};class wN{constructor(t){this._config=XN(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=dV(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),cV(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return uI(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,n){return uI(`${t}.transition.${n}`,()=>[[`datasets.${t}.transitions.${n}`,`transitions.${n}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,n){return uI(`${t}-${n}`,()=>[[`datasets.${t}.elements.${n}`,`datasets.${t}`,`elements.${n}`,""]])}pluginScopeKeys(t){const n=t.id,g=this.type;return uI(`${g}-plugin-${n}`,()=>[[`plugins.${n}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,n){const g=this._scopeCache;let i=g.get(t);return(!i||n)&&(i=new Map,g.set(t,i)),i}getOptionScopes(t,n,g){const{options:i,type:o}=this,s=this._cachedScopes(t,g),r=s.get(n);if(r)return r;const l=new Set;n.forEach(a=>{t&&(l.add(t),a.forEach(C=>rr(l,t,C))),a.forEach(C=>rr(l,i,C)),a.forEach(C=>rr(l,wo[o]||{},C)),a.forEach(C=>rr(l,bt,C)),a.forEach(C=>rr(l,Gu,C))});const I=Array.from(l);return I.length===0&&I.push(Object.create(null)),uV.has(n)&&s.set(n,I),I}chartOptionScopes(){const{options:t,type:n}=this;return[t,wo[n]||{},bt.datasets[n]||{},{type:n},bt,Gu]}resolveNamedOptions(t,n,g,i=[""]){const o={$shared:!0},{resolver:s,subPrefixes:r}=ef(this._resolverCache,t,i);let l=s;if(YN(s,n)){o.$shared=!1,g=Yi(g)?g():g;const I=this.createResolver(t,g,r);l=Js(s,g,I)}for(const I of n)o[I]=l[I];return o}createResolver(t,n,g=[""],i){const{resolver:o}=ef(this._resolverCache,t,g);return Me(n)?Js(o,n,void 0,i):o}}function ef(e,t,n){let g=e.get(t);g||(g=new Map,e.set(t,g));const i=n.join();let o=g.get(i);return o||(o={resolver:km(t,n),subPrefixes:n.filter(r=>!r.toLowerCase().includes("hover"))},g.set(i,o)),o}const JN=e=>Me(e)&&Object.getOwnPropertyNames(e).some(t=>Yi(e[t]));function YN(e,t){const{isScriptable:n,isIndexable:g}=qS(e);for(const i of t){const o=n(i),s=g(i),r=(s||o)&&e[i];if(o&&(Yi(r)||JN(r))||s&&Ct(r))return!0}return!1}var HN="4.4.3";const NN=["top","bottom","left","right","chartArea"];function tf(e,t){return e==="top"||e==="bottom"||NN.indexOf(e)===-1&&t==="x"}function nf(e,t){return function(n,g){return n[e]===g[e]?n[t]-g[t]:n[e]-g[e]}}function gf(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),tt(n&&n.onComplete,[e],t)}function FN(e){const t=e.chart,n=t.options.animation;tt(n&&n.onProgress,[e],t)}function AV(e){return Jm()&&typeof e=="string"?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const zI={},of=e=>{const t=AV(e);return Object.values(zI).filter(n=>n.canvas===t).pop()};function xN(e,t,n){const g=Object.keys(e);for(const i of g){const o=+i;if(o>=t){const s=e[i];delete e[i],(n>0||o>t)&&(e[o+n]=s)}}}function KN(e,t,n,g){return!n||e.type==="mouseout"?null:g?t:e}function AI(e,t,n){return e.options.clip?e[n]:t[n]}function EN(e,t){const{xScale:n,yScale:g}=e;return n&&g?{left:AI(n,t,"left"),right:AI(n,t,"right"),top:AI(g,t,"top"),bottom:AI(g,t,"bottom")}:t}var ni;let kC=(ni=class{static register(...t){Ig.add(...t),sf()}static unregister(...t){Ig.remove(...t),sf()}constructor(t,n){const g=this.config=new wN(n),i=AV(t),o=of(i);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const s=g.createResolver(g.chartOptionScopes(),this.getContext());this.platform=new(g.platform||gN(i)),this.platform.updateConfig(g);const r=this.platform.acquireContext(i,s.aspectRatio),l=r&&r.canvas,I=l&&l.height,a=l&&l.width;if(this.id=r1(),this.ctx=r,this.canvas=l,this.width=a,this.height=I,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new ZN,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=y1(C=>this.update(C),s.resizeDelay||0),this._dataChanges=[],zI[this.id]=this,!r||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Zg.listen(this,"complete",gf),Zg.listen(this,"progress",FN),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:n},width:g,height:i,_aspectRatio:o}=this;return _e(t)?n&&o?o:i?g/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Ig}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():v0(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return S0(this.canvas,this.ctx),this}stop(){return Zg.stop(this),this}resize(t,n){Zg.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){const g=this.options,i=this.canvas,o=g.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(i,t,n,o),r=g.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,v0(this,r,!0)&&(this.notifyPlugins("resize",{size:s}),tt(g.onResize,[this,s],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};De(n,(g,i)=>{g.id=i})}buildOrUpdateScales(){const t=this.options,n=t.scales,g=this.scales,i=Object.keys(g).reduce((s,r)=>(s[r]=!1,s),{});let o=[];n&&(o=o.concat(Object.keys(n).map(s=>{const r=n[s],l=Vu(s,r),I=l==="r",a=l==="x";return{options:r,dposition:I?"chartArea":a?"bottom":"left",dtype:I?"radialLinear":a?"category":"linear"}}))),De(o,s=>{const r=s.options,l=r.id,I=Vu(l,r),a=Le(r.type,s.dtype);(r.position===void 0||tf(r.position,I)!==tf(s.dposition))&&(r.position=s.dposition),i[l]=!0;let C=null;if(l in g&&g[l].type===a)C=g[l];else{const c=Ig.getScale(a);C=new c({id:l,type:a,ctx:this.ctx,chart:this}),g[C.id]=C}C.init(r,t)}),De(i,(s,r)=>{s||delete g[r]}),De(g,s=>{En.configure(this,s,s.options),En.addBox(this,s)})}_updateMetasets(){const t=this._metasets,n=this.data.datasets.length,g=t.length;if(t.sort((i,o)=>i.index-o.index),g>n){for(let i=n;i<g;++i)this._destroyDatasetMeta(i);t.splice(n,g-n)}this._sortedMetasets=t.slice(0).sort(nf("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((g,i)=>{n.filter(o=>o===g._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const t=[],n=this.data.datasets;let g,i;for(this._removeUnreferencedMetasets(),g=0,i=n.length;g<i;g++){const o=n[g];let s=this.getDatasetMeta(g);const r=o.type||this.config.type;if(s.type&&s.type!==r&&(this._destroyDatasetMeta(g),s=this.getDatasetMeta(g)),s.type=r,s.indexAxis=o.indexAxis||Su(r,this.options),s.order=o.order||0,s.index=g,s.label=""+o.label,s.visible=this.isDatasetVisible(g),s.controller)s.controller.updateIndex(g),s.controller.linkScales();else{const l=Ig.getController(r),{datasetElementType:I,dataElementType:a}=bt.datasets[r];Object.assign(l,{dataElementType:Ig.getElement(a),datasetElementType:I&&Ig.getElement(I)}),s.controller=new l(this,g),t.push(s.controller)}}return this._updateMetasets(),t}_resetElements(){De(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const n=this.config;n.update();const g=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!g.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let I=0,a=this.data.datasets.length;I<a;I++){const{controller:C}=this.getDatasetMeta(I),c=!i&&o.indexOf(C)===-1;C.buildOrUpdateElements(c),s=Math.max(+C.getMaxOverflow(),s)}s=this._minPadding=g.layout.autoPadding?s:0,this._updateLayout(s),i||De(o,I=>{I.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(nf("z","_idx"));const{_active:r,_lastEvent:l}=this;l?this._eventHandler(l,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){De(this.scales,t=>{En.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,n=new Set(Object.keys(this._listeners)),g=new Set(t.events);(!h0(n,g)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(const{method:g,start:i,count:o}of n){const s=g==="_removeElements"?-o:o;xN(t,i,s)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const n=this.data.datasets.length,g=o=>new Set(t.filter(s=>s[0]===o).map((s,r)=>r+","+s.splice(1).join(","))),i=g(0);for(let o=1;o<n;o++)if(!h0(i,g(o)))return;return Array.from(i).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;En.update(this,this.width,this.height,t);const n=this.chartArea,g=n.width<=0||n.height<=0;this._layers=[],De(this.boxes,i=>{g&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,o)=>{i._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,g=this.data.datasets.length;n<g;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,g=this.data.datasets.length;n<g;++n)this._updateDataset(n,Yi(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){const g=this.getDatasetMeta(t),i={meta:g,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(g.controller._update(n),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Zg.has(this)?this.attached&&!Zg.running(this)&&Zg.start(this):(this.draw(),gf({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:g,height:i}=this._resizeBeforeDraw;this._resize(g,i),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const n=this._sortedMetasets,g=[];let i,o;for(i=0,o=n.length;i<o;++i){const s=n[i];(!t||s.visible)&&g.push(s)}return g}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const n=this.ctx,g=t._clip,i=!g.disabled,o=EN(t,this.chartArea),s={meta:t,index:t.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(i&&Wm(n,{left:g.left===!1?0:o.left-g.left,right:g.right===!1?this.width:o.right+g.right,top:g.top===!1?0:o.top-g.top,bottom:g.bottom===!1?this.height:o.bottom+g.bottom}),t.controller.draw(),i&&Rm(n),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return as(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,g,i){const o=NH.modes[n];return typeof o=="function"?o(this,t,g,i):[]}getDatasetMeta(t){const n=this.data.datasets[t],g=this._metasets;let i=g.filter(o=>o&&o._dataset===n).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},g.push(i)),i}getContext(){return this.$context||(this.$context=xo(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const n=this.data.datasets[t];if(!n)return!1;const g=this.getDatasetMeta(t);return typeof g.hidden=="boolean"?!g.hidden:!n.hidden}setDatasetVisibility(t,n){const g=this.getDatasetMeta(t);g.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,g){const i=g?"show":"hide",o=this.getDatasetMeta(t),s=o.controller._resolveAnimations(void 0,i);dl(n)?(o.data[n].hidden=!g,this.update()):(this.setDatasetVisibility(t,g),s.update(o,{visible:g}),this.update(r=>r.datasetIndex===t?i:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){const n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),Zg.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),S0(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete zI[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,n=this.platform,g=(o,s)=>{n.addEventListener(this,o,s),t[o]=s},i=(o,s,r)=>{o.offsetX=s,o.offsetY=r,this._eventHandler(o)};De(this.options.events,o=>g(o,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,n=this.platform,g=(l,I)=>{n.addEventListener(this,l,I),t[l]=I},i=(l,I)=>{t[l]&&(n.removeEventListener(this,l,I),delete t[l])},o=(l,I)=>{this.canvas&&this.resize(l,I)};let s;const r=()=>{i("attach",r),this.attached=!0,this.resize(),g("resize",o),g("detach",s)};s=()=>{this.attached=!1,i("resize",o),this._stop(),this._resize(0,0),g("attach",r)},n.isAttached(this.canvas)?r():s()}unbindEvents(){De(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},De(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,g){const i=g?"set":"remove";let o,s,r,l;for(n==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+i+"DatasetHoverStyle"]()),r=0,l=t.length;r<l;++r){s=t[r];const I=s&&this.getDatasetMeta(s.datasetIndex).controller;I&&I[i+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const n=this._active||[],g=t.map(({datasetIndex:o,index:s})=>{const r=this.getDatasetMeta(o);if(!r)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:r.data[s],index:s}});!wa(g,n)&&(this._active=g,this._lastEvent=null,this._updateHoverStyles(g,n))}notifyPlugins(t,n,g){return this._plugins.notify(this,t,n,g)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,g){const i=this.options.hover,o=(l,I)=>l.filter(a=>!I.some(C=>a.datasetIndex===C.datasetIndex&&a.index===C.index)),s=o(n,t),r=g?t:o(t,n);s.length&&this.updateHoverStyle(s,i.mode,!1),r.length&&i.mode&&this.updateHoverStyle(r,i.mode,!0)}_eventHandler(t,n){const g={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},i=s=>(s.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",g,i)===!1)return;const o=this._handleEvent(t,n,g.inChartArea);return g.cancelable=!1,this.notifyPlugins("afterEvent",g,i),(o||g.changed)&&this.render(),this}_handleEvent(t,n,g){const{_active:i=[],options:o}=this,s=n,r=this._getActiveElements(t,i,g,s),l=d1(t),I=KN(t,this._lastEvent,g,l);g&&(this._lastEvent=null,tt(o.onHover,[t,r,this],this),l&&tt(o.onClick,[t,r,this],this));const a=!wa(r,i);return(a||n)&&(this._active=r,this._updateHoverStyles(r,i,n)),this._lastEvent=I,a}_getActiveElements(t,n,g,i){if(t.type==="mouseout")return[];if(!g)return n;const o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,i)}},Se(ni,"defaults",bt),Se(ni,"instances",zI),Se(ni,"overrides",wo),Se(ni,"registry",Ig),Se(ni,"version",HN),Se(ni,"getChart",of),ni);function sf(){return De(kC.instances,e=>e._plugins.invalidate())}function MN(e,t,n){const{startAngle:g,pixelMargin:i,x:o,y:s,outerRadius:r,innerRadius:l}=t;let I=i/r;e.beginPath(),e.arc(o,s,r,g-I,n+I),l>i?(I=i/l,e.arc(o,s,l,n+I,g-I,!0)):e.arc(o,s,i,n+Gt,g-Gt),e.closePath(),e.clip()}function TN(e){return vm(e,["outerStart","outerEnd","innerStart","innerEnd"])}function LN(e,t,n,g){const i=TN(e.options.borderRadius),o=(n-t)/2,s=Math.min(o,g*t/2),r=l=>{const I=(n-Math.min(o,l))*g/2;return An(l,0,Math.min(o,I))};return{outerStart:r(i.outerStart),outerEnd:r(i.outerEnd),innerStart:An(i.innerStart,0,s),innerEnd:An(i.innerEnd,0,s)}}function jo(e,t,n,g){return{x:n+e*Math.cos(t),y:g+e*Math.sin(t)}}function Ea(e,t,n,g,i,o){const{x:s,y:r,startAngle:l,pixelMargin:I,innerRadius:a}=t,C=Math.max(t.outerRadius+g+n-I,0),c=a>0?a+g+n+I:0;let d=0;const u=i-l;if(g){const D=a>0?a-g:0,ie=C>0?C-g:0,ge=(D+ie)/2,N=ge!==0?u*ge/(ge+g):u;d=(u-N)/2}const h=Math.max(.001,u*C-n/pt)/C,f=(u-h)/2,y=l+f+d,Z=i-f-d,{outerStart:p,outerEnd:B,innerStart:W,innerEnd:S}=LN(t,c,C,Z-y),V=C-p,R=C-B,J=y+p/V,M=Z-B/R,P=c+W,X=c+S,L=y+W/P,ne=Z-S/X;if(e.beginPath(),o){const D=(J+M)/2;if(e.arc(s,r,C,J,D),e.arc(s,r,C,D,M),B>0){const te=jo(R,M,s,r);e.arc(te.x,te.y,B,M,Z+Gt)}const ie=jo(X,Z,s,r);if(e.lineTo(ie.x,ie.y),S>0){const te=jo(X,ne,s,r);e.arc(te.x,te.y,S,Z+Gt,ne+Math.PI)}const ge=(Z-S/c+(y+W/c))/2;if(e.arc(s,r,c,Z-S/c,ge,!0),e.arc(s,r,c,ge,y+W/c,!0),W>0){const te=jo(P,L,s,r);e.arc(te.x,te.y,W,L+Math.PI,y-Gt)}const N=jo(V,y,s,r);if(e.lineTo(N.x,N.y),p>0){const te=jo(V,J,s,r);e.arc(te.x,te.y,p,y-Gt,J)}}else{e.moveTo(s,r);const D=Math.cos(J)*C+s,ie=Math.sin(J)*C+r;e.lineTo(D,ie);const ge=Math.cos(M)*C+s,N=Math.sin(M)*C+r;e.lineTo(ge,N)}e.closePath()}function UN(e,t,n,g,i){const{fullCircles:o,startAngle:s,circumference:r}=t;let l=t.endAngle;if(o){Ea(e,t,n,g,l,i);for(let I=0;I<o;++I)e.fill();isNaN(r)||(l=s+(r%mt||mt))}return Ea(e,t,n,g,l,i),e.fill(),l}function zN(e,t,n,g,i){const{fullCircles:o,startAngle:s,circumference:r,options:l}=t,{borderWidth:I,borderJoinStyle:a,borderDash:C,borderDashOffset:c}=l,d=l.borderAlign==="inner";if(!I)return;e.setLineDash(C||[]),e.lineDashOffset=c,d?(e.lineWidth=I*2,e.lineJoin=a||"round"):(e.lineWidth=I,e.lineJoin=a||"bevel");let u=t.endAngle;if(o){Ea(e,t,n,g,u,i);for(let h=0;h<o;++h)e.stroke();isNaN(r)||(u=s+(r%mt||mt))}d&&MN(e,t,u),o||(Ea(e,t,n,g,u,i),e.stroke())}class fr extends Ko{constructor(n){super();Se(this,"circumference");Se(this,"endAngle");Se(this,"fullCircles");Se(this,"innerRadius");Se(this,"outerRadius");Se(this,"pixelMargin");Se(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,g,i){const o=this.getProps(["x","y"],i),{angle:s,distance:r}=LS(o,{x:n,y:g}),{startAngle:l,endAngle:I,innerRadius:a,outerRadius:C,circumference:c}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),d=(this.options.spacing+this.options.borderWidth)/2,h=Le(c,I-l)>=mt||Na(s,l,I),f=ao(r,a+d,C+d);return h&&f}getCenterPoint(n){const{x:g,y:i,startAngle:o,endAngle:s,innerRadius:r,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:I,spacing:a}=this.options,C=(o+s)/2,c=(r+l+a+I)/2;return{x:g+Math.cos(C)*c,y:i+Math.sin(C)*c}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:g,circumference:i}=this,o=(g.offset||0)/4,s=(g.spacing||0)/2,r=g.circular;if(this.pixelMargin=g.borderAlign==="inner"?.33:0,this.fullCircles=i>mt?Math.floor(i/mt):0,i===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const l=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(l)*o,Math.sin(l)*o);const I=1-Math.sin(Math.min(pt,i||0)),a=o*I;n.fillStyle=g.backgroundColor,n.strokeStyle=g.borderColor,UN(n,this,a,s,r),zN(n,this,a,s,r),n.restore()}}Se(fr,"id","arc"),Se(fr,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),Se(fr,"defaultRoutes",{backgroundColor:"backgroundColor"}),Se(fr,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function hV(e,t){const{x:n,y:g,base:i,width:o,height:s}=e.getProps(["x","y","base","width","height"],t);let r,l,I,a,C;return e.horizontal?(C=s/2,r=Math.min(n,i),l=Math.max(n,i),I=g-C,a=g+C):(C=o/2,r=n-C,l=n+C,I=Math.min(g,i),a=Math.max(g,i)),{left:r,top:I,right:l,bottom:a}}function bi(e,t,n,g){return e?0:An(t,n,g)}function DN(e,t,n){const g=e.options.borderWidth,i=e.borderSkipped,o=_S(g);return{t:bi(i.top,o.top,0,n),r:bi(i.right,o.right,0,t),b:bi(i.bottom,o.bottom,0,n),l:bi(i.left,o.left,0,t)}}function QN(e,t,n){const{enableBorderRadius:g}=e.getProps(["enableBorderRadius"]),i=e.options.borderRadius,o=po(i),s=Math.min(t,n),r=e.borderSkipped,l=g||Me(i);return{topLeft:bi(!l||r.top||r.left,o.topLeft,0,s),topRight:bi(!l||r.top||r.right,o.topRight,0,s),bottomLeft:bi(!l||r.bottom||r.left,o.bottomLeft,0,s),bottomRight:bi(!l||r.bottom||r.right,o.bottomRight,0,s)}}function jN(e){const t=hV(e),n=t.right-t.left,g=t.bottom-t.top,i=DN(e,n/2,g/2),o=QN(e,n/2,g/2);return{outer:{x:t.left,y:t.top,w:n,h:g,radius:o},inner:{x:t.left+i.l,y:t.top+i.t,w:n-i.l-i.r,h:g-i.t-i.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,o.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(i.b,i.r))}}}}function Tc(e,t,n,g){const i=t===null,o=n===null,r=e&&!(i&&o)&&hV(e,g);return r&&(i||ao(t,r.left,r.right))&&(o||ao(n,r.top,r.bottom))}function PN(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}function ON(e,t){e.rect(t.x,t.y,t.w,t.h)}function Lc(e,t,n={}){const g=e.x!==n.x?-t:0,i=e.y!==n.y?-t:0,o=(e.x+e.w!==n.x+n.w?t:0)-g,s=(e.y+e.h!==n.y+n.h?t:0)-i;return{x:e.x+g,y:e.y+i,w:e.w+o,h:e.h+s,radius:e.radius}}class DI extends Ko{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:n,options:{borderColor:g,backgroundColor:i}}=this,{inner:o,outer:s}=jN(this),r=PN(s.radius)?ul:ON;t.save(),(s.w!==o.w||s.h!==o.h)&&(t.beginPath(),r(t,Lc(s,n,o)),t.clip(),r(t,Lc(o,-n,s)),t.fillStyle=g,t.fill("evenodd")),t.beginPath(),r(t,Lc(o,n)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,n,g){return Tc(this,t,n,g)}inXRange(t,n){return Tc(this,t,null,n)}inYRange(t,n){return Tc(this,null,t,n)}getCenterPoint(t){const{x:n,y:g,base:i,horizontal:o}=this.getProps(["x","y","base","horizontal"],t);return{x:o?(n+i)/2:n,y:o?g:(g+i)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}Se(DI,"id","bar"),Se(DI,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Se(DI,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const rf=(e,t)=>{let{boxHeight:n=t,boxWidth:g=t}=e;return e.usePointStyle&&(n=Math.min(n,t),g=e.pointStyleWidth||Math.min(g,t)),{boxWidth:g,boxHeight:n,itemHeight:Math.max(t,n)}},_N=(e,t)=>e!==null&&t!==null&&e.datasetIndex===t.datasetIndex&&e.index===t.index;class lf extends Ko{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n,g){this.maxWidth=t,this.maxHeight=n,this._margins=g,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let n=tt(t.generateLabels,[this.chart],this)||[];t.filter&&(n=n.filter(g=>t.filter(g,this.chart.data))),t.sort&&(n=n.sort((g,i)=>t.sort(g,i,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:t,ctx:n}=this;if(!t.display){this.width=this.height=0;return}const g=t.labels,i=Rt(g.font),o=i.size,s=this._computeTitleHeight(),{boxWidth:r,itemHeight:l}=rf(g,o);let I,a;n.font=i.string,this.isHorizontal()?(I=this.maxWidth,a=this._fitRows(s,o,r,l)+10):(a=this.maxHeight,I=this._fitCols(s,i,r,l)+10),this.width=Math.min(I,t.maxWidth||this.maxWidth),this.height=Math.min(a,t.maxHeight||this.maxHeight)}_fitRows(t,n,g,i){const{ctx:o,maxWidth:s,options:{labels:{padding:r}}}=this,l=this.legendHitBoxes=[],I=this.lineWidths=[0],a=i+r;let C=t;o.textAlign="left",o.textBaseline="middle";let c=-1,d=-a;return this.legendItems.forEach((u,h)=>{const f=g+n/2+o.measureText(u.text).width;(h===0||I[I.length-1]+f+2*r>s)&&(C+=a,I[I.length-(h>0?0:1)]=0,d+=a,c++),l[h]={left:0,top:d,row:c,width:f,height:i},I[I.length-1]+=f+r}),C}_fitCols(t,n,g,i){const{ctx:o,maxHeight:s,options:{labels:{padding:r}}}=this,l=this.legendHitBoxes=[],I=this.columnSizes=[],a=s-t;let C=r,c=0,d=0,u=0,h=0;return this.legendItems.forEach((f,y)=>{const{itemWidth:Z,itemHeight:p}=qN(g,n,o,f,i);y>0&&d+p+2*r>a&&(C+=c+r,I.push({width:c,height:d}),u+=c+r,h++,c=d=0),l[y]={left:u,top:d,col:h,width:Z,height:p},c=Math.max(c,Z),d+=p+r}),C+=c,I.push({width:c,height:d}),C}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:g,labels:{padding:i},rtl:o}}=this,s=Gs(o,this.left,this.width);if(this.isHorizontal()){let r=0,l=jt(g,this.left+i,this.right-this.lineWidths[r]);for(const I of n)r!==I.row&&(r=I.row,l=jt(g,this.left+i,this.right-this.lineWidths[r])),I.top+=this.top+t+i,I.left=s.leftForLtr(s.x(l),I.width),l+=I.width+i}else{let r=0,l=jt(g,this.top+t+i,this.bottom-this.columnSizes[r].height);for(const I of n)I.col!==r&&(r=I.col,l=jt(g,this.top+t+i,this.bottom-this.columnSizes[r].height)),I.top=l,I.left+=this.left+i,I.left=s.leftForLtr(s.x(I.left),I.width),l+=I.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Wm(t,this),this._draw(),Rm(t)}}_draw(){const{options:t,columnSizes:n,lineWidths:g,ctx:i}=this,{align:o,labels:s}=t,r=bt.color,l=Gs(t.rtl,this.left,this.width),I=Rt(s.font),{padding:a}=s,C=I.size,c=C/2;let d;this.drawTitle(),i.textAlign=l.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=I.string;const{boxWidth:u,boxHeight:h,itemHeight:f}=rf(s,C),y=function(S,V,R){if(isNaN(u)||u<=0||isNaN(h)||h<0)return;i.save();const J=Le(R.lineWidth,1);if(i.fillStyle=Le(R.fillStyle,r),i.lineCap=Le(R.lineCap,"butt"),i.lineDashOffset=Le(R.lineDashOffset,0),i.lineJoin=Le(R.lineJoin,"miter"),i.lineWidth=J,i.strokeStyle=Le(R.strokeStyle,r),i.setLineDash(Le(R.lineDash,[])),s.usePointStyle){const M={radius:h*Math.SQRT2/2,pointStyle:R.pointStyle,rotation:R.rotation,borderWidth:J},P=l.xPlus(S,u/2),X=V+c;OS(i,M,P,X,s.pointStyleWidth&&u)}else{const M=V+Math.max((C-h)/2,0),P=l.leftForLtr(S,u),X=po(R.borderRadius);i.beginPath(),Object.values(X).some(L=>L!==0)?ul(i,{x:P,y:M,w:u,h,radius:X}):i.rect(P,M,u,h),i.fill(),J!==0&&i.stroke()}i.restore()},Z=function(S,V,R){Jo(i,R.text,S,V+f/2,I,{strikethrough:R.hidden,textAlign:l.textAlign(R.textAlign)})},p=this.isHorizontal(),B=this._computeTitleHeight();p?d={x:jt(o,this.left+a,this.right-g[0]),y:this.top+a+B,line:0}:d={x:this.left+a,y:jt(o,this.top+B+a,this.bottom-n[0].height),line:0},nV(this.ctx,t.textDirection);const W=f+a;this.legendItems.forEach((S,V)=>{i.strokeStyle=S.fontColor,i.fillStyle=S.fontColor;const R=i.measureText(S.text).width,J=l.textAlign(S.textAlign||(S.textAlign=s.textAlign)),M=u+c+R;let P=d.x,X=d.y;l.setWidth(this.width),p?V>0&&P+M+a>this.right&&(X=d.y+=W,d.line++,P=d.x=jt(o,this.left+a,this.right-g[d.line])):V>0&&X+W>this.bottom&&(P=d.x=P+n[d.line].width+a,d.line++,X=d.y=jt(o,this.top+B+a,this.bottom-n[d.line].height));const L=l.x(P);if(y(L,X,S),P=G1(J,P+u+c,p?P+M:this.right,t.rtl),Z(l.x(P),X,S),p)d.x+=M+a;else if(typeof S.text!="string"){const ne=I.lineHeight;d.y+=mV(S,ne)+a}else d.y+=W}),gV(this.ctx,t.textDirection)}drawTitle(){const t=this.options,n=t.title,g=Rt(n.font),i=en(n.padding);if(!n.display)return;const o=Gs(t.rtl,this.left,this.width),s=this.ctx,r=n.position,l=g.size/2,I=i.top+l;let a,C=this.left,c=this.width;if(this.isHorizontal())c=Math.max(...this.lineWidths),a=this.top+I,C=jt(t.align,C,this.right-c);else{const u=this.columnSizes.reduce((h,f)=>Math.max(h,f.height),0);a=I+jt(t.align,this.top,this.bottom-u-t.labels.padding-this._computeTitleHeight())}const d=jt(r,C,C+c);s.textAlign=o.textAlign(Vm(r)),s.textBaseline="middle",s.strokeStyle=n.color,s.fillStyle=n.color,s.font=g.string,Jo(s,n.text,d,a,g)}_computeTitleHeight(){const t=this.options.title,n=Rt(t.font),g=en(t.padding);return t.display?n.lineHeight+g.height:0}_getLegendItemAt(t,n){let g,i,o;if(ao(t,this.left,this.right)&&ao(n,this.top,this.bottom)){for(o=this.legendHitBoxes,g=0;g<o.length;++g)if(i=o[g],ao(t,i.left,i.left+i.width)&&ao(n,i.top,i.top+i.height))return this.legendItems[g]}return null}handleEvent(t){const n=this.options;if(!tF(t.type,n))return;const g=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const i=this._hoveredItem,o=_N(i,g);i&&!o&&tt(n.onLeave,[t,i,this],this),this._hoveredItem=g,g&&!o&&tt(n.onHover,[t,g,this],this)}else g&&tt(n.onClick,[t,g,this],this)}}function qN(e,t,n,g,i){const o=$N(g,e,t,n),s=eF(i,g,t.lineHeight);return{itemWidth:o,itemHeight:s}}function $N(e,t,n,g){let i=e.text;return i&&typeof i!="string"&&(i=i.reduce((o,s)=>o.length>s.length?o:s)),t+n.size/2+g.measureText(i).width}function eF(e,t,n){let g=e;return typeof t.text!="string"&&(g=mV(t,n)),g}function mV(e,t){const n=e.text?e.text.length:0;return t*n}function tF(e,t){return!!((e==="mousemove"||e==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(e==="click"||e==="mouseup"))}var nF={id:"legend",_element:lf,start(e,t,n){const g=e.legend=new lf({ctx:e.ctx,options:n,chart:e});En.configure(e,g,n),En.addBox(e,g)},stop(e){En.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const g=e.legend;En.configure(e,g,n),g.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const g=t.datasetIndex,i=n.chart;i.isDatasetVisible(g)?(i.hide(g),t.hidden=!0):(i.show(g),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:g,textAlign:i,color:o,useBorderRadius:s,borderRadius:r}}=e.legend.options;return e._getSortedDatasetMetas().map(l=>{const I=l.controller.getStyle(n?0:void 0),a=en(I.borderWidth);return{text:t[l.index].label,fillStyle:I.backgroundColor,fontColor:o,hidden:!l.visible,lineCap:I.borderCapStyle,lineDash:I.borderDash,lineDashOffset:I.borderDashOffset,lineJoin:I.borderJoinStyle,lineWidth:(a.width+a.height)/4,strokeStyle:I.borderColor,pointStyle:g||I.pointStyle,rotation:I.rotation,textAlign:i||I.textAlign,borderRadius:s&&(r||I.borderRadius),datasetIndex:l.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class bV extends Ko{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n){const g=this.options;if(this.left=0,this.top=0,!g.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=n;const i=Ct(g.text)?g.text.length:1;this._padding=en(g.padding);const o=i*Rt(g.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:n,left:g,bottom:i,right:o,options:s}=this,r=s.align;let l=0,I,a,C;return this.isHorizontal()?(a=jt(r,g,o),C=n+t,I=o-g):(s.position==="left"?(a=g+t,C=jt(r,i,n),l=pt*-.5):(a=o-t,C=jt(r,n,i),l=pt*.5),I=i-n),{titleX:a,titleY:C,maxWidth:I,rotation:l}}draw(){const t=this.ctx,n=this.options;if(!n.display)return;const g=Rt(n.font),o=g.lineHeight/2+this._padding.top,{titleX:s,titleY:r,maxWidth:l,rotation:I}=this._drawArgs(o);Jo(t,n.text,0,0,g,{color:n.color,maxWidth:l,rotation:I,textAlign:Vm(n.align),textBaseline:"middle",translation:[s,r]})}}function gF(e,t){const n=new bV({ctx:e.ctx,options:t,chart:e});En.configure(e,n,t),En.addBox(e,n),e.titleBlock=n}var iF={id:"title",_element:bV,start(e,t,n){gF(e,n)},stop(e){const t=e.titleBlock;En.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const g=e.titleBlock;En.configure(e,g,n),g.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Zr={average(e){if(!e.length)return!1;let t,n,g=new Set,i=0,o=0;for(t=0,n=e.length;t<n;++t){const r=e[t].element;if(r&&r.hasValue()){const l=r.tooltipPosition();g.add(l.x),i+=l.y,++o}}return{x:[...g].reduce((r,l)=>r+l)/g.size,y:i/o}},nearest(e,t){if(!e.length)return!1;let n=t.x,g=t.y,i=Number.POSITIVE_INFINITY,o,s,r;for(o=0,s=e.length;o<s;++o){const l=e[o].element;if(l&&l.hasValue()){const I=l.getCenterPoint(),a=m1(t,I);a<i&&(i=a,r=l)}}if(r){const l=r.tooltipPosition();n=l.x,g=l.y}return{x:n,y:g}}};function sg(e,t){return t&&(Ct(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function yg(e){return(typeof e=="string"||e instanceof String)&&e.indexOf(`
`)>-1?e.split(`
`):e}function oF(e,t){const{element:n,datasetIndex:g,index:i}=t,o=e.getDatasetMeta(g).controller,{label:s,value:r}=o.getLabelAndValue(i);return{chart:e,label:s,parsed:o.getParsed(i),raw:e.data.datasets[g].data[i],formattedValue:r,dataset:o.getDataset(),dataIndex:i,datasetIndex:g,element:n}}function If(e,t){const n=e.chart.ctx,{body:g,footer:i,title:o}=e,{boxWidth:s,boxHeight:r}=t,l=Rt(t.bodyFont),I=Rt(t.titleFont),a=Rt(t.footerFont),C=o.length,c=i.length,d=g.length,u=en(t.padding);let h=u.height,f=0,y=g.reduce((B,W)=>B+W.before.length+W.lines.length+W.after.length,0);if(y+=e.beforeBody.length+e.afterBody.length,C&&(h+=C*I.lineHeight+(C-1)*t.titleSpacing+t.titleMarginBottom),y){const B=t.displayColors?Math.max(r,l.lineHeight):l.lineHeight;h+=d*B+(y-d)*l.lineHeight+(y-1)*t.bodySpacing}c&&(h+=t.footerMarginTop+c*a.lineHeight+(c-1)*t.footerSpacing);let Z=0;const p=function(B){f=Math.max(f,n.measureText(B).width+Z)};return n.save(),n.font=I.string,De(e.title,p),n.font=l.string,De(e.beforeBody.concat(e.afterBody),p),Z=t.displayColors?s+2+t.boxPadding:0,De(g,B=>{De(B.before,p),De(B.lines,p),De(B.after,p)}),Z=0,n.font=a.string,De(e.footer,p),n.restore(),f+=u.width,{width:f,height:h}}function sF(e,t){const{y:n,height:g}=t;return n<g/2?"top":n>e.height-g/2?"bottom":"center"}function rF(e,t,n,g){const{x:i,width:o}=g,s=n.caretSize+n.caretPadding;if(e==="left"&&i+o+s>t.width||e==="right"&&i-o-s<0)return!0}function lF(e,t,n,g){const{x:i,width:o}=n,{width:s,chartArea:{left:r,right:l}}=e;let I="center";return g==="center"?I=i<=(r+l)/2?"left":"right":i<=o/2?I="left":i>=s-o/2&&(I="right"),rF(I,e,t,n)&&(I="center"),I}function af(e,t,n){const g=n.yAlign||t.yAlign||sF(e,n);return{xAlign:n.xAlign||t.xAlign||lF(e,t,n,g),yAlign:g}}function IF(e,t){let{x:n,width:g}=e;return t==="right"?n-=g:t==="center"&&(n-=g/2),n}function aF(e,t,n){let{y:g,height:i}=e;return t==="top"?g+=n:t==="bottom"?g-=i+n:g-=i/2,g}function Cf(e,t,n,g){const{caretSize:i,caretPadding:o,cornerRadius:s}=e,{xAlign:r,yAlign:l}=n,I=i+o,{topLeft:a,topRight:C,bottomLeft:c,bottomRight:d}=po(s);let u=IF(t,r);const h=aF(t,l,I);return l==="center"?r==="left"?u+=I:r==="right"&&(u-=I):r==="left"?u-=Math.max(a,c)+i:r==="right"&&(u+=Math.max(C,d)+i),{x:An(u,0,g.width-t.width),y:An(h,0,g.height-t.height)}}function hI(e,t,n){const g=en(n.padding);return t==="center"?e.x+e.width/2:t==="right"?e.x+e.width-g.right:e.x+g.left}function cf(e){return sg([],yg(e))}function CF(e,t,n){return xo(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}function df(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const pV={beforeTitle:pg,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,g=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(g>0&&t.dataIndex<g)return n[t.dataIndex]}return""},afterTitle:pg,beforeBody:pg,beforeLabel:pg,label(e){if(this&&this.options&&this.options.mode==="dataset")return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return _e(n)||(t+=n),t},labelColor(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:pg,afterBody:pg,beforeFooter:pg,footer:pg,afterFooter:pg};function an(e,t,n,g){const i=e[t].call(n,g);return typeof i>"u"?pV[t].call(n,g):i}class Wu extends Ko{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const n=this.chart,g=this.options.setContext(this.getContext()),i=g.enabled&&n.options.animation&&g.animations,o=new iV(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=CF(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){const{callbacks:g}=n,i=an(g,"beforeTitle",this,t),o=an(g,"title",this,t),s=an(g,"afterTitle",this,t);let r=[];return r=sg(r,yg(i)),r=sg(r,yg(o)),r=sg(r,yg(s)),r}getBeforeBody(t,n){return cf(an(n.callbacks,"beforeBody",this,t))}getBody(t,n){const{callbacks:g}=n,i=[];return De(t,o=>{const s={before:[],lines:[],after:[]},r=df(g,o);sg(s.before,yg(an(r,"beforeLabel",this,o))),sg(s.lines,an(r,"label",this,o)),sg(s.after,yg(an(r,"afterLabel",this,o))),i.push(s)}),i}getAfterBody(t,n){return cf(an(n.callbacks,"afterBody",this,t))}getFooter(t,n){const{callbacks:g}=n,i=an(g,"beforeFooter",this,t),o=an(g,"footer",this,t),s=an(g,"afterFooter",this,t);let r=[];return r=sg(r,yg(i)),r=sg(r,yg(o)),r=sg(r,yg(s)),r}_createItems(t){const n=this._active,g=this.chart.data,i=[],o=[],s=[];let r=[],l,I;for(l=0,I=n.length;l<I;++l)r.push(oF(this.chart,n[l]));return t.filter&&(r=r.filter((a,C,c)=>t.filter(a,C,c,g))),t.itemSort&&(r=r.sort((a,C)=>t.itemSort(a,C,g))),De(r,a=>{const C=df(t.callbacks,a);i.push(an(C,"labelColor",this,a)),o.push(an(C,"labelPointStyle",this,a)),s.push(an(C,"labelTextColor",this,a))}),this.labelColors=i,this.labelPointStyles=o,this.labelTextColors=s,this.dataPoints=r,r}update(t,n){const g=this.options.setContext(this.getContext()),i=this._active;let o,s=[];if(!i.length)this.opacity!==0&&(o={opacity:0});else{const r=Zr[g.position].call(this,i,this._eventPosition);s=this._createItems(g),this.title=this.getTitle(s,g),this.beforeBody=this.getBeforeBody(s,g),this.body=this.getBody(s,g),this.afterBody=this.getAfterBody(s,g),this.footer=this.getFooter(s,g);const l=this._size=If(this,g),I=Object.assign({},r,l),a=af(this.chart,g,I),C=Cf(g,I,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,o={opacity:1,x:C.x,y:C.y,width:l.width,height:l.height,caretX:r.x,caretY:r.y}}this._tooltipItems=s,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&g.external&&g.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,g,i){const o=this.getCaretPosition(t,g,i);n.lineTo(o.x1,o.y1),n.lineTo(o.x2,o.y2),n.lineTo(o.x3,o.y3)}getCaretPosition(t,n,g){const{xAlign:i,yAlign:o}=this,{caretSize:s,cornerRadius:r}=g,{topLeft:l,topRight:I,bottomLeft:a,bottomRight:C}=po(r),{x:c,y:d}=t,{width:u,height:h}=n;let f,y,Z,p,B,W;return o==="center"?(B=d+h/2,i==="left"?(f=c,y=f-s,p=B+s,W=B-s):(f=c+u,y=f+s,p=B-s,W=B+s),Z=f):(i==="left"?y=c+Math.max(l,a)+s:i==="right"?y=c+u-Math.max(I,C)-s:y=this.caretX,o==="top"?(p=d,B=p-s,f=y-s,Z=y+s):(p=d+h,B=p+s,f=y+s,Z=y-s),W=p),{x1:f,x2:y,x3:Z,y1:p,y2:B,y3:W}}drawTitle(t,n,g){const i=this.title,o=i.length;let s,r,l;if(o){const I=Gs(g.rtl,this.x,this.width);for(t.x=hI(this,g.titleAlign,g),n.textAlign=I.textAlign(g.titleAlign),n.textBaseline="middle",s=Rt(g.titleFont),r=g.titleSpacing,n.fillStyle=g.titleColor,n.font=s.string,l=0;l<o;++l)n.fillText(i[l],I.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+r,l+1===o&&(t.y+=g.titleMarginBottom-r)}}_drawColorBox(t,n,g,i,o){const s=this.labelColors[g],r=this.labelPointStyles[g],{boxHeight:l,boxWidth:I}=o,a=Rt(o.bodyFont),C=hI(this,"left",o),c=i.x(C),d=l<a.lineHeight?(a.lineHeight-l)/2:0,u=n.y+d;if(o.usePointStyle){const h={radius:Math.min(I,l)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},f=i.leftForLtr(c,I)+I/2,y=u+l/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,V0(t,h,f,y),t.strokeStyle=s.borderColor,t.fillStyle=s.backgroundColor,V0(t,h,f,y)}else{t.lineWidth=Me(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,t.strokeStyle=s.borderColor,t.setLineDash(s.borderDash||[]),t.lineDashOffset=s.borderDashOffset||0;const h=i.leftForLtr(c,I),f=i.leftForLtr(i.xPlus(c,1),I-2),y=po(s.borderRadius);Object.values(y).some(Z=>Z!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,ul(t,{x:h,y:u,w:I,h:l,radius:y}),t.fill(),t.stroke(),t.fillStyle=s.backgroundColor,t.beginPath(),ul(t,{x:f,y:u+1,w:I-2,h:l-2,radius:y}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(h,u,I,l),t.strokeRect(h,u,I,l),t.fillStyle=s.backgroundColor,t.fillRect(f,u+1,I-2,l-2))}t.fillStyle=this.labelTextColors[g]}drawBody(t,n,g){const{body:i}=this,{bodySpacing:o,bodyAlign:s,displayColors:r,boxHeight:l,boxWidth:I,boxPadding:a}=g,C=Rt(g.bodyFont);let c=C.lineHeight,d=0;const u=Gs(g.rtl,this.x,this.width),h=function(R){n.fillText(R,u.x(t.x+d),t.y+c/2),t.y+=c+o},f=u.textAlign(s);let y,Z,p,B,W,S,V;for(n.textAlign=s,n.textBaseline="middle",n.font=C.string,t.x=hI(this,f,g),n.fillStyle=g.bodyColor,De(this.beforeBody,h),d=r&&f!=="right"?s==="center"?I/2+a:I+2+a:0,B=0,S=i.length;B<S;++B){for(y=i[B],Z=this.labelTextColors[B],n.fillStyle=Z,De(y.before,h),p=y.lines,r&&p.length&&(this._drawColorBox(n,t,B,u,g),c=Math.max(C.lineHeight,l)),W=0,V=p.length;W<V;++W)h(p[W]),c=C.lineHeight;De(y.after,h)}d=0,c=C.lineHeight,De(this.afterBody,h),t.y-=o}drawFooter(t,n,g){const i=this.footer,o=i.length;let s,r;if(o){const l=Gs(g.rtl,this.x,this.width);for(t.x=hI(this,g.footerAlign,g),t.y+=g.footerMarginTop,n.textAlign=l.textAlign(g.footerAlign),n.textBaseline="middle",s=Rt(g.footerFont),n.fillStyle=g.footerColor,n.font=s.string,r=0;r<o;++r)n.fillText(i[r],l.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+g.footerSpacing}}drawBackground(t,n,g,i){const{xAlign:o,yAlign:s}=this,{x:r,y:l}=t,{width:I,height:a}=g,{topLeft:C,topRight:c,bottomLeft:d,bottomRight:u}=po(i.cornerRadius);n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,n.lineWidth=i.borderWidth,n.beginPath(),n.moveTo(r+C,l),s==="top"&&this.drawCaret(t,n,g,i),n.lineTo(r+I-c,l),n.quadraticCurveTo(r+I,l,r+I,l+c),s==="center"&&o==="right"&&this.drawCaret(t,n,g,i),n.lineTo(r+I,l+a-u),n.quadraticCurveTo(r+I,l+a,r+I-u,l+a),s==="bottom"&&this.drawCaret(t,n,g,i),n.lineTo(r+d,l+a),n.quadraticCurveTo(r,l+a,r,l+a-d),s==="center"&&o==="left"&&this.drawCaret(t,n,g,i),n.lineTo(r,l+C),n.quadraticCurveTo(r,l,r+C,l),n.closePath(),n.fill(),i.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){const n=this.chart,g=this.$animations,i=g&&g.x,o=g&&g.y;if(i||o){const s=Zr[t.position].call(this,this._active,this._eventPosition);if(!s)return;const r=this._size=If(this,t),l=Object.assign({},s,this._size),I=af(n,t,l),a=Cf(t,l,I,n);(i._to!==a.x||o._to!==a.y)&&(this.xAlign=I.xAlign,this.yAlign=I.yAlign,this.width=r.width,this.height=r.height,this.caretX=s.x,this.caretY=s.y,this._resolveAnimations().update(this,a))}}_willRender(){return!!this.opacity}draw(t){const n=this.options.setContext(this.getContext());let g=this.opacity;if(!g)return;this._updateAnimationTarget(n);const i={width:this.width,height:this.height},o={x:this.x,y:this.y};g=Math.abs(g)<.001?0:g;const s=en(n.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&r&&(t.save(),t.globalAlpha=g,this.drawBackground(o,t,i,n),nV(t,n.textDirection),o.y+=s.top,this.drawTitle(o,t,n),this.drawBody(o,t,n),this.drawFooter(o,t,n),gV(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){const g=this._active,i=t.map(({datasetIndex:r,index:l})=>{const I=this.chart.getDatasetMeta(r);if(!I)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:I.data[l],index:l}}),o=!wa(g,i),s=this._positionChanged(i,n);(o||s)&&(this._active=i,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,g=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,o=this._active||[],s=this._getActiveElements(t,o,n,g),r=this._positionChanged(s,t),l=n||!wa(s,o)||r;return l&&(this._active=s,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),l}_getActiveElements(t,n,g,i){const o=this.options;if(t.type==="mouseout")return[];if(!i)return n.filter(r=>this.chart.data.datasets[r.datasetIndex]&&this.chart.getDatasetMeta(r.datasetIndex).controller.getParsed(r.index)!==void 0);const s=this.chart.getElementsAtEventForMode(t,o.mode,o,g);return o.reverse&&s.reverse(),s}_positionChanged(t,n){const{caretX:g,caretY:i,options:o}=this,s=Zr[o.position].call(this,t,n);return s!==!1&&(g!==s.x||i!==s.y)}}Se(Wu,"positioners",Zr);var cF={id:"tooltip",_element:Wu,positioners:Zr,afterInit(e,t,n){n&&(e.tooltip=new Wu({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(e.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:pV},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>e!=="filter"&&e!=="itemSort"&&e!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const dF=(e,t,n,g)=>(typeof t=="string"?(n=e.push(t)-1,g.unshift({index:n,label:t})):isNaN(t)&&(n=null),n);function uF(e,t,n,g){const i=e.indexOf(t);if(i===-1)return dF(e,t,n,g);const o=e.lastIndexOf(t);return i!==o?n:i}const AF=(e,t)=>e===null?null:An(Math.round(e),0,t);function uf(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class Ru extends Eo{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const n=this._addedLabels;if(n.length){const g=this.getLabels();for(const{index:i,label:o}of n)g[i]===o&&g.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(_e(t))return null;const g=this.getLabels();return n=isFinite(n)&&g[n]===t?n:uF(g,t,Le(n,t),this._addedLabels),AF(n,g.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:g,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(g=0),n||(i=this.getLabels().length-1)),this.min=g,this.max=i}buildTicks(){const t=this.min,n=this.max,g=this.options.offset,i=[];let o=this.getLabels();o=t===0&&n===o.length-1?o:o.slice(t,n+1),this._valueRange=Math.max(o.length-(g?0:1),1),this._startValue=this.min-(g?.5:0);for(let s=t;s<=n;s++)i.push({value:s});return i}getLabelForValue(t){return uf.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}Se(Ru,"id","category"),Se(Ru,"defaults",{ticks:{callback:uf}});function hF(e,t){const n=[],{bounds:i,step:o,min:s,max:r,precision:l,count:I,maxTicks:a,maxDigits:C,includeBounds:c}=e,d=o||1,u=a-1,{min:h,max:f}=t,y=!_e(s),Z=!_e(r),p=!_e(I),B=(f-h)/(C+1);let W=b0((f-h)/u/d)*d,S,V,R,J;if(W<1e-14&&!y&&!Z)return[{value:h},{value:f}];J=Math.ceil(f/W)-Math.floor(h/W),J>u&&(W=b0(J*W/u/d)*d),_e(l)||(S=Math.pow(10,l),W=Math.ceil(W*S)/S),i==="ticks"?(V=Math.floor(h/W)*W,R=Math.ceil(f/W)*W):(V=h,R=f),y&&Z&&o&&h1((r-s)/o,W/1e3)?(J=Math.round(Math.min((r-s)/W,a)),W=(r-s)/J,V=s,R=r):p?(V=y?s:V,R=Z?r:R,J=I-1,W=(R-V)/J):(J=(R-V)/W,TI(J,Math.round(J),W/1e3)?J=Math.round(J):J=Math.ceil(J));const M=Math.max(p0(W),p0(V));S=Math.pow(10,_e(l)?M:l),V=Math.round(V*S)/S,R=Math.round(R*S)/S;let P=0;for(y&&(c&&V!==s?(n.push({value:s}),V<s&&P++,TI(Math.round((V+P*W)*S)/S,s,Af(s,B,e))&&P++):V<s&&P++);P<J;++P){const X=Math.round((V+P*W)*S)/S;if(Z&&X>r)break;n.push({value:X})}return Z&&c&&R!==r?n.length&&TI(n[n.length-1].value,r,Af(r,B,e))?n[n.length-1].value=r:n.push({value:r}):(!Z||R===r)&&n.push({value:R}),n}function Af(e,t,{horizontal:n,minRotation:g}){const i=cg(g),o=(n?Math.sin(i):Math.cos(i))||.001,s=.75*t*(""+e).length;return Math.min(t/o,s)}class Ma extends Eo{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,n){return _e(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:n,maxDefined:g}=this.getUserBounds();let{min:i,max:o}=this;const s=l=>i=n?i:l,r=l=>o=g?o:l;if(t){const l=vi(i),I=vi(o);l<0&&I<0?r(0):l>0&&I>0&&s(0)}if(i===o){let l=o===0?1:Math.abs(o*.05);r(o+l),t||s(i-l)}this.min=i,this.max=o}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:n,stepSize:g}=t,i;return g?(i=Math.ceil(this.max/g)-Math.floor(this.min/g)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${g} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),n=n||11),n&&(i=Math.min(n,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,n=t.ticks;let g=this.getTickLimit();g=Math.max(2,g);const i={maxTicks:g,bounds:t.bounds,min:t.min,max:t.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},o=this._range||this,s=hF(i,o);return t.bounds==="ticks"&&TS(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}configure(){const t=this.ticks;let n=this.min,g=this.max;if(super.configure(),this.options.offset&&t.length){const i=(g-n)/Math.max(t.length-1,1)/2;n-=i,g+=i}this._startValue=n,this._endValue=g,this._valueRange=g-n}getLabelForValue(t){return WC(t,this.chart.options.locale,this.options.ticks.format)}}class vu extends Ma{determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=Yt(t)?t:0,this.max=Yt(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),n=t?this.width:this.height,g=cg(this.options.ticks.minRotation),i=(t?Math.sin(g):Math.cos(g))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,o.lineHeight/i))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}Se(vu,"id","linear"),Se(vu,"defaults",{ticks:{callback:RC.formatters.numeric}});const hl=e=>Math.floor(mi(e)),Di=(e,t)=>Math.pow(10,hl(e)+t);function hf(e){return e/Math.pow(10,hl(e))===1}function mf(e,t,n){const g=Math.pow(10,n),i=Math.floor(e/g);return Math.ceil(t/g)-i}function mF(e,t){const n=t-e;let g=hl(n);for(;mf(e,t,g)>10;)g++;for(;mf(e,t,g)<10;)g--;return Math.min(g,hl(e))}function bF(e,{min:t,max:n}){t=yn(e.min,t);const g=[],i=hl(t);let o=mF(t,n),s=o<0?Math.pow(10,Math.abs(o)):1;const r=Math.pow(10,o),l=i>o?Math.pow(10,i):0,I=Math.round((t-l)*s)/s,a=Math.floor((t-l)/r/10)*r*10;let C=Math.floor((I-a)/Math.pow(10,o)),c=yn(e.min,Math.round((l+a+C*Math.pow(10,o))*s)/s);for(;c<n;)g.push({value:c,major:hf(c),significand:C}),C>=10?C=C<15?15:20:C++,C>=20&&(o++,C=2,s=o>=0?1:s),c=Math.round((l+a+C*Math.pow(10,o))*s)/s;const d=yn(e.max,c);return g.push({value:d,major:hf(d),significand:C}),g}class bf extends Eo{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,n){const g=Ma.prototype.parse.apply(this,[t,n]);if(g===0){this._zero=!0;return}return Yt(g)&&g>0?g:null}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=Yt(t)?Math.max(0,t):null,this.max=Yt(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Yt(this._userMin)&&(this.min=t===Di(this.min,0)?Di(this.min,-1):Di(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let g=this.min,i=this.max;const o=r=>g=t?g:r,s=r=>i=n?i:r;g===i&&(g<=0?(o(1),s(10)):(o(Di(g,-1)),s(Di(i,1)))),g<=0&&o(Di(i,-1)),i<=0&&s(Di(g,1)),this.min=g,this.max=i}buildTicks(){const t=this.options,n={min:this._userMin,max:this._userMax},g=bF(n,this);return t.bounds==="ticks"&&TS(g,this,"value"),t.reverse?(g.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),g}getLabelForValue(t){return t===void 0?"0":WC(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=mi(t),this._valueRange=mi(this.max)-mi(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(mi(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const n=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+n*this._valueRange)}}Se(bf,"id","logarithmic"),Se(bf,"defaults",{ticks:{callback:RC.formatters.logarithmic,major:{enabled:!0}}});function ku(e){const t=e.ticks;if(t.display&&e.display){const n=en(t.backdropPadding);return Le(t.font&&t.font.size,bt.font.size)+n.height}return 0}function pF(e,t,n){return n=Ct(n)?n:[n],{w:J1(e,t.string,n),h:n.length*t.lineHeight}}function pf(e,t,n,g,i){return e===g||e===i?{start:t-n/2,end:t+n/2}:e<g||e>i?{start:t-n,end:t}:{start:t,end:t+n}}function fF(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),g=[],i=[],o=e._pointLabels.length,s=e.options.pointLabels,r=s.centerPointLabels?pt/o:0;for(let l=0;l<o;l++){const I=s.setContext(e.getPointLabelContext(l));i[l]=I.padding;const a=e.getPointPosition(l,e.drawingArea+i[l],r),C=Rt(I.font),c=pF(e.ctx,C,e._pointLabels[l]);g[l]=c;const d=ag(e.getIndexAngle(l)+r),u=Math.round(Bm(d)),h=pf(u,a.x,c.w,0,180),f=pf(u,a.y,c.h,90,270);ZF(n,t,d,h,f)}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=BF(e,g,i)}function ZF(e,t,n,g,i){const o=Math.abs(Math.sin(n)),s=Math.abs(Math.cos(n));let r=0,l=0;g.start<t.l?(r=(t.l-g.start)/o,e.l=Math.min(e.l,t.l-r)):g.end>t.r&&(r=(g.end-t.r)/o,e.r=Math.max(e.r,t.r+r)),i.start<t.t?(l=(t.t-i.start)/s,e.t=Math.min(e.t,t.t-l)):i.end>t.b&&(l=(i.end-t.b)/s,e.b=Math.max(e.b,t.b+l))}function yF(e,t,n){const g=e.drawingArea,{extra:i,additionalAngle:o,padding:s,size:r}=n,l=e.getPointPosition(t,g+i+s,o),I=Math.round(Bm(ag(l.angle+Gt))),a=WF(l.y,r.h,I),C=SF(I),c=VF(l.x,r.w,C);return{visible:!0,x:l.x,y:a,textAlign:C,left:c,top:a,right:c+r.w,bottom:a+r.h}}function GF(e,t){if(!t)return!0;const{left:n,top:g,right:i,bottom:o}=e;return!(as({x:n,y:g},t)||as({x:n,y:o},t)||as({x:i,y:g},t)||as({x:i,y:o},t))}function BF(e,t,n){const g=[],i=e._pointLabels.length,o=e.options,{centerPointLabels:s,display:r}=o.pointLabels,l={extra:ku(o)/2,additionalAngle:s?pt/i:0};let I;for(let a=0;a<i;a++){l.padding=n[a],l.size=t[a];const C=yF(e,a,l);g.push(C),r==="auto"&&(C.visible=GF(C,I),C.visible&&(I=C))}return g}function SF(e){return e===0||e===180?"center":e<180?"left":"right"}function VF(e,t,n){return n==="right"?e-=t:n==="center"&&(e-=t/2),e}function WF(e,t,n){return n===90||n===270?e-=t/2:(n>270||n<90)&&(e-=t),e}function RF(e,t,n){const{left:g,top:i,right:o,bottom:s}=n,{backdropColor:r}=t;if(!_e(r)){const l=po(t.borderRadius),I=en(t.backdropPadding);e.fillStyle=r;const a=g-I.left,C=i-I.top,c=o-g+I.width,d=s-i+I.height;Object.values(l).some(u=>u!==0)?(e.beginPath(),ul(e,{x:a,y:C,w:c,h:d,radius:l}),e.fill()):e.fillRect(a,C,c,d)}}function vF(e,t){const{ctx:n,options:{pointLabels:g}}=e;for(let i=t-1;i>=0;i--){const o=e._pointLabelItems[i];if(!o.visible)continue;const s=g.setContext(e.getPointLabelContext(i));RF(n,s,o);const r=Rt(s.font),{x:l,y:I,textAlign:a}=o;Jo(n,e._pointLabels[i],l,I+r.lineHeight/2,r,{color:s.color,textAlign:a,textBaseline:"middle"})}}function fV(e,t,n,g){const{ctx:i}=e;if(n)i.arc(e.xCenter,e.yCenter,t,0,mt);else{let o=e.getPointPosition(0,t);i.moveTo(o.x,o.y);for(let s=1;s<g;s++)o=e.getPointPosition(s,t),i.lineTo(o.x,o.y)}}function kF(e,t,n,g,i){const o=e.ctx,s=t.circular,{color:r,lineWidth:l}=t;!s&&!g||!r||!l||n<0||(o.save(),o.strokeStyle=r,o.lineWidth=l,o.setLineDash(i.dash),o.lineDashOffset=i.dashOffset,o.beginPath(),fV(e,n,s,g),o.closePath(),o.stroke(),o.restore())}function XF(e,t,n){return xo(e,{label:n,index:t,type:"pointLabel"})}class mI extends Ma{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=en(ku(this.options)/2),n=this.width=this.maxWidth-t.width,g=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+n/2+t.left),this.yCenter=Math.floor(this.top+g/2+t.top),this.drawingArea=Math.floor(Math.min(n,g)/2)}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!1);this.min=Yt(t)&&!isNaN(t)?t:0,this.max=Yt(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/ku(this.options))}generateTickLabels(t){Ma.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((n,g)=>{const i=tt(this.options.pointLabels.callback,[n,g],this);return i||i===0?i:""}).filter((n,g)=>this.chart.getDataVisibility(g))}fit(){const t=this.options;t.display&&t.pointLabels.display?fF(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,n,g,i){this.xCenter+=Math.floor((t-n)/2),this.yCenter+=Math.floor((g-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,n,g,i))}getIndexAngle(t){const n=mt/(this._pointLabels.length||1),g=this.options.startAngle||0;return ag(t*n+cg(g))}getDistanceFromCenterForValue(t){if(_e(t))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*n:(t-this.min)*n}getValueForDistanceFromCenter(t){if(_e(t))return NaN;const n=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(t){const n=this._pointLabels||[];if(t>=0&&t<n.length){const g=n[t];return XF(this.getContext(),t,g)}}getPointPosition(t,n,g=0){const i=this.getIndexAngle(t)-Gt+g;return{x:Math.cos(i)*n+this.xCenter,y:Math.sin(i)*n+this.yCenter,angle:i}}getPointPositionForValue(t,n){return this.getPointPosition(t,this.getDistanceFromCenterForValue(n))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:n,top:g,right:i,bottom:o}=this._pointLabelItems[t];return{left:n,top:g,right:i,bottom:o}}drawBackground(){const{backgroundColor:t,grid:{circular:n}}=this.options;if(t){const g=this.ctx;g.save(),g.beginPath(),fV(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),g.closePath(),g.fillStyle=t,g.fill(),g.restore()}}drawGrid(){const t=this.ctx,n=this.options,{angleLines:g,grid:i,border:o}=n,s=this._pointLabels.length;let r,l,I;if(n.pointLabels.display&&vF(this,s),i.display&&this.ticks.forEach((a,C)=>{if(C!==0||C===0&&this.min<0){l=this.getDistanceFromCenterForValue(a.value);const c=this.getContext(C),d=i.setContext(c),u=o.setContext(c);kF(this,d,l,s,u)}}),g.display){for(t.save(),r=s-1;r>=0;r--){const a=g.setContext(this.getPointLabelContext(r)),{color:C,lineWidth:c}=a;!c||!C||(t.lineWidth=c,t.strokeStyle=C,t.setLineDash(a.borderDash),t.lineDashOffset=a.borderDashOffset,l=this.getDistanceFromCenterForValue(n.ticks.reverse?this.min:this.max),I=this.getPointPosition(r,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(I.x,I.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,n=this.options,g=n.ticks;if(!g.display)return;const i=this.getIndexAngle(0);let o,s;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((r,l)=>{if(l===0&&this.min>=0&&!n.reverse)return;const I=g.setContext(this.getContext(l)),a=Rt(I.font);if(o=this.getDistanceFromCenterForValue(this.ticks[l].value),I.showLabelBackdrop){t.font=a.string,s=t.measureText(r.label).width,t.fillStyle=I.backdropColor;const C=en(I.backdropPadding);t.fillRect(-s/2-C.left,-o-a.size/2-C.top,s+C.width,a.size+C.height)}Jo(t,r.label,0,-o,a,{color:I.color,strokeColor:I.textStrokeColor,strokeWidth:I.textStrokeWidth})}),t.restore()}drawTitle(){}}Se(mI,"id","radialLinear"),Se(mI,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:RC.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),Se(mI,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Se(mI,"descriptors",{angleLines:{_fallback:"grid"}});const XC={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},dn=Object.keys(XC);function ff(e,t){return e-t}function Zf(e,t){if(_e(t))return null;const n=e._adapter,{parser:g,round:i,isoWeekday:o}=e._parseOpts;let s=t;return typeof g=="function"&&(s=g(s)),Yt(s)||(s=typeof g=="string"?n.parse(s,g):n.parse(s)),s===null?null:(i&&(s=i==="week"&&(Ha(o)||o===!0)?n.startOf(s,"isoWeek",o):n.startOf(s,i)),+s)}function yf(e,t,n,g){const i=dn.length;for(let o=dn.indexOf(e);o<i-1;++o){const s=XC[dn[o]],r=s.steps?s.steps:Number.MAX_SAFE_INTEGER;if(s.common&&Math.ceil((n-t)/(r*s.size))<=g)return dn[o]}return dn[i-1]}function wF(e,t,n,g,i){for(let o=dn.length-1;o>=dn.indexOf(n);o--){const s=dn[o];if(XC[s].common&&e._adapter.diff(i,g,s)>=t-1)return s}return dn[n?dn.indexOf(n):0]}function JF(e){for(let t=dn.indexOf(e)+1,n=dn.length;t<n;++t)if(XC[dn[t]].common)return dn[t]}function Gf(e,t,n){if(!n)e[t]=!0;else if(n.length){const{lo:g,hi:i}=Sm(n,t),o=n[g]>=t?n[g]:n[i];e[o]=!0}}function YF(e,t,n,g){const i=e._adapter,o=+i.startOf(t[0].value,g),s=t[t.length-1].value;let r,l;for(r=o;r<=s;r=+i.add(r,1,g))l=n[r],l>=0&&(t[l].major=!0);return t}function Bf(e,t,n){const g=[],i={},o=t.length;let s,r;for(s=0;s<o;++s)r=t[s],i[r]=s,g.push({value:r,major:!1});return o===0||!n?g:YF(e,g,i,n)}class Ta extends Eo{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){const g=t.time||(t.time={}),i=this._adapter=new XH._date(t.adapters.date);i.init(n),Hr(g.displayFormats,i.formats()),this._parseOpts={parser:g.parser,round:g.round,isoWeekday:g.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:Zf(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,n=this._adapter,g=t.time.unit||"day";let{min:i,max:o,minDefined:s,maxDefined:r}=this.getUserBounds();function l(I){!s&&!isNaN(I.min)&&(i=Math.min(i,I.min)),!r&&!isNaN(I.max)&&(o=Math.max(o,I.max))}(!s||!r)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),i=Yt(i)&&!isNaN(i)?i:+n.startOf(Date.now(),g),o=Yt(o)&&!isNaN(o)?o:+n.endOf(Date.now(),g)+1,this.min=Math.min(i,o-1),this.max=Math.max(i+1,o)}_getLabelBounds(){const t=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],g=t[t.length-1]),{min:n,max:g}}buildTicks(){const t=this.options,n=t.time,g=t.ticks,i=g.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const o=this.min,s=this.max,r=f1(i,o,s);return this._unit=n.unit||(g.autoSkip?yf(n.minUnit,this.min,this.max,this._getLabelCapacity(o)):wF(this,r.length,n.minUnit,this.min,this.max)),this._majorUnit=!g.major.enabled||this._unit==="year"?void 0:JF(this._unit),this.initOffsets(i),t.reverse&&r.reverse(),Bf(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,g=0,i,o;this.options.offset&&t.length&&(i=this.getDecimalForValue(t[0]),t.length===1?n=1-i:n=(this.getDecimalForValue(t[1])-i)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?g=o:g=(o-this.getDecimalForValue(t[t.length-2]))/2);const s=t.length<3?.5:.25;n=An(n,0,s),g=An(g,0,s),this._offsets={start:n,end:g,factor:1/(n+1+g)}}_generate(){const t=this._adapter,n=this.min,g=this.max,i=this.options,o=i.time,s=o.unit||yf(o.minUnit,n,g,this._getLabelCapacity(n)),r=Le(i.ticks.stepSize,1),l=s==="week"?o.isoWeekday:!1,I=Ha(l)||l===!0,a={};let C=n,c,d;if(I&&(C=+t.startOf(C,"isoWeek",l)),C=+t.startOf(C,I?"day":s),t.diff(g,n,s)>1e5*r)throw new Error(n+" and "+g+" are too far apart with stepSize of "+r+" "+s);const u=i.ticks.source==="data"&&this.getDataTimestamps();for(c=C,d=0;c<g;c=+t.add(c,r,s),d++)Gf(a,c,u);return(c===g||i.bounds==="ticks"||d===1)&&Gf(a,c,u),Object.keys(a).sort(ff).map(h=>+h)}getLabelForValue(t){const n=this._adapter,g=this.options.time;return g.tooltipFormat?n.format(t,g.tooltipFormat):n.format(t,g.displayFormats.datetime)}format(t,n){const i=this.options.time.displayFormats,o=this._unit,s=n||i[o];return this._adapter.format(t,s)}_tickFormatFunction(t,n,g,i){const o=this.options,s=o.ticks.callback;if(s)return tt(s,[t,n,g],this);const r=o.time.displayFormats,l=this._unit,I=this._majorUnit,a=l&&r[l],C=I&&r[I],c=g[n],d=I&&C&&c&&c.major;return this._adapter.format(t,i||(d?C:a))}generateTickLabels(t){let n,g,i;for(n=0,g=t.length;n<g;++n)i=t[n],i.label=this._tickFormatFunction(i.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const n=this._offsets,g=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+g)*n.factor)}getValueForPixel(t){const n=this._offsets,g=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+g*(this.max-this.min)}_getLabelSize(t){const n=this.options.ticks,g=this.ctx.measureText(t).width,i=cg(this.isHorizontal()?n.maxRotation:n.minRotation),o=Math.cos(i),s=Math.sin(i),r=this._resolveTickFontOptions(0).size;return{w:g*o+r*s,h:g*s+r*o}}_getLabelCapacity(t){const n=this.options.time,g=n.displayFormats,i=g[n.unit]||g.millisecond,o=this._tickFormatFunction(t,0,Bf(this,[t],this._majorUnit),i),s=this._getLabelSize(o),r=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return r>0?r:1}getDataTimestamps(){let t=this._cache.data||[],n,g;if(t.length)return t;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(n=0,g=i.length;n<g;++n)t=t.concat(i[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let n,g;if(t.length)return t;const i=this.getLabels();for(n=0,g=i.length;n<g;++n)t.push(Zf(this,i[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return zS(t.sort(ff))}}Se(Ta,"id","time"),Se(Ta,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function bI(e,t,n){let g=0,i=e.length-1,o,s,r,l;n?(t>=e[g].pos&&t<=e[i].pos&&({lo:g,hi:i}=yu(e,"pos",t)),{pos:o,time:r}=e[g],{pos:s,time:l}=e[i]):(t>=e[g].time&&t<=e[i].time&&({lo:g,hi:i}=yu(e,"time",t)),{time:o,pos:r}=e[g],{time:s,pos:l}=e[i]);const I=s-o;return I?r+(l-r)*(t-o)/I:r}class Sf extends Ta{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(t);this._minPos=bI(n,this.min),this._tableRange=bI(n,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:n,max:g}=this,i=[],o=[];let s,r,l,I,a;for(s=0,r=t.length;s<r;++s)I=t[s],I>=n&&I<=g&&i.push(I);if(i.length<2)return[{time:n,pos:0},{time:g,pos:1}];for(s=0,r=i.length;s<r;++s)a=i[s+1],l=i[s-1],I=i[s],Math.round((a+l)/2)!==I&&o.push({time:I,pos:s/(r-1)});return o}_generate(){const t=this.min,n=this.max;let g=super.getDataTimestamps();return(!g.includes(t)||!g.length)&&g.splice(0,0,t),(!g.includes(n)||g.length===1)&&g.push(n),g.sort((i,o)=>i-o)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const n=this.getDataTimestamps(),g=this.getLabelTimestamps();return n.length&&g.length?t=this.normalize(n.concat(g)):t=n.length?n:g,t=this._cache.all=t,t}getDecimalForValue(t){return(bI(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const n=this._offsets,g=this.getDecimalForPixel(t)/n.factor-n.end;return bI(this._table,g*this._tableRange+this._minPos,!0)}}Se(Sf,"id","timeseries"),Se(Sf,"defaults",Ta.defaults);const ZV="label";function Vf(e,t){typeof e=="function"?e(t):e&&(e.current=t)}function HF(e,t){const n=e.options;n&&t&&Object.assign(n,t)}function yV(e,t){e.labels=t}function GV(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ZV;const g=[];e.datasets=t.map(i=>{const o=e.datasets.find(s=>s[n]===i[n]);return!o||!i.data||g.includes(o)?{...i}:(g.push(o),Object.assign(o,i),o)})}function NF(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ZV;const n={labels:[],datasets:[]};return yV(n,e.labels),GV(n,e.datasets,t),n}function FF(e,t){const{height:n=150,width:g=300,redraw:i=!1,datasetIdKey:o,type:s,data:r,options:l,plugins:I=[],fallbackContent:a,updateMode:C,...c}=e,d=H.useRef(null),u=H.useRef(),h=()=>{d.current&&(u.current=new kC(d.current,{type:s,data:NF(r,o),options:l&&{...l},plugins:I}),Vf(t,u.current))},f=()=>{Vf(t,null),u.current&&(u.current.destroy(),u.current=null)};return H.useEffect(()=>{!i&&u.current&&l&&HF(u.current,l)},[i,l]),H.useEffect(()=>{!i&&u.current&&yV(u.current.config.data,r.labels)},[i,r.labels]),H.useEffect(()=>{!i&&u.current&&r.datasets&&GV(u.current.config.data,r.datasets,o)},[i,r.datasets]),H.useEffect(()=>{u.current&&(i?(f(),setTimeout(h)):u.current.update(C))},[i,l,r.labels,r.datasets,C]),H.useEffect(()=>{u.current&&(f(),setTimeout(h))},[s]),H.useEffect(()=>(h(),()=>f()),[]),sn.createElement("canvas",Object.assign({ref:d,role:"img",height:n,width:g},c),a)}const xF=H.forwardRef(FF);function BV(e,t){return kC.register(t),H.forwardRef((n,g)=>sn.createElement(xF,Object.assign({},n,{ref:g,type:e})))}const KF=BV("bar",LI),EF=BV("pie",Bu);kC.register(Ru,vu,DI,iF,cF,nF,fr);const MF=()=>{const[e,t]=H.useState([]),[n,g]=H.useState(""),[i,o]=H.useState(""),s=async(f,y)=>{const Z=localStorage.getItem("access_token");if(!Z){console.error("Token no encontrado");return}try{const p=await Je.post("https://securityflow.onrender.com/entry/by-date",{from:f,to:y},{headers:{Authorization:`Bearer ${Z}`}});t(p.data.details)}catch(p){console.error("Error fetching data:",p)}},r=()=>{if(!n||!i){alert("Por favor seleccione ambas fechas");return}s(n,i)},I=(f=>f.reduce((Z,p)=>{const B=new Date(p.date).toLocaleDateString();return Z[B]||(Z[B]=0),Z[B]++,Z},{}))(e),a={labels:Object.keys(I),datasets:[{label:"Entradas por da",data:Object.values(I),backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},C={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Entradas por da"}}},d=(f=>f.reduce((Z,p)=>(p.userEmail?Z.userEntries++:Z.anonymousEntries++,Z),{userEntries:0,anonymousEntries:0}))(e),u={labels:["Entradas de Usuario","Entradas Annimas"],datasets:[{data:[d.userEntries,d.anonymousEntries],backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)"],borderWidth:1}]},h={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Entradas Annimas vs Entradas de Usuario"}}};return G.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4",children:[G.jsx("h1",{className:"text-2xl font-bold text-center text-azul-principal m-3 font-roboto_mono",children:"Listado de Entradas"}),G.jsxs("div",{className:"flex flex-col items-center w-full",children:[G.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full max-w-4xl mb-4",children:[G.jsx("label",{htmlFor:"houseNumber",className:"text-base font-roboto_mono mb-2 md:mb-0",children:"Filtrar por fechas:"}),G.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4",children:[G.jsx("input",{type:"datetime-local",value:n,onChange:f=>g(f.target.value),className:"border p-2 rounded"}),G.jsx("input",{type:"datetime-local",value:i,onChange:f=>o(f.target.value),className:"border p-2 rounded"}),G.jsx("button",{onClick:r,className:"bg-blue-500 text-white p-2 rounded",children:"Filtrar"})]})]}),G.jsx("div",{className:"w-full max-w-4xl bg-white shadow-md rounded-lg p-4 overflow-x-auto",children:G.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[G.jsx("thead",{children:G.jsxs("tr",{children:[G.jsx("th",{className:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Casa"}),G.jsx("th",{className:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Correo electrnico"}),G.jsx("th",{className:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Documento"}),G.jsx("th",{className:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Motivo"}),G.jsx("th",{className:"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"})]})}),G.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map((f,y)=>G.jsxs("tr",{children:[G.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:f.houseName||"-"}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:f.userEmail||"-"}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:f.document||"-"}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:f.reason||"-"}),G.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(f.date).toLocaleString()})]},y))})]})}),G.jsx("div",{className:"w-full max-w-4xl bg-white shadow-md rounded-lg p-4 mt-4",children:G.jsx(KF,{data:a,options:C})}),G.jsx("div",{className:"w-full max-w-4xl bg-white shadow-md rounded-lg p-4 mt-4",children:G.jsx(EF,{data:u,options:h})})]})]})},TF=({houseNumber:e,representative:t,onGestionClick:n})=>{const g=Ei(),i=()=>{g(`/admon/gestionar/${e}`)};return G.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md w-full sm:w-96 mb-4",children:[G.jsxs("p",{className:"text-gray-700 font-roboto_mono mb-2",children:[G.jsx("span",{className:"font-bold",children:"Casa Nmero:"})," ",e]}),G.jsxs("p",{className:"text-gray-700 font-roboto_mono mb-4",children:[G.jsx("span",{className:"font-bold",children:"Representante:"})," ",t]}),G.jsx("button",{className:"bg-amarillo-principal text-black py-2 px-4 rounded-md font-roboto_mono hover:bg-yellow-600 transition duration-300",onClick:i,children:"Gestin de residentes"})]})},LF=async(e,t)=>{try{return(await Xn.post("/home/assign",{identifier:e,num_home:t})).data}catch(n){throw n}},UF=async e=>{try{return(await Xn.post("/home/add",{num_home:e})).data}catch(t){throw t}},SV=async()=>{try{return(await Xn.get("/home/list")).data}catch(e){throw e}},zF=async e=>{try{const t=await Xn.get("/home/residents",{params:{numHome:e}});return console.log("Response from /home/residents:",t.data),t.data}catch(t){throw console.error("Error in getResidentsByHome:",t),t}},DF=async(e,t,n)=>{try{return(await Xn.post("/home/changeRole",null,{params:{userId:e,newRole:t,numHome:n}})).data}catch(g){throw g}},QF=()=>{const e=Ei(),[t,n]=H.useState([]),[g,i]=H.useState(""),[o,s]=H.useState([]),[r,l]=H.useState(!0);H.useEffect(()=>{I()},[]);const I=async()=>{l(!0);try{const d=(await SV()).map(u=>({...u,representatives:u.representatives.length>0?u.representatives:["N/A"]}));n(d),s(d)}catch(c){console.error("Error fetching houses:",c)}finally{l(!1)}},a=c=>{const d=c.target.value;i(d);const u=t.filter(h=>h.numHome.toString().includes(d)||h.representatives.join(", ").toLowerCase().includes(d.toLowerCase()));s(u)},C=c=>{e(`/gestionar/${c}`)};return G.jsx("div",{className:"p-4",children:G.jsxs("div",{className:"flex flex-col items-center w-full",children:[G.jsx("h2",{className:"text-3xl font-bold text-center text-azul-principal m-2 font-roboto_mono",children:"Bsqueda de Hogar"}),G.jsx("p",{className:"text-center text-base mb-2 font-roboto_mono mt-5",children:"Ingrese nmero de casa o nombre de encargado para realizar su bsqueda"}),G.jsx("div",{className:"flex flex-col sm:flex-row justify-center items-center mt-2 w-full sm:w-auto",children:G.jsx("input",{type:"text",placeholder:"Nmero Hogar o Encargado",className:"border border-gray-300 p-2 rounded-md w-full sm:w-64",value:g,onChange:a})}),G.jsx("h2",{className:"text-3xl font-bold text-center text-azul-principal m-2 font-roboto_mono mt-7 mb-7",children:"Listado de Hogares"}),G.jsx("div",{className:"flex flex-col items-center w-full",children:r?G.jsx(al,{color:"#F8BD0D",loading:r,size:50}):o.length>0?o.map(c=>G.jsx(TF,{houseNumber:c.numHome,representative:c.representatives.join(", "),onGestionClick:C},c.numHome)):G.jsx("p",{className:"text-gray-700 font-roboto_mono mt-4",children:"No se encontraron resultados."})})]})})},Ys="/assets/profile-CXthF0zB.png",Hl=({menuItems:e})=>{const[t,n]=H.useState(!1),[g,i]=H.useState(!1),[o,s]=H.useState(Ys),[r,l]=H.useState("User"),[I,a]=H.useState(""),C=()=>{n(!t)},c=()=>{i(!g)},d=Ei();H.useEffect(()=>{const h=JSON.parse(localStorage.getItem("user"));if(h){if(h.picture&&s(h.picture),h.name){const f=h.name.split(" ")[0];l(f)}h.email&&a(h.email)}console.log("User image URL: ",h==null?void 0:h.picture)},[]);const u=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("role"),localStorage.removeItem("user"),localStorage.removeItem("picture"),d("/")};return G.jsx(G.Fragment,{children:G.jsx("nav",{className:"bg-white border-gray-200 dark:bg-gray-900",children:G.jsxs("div",{className:"max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4",children:[G.jsx("a",{href:"home",className:"flex items-center space-x-3 rtl:space-x-reverse",children:G.jsx("span",{className:"self-center text-2xl font-semibold whitespace-nowrap dark:text-white",children:"Security Flow"})}),G.jsxs("div",{className:"flex flex-row md:flex-col md:items-end md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse",children:[G.jsx("button",{type:"button",className:"flex items-center text-sm md:bg-gray-800 rounded-full md:me-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600",id:"user-picture-button","aria-expanded":t?"true":"false",onClick:C,"data-dropdown-toggle":"user-dropdown","data-dropdown-placement":"bottom",children:G.jsx("img",{className:"w-8 h-8 rounded-full object-cover",src:o,alt:"user photo",onError:()=>s(Ys)})}),t&&G.jsxs("div",{className:"z-50 absolute right-0 text-base m-10 list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600",children:[G.jsxs("div",{className:"px-3 py-3",children:[G.jsx("span",{className:"block text-sm text-gray-900 dark:text-white",children:r}),G.jsx("span",{className:"block text-sm text-gray-500 truncate dark:text-gray-400",children:I})]}),G.jsx("ul",{className:"py-1","aria-labelledby":"user-menu-button",children:G.jsx("li",{children:G.jsx("button",{onClick:u,className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white",children:"Sign out"})})})]}),G.jsx("button",{"data-collapse-toggle":"navbar-user",type:"button",className:"inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-expanded":g?"true":"false",onClick:c,children:G.jsx("svg",{className:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 14",children:G.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M1 1h15M1 7h15M1 13h15"})})}),g&&G.jsx("div",{className:"z-50 absolute right-0 text-base m-11 list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600 md:hidden",children:G.jsx("ul",{className:"py-1","aria-labelledby":"user-menu-button",children:e.map((h,f)=>G.jsx("li",{children:G.jsx("a",{href:h.url,className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white",children:h.label})},f))})})]}),G.jsx("div",{className:"items-center justify-between hidden w-full md:flex md:w-auto md:order-1",id:"navbar-user",children:G.jsx("ul",{className:"flex flex-col font-medium p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700",children:e.map((h,f)=>G.jsx("li",{children:G.jsx("a",{href:h.url,className:"text-xl block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700",children:h.label})},f))})})]})})})},jF=()=>{const[e,t]=H.useState(""),[n,g]=H.useState(""),{showPopup:i}=Og(),[o,s]=H.useState([]),[r,l]=H.useState([]);H.useEffect(()=>{(async()=>{try{const C=await SV(),c=await fu();s(C),l(c)}catch(C){i(`Error: ${C.response?C.response.data:C.message}`,!1)}})()},[]);const I=async a=>{a.preventDefault();try{if(o.some(d=>d.numHome===e)){i("Este nmero ya ha sido asignado",!1);return}const c=r.find(d=>d.email===n);if(c&&c.roles&&c.roles.length>0){i("El usuario ya tiene un rol activo",!1);return}await UF(e),await LF(n,e),i("Casa y usuario asignado con xito",!0),t(""),g("")}catch(C){i(`Error: ${C.response?C.response.data:C.message}`,!1)}};return G.jsxs("div",{className:"flex justify-center items-center h-screen flex-col w-full",children:[G.jsx("h1",{className:"text-2xl font-bold text-center text-azul-principal m-2 font-roboto_mono",children:"Asignar usuario encargado a Hogar"}),G.jsxs("div",{className:"flex flex-col mt-2 w-[150px] sm:w-[332px]",children:[G.jsx("label",{htmlFor:"houseNumber",className:"text-base m-2 font-roboto_mono",children:"Nmero de casa:"}),G.jsx("input",{type:"text",id:"houseNumber",placeholder:"Ingrese el nmero de casa",className:"border border-gray-300 p-2 rounded-md",value:e,onChange:a=>t(a.target.value)}),G.jsx("label",{htmlFor:"identifier",className:"text-base m-2 font-roboto_mono",children:"Nombre o Correo del Usuario:"}),G.jsx("input",{type:"email",id:"identifier",placeholder:"Ingrese el nombre o correo electrnico del usuario",className:"border border-gray-300 p-2 rounded-md",value:n,onChange:a=>g(a.target.value)}),G.jsx("button",{className:"bg-amarillo-principal text-black m-2 w-20 py-2 rounded-md font-roboto_mono mt-7",onClick:I,children:"Asignar Usuario"})]})]})},PF=({columnas:e,datos:t})=>G.jsxs("div",{className:"w-full h-full mt-6 mr-6 ml-auto pl-5 pr-5",children:[G.jsx("div",{className:"m-6 flex justify-center",children:G.jsx("h1",{className:"font-bold text-2xl font-roboto_mono",children:"Tabla de Residentes"})}),G.jsx("div",{className:"overflow-x-auto",children:G.jsxs("table",{className:"min-w-full divide-y border-separate border-spacing-0.5 border border-gray-500",children:[G.jsx("thead",{children:G.jsx("tr",{className:"bg-[#F8BD0D] bg-opacity-70 font-semibold font-roboto_mono",children:e.map(n=>G.jsx("th",{className:"px-4 py-2 text-center border border-gray-500",children:n.Header},n.accessor||n.Header))})}),G.jsx("tbody",{className:"text-center bg-gray-100 border-stone-500 font-roboto_mono",children:t.map((n,g)=>G.jsx("tr",{className:"hover:bg-gray-100 border-black",children:e.map(i=>G.jsx("td",{className:"border px-4 py-2 border-gray-500",children:i.accessor?n[i.accessor]||"N/A":i.Cell({row:{original:n}})},i.accessor||i.Header))},g))})]})})]}),OF=()=>{const{houseNumber:e}=lS(),[t,n]=H.useState([]),[g,i]=H.useState(!0);H.useEffect(()=>{o()},[]);const o=async()=>{try{i(!0);const l=await zF(e);n(Array.isArray(l)?l:[])}catch(l){console.error("Error fetching residents:",l),n([])}finally{i(!1)}},s=async(l,I)=>{let a;switch(I){case"RSNR":a="RSDT";break;case"RSDT":a="VSTT";break;default:a="VSTT"}try{i(!0),await DF(l,a,e),o()}catch(C){console.error("Error changing user role:",C)}finally{i(!1)}},r=[{Header:"Nombre",accessor:"username"},{Header:"Correo electrnico",accessor:"email"},{Header:"Documento",accessor:"dui"},{Header:"Rol",accessor:"role"},{Header:"Acciones",Cell:({row:l})=>G.jsx("button",{className:"bg-amarillo-principal text-black py-2 px-4 rounded-md font-roboto_mono hover:bg-yellow-600 transition duration-300",onClick:()=>s(l.original.code,l.original.role),children:"Eliminar Encargado"})}];return G.jsxs("div",{children:[G.jsxs("h1",{className:"text-3xl font-bold mb-4 text-center text-azul-claro mt-4 md:mt-8 font-roboto_mono",children:["Gestin de residentes para la casa ",e]}),g?G.jsx("div",{className:"flex justify-center items-center",children:G.jsx(al,{color:"#F8BD0D",loading:g,size:50})}):G.jsx(PF,{columnas:r,datos:t})]})},_F=()=>{const e=[{label:"Entradas",url:"/admon"},{label:"Gestionar Hogares",url:"/admon/manager"},{label:"Historial",url:"/admon/home"},{label:"Gestionar Guardias",url:"/admon/guard"}];return G.jsxs(G.Fragment,{children:[G.jsx(Hl,{menuItems:e}),G.jsxs(Ms,{children:[G.jsx(Ye,{path:"/home",element:G.jsx(QF,{})}),G.jsx(Ye,{path:"/manager",element:G.jsx(jF,{})}),G.jsx(Ye,{path:"/guard",element:G.jsx(xY,{})}),G.jsx(Ye,{path:"/",element:G.jsx(MF,{})}),G.jsx(Ye,{path:"/gestionar/:houseNumber",element:G.jsx(OF,{})}),G.jsx(Ye,{path:"/",element:G.jsx(Wi,{to:"/admon/history"})})]})]})},qF=()=>{const{showPopup:e}=Og(),[t,n]=H.useState({email:"",dates:[{date1:"",date2:"",time1:"",time2:""}]}),[g,i]=H.useState(""),[o,s]=H.useState({});H.useEffect(()=>{(async()=>{const d=localStorage.getItem("access_token");if(!d){e("Token no encontrado",!1);return}try{const u=await fetch("https://securityflow.onrender.com/user/profile",{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(u.ok){const h=await u.json();console.log("Datos del usuario:",h),i(h.home||"")}else e("Error al obtener los datos del usuario",!1)}catch{e("Error de conexin",!1)}})()},[]);const r=(c,d)=>{const{name:u,value:h}=c.target,f=[...t.dates];f[d][u]=h,n({...t,dates:f})},l=()=>{const{email:c,dates:d}=t;let u={};return c||(u.email="El correo electrnico es obligatorio"),d.forEach((h,f)=>{h.date1||(u[`date1-${f}`]="La fecha inicial es obligatoria"),h.date2||(u[`date2-${f}`]="La fecha final es obligatoria"),h.time1||(u[`time1-${f}`]="La hora inicial es obligatoria"),h.time2||(u[`time2-${f}`]="La hora final es obligatoria")}),s(u),Object.keys(u).length===0},I=()=>{n({...t,dates:[...t.dates,{date1:"",date2:"",time1:"",time2:""}]})},a=async c=>{if(c.preventDefault(),!l())return;const d=localStorage.getItem("access_token");if(!d){e("Token no encontrado",!1);return}const u=t.dates.map(y=>`${y.date1}T${y.time1}:00`),h=t.dates.map(y=>`${y.date2}T${y.time2}:00`),f={house_number:g,user_identifier:t.email,request:!1,initial_dates:u,final_dates:h};try{(await fetch("https://securityflow.onrender.com/invitation/add/multiple",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(f)})).status===201?(e("Solicitud enviada exitosamente",!0),n({email:"",dates:[{date1:"",date2:"",time1:"",time2:""}]}),s({})):e("Error al enviar la solicitud",!1)}catch{e("Error de conexin",!1)}},C=c=>{c.preventDefault(),e("Solicitud cancelada",!1)};return G.jsxs("div",{className:"flex items-center h-screen flex-col w-full font-roboto_mono",children:[G.jsx("h1",{className:"text-2xl text-[#6185A9] text-center m-2",children:"Detalles de la solicitud"}),G.jsx("h2",{className:"text-center text-xl text-[#6185A9] pb-2",children:"Acceso Frecuente"}),G.jsxs("form",{onSubmit:a,className:"max-w-md mx-auto",children:[G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Correo electrnico:"}),G.jsx("input",{type:"email",name:"email",placeholder:"Correo electrnico",className:`border ${o.email?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.email,onChange:c=>n({...t,email:c.target.value})}),o.email&&G.jsx("p",{className:"text-red-500 text-sm",children:o.email})]}),t.dates.map((c,d)=>G.jsxs("div",{children:[G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Fecha inicial de visita:"}),G.jsx("input",{type:"date",name:"date1",className:`border ${o[`date1-${d}`]?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:c.date1,onChange:u=>r(u,d)}),o[`date1-${d}`]&&G.jsx("p",{className:"text-red-500 text-sm",children:o[`date1-${d}`]})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Fecha final de visita:"}),G.jsx("input",{type:"date",name:"date2",className:`border ${o[`date2-${d}`]?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:c.date2,onChange:u=>r(u,d)}),o[`date2-${d}`]&&G.jsx("p",{className:"text-red-500 text-sm",children:o[`date2-${d}`]})]}),G.jsxs("div",{className:"flex flex-col mt-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Permiso habilitado desde:"}),G.jsx("input",{type:"time",name:"time1",className:`border ${o[`time1-${d}`]?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:c.time1,onChange:u=>r(u,d)}),o[`time1-${d}`]&&G.jsx("p",{className:"text-red-500 text-sm",children:o[`time1-${d}`]})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-8",children:[G.jsx("label",{className:"text-lg mb-2",children:"Hasta:"}),G.jsx("input",{type:"time",name:"time2",className:`border ${o[`time2-${d}`]?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:c.time2,onChange:u=>r(u,d)}),o[`time2-${d}`]&&G.jsx("p",{className:"text-red-500 text-sm",children:o[`time2-${d}`]})]})]},d)),G.jsx("div",{className:"flex justify-between mb-4",children:G.jsx("button",{type:"button",onClick:I,className:"p-2 rounded-lg bg-[#8BC34A] w-full md:w-1/2 lg:w-1/3 mx-2 transition-transform duration-150 active:scale-95 hover:scale-105",children:"agregar otro"})}),G.jsxs("div",{className:"flex justify-between",children:[G.jsx("button",{type:"submit",className:"p-2 rounded-lg bg-[#F8BD0D] bg-opacity-70 w-full md:w-1/2 lg:w-1/3 mx-2 transition-transform duration-150 active:scale-95 hover:scale-105",children:"Aceptar"}),G.jsx("button",{type:"button",className:"p-2 rounded-lg bg-[#F79E9E] w-full md:w-1/2 lg:w-1/3 mx-2 transition-transform duration-150 active:scale-95 hover:scale-105",onClick:C,children:"Cancelar"})]})]})]})},Wf="data:image/svg+xml,%3csvg%20width='34'%20height='32'%20viewBox='0%200%2034%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M17%200.5625C8.03984%200.5625%200.75%207.48785%200.75%2016C0.75%2024.5121%208.03984%2031.4375%2017%2031.4375C25.9602%2031.4375%2033.25%2024.5121%2033.25%2016C33.25%207.48785%2025.9602%200.5625%2017%200.5625ZM24.5%2017.1875H18.25V23.125H15.75V17.1875H9.5V14.8125H15.75V8.875H18.25V14.8125H24.5V17.1875Z'%20fill='black'/%3e%3c/svg%3e";var $F={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function ex(e){if(typeof e=="number")return{value:e,unit:"px"};var t,n=(e.match(/^[0-9.]*/)||"").toString();n.includes(".")?t=parseFloat(n):t=parseInt(n,10);var g=(e.match(/[^0-9]*$/)||"").toString();return $F[g]?{value:t,unit:g}:(console.warn("React Spinners: ".concat(e," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}function Rf(e){var t=ex(e);return"".concat(t.value).concat(t.unit)}var tx=function(e,t,n){var g="react-spinners-".concat(e,"-").concat(n);if(typeof window>"u"||!window.document)return g;var i=document.createElement("style");document.head.appendChild(i);var o=i.sheet,s=`
    @keyframes `.concat(g,` {
      `).concat(t,`
    }
  `);return o&&o.insertRule(s,0),g},La=function(){return La=Object.assign||function(e){for(var t,n=1,g=arguments.length;n<g;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},La.apply(this,arguments)},nx=function(e,t){var n={};for(var g in e)Object.prototype.hasOwnProperty.call(e,g)&&t.indexOf(g)<0&&(n[g]=e[g]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,g=Object.getOwnPropertySymbols(e);i<g.length;i++)t.indexOf(g[i])<0&&Object.prototype.propertyIsEnumerable.call(e,g[i])&&(n[g[i]]=e[g[i]]);return n},gx=tx("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function Nm(e){var t=e.loading,n=t===void 0?!0:t,g=e.color,i=g===void 0?"#000000":g,o=e.speedMultiplier,s=o===void 0?1:o,r=e.cssOverride,l=r===void 0?{}:r,I=e.size,a=I===void 0?35:I,C=nx(e,["loading","color","speedMultiplier","cssOverride","size"]),c=La({background:"transparent !important",width:Rf(a),height:Rf(a),borderRadius:"100%",border:"2px solid",borderTopColor:i,borderBottomColor:"transparent",borderLeftColor:i,borderRightColor:i,display:"inline-block",animation:"".concat(gx," ").concat(.75/s,"s 0s infinite linear"),animationFillMode:"both"},l);return n?H.createElement("span",La({style:c},C)):null}const VV=H.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),wC=H.createContext({}),Fm=H.createContext(null),xm=typeof document<"u",ix=xm?H.useLayoutEffect:H.useEffect,WV=H.createContext({strict:!1}),Km=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ox="framerAppearId",RV="data-"+Km(ox),sx={skipAnimations:!1,useManualTiming:!1};class vf{constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const n=this.order.indexOf(t);n!==-1&&(this.order.splice(n,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function rx(e){let t=new vf,n=new vf,g=0,i=!1,o=!1;const s=new WeakSet,r={schedule:(l,I=!1,a=!1)=>{const C=a&&i,c=C?t:n;return I&&s.add(l),c.add(l)&&C&&i&&(g=t.order.length),l},cancel:l=>{n.remove(l),s.delete(l)},process:l=>{if(i){o=!0;return}if(i=!0,[t,n]=[n,t],n.clear(),g=t.order.length,g)for(let I=0;I<g;I++){const a=t.order[I];s.has(a)&&(r.schedule(a),e()),a(l)}i=!1,o&&(o=!1,r.process(l))}};return r}const pI=["read","resolveKeyframes","update","preRender","render","postRender"],lx=40;function vV(e,t){let n=!1,g=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=pI.reduce((C,c)=>(C[c]=rx(()=>n=!0),C),{}),s=C=>{o[C].process(i)},r=()=>{const C=performance.now();n=!1,i.delta=g?1e3/60:Math.max(Math.min(C-i.timestamp,lx),1),i.timestamp=C,i.isProcessing=!0,pI.forEach(s),i.isProcessing=!1,n&&t&&(g=!1,e(r))},l=()=>{n=!0,g=!0,i.isProcessing||e(r)};return{schedule:pI.reduce((C,c)=>{const d=o[c];return C[c]=(u,h=!1,f=!1)=>(n||l(),d.schedule(u,h,f)),C},{}),cancel:C=>pI.forEach(c=>o[c].cancel(C)),state:i,steps:o}}const{schedule:Em,cancel:nL}=vV(queueMicrotask,!1);function Cs(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}const kV=H.createContext({});let kf=!1;function Ix(e,t,n,g,i){const{visualElement:o}=H.useContext(wC),s=H.useContext(WV),r=H.useContext(Fm),l=H.useContext(VV).reducedMotion,I=H.useRef();g=g||s.renderer,!I.current&&g&&(I.current=g(e,{visualState:t,parent:o,props:n,presenceContext:r,blockInitialAnimation:r?r.initial===!1:!1,reducedMotionConfig:l}));const a=I.current,C=H.useContext(kV);a&&!a.projection&&i&&(a.type==="html"||a.type==="svg")&&Cx(I.current,n,i,C),H.useInsertionEffect(()=>{a&&a.update(n,r)});const c=H.useRef(!!(n[RV]&&!window.HandoffComplete));return ix(()=>{a&&(a.updateFeatures(),Em.render(a.render),c.current&&a.animationState&&a.animationState.animateChanges())}),H.useEffect(()=>{a&&(!c.current&&a.animationState&&a.animationState.animateChanges(),c.current&&(c.current=!1,kf||(kf=!0,queueMicrotask(ax))))}),a}function ax(){window.HandoffComplete=!0}function Cx(e,t,n,g){const{layoutId:i,layout:o,drag:s,dragConstraints:r,layoutScroll:l,layoutRoot:I}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:XV(e.parent)),e.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:!!s||r&&Cs(r),visualElement:e,scheduleRender:()=>e.scheduleRender(),animationType:typeof o=="string"?o:"both",initialPromotionConfig:g,layoutScroll:l,layoutRoot:I})}function XV(e){if(e)return e.options.allowProjection!==!1?e.projection:XV(e.parent)}function cx(e,t,n){return H.useCallback(g=>{g&&e.mount&&e.mount(g),t&&(g?t.mount(g):t.unmount()),n&&(typeof n=="function"?n(g):Cs(n)&&(n.current=g))},[t])}function ml(e){return typeof e=="string"||Array.isArray(e)}function JC(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const Mm=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Tm=["initial",...Mm];function YC(e){return JC(e.animate)||Tm.some(t=>ml(e[t]))}function wV(e){return!!(YC(e)||e.variants)}function dx(e,t){if(YC(e)){const{initial:n,animate:g}=e;return{initial:n===!1||ml(n)?n:void 0,animate:ml(g)?g:void 0}}return e.inherit!==!1?t:{}}function ux(e){const{initial:t,animate:n}=dx(e,H.useContext(wC));return H.useMemo(()=>({initial:t,animate:n}),[Xf(t),Xf(n)])}function Xf(e){return Array.isArray(e)?e.join(" "):e}const wf={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Hs={};for(const e in wf)Hs[e]={isEnabled:t=>wf[e].some(n=>!!t[n])};function Ax(e){for(const t in e)Hs[t]={...Hs[t],...e[t]}}const JV=H.createContext({}),hx=Symbol.for("motionComponentSymbol"),qt=e=>e;let Xu=qt;function mx({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:g,Component:i}){e&&Ax(e);function o(r,l){let I;const a={...H.useContext(VV),...r,layoutId:bx(r)},{isStatic:C}=a,c=ux(r),d=g(r,C);if(!C&&xm){px();const u=fx(a);I=u.MeasureLayout,c.visualElement=Ix(i,d,a,t,u.ProjectionNode)}return G.jsxs(wC.Provider,{value:c,children:[I&&c.visualElement?G.jsx(I,{visualElement:c.visualElement,...a}):null,n(i,r,cx(d,c.visualElement,l),d,C,c.visualElement)]})}const s=H.forwardRef(o);return s[hx]=i,s}function bx({layoutId:e}){const t=H.useContext(JV).id;return t&&e!==void 0?t+"-"+e:e}function px(e,t){H.useContext(WV).strict}function fx(e){const{drag:t,layout:n}=Hs;if(!t&&!n)return{};const g={...t,...n};return{MeasureLayout:t!=null&&t.isEnabled(e)||n!=null&&n.isEnabled(e)?g.MeasureLayout:void 0,ProjectionNode:g.ProjectionNode}}function Zx(e){function t(g,i={}){return mx(e(g,i))}if(typeof Proxy>"u")return t;const n=new Map;return new Proxy(t,{get:(g,i)=>(n.has(i)||n.set(i,t(i)),n.get(i))})}const yx=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Lm(e){return typeof e!="string"||e.includes("-")?!1:!!(yx.indexOf(e)>-1||/[A-Z]/u.test(e))}const Ua={};function Gx(e){Object.assign(Ua,e)}const Nl=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Mo=new Set(Nl);function YV(e,{layout:t,layoutId:n}){return Mo.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!Ua[e]||e==="opacity")}const _t=e=>!!(e&&e.getVelocity),Bx={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Sx=Nl.length;function Vx(e,{enableHardwareAcceleration:t=!0,allowTransformNone:n=!0},g,i){let o="";for(let s=0;s<Sx;s++){const r=Nl[s];if(e[r]!==void 0){const l=Bx[r]||r;o+=`${l}(${e[r]}) `}}return t&&!e.z&&(o+="translateZ(0)"),o=o.trim(),i?o=i(e,g?"":o):n&&g&&(o="none"),o}const HV=e=>t=>typeof t=="string"&&t.startsWith(e),NV=HV("--"),Wx=HV("var(--"),Um=e=>Wx(e)?Rx.test(e.split("/*")[0].trim()):!1,Rx=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,vx=(e,t)=>t&&typeof e=="number"?t.transform(e):e,Hi=(e,t,n)=>n>t?t:n<e?e:n,Us={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},xr={...Us,transform:e=>Hi(0,1,e)},fI={...Us,default:1},Kr=e=>Math.round(e*1e5)/1e5,zm=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,kx=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,Xx=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function Fl(e){return typeof e=="string"}function Jx(e){return e==null}const xl=e=>({test:t=>Fl(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),gi=xl("deg"),mg=xl("%"),ke=xl("px"),Yx=xl("vh"),Hx=xl("vw"),Jf={...mg,parse:e=>mg.parse(e)/100,transform:e=>mg.transform(e*100)},Yf={...Us,transform:Math.round},FV={borderWidth:ke,borderTopWidth:ke,borderRightWidth:ke,borderBottomWidth:ke,borderLeftWidth:ke,borderRadius:ke,radius:ke,borderTopLeftRadius:ke,borderTopRightRadius:ke,borderBottomRightRadius:ke,borderBottomLeftRadius:ke,width:ke,maxWidth:ke,height:ke,maxHeight:ke,size:ke,top:ke,right:ke,bottom:ke,left:ke,padding:ke,paddingTop:ke,paddingRight:ke,paddingBottom:ke,paddingLeft:ke,margin:ke,marginTop:ke,marginRight:ke,marginBottom:ke,marginLeft:ke,rotate:gi,rotateX:gi,rotateY:gi,rotateZ:gi,scale:fI,scaleX:fI,scaleY:fI,scaleZ:fI,skew:gi,skewX:gi,skewY:gi,distance:ke,translateX:ke,translateY:ke,translateZ:ke,x:ke,y:ke,z:ke,perspective:ke,transformPerspective:ke,opacity:xr,originX:Jf,originY:Jf,originZ:ke,zIndex:Yf,backgroundPositionX:ke,backgroundPositionY:ke,fillOpacity:xr,strokeOpacity:xr,numOctaves:Yf};function Dm(e,t,n,g){const{style:i,vars:o,transform:s,transformOrigin:r}=e;let l=!1,I=!1,a=!0;for(const C in t){const c=t[C];if(NV(C)){o[C]=c;continue}const d=FV[C],u=vx(c,d);if(Mo.has(C)){if(l=!0,s[C]=u,!a)continue;c!==(d.default||0)&&(a=!1)}else C.startsWith("origin")?(I=!0,r[C]=u):i[C]=u}if(t.transform||(l||g?i.transform=Vx(e.transform,n,a,g):i.transform&&(i.transform="none")),I){const{originX:C="50%",originY:c="50%",originZ:d=0}=r;i.transformOrigin=`${C} ${c} ${d}`}}const Qm=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function xV(e,t,n){for(const g in t)!_t(t[g])&&!YV(g,n)&&(e[g]=t[g])}function Nx({transformTemplate:e},t,n){return H.useMemo(()=>{const g=Qm();return Dm(g,t,{enableHardwareAcceleration:!n},e),Object.assign({},g.vars,g.style)},[t])}function Fx(e,t,n){const g=e.style||{},i={};return xV(i,g,e),Object.assign(i,Nx(e,t,n)),i}function xx(e,t,n){const g={},i=Fx(e,t,n);return e.drag&&e.dragListener!==!1&&(g.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(g.tabIndex=0),g.style=i,g}const Kx=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function za(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Kx.has(e)}let KV=e=>!za(e);function Ex(e){e&&(KV=t=>t.startsWith("on")?!za(t):e(t))}try{Ex(require("@emotion/is-prop-valid").default)}catch{}function Mx(e,t,n){const g={};for(const i in e)i==="values"&&typeof e.values=="object"||(KV(i)||n===!0&&za(i)||!t&&!za(i)||e.draggable&&i.startsWith("onDrag"))&&(g[i]=e[i]);return g}function Hf(e,t,n){return typeof e=="string"?e:ke.transform(t+n*e)}function Tx(e,t,n){const g=Hf(t,e.x,e.width),i=Hf(n,e.y,e.height);return`${g} ${i}`}const Lx={offset:"stroke-dashoffset",array:"stroke-dasharray"},Ux={offset:"strokeDashoffset",array:"strokeDasharray"};function zx(e,t,n=1,g=0,i=!0){e.pathLength=1;const o=i?Lx:Ux;e[o.offset]=ke.transform(-g);const s=ke.transform(t),r=ke.transform(n);e[o.array]=`${s} ${r}`}function jm(e,{attrX:t,attrY:n,attrScale:g,originX:i,originY:o,pathLength:s,pathSpacing:r=1,pathOffset:l=0,...I},a,C,c){if(Dm(e,I,a,c),C){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:d,style:u,dimensions:h}=e;d.transform&&(h&&(u.transform=d.transform),delete d.transform),h&&(i!==void 0||o!==void 0||u.transform)&&(u.transformOrigin=Tx(h,i!==void 0?i:.5,o!==void 0?o:.5)),t!==void 0&&(d.x=t),n!==void 0&&(d.y=n),g!==void 0&&(d.scale=g),s!==void 0&&zx(d,s,r,l,!1)}const EV=()=>({...Qm(),attrs:{}}),Pm=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Dx(e,t,n,g){const i=H.useMemo(()=>{const o=EV();return jm(o,t,{enableHardwareAcceleration:!1},Pm(g),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};xV(o,e.style,e),i.style={...o,...i.style}}return i}function Qx(e=!1){return(n,g,i,{latestValues:o},s)=>{const l=(Lm(n)?Dx:xx)(g,o,s,n),I=Mx(g,typeof n=="string",e),a=n!==H.Fragment?{...I,...l,ref:i}:{},{children:C}=g,c=H.useMemo(()=>_t(C)?C.get():C,[C]);return H.createElement(n,{...a,children:c})}}function MV(e,{style:t,vars:n},g,i){Object.assign(e.style,t,i&&i.getProjectionStyles(g));for(const o in n)e.style.setProperty(o,n[o])}const TV=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function LV(e,t,n,g){MV(e,t,void 0,g);for(const i in t.attrs)e.setAttribute(TV.has(i)?i:Km(i),t.attrs[i])}function Om(e,t,n){var g;const{style:i}=e,o={};for(const s in i)(_t(i[s])||t.style&&_t(t.style[s])||YV(s,e)||((g=n==null?void 0:n.getValue(s))===null||g===void 0?void 0:g.liveStyle)!==void 0)&&(o[s]=i[s]);return o}function UV(e,t,n){const g=Om(e,t,n);for(const i in e)if(_t(e[i])||_t(t[i])){const o=Nl.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;g[o]=e[i]}return g}function Nf(e){const t=[{},{}];return e==null||e.values.forEach((n,g)=>{t[0][g]=n.get(),t[1][g]=n.getVelocity()}),t}function _m(e,t,n,g){if(typeof t=="function"){const[i,o]=Nf(g);t=t(n!==void 0?n:e.custom,i,o)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[i,o]=Nf(g);t=t(n!==void 0?n:e.custom,i,o)}return t}function jx(e){const t=H.useRef(null);return t.current===null&&(t.current=e()),t.current}const wu=e=>Array.isArray(e),Px=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),Ox=e=>wu(e)?e[e.length-1]||0:e;function QI(e){const t=_t(e)?e.get():e;return Px(t)?t.toValue():t}function _x({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:n},g,i,o){const s={latestValues:qx(g,i,o,e),renderState:t()};return n&&(s.mount=r=>n(g,r,s)),s}const zV=e=>(t,n)=>{const g=H.useContext(wC),i=H.useContext(Fm),o=()=>_x(e,t,g,i);return n?o():jx(o)};function qx(e,t,n,g){const i={},o=g(e,{});for(const c in o)i[c]=QI(o[c]);let{initial:s,animate:r}=e;const l=YC(e),I=wV(e);t&&I&&!l&&e.inherit!==!1&&(s===void 0&&(s=t.initial),r===void 0&&(r=t.animate));let a=n?n.initial===!1:!1;a=a||s===!1;const C=a?r:s;return C&&typeof C!="boolean"&&!JC(C)&&(Array.isArray(C)?C:[C]).forEach(d=>{const u=_m(e,d);if(!u)return;const{transitionEnd:h,transition:f,...y}=u;for(const Z in y){let p=y[Z];if(Array.isArray(p)){const B=a?p.length-1:0;p=p[B]}p!==null&&(i[Z]=p)}for(const Z in h)i[Z]=h[Z]}),i}const{schedule:Qe,cancel:Ug,state:Kt,steps:Uc}=vV(typeof requestAnimationFrame<"u"?requestAnimationFrame:qt,!0),$x={useVisualState:zV({scrapeMotionValuesFromProps:UV,createRenderState:EV,onMount:(e,t,{renderState:n,latestValues:g})=>{Qe.read(()=>{try{n.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),Qe.render(()=>{jm(n,g,{enableHardwareAcceleration:!1},Pm(t.tagName),e.transformTemplate),LV(t,n)})}})},eK={useVisualState:zV({scrapeMotionValuesFromProps:Om,createRenderState:Qm})};function tK(e,{forwardMotionProps:t=!1},n,g){return{...Lm(e)?$x:eK,preloadedFeatures:n,useRender:Qx(t),createVisualElement:g,Component:e}}function Jg(e,t,n,g={passive:!0}){return e.addEventListener(t,n,g),()=>e.removeEventListener(t,n)}const DV=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function HC(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const nK=e=>t=>DV(t)&&e(t,HC(t));function Fg(e,t,n,g){return Jg(e,t,nK(n),g)}const gK=(e,t)=>n=>t(e(n)),xg=(...e)=>e.reduce(gK);function QV(e){let t=null;return()=>{const n=()=>{t=null};return t===null?(t=e,n):!1}}const Ff=QV("dragHorizontal"),xf=QV("dragVertical");function jV(e){let t=!1;if(e==="y")t=xf();else if(e==="x")t=Ff();else{const n=Ff(),g=xf();n&&g?t=()=>{n(),g()}:(n&&n(),g&&g())}return t}function PV(){const e=jV(!0);return e?(e(),!1):!0}class Mi{constructor(t){this.isMounted=!1,this.node=t}update(){}}function Kf(e,t){const n=t?"pointerenter":"pointerleave",g=t?"onHoverStart":"onHoverEnd",i=(o,s)=>{if(o.pointerType==="touch"||PV())return;const r=e.getProps();e.animationState&&r.whileHover&&e.animationState.setActive("whileHover",t);const l=r[g];l&&Qe.postRender(()=>l(o,s))};return Fg(e.current,n,i,{passive:!e.getProps()[g]})}class iK extends Mi{mount(){this.unmount=xg(Kf(this.node,!0),Kf(this.node,!1))}unmount(){}}class oK extends Mi{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=xg(Jg(this.node.current,"focus",()=>this.onFocus()),Jg(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const OV=(e,t)=>t?e===t?!0:OV(e,t.parentElement):!1;function zc(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,HC(n))}class sK extends Mi{constructor(){super(...arguments),this.removeStartListeners=qt,this.removeEndListeners=qt,this.removeAccessibleListeners=qt,this.startPointerPress=(t,n)=>{if(this.isPressing)return;this.removeEndListeners();const g=this.node.getProps(),o=Fg(window,"pointerup",(r,l)=>{if(!this.checkPressEnd())return;const{onTap:I,onTapCancel:a,globalTapTarget:C}=this.node.getProps(),c=!C&&!OV(this.node.current,r.target)?a:I;c&&Qe.update(()=>c(r,l))},{passive:!(g.onTap||g.onPointerUp)}),s=Fg(window,"pointercancel",(r,l)=>this.cancelPress(r,l),{passive:!(g.onTapCancel||g.onPointerCancel)});this.removeEndListeners=xg(o,s),this.startPress(t,n)},this.startAccessiblePress=()=>{const t=o=>{if(o.key!=="Enter"||this.isPressing)return;const s=r=>{r.key!=="Enter"||!this.checkPressEnd()||zc("up",(l,I)=>{const{onTap:a}=this.node.getProps();a&&Qe.postRender(()=>a(l,I))})};this.removeEndListeners(),this.removeEndListeners=Jg(this.node.current,"keyup",s),zc("down",(r,l)=>{this.startPress(r,l)})},n=Jg(this.node.current,"keydown",t),g=()=>{this.isPressing&&zc("cancel",(o,s)=>this.cancelPress(o,s))},i=Jg(this.node.current,"blur",g);this.removeAccessibleListeners=xg(n,i)}}startPress(t,n){this.isPressing=!0;const{onTapStart:g,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),g&&Qe.postRender(()=>g(t,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!PV()}cancelPress(t,n){if(!this.checkPressEnd())return;const{onTapCancel:g}=this.node.getProps();g&&Qe.postRender(()=>g(t,n))}mount(){const t=this.node.getProps(),n=Fg(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),g=Jg(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=xg(n,g)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Ju=new WeakMap,Dc=new WeakMap,rK=e=>{const t=Ju.get(e.target);t&&t(e)},lK=e=>{e.forEach(rK)};function IK({root:e,...t}){const n=e||document;Dc.has(n)||Dc.set(n,{});const g=Dc.get(n),i=JSON.stringify(t);return g[i]||(g[i]=new IntersectionObserver(lK,{root:e,...t})),g[i]}function aK(e,t,n){const g=IK(t);return Ju.set(e,n),g.observe(e),()=>{Ju.delete(e),g.unobserve(e)}}const CK={some:0,all:1};class cK extends Mi{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:g,amount:i="some",once:o}=t,s={root:n?n.current:void 0,rootMargin:g,threshold:typeof i=="number"?i:CK[i]},r=l=>{const{isIntersecting:I}=l;if(this.isInView===I||(this.isInView=I,o&&!I&&this.hasEnteredView))return;I&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",I);const{onViewportEnter:a,onViewportLeave:C}=this.node.getProps(),c=I?a:C;c&&c(l)};return aK(this.node.current,s,r)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(dK(t,n))&&this.startObserver()}unmount(){}}function dK({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const uK={inView:{Feature:cK},tap:{Feature:sK},focus:{Feature:oK},hover:{Feature:iK}};function _V(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let g=0;g<n;g++)if(t[g]!==e[g])return!1;return!0}function NC(e,t,n){const g=e.getProps();return _m(g,t,n!==void 0?n:g.custom,e)}const ki=e=>e*1e3,Kg=e=>e/1e3,AK={type:"spring",stiffness:500,damping:25,restSpeed:10},hK=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),mK={type:"keyframes",duration:.8},bK={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},pK=(e,{keyframes:t})=>t.length>2?mK:Mo.has(e)?e.startsWith("scale")?hK(t[1]):AK:bK;function fK({when:e,delay:t,delayChildren:n,staggerChildren:g,staggerDirection:i,repeat:o,repeatType:s,repeatDelay:r,from:l,elapsed:I,...a}){return!!Object.keys(a).length}function qm(e,t){return e[t]||e.default||e}const ZK=e=>e!==null;function FC(e,{repeat:t,repeatType:n="loop"},g){const i=e.filter(ZK),o=t&&n!=="loop"&&t%2===1?0:i.length-1;return!o||g===void 0?i[o]:g}let jI;function yK(){jI=void 0}const Xi={now:()=>(jI===void 0&&Xi.set(Kt.isProcessing||sx.useManualTiming?Kt.timestamp:performance.now()),jI),set:e=>{jI=e,queueMicrotask(yK)}},qV=e=>/^0[^.\s]+$/u.test(e);function GK(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||qV(e):!0}const $V=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),BK=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function SK(e){const t=BK.exec(e);if(!t)return[,];const[,n,g,i]=t;return[`--${n??g}`,i]}function eW(e,t,n=1){const[g,i]=SK(e);if(!g)return;const o=window.getComputedStyle(t).getPropertyValue(g);if(o){const s=o.trim();return $V(s)?parseFloat(s):s}return Um(i)?eW(i,t,n+1):i}const VK=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Ef=e=>e===Us||e===ke,Mf=(e,t)=>parseFloat(e.split(", ")[t]),Tf=(e,t)=>(n,{transform:g})=>{if(g==="none"||!g)return 0;const i=g.match(/^matrix3d\((.+)\)$/u);if(i)return Mf(i[1],t);{const o=g.match(/^matrix\((.+)\)$/u);return o?Mf(o[1],e):0}},WK=new Set(["x","y","z"]),RK=Nl.filter(e=>!WK.has(e));function vK(e){const t=[];return RK.forEach(n=>{const g=e.getValue(n);g!==void 0&&(t.push([n,g.get()]),g.set(n.startsWith("scale")?1:0))}),t}const Ns={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Tf(4,13),y:Tf(5,14)};Ns.translateX=Ns.x;Ns.translateY=Ns.y;const tW=e=>t=>t.test(e),kK={test:e=>e==="auto",parse:e=>e},nW=[Us,ke,mg,gi,Hx,Yx,kK],Lf=e=>nW.find(tW(e)),Zo=new Set;let Yu=!1,Hu=!1;function gW(){if(Hu){const e=Array.from(Zo).filter(g=>g.needsMeasurement),t=new Set(e.map(g=>g.element)),n=new Map;t.forEach(g=>{const i=vK(g);i.length&&(n.set(g,i),g.render())}),e.forEach(g=>g.measureInitialState()),t.forEach(g=>{g.render();const i=n.get(g);i&&i.forEach(([o,s])=>{var r;(r=g.getValue(o))===null||r===void 0||r.set(s)})}),e.forEach(g=>g.measureEndState()),e.forEach(g=>{g.suspendedScrollY!==void 0&&window.scrollTo(0,g.suspendedScrollY)})}Hu=!1,Yu=!1,Zo.forEach(e=>e.complete()),Zo.clear()}function iW(){Zo.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Hu=!0)})}function XK(){iW(),gW()}class $m{constructor(t,n,g,i,o,s=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=g,this.motionValue=i,this.element=o,this.isAsync=s}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Zo.add(this),Yu||(Yu=!0,Qe.read(iW),Qe.resolveKeyframes(gW))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:g,motionValue:i}=this;for(let o=0;o<t.length;o++)if(t[o]===null)if(o===0){const s=i==null?void 0:i.get(),r=t[t.length-1];if(s!==void 0)t[0]=s;else if(g&&n){const l=g.readValue(n,r);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=r),i&&s===void 0&&i.set(t[0])}else t[o]=t[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Zo.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Zo.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const eb=(e,t)=>n=>!!(Fl(n)&&Xx.test(n)&&n.startsWith(e)||t&&!Jx(n)&&Object.prototype.hasOwnProperty.call(n,t)),oW=(e,t,n)=>g=>{if(!Fl(g))return g;const[i,o,s,r]=g.match(zm);return{[e]:parseFloat(i),[t]:parseFloat(o),[n]:parseFloat(s),alpha:r!==void 0?parseFloat(r):1}},wK=e=>Hi(0,255,e),Qc={...Us,transform:e=>Math.round(wK(e))},Co={test:eb("rgb","red"),parse:oW("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:g=1})=>"rgba("+Qc.transform(e)+", "+Qc.transform(t)+", "+Qc.transform(n)+", "+Kr(xr.transform(g))+")"};function JK(e){let t="",n="",g="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),g=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),g=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,g+=g,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(g,16),alpha:i?parseInt(i,16)/255:1}}const Nu={test:eb("#"),parse:JK,transform:Co.transform},cs={test:eb("hsl","hue"),parse:oW("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:g=1})=>"hsla("+Math.round(e)+", "+mg.transform(Kr(t))+", "+mg.transform(Kr(n))+", "+Kr(xr.transform(g))+")"},Pt={test:e=>Co.test(e)||Nu.test(e)||cs.test(e),parse:e=>Co.test(e)?Co.parse(e):cs.test(e)?cs.parse(e):Nu.parse(e),transform:e=>Fl(e)?e:e.hasOwnProperty("red")?Co.transform(e):cs.transform(e)};function YK(e){var t,n;return isNaN(e)&&Fl(e)&&(((t=e.match(zm))===null||t===void 0?void 0:t.length)||0)+(((n=e.match(kx))===null||n===void 0?void 0:n.length)||0)>0}const sW="number",rW="color",HK="var",NK="var(",Uf="${}",FK=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function bl(e){const t=e.toString(),n=[],g={color:[],number:[],var:[]},i=[];let o=0;const r=t.replace(FK,l=>(Pt.test(l)?(g.color.push(o),i.push(rW),n.push(Pt.parse(l))):l.startsWith(NK)?(g.var.push(o),i.push(HK),n.push(l)):(g.number.push(o),i.push(sW),n.push(parseFloat(l))),++o,Uf)).split(Uf);return{values:n,split:r,indexes:g,types:i}}function lW(e){return bl(e).values}function IW(e){const{split:t,types:n}=bl(e),g=t.length;return i=>{let o="";for(let s=0;s<g;s++)if(o+=t[s],i[s]!==void 0){const r=n[s];r===sW?o+=Kr(i[s]):r===rW?o+=Pt.transform(i[s]):o+=i[s]}return o}}const xK=e=>typeof e=="number"?0:e;function KK(e){const t=lW(e);return IW(e)(t.map(xK))}const Ni={test:YK,parse:lW,createTransformer:IW,getAnimatableNone:KK},EK=new Set(["brightness","contrast","saturate","opacity"]);function MK(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[g]=n.match(zm)||[];if(!g)return e;const i=n.replace(g,"");let o=EK.has(t)?1:0;return g!==n&&(o*=100),t+"("+o+i+")"}const TK=/\b([a-z-]*)\(.*?\)/gu,Fu={...Ni,getAnimatableNone:e=>{const t=e.match(TK);return t?t.map(MK).join(" "):e}},LK={...FV,color:Pt,backgroundColor:Pt,outlineColor:Pt,fill:Pt,stroke:Pt,borderColor:Pt,borderTopColor:Pt,borderRightColor:Pt,borderBottomColor:Pt,borderLeftColor:Pt,filter:Fu,WebkitFilter:Fu},tb=e=>LK[e];function aW(e,t){let n=tb(e);return n!==Fu&&(n=Ni),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const UK=new Set(["auto","none","0"]);function zK(e,t,n){let g=0,i;for(;g<e.length&&!i;){const o=e[g];typeof o=="string"&&!UK.has(o)&&bl(o).values.length&&(i=e[g]),g++}if(i&&n)for(const o of t)e[o]=aW(n,i)}class CW extends $m{constructor(t,n,g,i){super(t,n,g,i,i==null?void 0:i.owner,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:g}=this;if(!n.current)return;super.readKeyframes();for(let l=0;l<t.length;l++){let I=t[l];if(typeof I=="string"&&(I=I.trim(),Um(I))){const a=eW(I,n.current);a!==void 0&&(t[l]=a),l===t.length-1&&(this.finalKeyframe=I)}}if(this.resolveNoneKeyframes(),!VK.has(g)||t.length!==2)return;const[i,o]=t,s=Lf(i),r=Lf(o);if(s!==r)if(Ef(s)&&Ef(r))for(let l=0;l<t.length;l++){const I=t[l];typeof I=="string"&&(t[l]=parseFloat(I))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,g=[];for(let i=0;i<t.length;i++)GK(t[i])&&g.push(i);g.length&&zK(t,g,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:g}=this;if(!t.current)return;g==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ns[g](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const i=n[n.length-1];i!==void 0&&t.getValue(g,i).jump(i,!1)}measureEndState(){var t;const{element:n,name:g,unresolvedKeyframes:i}=this;if(!n.current)return;const o=n.getValue(g);o&&o.jump(this.measuredOrigin,!1);const s=i.length-1,r=i[s];i[s]=Ns[g](n.measureViewportBox(),window.getComputedStyle(n.current)),r!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=r),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([l,I])=>{n.getValue(l).set(I)}),this.resolveNoneKeyframes()}}function cW(e){let t;return()=>(t===void 0&&(t=e()),t)}const zf=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Ni.test(e)||e==="0")&&!e.startsWith("url("));function DK(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function QK(e,t,n,g){const i=e[0];if(i===null)return!1;if(t==="display"||t==="visibility")return!0;const o=e[e.length-1],s=zf(i,t),r=zf(o,t);return!s||!r?!1:DK(e)||n==="spring"&&g}class dW{constructor({autoplay:t=!0,delay:n=0,type:g="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:s="loop",...r}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:t,delay:n,type:g,repeat:i,repeatDelay:o,repeatType:s,...r},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&XK(),this._resolved}onKeyframesResolved(t,n){this.hasAttemptedResolve=!0;const{name:g,type:i,velocity:o,delay:s,onComplete:r,onUpdate:l,isGenerator:I}=this.options;if(!I&&!QK(t,g,i,o))if(s)this.options.duration=0;else{l==null||l(FC(t,this.options,n)),r==null||r(),this.resolveFinishedPromise();return}const a=this.initPlayback(t,n);a!==!1&&(this._resolved={keyframes:t,finalKeyframe:n,...a},this.onPostResolved())}onPostResolved(){}then(t,n){return this.currentFinishedPromise.then(t,n)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function uW(e,t){return t?e*(1e3/t):0}const jK=5;function AW(e,t,n){const g=Math.max(t-jK,0);return uW(n-e(g),t-g)}const jc=.001,PK=.01,OK=10,_K=.05,qK=1;function $K({duration:e=800,bounce:t=.25,velocity:n=0,mass:g=1}){let i,o,s=1-t;s=Hi(_K,qK,s),e=Hi(PK,OK,Kg(e)),s<1?(i=I=>{const a=I*s,C=a*e,c=a-n,d=xu(I,s),u=Math.exp(-C);return jc-c/d*u},o=I=>{const C=I*s*e,c=C*n+n,d=Math.pow(s,2)*Math.pow(I,2)*e,u=Math.exp(-C),h=xu(Math.pow(I,2),s);return(-i(I)+jc>0?-1:1)*((c-d)*u)/h}):(i=I=>{const a=Math.exp(-I*e),C=(I-n)*e+1;return-jc+a*C},o=I=>{const a=Math.exp(-I*e),C=(n-I)*(e*e);return a*C});const r=5/e,l=t9(i,o,r);if(e=ki(e),isNaN(l))return{stiffness:100,damping:10,duration:e};{const I=Math.pow(l,2)*g;return{stiffness:I,damping:s*2*Math.sqrt(g*I),duration:e}}}const e9=12;function t9(e,t,n){let g=n;for(let i=1;i<e9;i++)g=g-e(g)/t(g);return g}function xu(e,t){return e*Math.sqrt(1-t*t)}const n9=["duration","bounce"],g9=["stiffness","damping","mass"];function Df(e,t){return t.some(n=>e[n]!==void 0)}function i9(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!Df(e,g9)&&Df(e,n9)){const n=$K(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}function hW({keyframes:e,restDelta:t,restSpeed:n,...g}){const i=e[0],o=e[e.length-1],s={done:!1,value:i},{stiffness:r,damping:l,mass:I,duration:a,velocity:C,isResolvedFromDuration:c}=i9({...g,velocity:-Kg(g.velocity||0)}),d=C||0,u=l/(2*Math.sqrt(r*I)),h=o-i,f=Kg(Math.sqrt(r/I)),y=Math.abs(h)<5;n||(n=y?.01:2),t||(t=y?.005:.5);let Z;if(u<1){const p=xu(f,u);Z=B=>{const W=Math.exp(-u*f*B);return o-W*((d+u*f*h)/p*Math.sin(p*B)+h*Math.cos(p*B))}}else if(u===1)Z=p=>o-Math.exp(-f*p)*(h+(d+f*h)*p);else{const p=f*Math.sqrt(u*u-1);Z=B=>{const W=Math.exp(-u*f*B),S=Math.min(p*B,300);return o-W*((d+u*f*h)*Math.sinh(S)+p*h*Math.cosh(S))/p}}return{calculatedDuration:c&&a||null,next:p=>{const B=Z(p);if(c)s.done=p>=a;else{let W=d;p!==0&&(u<1?W=AW(Z,p,B):W=0);const S=Math.abs(W)<=n,V=Math.abs(o-B)<=t;s.done=S&&V}return s.value=s.done?o:B,s}}}function Qf({keyframes:e,velocity:t=0,power:n=.8,timeConstant:g=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:s,min:r,max:l,restDelta:I=.5,restSpeed:a}){const C=e[0],c={done:!1,value:C},d=R=>r!==void 0&&R<r||l!==void 0&&R>l,u=R=>r===void 0?l:l===void 0||Math.abs(r-R)<Math.abs(l-R)?r:l;let h=n*t;const f=C+h,y=s===void 0?f:s(f);y!==f&&(h=y-C);const Z=R=>-h*Math.exp(-R/g),p=R=>y+Z(R),B=R=>{const J=Z(R),M=p(R);c.done=Math.abs(J)<=I,c.value=c.done?y:M};let W,S;const V=R=>{d(c.value)&&(W=R,S=hW({keyframes:[c.value,u(c.value)],velocity:AW(p,R,c.value),damping:i,stiffness:o,restDelta:I,restSpeed:a}))};return V(0),{calculatedDuration:null,next:R=>{let J=!1;return!S&&W===void 0&&(J=!0,B(R),V(R)),W!==void 0&&R>=W?S.next(R-W):(!J&&B(R),c)}}}const mW=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,o9=1e-7,s9=12;function r9(e,t,n,g,i){let o,s,r=0;do s=t+(n-t)/2,o=mW(s,g,i)-e,o>0?n=s:t=s;while(Math.abs(o)>o9&&++r<s9);return s}function Kl(e,t,n,g){if(e===t&&n===g)return qt;const i=o=>r9(o,0,1,e,n);return o=>o===0||o===1?o:mW(i(o),t,g)}const l9=Kl(.42,0,1,1),I9=Kl(0,0,.58,1),bW=Kl(.42,0,.58,1),a9=e=>Array.isArray(e)&&typeof e[0]!="number",pW=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,fW=e=>t=>1-e(1-t),nb=e=>1-Math.sin(Math.acos(e)),ZW=fW(nb),C9=pW(nb),yW=Kl(.33,1.53,.69,.99),gb=fW(yW),c9=pW(gb),d9=e=>(e*=2)<1?.5*gb(e):.5*(2-Math.pow(2,-10*(e-1))),jf={linear:qt,easeIn:l9,easeInOut:bW,easeOut:I9,circIn:nb,circInOut:C9,circOut:ZW,backIn:gb,backInOut:c9,backOut:yW,anticipate:d9},Pf=e=>{if(Array.isArray(e)){Xu(e.length===4);const[t,n,g,i]=e;return Kl(t,n,g,i)}else if(typeof e=="string")return Xu(jf[e]!==void 0),jf[e];return e},pl=(e,t,n)=>{const g=t-e;return g===0?1:(n-e)/g},ct=(e,t,n)=>e+(t-e)*n;function Pc(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function u9({hue:e,saturation:t,lightness:n,alpha:g}){e/=360,t/=100,n/=100;let i=0,o=0,s=0;if(!t)i=o=s=n;else{const r=n<.5?n*(1+t):n+t-n*t,l=2*n-r;i=Pc(l,r,e+1/3),o=Pc(l,r,e),s=Pc(l,r,e-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(s*255),alpha:g}}function Da(e,t){return n=>n>0?t:e}const Oc=(e,t,n)=>{const g=e*e,i=n*(t*t-g)+g;return i<0?0:Math.sqrt(i)},A9=[Nu,Co,cs],h9=e=>A9.find(t=>t.test(e));function Of(e){const t=h9(e);if(!t)return!1;let n=t.parse(e);return t===cs&&(n=u9(n)),n}const _f=(e,t)=>{const n=Of(e),g=Of(t);if(!n||!g)return Da(e,t);const i={...n};return o=>(i.red=Oc(n.red,g.red,o),i.green=Oc(n.green,g.green,o),i.blue=Oc(n.blue,g.blue,o),i.alpha=ct(n.alpha,g.alpha,o),Co.transform(i))},Ku=new Set(["none","hidden"]);function m9(e,t){return Ku.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function b9(e,t){return n=>ct(e,t,n)}function ib(e){return typeof e=="number"?b9:typeof e=="string"?Um(e)?Da:Pt.test(e)?_f:Z9:Array.isArray(e)?GW:typeof e=="object"?Pt.test(e)?_f:p9:Da}function GW(e,t){const n=[...e],g=n.length,i=e.map((o,s)=>ib(o)(o,t[s]));return o=>{for(let s=0;s<g;s++)n[s]=i[s](o);return n}}function p9(e,t){const n={...e,...t},g={};for(const i in n)e[i]!==void 0&&t[i]!==void 0&&(g[i]=ib(e[i])(e[i],t[i]));return i=>{for(const o in g)n[o]=g[o](i);return n}}function f9(e,t){var n;const g=[],i={color:0,var:0,number:0};for(let o=0;o<t.values.length;o++){const s=t.types[o],r=e.indexes[s][i[s]],l=(n=e.values[r])!==null&&n!==void 0?n:0;g[o]=l,i[s]++}return g}const Z9=(e,t)=>{const n=Ni.createTransformer(t),g=bl(e),i=bl(t);return g.indexes.var.length===i.indexes.var.length&&g.indexes.color.length===i.indexes.color.length&&g.indexes.number.length>=i.indexes.number.length?Ku.has(e)&&!i.values.length||Ku.has(t)&&!g.values.length?m9(e,t):xg(GW(f9(g,i),i.values),n):Da(e,t)};function BW(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?ct(e,t,n):ib(e)(e,t)}function y9(e,t,n){const g=[],i=n||BW,o=e.length-1;for(let s=0;s<o;s++){let r=i(e[s],e[s+1]);if(t){const l=Array.isArray(t)?t[s]||qt:t;r=xg(l,r)}g.push(r)}return g}function G9(e,t,{clamp:n=!0,ease:g,mixer:i}={}){const o=e.length;if(Xu(o===t.length),o===1)return()=>t[0];if(o===2&&e[0]===e[1])return()=>t[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const s=y9(t,g,i),r=s.length,l=I=>{let a=0;if(r>1)for(;a<e.length-2&&!(I<e[a+1]);a++);const C=pl(e[a],e[a+1],I);return s[a](C)};return n?I=>l(Hi(e[0],e[o-1],I)):l}function B9(e,t){const n=e[e.length-1];for(let g=1;g<=t;g++){const i=pl(0,t,g);e.push(ct(n,1,i))}}function S9(e){const t=[0];return B9(t,e.length-1),t}function V9(e,t){return e.map(n=>n*t)}function W9(e,t){return e.map(()=>t||bW).splice(0,e.length-1)}function Qa({duration:e=300,keyframes:t,times:n,ease:g="easeInOut"}){const i=a9(g)?g.map(Pf):Pf(g),o={done:!1,value:t[0]},s=V9(n&&n.length===t.length?n:S9(t),e),r=G9(s,t,{ease:Array.isArray(i)?i:W9(t,i)});return{calculatedDuration:e,next:l=>(o.value=r(l),o.done=l>=e,o)}}const qf=2e4;function R9(e){let t=0;const n=50;let g=e.next(t);for(;!g.done&&t<qf;)t+=n,g=e.next(t);return t>=qf?1/0:t}const v9=e=>{const t=({timestamp:n})=>e(n);return{start:()=>Qe.update(t,!0),stop:()=>Ug(t),now:()=>Kt.isProcessing?Kt.timestamp:Xi.now()}},k9={decay:Qf,inertia:Qf,tween:Qa,keyframes:Qa,spring:hW},X9=e=>e/100;class ob extends dW{constructor({KeyframeResolver:t=$m,...n}){super(n),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:r}=this.options;r&&r()};const{name:g,motionValue:i,keyframes:o}=this.options,s=(r,l)=>this.onKeyframesResolved(r,l);g&&i&&i.owner?this.resolver=i.owner.resolveKeyframes(o,s,g,i):this.resolver=new t(o,s,g,i),this.resolver.scheduleResolve()}initPlayback(t){const{type:n="keyframes",repeat:g=0,repeatDelay:i=0,repeatType:o,velocity:s=0}=this.options,r=k9[n]||Qa;let l,I;r!==Qa&&typeof t[0]!="number"&&(l=xg(X9,BW(t[0],t[1])),t=[0,100]);const a=r({...this.options,keyframes:t});o==="mirror"&&(I=r({...this.options,keyframes:[...t].reverse(),velocity:-s})),a.calculatedDuration===null&&(a.calculatedDuration=R9(a));const{calculatedDuration:C}=a,c=C+i,d=c*(g+1)-i;return{generator:a,mirroredGenerator:I,mapPercentToKeyframes:l,calculatedDuration:C,resolvedDuration:c,totalDuration:d}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,n=!1){const{resolved:g}=this;if(!g){const{keyframes:R}=this.options;return{done:!0,value:R[R.length-1]}}const{finalKeyframe:i,generator:o,mirroredGenerator:s,mapPercentToKeyframes:r,keyframes:l,calculatedDuration:I,totalDuration:a,resolvedDuration:C}=g;if(this.startTime===null)return o.next(0);const{delay:c,repeat:d,repeatType:u,repeatDelay:h,onUpdate:f}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),n?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const y=this.currentTime-c*(this.speed>=0?1:-1),Z=this.speed>=0?y<0:y>a;this.currentTime=Math.max(y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let p=this.currentTime,B=o;if(d){const R=Math.min(this.currentTime,a)/C;let J=Math.floor(R),M=R%1;!M&&R>=1&&(M=1),M===1&&J--,J=Math.min(J,d+1),!!(J%2)&&(u==="reverse"?(M=1-M,h&&(M-=h/C)):u==="mirror"&&(B=s)),p=Hi(0,1,M)*C}const W=Z?{done:!1,value:l[0]}:B.next(p);r&&(W.value=r(W.value));let{done:S}=W;!Z&&I!==null&&(S=this.speed>=0?this.currentTime>=a:this.currentTime<=0);const V=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return V&&i!==void 0&&(W.value=FC(l,this.options,i)),f&&f(W.value),V&&this.finish(),W}get duration(){const{resolved:t}=this;return t?Kg(t.calculatedDuration):0}get time(){return Kg(this.currentTime)}set time(t){t=ki(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Kg(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=v9,onPlay:n}=this.options;this.driver||(this.driver=t(i=>this.tick(i))),n&&n();const g=this.driver.now();this.holdTime!==null?this.startTime=g-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=g),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const SW=e=>Array.isArray(e)&&typeof e[0]=="number";function VW(e){return!!(!e||typeof e=="string"&&e in sb||SW(e)||Array.isArray(e)&&e.every(VW))}const yr=([e,t,n,g])=>`cubic-bezier(${e}, ${t}, ${n}, ${g})`,sb={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:yr([0,.65,.55,1]),circOut:yr([.55,0,1,.45]),backIn:yr([.31,.01,.66,-.59]),backOut:yr([.33,1.53,.69,.99])};function w9(e){return WW(e)||sb.easeOut}function WW(e){if(e)return SW(e)?yr(e):Array.isArray(e)?e.map(w9):sb[e]}function J9(e,t,n,{delay:g=0,duration:i=300,repeat:o=0,repeatType:s="loop",ease:r,times:l}={}){const I={[t]:n};l&&(I.offset=l);const a=WW(r);return Array.isArray(a)&&(I.easing=a),e.animate(I,{delay:g,duration:i,easing:Array.isArray(a)?"linear":a,fill:"both",iterations:o+1,direction:s==="reverse"?"alternate":"normal"})}const Y9=cW(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),H9=new Set(["opacity","clipPath","filter","transform"]),ja=10,N9=2e4;function F9(e){return e.type==="spring"||e.name==="backgroundColor"||!VW(e.ease)}function x9(e,t){const n=new ob({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let g={done:!1,value:e[0]};const i=[];let o=0;for(;!g.done&&o<N9;)g=n.sample(o),i.push(g.value),o+=ja;return{times:void 0,keyframes:i,duration:o-ja,ease:"linear"}}class $f extends dW{constructor(t){super(t);const{name:n,motionValue:g,keyframes:i}=this.options;this.resolver=new CW(i,(o,s)=>this.onKeyframesResolved(o,s),n,g),this.resolver.scheduleResolve()}initPlayback(t,n){var g;let{duration:i=300,times:o,ease:s,type:r,motionValue:l,name:I}=this.options;if(!(!((g=l.owner)===null||g===void 0)&&g.current))return!1;if(F9(this.options)){const{onComplete:C,onUpdate:c,motionValue:d,...u}=this.options,h=x9(t,u);t=h.keyframes,t.length===1&&(t[1]=t[0]),i=h.duration,o=h.times,s=h.ease,r="keyframes"}const a=J9(l.owner.current,I,t,{...this.options,duration:i,times:o,ease:s});return a.startTime=Xi.now(),this.pendingTimeline?(a.timeline=this.pendingTimeline,this.pendingTimeline=void 0):a.onfinish=()=>{const{onComplete:C}=this.options;l.set(FC(t,this.options,n)),C&&C(),this.cancel(),this.resolveFinishedPromise()},{animation:a,duration:i,times:o,type:r,ease:s,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:n}=t;return Kg(n)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:n}=t;return Kg(n.currentTime||0)}set time(t){const{resolved:n}=this;if(!n)return;const{animation:g}=n;g.currentTime=ki(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:n}=t;return n.playbackRate}set speed(t){const{resolved:n}=this;if(!n)return;const{animation:g}=n;g.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:n}=t;return n.playState}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:n}=this;if(!n)return qt;const{animation:g}=n;g.timeline=t,g.onfinish=null}return qt}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:t}=this;if(!t)return;const{animation:n,keyframes:g,duration:i,type:o,ease:s,times:r}=t;if(!(n.playState==="idle"||n.playState==="finished")){if(this.time){const{motionValue:l,onUpdate:I,onComplete:a,...C}=this.options,c=new ob({...C,keyframes:g,duration:i,type:o,ease:s,times:r,isGenerator:!0}),d=ki(this.time);l.setWithVelocity(c.sample(d-ja).value,c.sample(d).value,ja)}this.cancel()}}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:n,name:g,repeatDelay:i,repeatType:o,damping:s,type:r}=t;return Y9()&&g&&H9.has(g)&&n&&n.owner&&n.owner.current instanceof HTMLElement&&!n.owner.getProps().onUpdate&&!i&&o!=="mirror"&&s!==0&&r!=="inertia"}}function K9(e,t){let n;const g=()=>{const{currentTime:i}=t,s=(i===null?0:i.value)/100;n!==s&&e(s),n=s};return Qe.update(g,!0),()=>Ug(g)}const E9=cW(()=>window.ScrollTimeline!==void 0);class M9{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}then(t,n){return Promise.all(this.animations).then(t).catch(n)}getAll(t){return this.animations[0][t]}setAll(t,n){for(let g=0;g<this.animations.length;g++)this.animations[g][t]=n}attachTimeline(t){const n=this.animations.map(g=>{if(E9()&&g.attachTimeline)g.attachTimeline(t);else return g.pause(),K9(i=>{g.time=g.duration*i},t)});return()=>{n.forEach((g,i)=>{g&&g(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get duration(){let t=0;for(let n=0;n<this.animations.length;n++)t=Math.max(t,this.animations[n].duration);return t}runAll(t){this.animations.forEach(n=>n[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}const rb=(e,t,n,g={},i,o)=>s=>{const r=qm(g,e)||{},l=r.delay||g.delay||0;let{elapsed:I=0}=g;I=I-ki(l);let a={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...r,delay:-I,onUpdate:c=>{t.set(c),r.onUpdate&&r.onUpdate(c)},onComplete:()=>{s(),r.onComplete&&r.onComplete()},name:e,motionValue:t,element:o?void 0:i};fK(r)||(a={...a,...pK(e,a)}),a.duration&&(a.duration=ki(a.duration)),a.repeatDelay&&(a.repeatDelay=ki(a.repeatDelay)),a.from!==void 0&&(a.keyframes[0]=a.from);let C=!1;if((a.type===!1||a.duration===0&&!a.repeatDelay)&&(a.duration=0,a.delay===0&&(C=!0)),C&&!o&&t.get()!==void 0){const c=FC(a.keyframes,r);if(c!==void 0)return Qe.update(()=>{a.onUpdate(c),a.onComplete()}),new M9([])}return!o&&$f.supports(a)?new $f(a):new ob(a)};function Pa(e){return!!(_t(e)&&e.add)}function lb(e,t){e.indexOf(t)===-1&&e.push(t)}function Ib(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class ab{constructor(){this.subscriptions=[]}add(t){return lb(this.subscriptions,t),()=>Ib(this.subscriptions,t)}notify(t,n,g){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](t,n,g);else for(let o=0;o<i;o++){const s=this.subscriptions[o];s&&s(t,n,g)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const eZ=30,T9=e=>!isNaN(parseFloat(e));class L9{constructor(t,n={}){this.version="11.2.13",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(g,i=!0)=>{const o=Xi.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(g),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=Xi.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=T9(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new ab);const g=this.events[t].add(n);return t==="change"?()=>{g(),Qe.read(()=>{this.events.change.getSize()||this.stop()})}:g}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t,n=!0){!n||!this.passiveEffect?this.updateAndNotify(t,n):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,n,g){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-g}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Xi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>eZ)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,eZ);return uW(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function fl(e,t){return new L9(e,t)}function U9(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,fl(n))}function z9(e,t){const n=NC(e,t);let{transitionEnd:g={},transition:i={},...o}=n||{};o={...o,...g};for(const s in o){const r=Ox(o[s]);U9(e,s,r)}}function RW(e){return e.getProps()[RV]}function D9({protectedKeys:e,needsAnimating:t},n){const g=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,g}function vW(e,t,{delay:n=0,transitionOverride:g,type:i}={}){var o;let{transition:s=e.getDefaultTransition(),transitionEnd:r,...l}=t;const I=e.getValue("willChange");g&&(s=g);const a=[],C=i&&e.animationState&&e.animationState.getState()[i];for(const c in l){const d=e.getValue(c,(o=e.latestValues[c])!==null&&o!==void 0?o:null),u=l[c];if(u===void 0||C&&D9(C,c))continue;const h={delay:n,elapsed:0,...qm(s||{},c)};let f=!1;if(window.HandoffAppearAnimations){const Z=RW(e);if(Z){const p=window.HandoffAppearAnimations(Z,c,d,Qe);p!==null&&(h.elapsed=p,f=!0)}}d.start(rb(c,d,u,e.shouldReduceMotion&&Mo.has(c)?{type:!1}:h,e,f));const y=d.animation;y&&(Pa(I)&&(I.add(c),y.then(()=>I.remove(c))),a.push(y))}return r&&Promise.all(a).then(()=>{Qe.update(()=>{r&&z9(e,r)})}),a}function Eu(e,t,n={}){var g;const i=NC(e,t,n.type==="exit"?(g=e.presenceContext)===null||g===void 0?void 0:g.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(o=n.transitionOverride);const s=i?()=>Promise.all(vW(e,i,n)):()=>Promise.resolve(),r=e.variantChildren&&e.variantChildren.size?(I=0)=>{const{delayChildren:a=0,staggerChildren:C,staggerDirection:c}=o;return Q9(e,t,a+I,C,c,n)}:()=>Promise.resolve(),{when:l}=o;if(l){const[I,a]=l==="beforeChildren"?[s,r]:[r,s];return I().then(()=>a())}else return Promise.all([s(),r(n.delay)])}function Q9(e,t,n=0,g=0,i=1,o){const s=[],r=(e.variantChildren.size-1)*g,l=i===1?(I=0)=>I*g:(I=0)=>r-I*g;return Array.from(e.variantChildren).sort(j9).forEach((I,a)=>{I.notify("AnimationStart",t),s.push(Eu(I,t,{...o,delay:n+l(a)}).then(()=>I.notify("AnimationComplete",t)))}),Promise.all(s)}function j9(e,t){return e.sortNodePosition(t)}function P9(e,t,n={}){e.notify("AnimationStart",t);let g;if(Array.isArray(t)){const i=t.map(o=>Eu(e,o,n));g=Promise.all(i)}else if(typeof t=="string")g=Eu(e,t,n);else{const i=typeof t=="function"?NC(e,t,n.custom):t;g=Promise.all(vW(e,i,n))}return g.then(()=>{Qe.postRender(()=>{e.notify("AnimationComplete",t)})})}const O9=[...Mm].reverse(),_9=Mm.length;function q9(e){return t=>Promise.all(t.map(({animation:n,options:g})=>P9(e,n,g)))}function $9(e){let t=q9(e),n=tZ(),g=!0;const i=l=>(I,a)=>{var C;const c=NC(e,a,l==="exit"?(C=e.presenceContext)===null||C===void 0?void 0:C.custom:void 0);if(c){const{transition:d,transitionEnd:u,...h}=c;I={...I,...h,...u}}return I};function o(l){t=l(e)}function s(l){const I=e.getProps(),a=e.getVariantContext(!0)||{},C=[],c=new Set;let d={},u=1/0;for(let f=0;f<_9;f++){const y=O9[f],Z=n[y],p=I[y]!==void 0?I[y]:a[y],B=ml(p),W=y===l?Z.isActive:null;W===!1&&(u=f);let S=p===a[y]&&p!==I[y]&&B;if(S&&g&&e.manuallyAnimateOnMount&&(S=!1),Z.protectedKeys={...d},!Z.isActive&&W===null||!p&&!Z.prevProp||JC(p)||typeof p=="boolean")continue;let R=e5(Z.prevProp,p)||y===l&&Z.isActive&&!S&&B||f>u&&B,J=!1;const M=Array.isArray(p)?p:[p];let P=M.reduce(i(y),{});W===!1&&(P={});const{prevResolvedValues:X={}}=Z,L={...X,...P},ne=D=>{R=!0,c.has(D)&&(J=!0,c.delete(D)),Z.needsAnimating[D]=!0;const ie=e.getValue(D);ie&&(ie.liveStyle=!1)};for(const D in L){const ie=P[D],ge=X[D];if(d.hasOwnProperty(D))continue;let N=!1;wu(ie)&&wu(ge)?N=!_V(ie,ge):N=ie!==ge,N?ie!=null?ne(D):c.add(D):ie!==void 0&&c.has(D)?ne(D):Z.protectedKeys[D]=!0}Z.prevProp=p,Z.prevResolvedValues=P,Z.isActive&&(d={...d,...P}),g&&e.blockInitialAnimation&&(R=!1),R&&(!S||J)&&C.push(...M.map(D=>({animation:D,options:{type:y}})))}if(c.size){const f={};c.forEach(y=>{const Z=e.getBaseTarget(y),p=e.getValue(y);p&&(p.liveStyle=!0),f[y]=Z??null}),C.push({animation:f})}let h=!!C.length;return g&&(I.initial===!1||I.initial===I.animate)&&!e.manuallyAnimateOnMount&&(h=!1),g=!1,h?t(C):Promise.resolve()}function r(l,I){var a;if(n[l].isActive===I)return Promise.resolve();(a=e.variantChildren)===null||a===void 0||a.forEach(c=>{var d;return(d=c.animationState)===null||d===void 0?void 0:d.setActive(l,I)}),n[l].isActive=I;const C=s(l);for(const c in n)n[c].protectedKeys={};return C}return{animateChanges:s,setActive:r,setAnimateFunction:o,getState:()=>n,reset:()=>{n=tZ(),g=!0}}}function e5(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!_V(t,e):!1}function Qi(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function tZ(){return{animate:Qi(!0),whileInView:Qi(),whileHover:Qi(),whileTap:Qi(),whileDrag:Qi(),whileFocus:Qi(),exit:Qi()}}class t5 extends Mi{constructor(t){super(t),t.animationState||(t.animationState=$9(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();JC(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let n5=0;class g5 extends Mi{constructor(){super(...arguments),this.id=n5++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:g}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===g)return;const i=this.node.animationState.setActive("exit",!t);n&&!t&&i.then(()=>n(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const i5={animation:{Feature:t5},exit:{Feature:g5}},nZ=(e,t)=>Math.abs(e-t);function o5(e,t){const n=nZ(e.x,t.x),g=nZ(e.y,t.y);return Math.sqrt(n**2+g**2)}class kW{constructor(t,n,{transformPagePoint:g,contextWindow:i,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const C=qc(this.lastMoveEventInfo,this.history),c=this.startEvent!==null,d=o5(C.offset,{x:0,y:0})>=3;if(!c&&!d)return;const{point:u}=C,{timestamp:h}=Kt;this.history.push({...u,timestamp:h});const{onStart:f,onMove:y}=this.handlers;c||(f&&f(this.lastMoveEvent,C),this.startEvent=this.lastMoveEvent),y&&y(this.lastMoveEvent,C)},this.handlePointerMove=(C,c)=>{this.lastMoveEvent=C,this.lastMoveEventInfo=_c(c,this.transformPagePoint),Qe.update(this.updatePoint,!0)},this.handlePointerUp=(C,c)=>{this.end();const{onEnd:d,onSessionEnd:u,resumeAnimation:h}=this.handlers;if(this.dragSnapToOrigin&&h&&h(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=qc(C.type==="pointercancel"?this.lastMoveEventInfo:_c(c,this.transformPagePoint),this.history);this.startEvent&&d&&d(C,f),u&&u(C,f)},!DV(t))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=g,this.contextWindow=i||window;const s=HC(t),r=_c(s,this.transformPagePoint),{point:l}=r,{timestamp:I}=Kt;this.history=[{...l,timestamp:I}];const{onSessionStart:a}=n;a&&a(t,qc(r,this.history)),this.removeListeners=xg(Fg(this.contextWindow,"pointermove",this.handlePointerMove),Fg(this.contextWindow,"pointerup",this.handlePointerUp),Fg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Ug(this.updatePoint)}}function _c(e,t){return t?{point:t(e.point)}:e}function gZ(e,t){return{x:e.x-t.x,y:e.y-t.y}}function qc({point:e},t){return{point:e,delta:gZ(e,XW(t)),offset:gZ(e,s5(t)),velocity:r5(t,.1)}}function s5(e){return e[0]}function XW(e){return e[e.length-1]}function r5(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,g=null;const i=XW(e);for(;n>=0&&(g=e[n],!(i.timestamp-g.timestamp>ki(t)));)n--;if(!g)return{x:0,y:0};const o=Kg(i.timestamp-g.timestamp);if(o===0)return{x:0,y:0};const s={x:(i.x-g.x)/o,y:(i.y-g.y)/o};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function Rn(e){return e.max-e.min}function Mu(e,t=0,n=.01){return Math.abs(e-t)<=n}function iZ(e,t,n,g=.5){e.origin=g,e.originPoint=ct(t.min,t.max,e.origin),e.scale=Rn(n)/Rn(t),(Mu(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=ct(n.min,n.max,e.origin)-e.originPoint,(Mu(e.translate)||isNaN(e.translate))&&(e.translate=0)}function Er(e,t,n,g){iZ(e.x,t.x,n.x,g?g.originX:void 0),iZ(e.y,t.y,n.y,g?g.originY:void 0)}function oZ(e,t,n){e.min=n.min+t.min,e.max=e.min+Rn(t)}function l5(e,t,n){oZ(e.x,t.x,n.x),oZ(e.y,t.y,n.y)}function sZ(e,t,n){e.min=t.min-n.min,e.max=e.min+Rn(t)}function Mr(e,t,n){sZ(e.x,t.x,n.x),sZ(e.y,t.y,n.y)}function I5(e,{min:t,max:n},g){return t!==void 0&&e<t?e=g?ct(t,e,g.min):Math.max(e,t):n!==void 0&&e>n&&(e=g?ct(n,e,g.max):Math.min(e,n)),e}function rZ(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function a5(e,{top:t,left:n,bottom:g,right:i}){return{x:rZ(e.x,n,i),y:rZ(e.y,t,g)}}function lZ(e,t){let n=t.min-e.min,g=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,g]=[g,n]),{min:n,max:g}}function C5(e,t){return{x:lZ(e.x,t.x),y:lZ(e.y,t.y)}}function c5(e,t){let n=.5;const g=Rn(e),i=Rn(t);return i>g?n=pl(t.min,t.max-g,e.min):g>i&&(n=pl(e.min,e.max-i,t.min)),Hi(0,1,n)}function d5(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const Tu=.35;function u5(e=Tu){return e===!1?e=0:e===!0&&(e=Tu),{x:IZ(e,"left","right"),y:IZ(e,"top","bottom")}}function IZ(e,t,n){return{min:aZ(e,t),max:aZ(e,n)}}function aZ(e,t){return typeof e=="number"?e:e[t]||0}const CZ=()=>({translate:0,scale:1,origin:0,originPoint:0}),ds=()=>({x:CZ(),y:CZ()}),cZ=()=>({min:0,max:0}),Zt=()=>({x:cZ(),y:cZ()});function Hn(e){return[e("x"),e("y")]}function wW({top:e,left:t,right:n,bottom:g}){return{x:{min:t,max:n},y:{min:e,max:g}}}function A5({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function h5(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),g=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:g.y,right:g.x}}function $c(e){return e===void 0||e===1}function Lu({scale:e,scaleX:t,scaleY:n}){return!$c(e)||!$c(t)||!$c(n)}function go(e){return Lu(e)||JW(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function JW(e){return dZ(e.x)||dZ(e.y)}function dZ(e){return e&&e!=="0%"}function Oa(e,t,n){const g=e-n,i=t*g;return n+i}function uZ(e,t,n,g,i){return i!==void 0&&(e=Oa(e,i,g)),Oa(e,n,g)+t}function Uu(e,t=0,n=1,g,i){e.min=uZ(e.min,t,n,g,i),e.max=uZ(e.max,t,n,g,i)}function YW(e,{x:t,y:n}){Uu(e.x,t.translate,t.scale,t.originPoint),Uu(e.y,n.translate,n.scale,n.originPoint)}function m5(e,t,n,g=!1){const i=n.length;if(!i)return;t.x=t.y=1;let o,s;for(let r=0;r<i;r++){o=n[r],s=o.projectionDelta;const l=o.instance;l&&l.style&&l.style.display==="contents"||(g&&o.options.layoutScroll&&o.scroll&&o!==o.root&&us(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),s&&(t.x*=s.x.scale,t.y*=s.y.scale,YW(e,s)),g&&go(o.latestValues)&&us(e,o.latestValues))}t.x=AZ(t.x),t.y=AZ(t.y)}function AZ(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function ai(e,t){e.min=e.min+t,e.max=e.max+t}function hZ(e,t,[n,g,i]){const o=t[i]!==void 0?t[i]:.5,s=ct(e.min,e.max,o);Uu(e,t[n],t[g],s,t.scale)}const b5=["x","scaleX","originX"],p5=["y","scaleY","originY"];function us(e,t){hZ(e.x,t,b5),hZ(e.y,t,p5)}function HW(e,t){return wW(h5(e.getBoundingClientRect(),t))}function f5(e,t,n){const g=HW(e,n),{scroll:i}=t;return i&&(ai(g.x,i.offset.x),ai(g.y,i.offset.y)),g}const NW=({current:e})=>e?e.ownerDocument.defaultView:null,Z5=new WeakMap;class y5{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Zt(),this.visualElement=t}start(t,{snapToCursor:n=!1}={}){const{presenceContext:g}=this.visualElement;if(g&&g.isPresent===!1)return;const i=a=>{const{dragSnapToOrigin:C}=this.getProps();C?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(HC(a,"page").point)},o=(a,C)=>{const{drag:c,dragPropagation:d,onDragStart:u}=this.getProps();if(c&&!d&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=jV(c),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Hn(f=>{let y=this.getAxisMotionValue(f).get()||0;if(mg.test(y)){const{projection:Z}=this.visualElement;if(Z&&Z.layout){const p=Z.layout.layoutBox[f];p&&(y=Rn(p)*(parseFloat(y)/100))}}this.originPoint[f]=y}),u&&Qe.postRender(()=>u(a,C));const{animationState:h}=this.visualElement;h&&h.setActive("whileDrag",!0)},s=(a,C)=>{const{dragPropagation:c,dragDirectionLock:d,onDirectionLock:u,onDrag:h}=this.getProps();if(!c&&!this.openGlobalLock)return;const{offset:f}=C;if(d&&this.currentDirection===null){this.currentDirection=G5(f),this.currentDirection!==null&&u&&u(this.currentDirection);return}this.updateAxis("x",C.point,f),this.updateAxis("y",C.point,f),this.visualElement.render(),h&&h(a,C)},r=(a,C)=>this.stop(a,C),l=()=>Hn(a=>{var C;return this.getAnimationState(a)==="paused"&&((C=this.getAxisMotionValue(a).animation)===null||C===void 0?void 0:C.play())}),{dragSnapToOrigin:I}=this.getProps();this.panSession=new kW(t,{onSessionStart:i,onStart:o,onMove:s,onSessionEnd:r,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:I,contextWindow:NW(this.visualElement)})}stop(t,n){const g=this.isDragging;if(this.cancel(),!g)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:o}=this.getProps();o&&Qe.postRender(()=>o(t,n))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:g}=this.getProps();!g&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,g){const{drag:i}=this.getProps();if(!g||!ZI(t,i,this.currentDirection))return;const o=this.getAxisMotionValue(t);let s=this.originPoint[t]+g[t];this.constraints&&this.constraints[t]&&(s=I5(s,this.constraints[t],this.elastic[t])),o.set(s)}resolveConstraints(){var t;const{dragConstraints:n,dragElastic:g}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;n&&Cs(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&i?this.constraints=a5(i.layoutBox,n):this.constraints=!1,this.elastic=u5(g),o!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Hn(s=>{this.constraints!==!1&&this.getAxisMotionValue(s)&&(this.constraints[s]=d5(i.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!Cs(t))return!1;const g=t.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=f5(g,i.root,this.visualElement.getTransformPagePoint());let s=C5(i.layout.layoutBox,o);if(n){const r=n(A5(s));this.hasMutatedConstraints=!!r,r&&(s=wW(r))}return s}startAnimation(t){const{drag:n,dragMomentum:g,dragElastic:i,dragTransition:o,dragSnapToOrigin:s,onDragTransitionEnd:r}=this.getProps(),l=this.constraints||{},I=Hn(a=>{if(!ZI(a,n,this.currentDirection))return;let C=l&&l[a]||{};s&&(C={min:0,max:0});const c=i?200:1e6,d=i?40:1e7,u={type:"inertia",velocity:g?t[a]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...o,...C};return this.startAxisValueAnimation(a,u)});return Promise.all(I).then(r)}startAxisValueAnimation(t,n){const g=this.getAxisMotionValue(t);return g.start(rb(t,g,0,n,this.visualElement))}stopAnimation(){Hn(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Hn(t=>{var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,g=this.visualElement.getProps(),i=g[n];return i||this.visualElement.getValue(t,(g.initial?g.initial[t]:void 0)||0)}snapToCursor(t){Hn(n=>{const{drag:g}=this.getProps();if(!ZI(n,g,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(n);if(i&&i.layout){const{min:s,max:r}=i.layout.layoutBox[n];o.set(t[n]-ct(s,r,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:g}=this.visualElement;if(!Cs(n)||!g||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Hn(s=>{const r=this.getAxisMotionValue(s);if(r&&this.constraints!==!1){const l=r.get();i[s]=c5({min:l,max:l},this.constraints[s])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",g.root&&g.root.updateScroll(),g.updateLayout(),this.resolveConstraints(),Hn(s=>{if(!ZI(s,t,null))return;const r=this.getAxisMotionValue(s),{min:l,max:I}=this.constraints[s];r.set(ct(l,I,i[s]))})}addListeners(){if(!this.visualElement.current)return;Z5.set(this.visualElement,this);const t=this.visualElement.current,n=Fg(t,"pointerdown",l=>{const{drag:I,dragListener:a=!0}=this.getProps();I&&a&&this.start(l)}),g=()=>{const{dragConstraints:l}=this.getProps();Cs(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",g);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Qe.read(g);const s=Jg(window,"resize",()=>this.scalePositionWithinConstraints()),r=i.addEventListener("didUpdate",({delta:l,hasLayoutChanged:I})=>{this.isDragging&&I&&(Hn(a=>{const C=this.getAxisMotionValue(a);C&&(this.originPoint[a]+=l[a].translate,C.set(C.get()+l[a].translate))}),this.visualElement.render())});return()=>{s(),n(),o(),r&&r()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:g=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:s=Tu,dragMomentum:r=!0}=t;return{...t,drag:n,dragDirectionLock:g,dragPropagation:i,dragConstraints:o,dragElastic:s,dragMomentum:r}}}function ZI(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function G5(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class B5 extends Mi{constructor(t){super(t),this.removeGroupControls=qt,this.removeListeners=qt,this.controls=new y5(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||qt}unmount(){this.removeGroupControls(),this.removeListeners()}}const mZ=e=>(t,n)=>{e&&Qe.postRender(()=>e(t,n))};class S5 extends Mi{constructor(){super(...arguments),this.removePointerDownListener=qt}onPointerDown(t){this.session=new kW(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:NW(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:g,onPanEnd:i}=this.node.getProps();return{onSessionStart:mZ(t),onStart:mZ(n),onMove:g,onEnd:(o,s)=>{delete this.session,i&&Qe.postRender(()=>i(o,s))}}}mount(){this.removePointerDownListener=Fg(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function V5(){const e=H.useContext(Fm);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:g}=e,i=H.useId();return H.useEffect(()=>g(i),[]),!t&&n?[!1,()=>n&&n(i)]:[!0]}const PI={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function bZ(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const lr={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(ke.test(e))e=parseFloat(e);else return e;const n=bZ(e,t.target.x),g=bZ(e,t.target.y);return`${n}% ${g}%`}},W5={correct:(e,{treeScale:t,projectionDelta:n})=>{const g=e,i=Ni.parse(e);if(i.length>5)return g;const o=Ni.createTransformer(e),s=typeof i[0]!="number"?1:0,r=n.x.scale*t.x,l=n.y.scale*t.y;i[0+s]/=r,i[1+s]/=l;const I=ct(r,l,.5);return typeof i[2+s]=="number"&&(i[2+s]/=I),typeof i[3+s]=="number"&&(i[3+s]/=I),o(i)}};class R5 extends H.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:g,layoutId:i}=this.props,{projection:o}=t;Gx(v5),o&&(n.group&&n.group.add(o),g&&g.register&&i&&g.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),PI.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:g,drag:i,isPresent:o}=this.props,s=g.projection;return s&&(s.isPresent=o,i||t.layoutDependency!==n||n===void 0?s.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?s.promote():s.relegate()||Qe.postRender(()=>{const r=s.getStack();(!r||!r.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Em.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:g}=this.props,{projection:i}=t;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),g&&g.deregister&&g.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function FW(e){const[t,n]=V5(),g=H.useContext(JV);return G.jsx(R5,{...e,layoutGroup:g,switchLayoutGroup:H.useContext(kV),isPresent:t,safeToRemove:n})}const v5={borderRadius:{...lr,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:lr,borderTopRightRadius:lr,borderBottomLeftRadius:lr,borderBottomRightRadius:lr,boxShadow:W5},xW=["TopLeft","TopRight","BottomLeft","BottomRight"],k5=xW.length,pZ=e=>typeof e=="string"?parseFloat(e):e,fZ=e=>typeof e=="number"||ke.test(e);function X5(e,t,n,g,i,o){i?(e.opacity=ct(0,n.opacity!==void 0?n.opacity:1,w5(g)),e.opacityExit=ct(t.opacity!==void 0?t.opacity:1,0,J5(g))):o&&(e.opacity=ct(t.opacity!==void 0?t.opacity:1,n.opacity!==void 0?n.opacity:1,g));for(let s=0;s<k5;s++){const r=`border${xW[s]}Radius`;let l=ZZ(t,r),I=ZZ(n,r);if(l===void 0&&I===void 0)continue;l||(l=0),I||(I=0),l===0||I===0||fZ(l)===fZ(I)?(e[r]=Math.max(ct(pZ(l),pZ(I),g),0),(mg.test(I)||mg.test(l))&&(e[r]+="%")):e[r]=I}(t.rotate||n.rotate)&&(e.rotate=ct(t.rotate||0,n.rotate||0,g))}function ZZ(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const w5=KW(0,.5,ZW),J5=KW(.5,.95,qt);function KW(e,t,n){return g=>g<e?0:g>t?1:n(pl(e,t,g))}function yZ(e,t){e.min=t.min,e.max=t.max}function Yn(e,t){yZ(e.x,t.x),yZ(e.y,t.y)}function GZ(e,t,n,g,i){return e-=t,e=Oa(e,1/n,g),i!==void 0&&(e=Oa(e,1/i,g)),e}function Y5(e,t=0,n=1,g=.5,i,o=e,s=e){if(mg.test(t)&&(t=parseFloat(t),t=ct(s.min,s.max,t/100)-s.min),typeof t!="number")return;let r=ct(o.min,o.max,g);e===o&&(r-=t),e.min=GZ(e.min,t,n,r,i),e.max=GZ(e.max,t,n,r,i)}function BZ(e,t,[n,g,i],o,s){Y5(e,t[n],t[g],t[i],t.scale,o,s)}const H5=["x","scaleX","originX"],N5=["y","scaleY","originY"];function SZ(e,t,n,g){BZ(e.x,t,H5,n?n.x:void 0,g?g.x:void 0),BZ(e.y,t,N5,n?n.y:void 0,g?g.y:void 0)}function VZ(e){return e.translate===0&&e.scale===1}function EW(e){return VZ(e.x)&&VZ(e.y)}function F5(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function MW(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function WZ(e){return Rn(e.x)/Rn(e.y)}class x5{constructor(){this.members=[]}add(t){lb(this.members,t),t.scheduleRender()}remove(t){if(Ib(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(i=>t===i);if(n===0)return!1;let g;for(let i=n;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){g=o;break}}return g?(this.promote(g),!0):!1}promote(t,n){const g=this.lead;if(t!==g&&(this.prevLead=g,this.lead=t,t.show(),g)){g.instance&&g.scheduleRender(),t.scheduleRender(),t.resumeFrom=g,n&&(t.resumeFrom.preserveOpacity=!0),g.snapshot&&(t.snapshot=g.snapshot,t.snapshot.latestValues=g.animationValues||g.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;i===!1&&g.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:g}=t;n.onExitComplete&&n.onExitComplete(),g&&g.options.onExitComplete&&g.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function RZ(e,t,n){let g="";const i=e.x.translate/t.x,o=e.y.translate/t.y,s=(n==null?void 0:n.z)||0;if((i||o||s)&&(g=`translate3d(${i}px, ${o}px, ${s}px) `),(t.x!==1||t.y!==1)&&(g+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:I,rotate:a,rotateX:C,rotateY:c,skewX:d,skewY:u}=n;I&&(g=`perspective(${I}px) ${g}`),a&&(g+=`rotate(${a}deg) `),C&&(g+=`rotateX(${C}deg) `),c&&(g+=`rotateY(${c}deg) `),d&&(g+=`skewX(${d}deg) `),u&&(g+=`skewY(${u}deg) `)}const r=e.x.scale*t.x,l=e.y.scale*t.y;return(r!==1||l!==1)&&(g+=`scale(${r}, ${l})`),g||"none"}const K5=(e,t)=>e.depth-t.depth;class E5{constructor(){this.children=[],this.isDirty=!1}add(t){lb(this.children,t),this.isDirty=!0}remove(t){Ib(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(K5),this.isDirty=!1,this.children.forEach(t)}}function M5(e,t){const n=Xi.now(),g=({timestamp:i})=>{const o=i-n;o>=t&&(Ug(g),e(o-t))};return Qe.read(g,!0),()=>Ug(g)}function T5(e){window.MotionDebug&&window.MotionDebug.record(e)}function L5(e){return e instanceof SVGElement&&e.tagName!=="svg"}function U5(e,t,n){const g=_t(e)?e:fl(e);return g.start(rb("",g,t,n)),g.animation}const ed=["","X","Y","Z"],z5={visibility:"hidden"},vZ=1e3;let D5=0;const io={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function td(e,t,n,g){const{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),g&&(g[e]=0))}function TW(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return!1;const{visualElement:t}=e.options;return t?RW(t)?!0:e.parent&&!e.parent.hasCheckedOptimisedAppear?TW(e.parent):!1:!1}function LW({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:g,resetTransform:i}){return class{constructor(s={},r=t==null?void 0:t()){this.id=D5++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,io.totalNodes=io.resolvedTargetDeltas=io.recalculatedProjection=0,this.nodes.forEach(P5),this.nodes.forEach(eE),this.nodes.forEach(tE),this.nodes.forEach(O5),T5(io)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=s,this.root=r?r.root||r:this,this.path=r?[...r.path,r]:[],this.parent=r,this.depth=r?r.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new E5)}addEventListener(s,r){return this.eventHandlers.has(s)||this.eventHandlers.set(s,new ab),this.eventHandlers.get(s).add(r)}notifyListeners(s,...r){const l=this.eventHandlers.get(s);l&&l.notify(...r)}hasListeners(s){return this.eventHandlers.has(s)}mount(s,r=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=L5(s),this.instance=s;const{layoutId:l,layout:I,visualElement:a}=this.options;if(a&&!a.current&&a.mount(s),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),r&&(I||l)&&(this.isLayoutDirty=!0),e){let C;const c=()=>this.root.updateBlockedByResize=!1;e(s,()=>{this.root.updateBlockedByResize=!0,C&&C(),C=M5(c,250),PI.hasAnimatedSinceResize&&(PI.hasAnimatedSinceResize=!1,this.nodes.forEach(XZ))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&a&&(l||I)&&this.addEventListener("didUpdate",({delta:C,hasLayoutChanged:c,hasRelativeTargetChanged:d,layout:u})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const h=this.options.transition||a.getDefaultTransition()||sE,{onLayoutAnimationStart:f,onLayoutAnimationComplete:y}=a.getProps(),Z=!this.targetLayout||!MW(this.targetLayout,u)||d,p=!c&&d;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||p||c&&(Z||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(C,p);const B={...qm(h,"layout"),onPlay:f,onComplete:y};(a.shouldReduceMotion||this.options.layoutRoot)&&(B.delay=0,B.type=!1),this.startAnimation(B)}else c||XZ(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=u})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const s=this.getStack();s&&s.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ug(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(nE),this.animationId++)}getTransformTemplate(){const{visualElement:s}=this.options;return s&&s.getProps().transformTemplate}willUpdate(s=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.HandoffCancelAllAnimations&&TW(this)&&window.HandoffCancelAllAnimations(),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let a=0;a<this.path.length;a++){const C=this.path[a];C.shouldResetTransform=!0,C.updateScroll("snapshot"),C.options.layoutRoot&&C.willUpdate(!1)}const{layoutId:r,layout:l}=this.options;if(r===void 0&&!l)return;const I=this.getTransformTemplate();this.prevTransformTemplateValue=I?I(this.latestValues,""):void 0,this.updateSnapshot(),s&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(kZ);return}this.isUpdating||this.nodes.forEach(q5),this.isUpdating=!1,this.nodes.forEach($5),this.nodes.forEach(Q5),this.nodes.forEach(j5),this.clearAllSnapshots();const r=Xi.now();Kt.delta=Hi(0,1e3/60,r-Kt.timestamp),Kt.timestamp=r,Kt.isProcessing=!0,Uc.update.process(Kt),Uc.preRender.process(Kt),Uc.render.process(Kt),Kt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Em.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(_5),this.sharedNodes.forEach(gE)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Qe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Qe.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const s=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Zt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:r}=this.options;r&&r.notify("LayoutMeasure",this.layout.layoutBox,s?s.layoutBox:void 0)}updateScroll(s="measure"){let r=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===s&&(r=!1),r&&(this.scroll={animationId:this.root.animationId,phase:s,isRoot:g(this.instance),offset:n(this.instance)})}resetTransform(){if(!i)return;const s=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,r=this.projectionDelta&&!EW(this.projectionDelta),l=this.getTransformTemplate(),I=l?l(this.latestValues,""):void 0,a=I!==this.prevTransformTemplateValue;s&&(r||go(this.latestValues)||a)&&(i(this.instance,I),this.shouldResetTransform=!1,this.scheduleRender())}measure(s=!0){const r=this.measurePageBox();let l=this.removeElementScroll(r);return s&&(l=this.removeTransform(l)),rE(l),{animationId:this.root.animationId,measuredBox:r,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:s}=this.options;if(!s)return Zt();const r=s.measureViewportBox(),{scroll:l}=this.root;return l&&(ai(r.x,l.offset.x),ai(r.y,l.offset.y)),r}removeElementScroll(s){const r=Zt();Yn(r,s);for(let l=0;l<this.path.length;l++){const I=this.path[l],{scroll:a,options:C}=I;if(I!==this.root&&a&&C.layoutScroll){if(a.isRoot){Yn(r,s);const{scroll:c}=this.root;c&&(ai(r.x,-c.offset.x),ai(r.y,-c.offset.y))}ai(r.x,a.offset.x),ai(r.y,a.offset.y)}}return r}applyTransform(s,r=!1){const l=Zt();Yn(l,s);for(let I=0;I<this.path.length;I++){const a=this.path[I];!r&&a.options.layoutScroll&&a.scroll&&a!==a.root&&us(l,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),go(a.latestValues)&&us(l,a.latestValues)}return go(this.latestValues)&&us(l,this.latestValues),l}removeTransform(s){const r=Zt();Yn(r,s);for(let l=0;l<this.path.length;l++){const I=this.path[l];if(!I.instance||!go(I.latestValues))continue;Lu(I.latestValues)&&I.updateSnapshot();const a=Zt(),C=I.measurePageBox();Yn(a,C),SZ(r,I.latestValues,I.snapshot?I.snapshot.layoutBox:void 0,a)}return go(this.latestValues)&&SZ(r,this.latestValues),r}setTargetDelta(s){this.targetDelta=s,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(s){this.options={...this.options,...s,crossfade:s.crossfade!==void 0?s.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Kt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(s=!1){var r;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const I=!!this.resumingFrom||this!==l;if(!(s||I&&this.isSharedProjectionDirty||this.isProjectionDirty||!((r=this.parent)===null||r===void 0)&&r.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:C,layoutId:c}=this.options;if(!(!this.layout||!(C||c))){if(this.resolvedRelativeTargetAt=Kt.timestamp,!this.targetDelta&&!this.relativeTarget){const d=this.getClosestProjectingParent();d&&d.layout&&this.animationProgress!==1?(this.relativeParent=d,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zt(),this.relativeTargetOrigin=Zt(),Mr(this.relativeTargetOrigin,this.layout.layoutBox,d.layout.layoutBox),Yn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Zt(),this.targetWithTransforms=Zt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),l5(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Yn(this.target,this.layout.layoutBox),YW(this.target,this.targetDelta)):Yn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const d=this.getClosestProjectingParent();d&&!!d.resumingFrom==!!this.resumingFrom&&!d.options.layoutScroll&&d.target&&this.animationProgress!==1?(this.relativeParent=d,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zt(),this.relativeTargetOrigin=Zt(),Mr(this.relativeTargetOrigin,this.target,d.target),Yn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}io.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Lu(this.parent.latestValues)||JW(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var s;const r=this.getLead(),l=!!this.resumingFrom||this!==r;let I=!0;if((this.isProjectionDirty||!((s=this.parent)===null||s===void 0)&&s.isProjectionDirty)&&(I=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(I=!1),this.resolvedRelativeTargetAt===Kt.timestamp&&(I=!1),I)return;const{layout:a,layoutId:C}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(a||C))return;Yn(this.layoutCorrected,this.layout.layoutBox);const c=this.treeScale.x,d=this.treeScale.y;m5(this.layoutCorrected,this.treeScale,this.path,l),r.layout&&!r.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(r.target=r.layout.layoutBox,r.targetWithTransforms=Zt());const{target:u}=r;if(!u){this.projectionTransform&&(this.projectionDelta=ds(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=ds(),this.projectionDeltaWithTransform=ds());const h=this.projectionTransform;Er(this.projectionDelta,this.layoutCorrected,u,this.latestValues),this.projectionTransform=RZ(this.projectionDelta,this.treeScale),(this.projectionTransform!==h||this.treeScale.x!==c||this.treeScale.y!==d)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",u)),io.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(s=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),s){const r=this.getStack();r&&r.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(s,r=!1){const l=this.snapshot,I=l?l.latestValues:{},a={...this.latestValues},C=ds();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!r;const c=Zt(),d=l?l.source:void 0,u=this.layout?this.layout.source:void 0,h=d!==u,f=this.getStack(),y=!f||f.members.length<=1,Z=!!(h&&!y&&this.options.crossfade===!0&&!this.path.some(oE));this.animationProgress=0;let p;this.mixTargetDelta=B=>{const W=B/1e3;wZ(C.x,s.x,W),wZ(C.y,s.y,W),this.setTargetDelta(C),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Mr(c,this.layout.layoutBox,this.relativeParent.layout.layoutBox),iE(this.relativeTarget,this.relativeTargetOrigin,c,W),p&&F5(this.relativeTarget,p)&&(this.isProjectionDirty=!1),p||(p=Zt()),Yn(p,this.relativeTarget)),h&&(this.animationValues=a,X5(a,I,this.latestValues,W,Z,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=W},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(s){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ug(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Qe.update(()=>{PI.hasAnimatedSinceResize=!0,this.currentAnimation=U5(0,vZ,{...s,onUpdate:r=>{this.mixTargetDelta(r),s.onUpdate&&s.onUpdate(r)},onComplete:()=>{s.onComplete&&s.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const s=this.getStack();s&&s.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(vZ),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const s=this.getLead();let{targetWithTransforms:r,target:l,layout:I,latestValues:a}=s;if(!(!r||!l||!I)){if(this!==s&&this.layout&&I&&UW(this.options.animationType,this.layout.layoutBox,I.layoutBox)){l=this.target||Zt();const C=Rn(this.layout.layoutBox.x);l.x.min=s.target.x.min,l.x.max=l.x.min+C;const c=Rn(this.layout.layoutBox.y);l.y.min=s.target.y.min,l.y.max=l.y.min+c}Yn(r,l),us(r,a),Er(this.projectionDeltaWithTransform,this.layoutCorrected,r,a)}}registerSharedNode(s,r){this.sharedNodes.has(s)||this.sharedNodes.set(s,new x5),this.sharedNodes.get(s).add(r);const I=r.options.initialPromotionConfig;r.promote({transition:I?I.transition:void 0,preserveFollowOpacity:I&&I.shouldPreserveFollowOpacity?I.shouldPreserveFollowOpacity(r):void 0})}isLead(){const s=this.getStack();return s?s.lead===this:!0}getLead(){var s;const{layoutId:r}=this.options;return r?((s=this.getStack())===null||s===void 0?void 0:s.lead)||this:this}getPrevLead(){var s;const{layoutId:r}=this.options;return r?(s=this.getStack())===null||s===void 0?void 0:s.prevLead:void 0}getStack(){const{layoutId:s}=this.options;if(s)return this.root.sharedNodes.get(s)}promote({needsReset:s,transition:r,preserveFollowOpacity:l}={}){const I=this.getStack();I&&I.promote(this,l),s&&(this.projectionDelta=void 0,this.needsReset=!0),r&&this.setOptions({transition:r})}relegate(){const s=this.getStack();return s?s.relegate(this):!1}resetSkewAndRotation(){const{visualElement:s}=this.options;if(!s)return;let r=!1;const{latestValues:l}=s;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(r=!0),!r)return;const I={};l.z&&td("z",s,I,this.animationValues);for(let a=0;a<ed.length;a++)td(`rotate${ed[a]}`,s,I,this.animationValues),td(`skew${ed[a]}`,s,I,this.animationValues);s.render();for(const a in I)s.setStaticValue(a,I[a]),this.animationValues&&(this.animationValues[a]=I[a]);s.scheduleRender()}getProjectionStyles(s){var r,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return z5;const I={visibility:""},a=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,I.opacity="",I.pointerEvents=QI(s==null?void 0:s.pointerEvents)||"",I.transform=a?a(this.latestValues,""):"none",I;const C=this.getLead();if(!this.projectionDelta||!this.layout||!C.target){const h={};return this.options.layoutId&&(h.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,h.pointerEvents=QI(s==null?void 0:s.pointerEvents)||""),this.hasProjected&&!go(this.latestValues)&&(h.transform=a?a({},""):"none",this.hasProjected=!1),h}const c=C.animationValues||C.latestValues;this.applyTransformsToTarget(),I.transform=RZ(this.projectionDeltaWithTransform,this.treeScale,c),a&&(I.transform=a(c,I.transform));const{x:d,y:u}=this.projectionDelta;I.transformOrigin=`${d.origin*100}% ${u.origin*100}% 0`,C.animationValues?I.opacity=C===this?(l=(r=c.opacity)!==null&&r!==void 0?r:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:c.opacityExit:I.opacity=C===this?c.opacity!==void 0?c.opacity:"":c.opacityExit!==void 0?c.opacityExit:0;for(const h in Ua){if(c[h]===void 0)continue;const{correct:f,applyTo:y}=Ua[h],Z=I.transform==="none"?c[h]:f(c[h],C);if(y){const p=y.length;for(let B=0;B<p;B++)I[y[B]]=Z}else I[h]=Z}return this.options.layoutId&&(I.pointerEvents=C===this?QI(s==null?void 0:s.pointerEvents)||"":"none"),I}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(s=>{var r;return(r=s.currentAnimation)===null||r===void 0?void 0:r.stop()}),this.root.nodes.forEach(kZ),this.root.sharedNodes.clear()}}}function Q5(e){e.updateLayout()}function j5(e){var t;const n=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:g,measuredBox:i}=e.layout,{animationType:o}=e.options,s=n.source!==e.layout.source;o==="size"?Hn(C=>{const c=s?n.measuredBox[C]:n.layoutBox[C],d=Rn(c);c.min=g[C].min,c.max=c.min+d}):UW(o,n.layoutBox,g)&&Hn(C=>{const c=s?n.measuredBox[C]:n.layoutBox[C],d=Rn(g[C]);c.max=c.min+d,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[C].max=e.relativeTarget[C].min+d)});const r=ds();Er(r,g,n.layoutBox);const l=ds();s?Er(l,e.applyTransform(i,!0),n.measuredBox):Er(l,g,n.layoutBox);const I=!EW(r);let a=!1;if(!e.resumeFrom){const C=e.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:c,layout:d}=C;if(c&&d){const u=Zt();Mr(u,n.layoutBox,c.layoutBox);const h=Zt();Mr(h,g,d.layoutBox),MW(u,h)||(a=!0),C.options.layoutRoot&&(e.relativeTarget=h,e.relativeTargetOrigin=u,e.relativeParent=C)}}}e.notifyListeners("didUpdate",{layout:g,snapshot:n,delta:l,layoutDelta:r,hasLayoutChanged:I,hasRelativeTargetChanged:a})}else if(e.isLead()){const{onExitComplete:g}=e.options;g&&g()}e.options.transition=void 0}function P5(e){io.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function O5(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function _5(e){e.clearSnapshot()}function kZ(e){e.clearMeasurements()}function q5(e){e.isLayoutDirty=!1}function $5(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function XZ(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function eE(e){e.resolveTargetDelta()}function tE(e){e.calcProjection()}function nE(e){e.resetSkewAndRotation()}function gE(e){e.removeLeadSnapshot()}function wZ(e,t,n){e.translate=ct(t.translate,0,n),e.scale=ct(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function JZ(e,t,n,g){e.min=ct(t.min,n.min,g),e.max=ct(t.max,n.max,g)}function iE(e,t,n,g){JZ(e.x,t.x,n.x,g),JZ(e.y,t.y,n.y,g)}function oE(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const sE={duration:.45,ease:[.4,0,.1,1]},YZ=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),HZ=YZ("applewebkit/")&&!YZ("chrome/")?Math.round:qt;function NZ(e){e.min=HZ(e.min),e.max=HZ(e.max)}function rE(e){NZ(e.x),NZ(e.y)}function UW(e,t,n){return e==="position"||e==="preserve-aspect"&&!Mu(WZ(t),WZ(n),.2)}const lE=LW({attachResizeListener:(e,t)=>Jg(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),nd={current:void 0},zW=LW({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!nd.current){const e=new lE({});e.mount(window),e.setOptions({layoutScroll:!0}),nd.current=e}return nd.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),IE={pan:{Feature:S5},drag:{Feature:B5,ProjectionNode:zW,MeasureLayout:FW}},zu={current:null},DW={current:!1};function aE(){if(DW.current=!0,!!xm)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>zu.current=e.matches;e.addListener(t),t()}else zu.current=!1}function CE(e,t,n){const{willChange:g}=t;for(const i in t){const o=t[i],s=n[i];if(_t(o))e.addValue(i,o),Pa(g)&&g.add(i);else if(_t(s))e.addValue(i,fl(o,{owner:e})),Pa(g)&&g.remove(i);else if(s!==o)if(e.hasValue(i)){const r=e.getValue(i);r.liveStyle===!0?r.jump(o):r.hasAnimated||r.set(o)}else{const r=e.getStaticValue(i);e.addValue(i,fl(r!==void 0?r:o,{owner:e}))}}for(const i in n)t[i]===void 0&&e.removeValue(i);return t}const FZ=new WeakMap,cE=[...nW,Pt,Ni],dE=e=>cE.find(tW(e)),xZ=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],uE=Tm.length;class AE{scrapeMotionValuesFromProps(t,n,g){return{}}constructor({parent:t,props:n,presenceContext:g,reducedMotionConfig:i,blockInitialAnimation:o,visualState:s},r={}){this.resolveKeyframes=(c,d,u,h)=>new this.KeyframeResolver(c,d,u,h,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=$m,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Qe.render(this.render,!1,!0);const{latestValues:l,renderState:I}=s;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=I,this.parent=t,this.props=n,this.presenceContext=g,this.depth=t?t.depth+1:0,this.reducedMotionConfig=i,this.options=r,this.blockInitialAnimation=!!o,this.isControllingVariants=YC(n),this.isVariantNode=wV(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:a,...C}=this.scrapeMotionValuesFromProps(n,{},this);for(const c in C){const d=C[c];l[c]!==void 0&&_t(d)&&(d.set(l[c],!1),Pa(a)&&a.add(c))}}mount(t){this.current=t,FZ.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,g)=>this.bindToMotionValue(g,n)),DW.current||aE(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:zu.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){FZ.delete(this.current),this.projection&&this.projection.unmount(),Ug(this.notifyUpdate),Ug(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(t,n){const g=Mo.has(t),i=n.on("change",s=>{this.latestValues[t]=s,this.props.onUpdate&&Qe.preRender(this.notifyUpdate),g&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{i(),o(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Hs){const n=Hs[t];if(!n)continue;const{isEnabled:g,Feature:i}=n;if(!this.features[t]&&i&&g(this.props)&&(this.features[t]=new i(this)),this.features[t]){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Zt()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let g=0;g<xZ.length;g++){const i=xZ[g];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o="on"+i,s=t[o];s&&(this.propEventSubscriptions[i]=this.on(i,s))}this.prevMotionValues=CE(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const g=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(g.initial=this.props.initial),g}const n={};for(let g=0;g<uE;g++){const i=Tm[g],o=this.props[i];(ml(o)||o===!1)&&(n[i]=o)}return n}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const g=this.values.get(t);n!==g&&(g&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let g=this.values.get(t);return g===void 0&&n!==void 0&&(g=fl(n===null?void 0:n,{owner:this}),this.addValue(t,g)),g}readValue(t,n){var g;let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(g=this.getBaseTargetFromProps(this.props,t))!==null&&g!==void 0?g:this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&($V(i)||qV(i))?i=parseFloat(i):!dE(i)&&Ni.test(n)&&(i=aW(t,n)),this.setBaseTarget(t,_t(i)?i.get():i)),_t(i)?i.get():i}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var n;const{initial:g}=this.props;let i;if(typeof g=="string"||typeof g=="object"){const s=_m(this.props,g,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);s&&(i=s[t])}if(g&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!_t(o)?o:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new ab),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}}class QW extends AE{constructor(){super(...arguments),this.KeyframeResolver=CW}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:g}){delete n[t],delete g[t]}}function hE(e){return window.getComputedStyle(e)}class mE extends QW{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,n){if(Mo.has(n)){const g=tb(n);return g&&g.default||0}else{const g=hE(t),i=(NV(n)?g.getPropertyValue(n):g[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(t,{transformPagePoint:n}){return HW(t,n)}build(t,n,g,i){Dm(t,n,g,i.transformTemplate)}scrapeMotionValuesFromProps(t,n,g){return Om(t,n,g)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;_t(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(t,n,g,i){MV(t,n,g,i)}}class bE extends QW{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(Mo.has(n)){const g=tb(n);return g&&g.default||0}return n=TV.has(n)?n:Km(n),t.getAttribute(n)}measureInstanceViewportBox(){return Zt()}scrapeMotionValuesFromProps(t,n,g){return UV(t,n,g)}build(t,n,g,i){jm(t,n,g,this.isSVGTag,i.transformTemplate)}renderInstance(t,n,g,i){LV(t,n,g,i)}mount(t){this.isSVGTag=Pm(t.tagName),super.mount(t)}}const pE=(e,t)=>Lm(e)?new bE(t,{enableHardwareAcceleration:!1}):new mE(t,{allowProjection:e!==H.Fragment,enableHardwareAcceleration:!0}),fE={layout:{ProjectionNode:zW,MeasureLayout:FW}},ZE={...i5,...uK,...IE,...fE},Yo=Zx((e,t)=>tK(e,t,ZE,pE)),yE=()=>{const e=Ei(),{showPopup:t}=Og(),[n,g]=H.useState(""),[i,o]=H.useState([]),[s,r]=H.useState(!0);H.useEffect(()=>{(async()=>{const d=localStorage.getItem("access_token");if(!d){t("Token no encontrado",!1),r(!1);return}try{const u=await fetch("https://securityflow.onrender.com/user/profile",{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(u.ok){const h=await u.json();console.log("Datos del usuario:",h),g(h.home||"")}else t("Error al obtener los datos del usuario",!1)}catch{t("Error de conexin",!1)}finally{r(!1)}})()},[t]),H.useEffect(()=>{n&&(async()=>{const d=localStorage.getItem("access_token");if(!d){t("Token no encontrado",!1),r(!1);return}try{const u=await fetch(`https://securityflow.onrender.com/invitation/get/invitations/${n}`,{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(u.ok){const h=await u.json();console.log("Invitaciones:",h),o(h||[])}else t("Error al obtener las invitaciones",!1)}catch{t("Error de conexin",!1)}finally{r(!1)}})()},[n,t]);const l=()=>{e("/resident/UniqueP")},I=()=>{e("/resident/MultipleP")},a=async c=>{const d=localStorage.getItem("access_token");if(!d){t("Token no encontrado",!1);return}try{(await Je.post(`https://securityflow.onrender.com/invitation/deactivate/${c}`,{},{headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}})).status===200?(t("Removido exitosamente",!0),o(h=>h.filter(f=>f.id!==c))):t("Error al revocar la invitacin",!1)}catch(u){console.error("Error revoking invitation:",u),t("Error de conexin",!1)}},C=({id:c,name:d,pictureUrl:u,dates:h})=>G.jsxs(Yo.div,{className:"bg-[#D9D9D9] bg-opacity-52 p-2 rounded-md flex flex-col sm:flex-row justify-between items-center m-2 w-full sm:w-auto font-roboto_mono",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[G.jsxs("div",{className:"flex items-center mb-2 sm:mb-0",children:[G.jsx("img",{className:"w-10 h-10 sm:mr-5 m-1",src:u||Ys,alt:"profile"}),G.jsxs("div",{className:"flex flex-col justify-center items-start sm:mr-5 m-1",children:[G.jsx("p",{className:"pt-1",children:d}),h.map((f,y)=>G.jsxs("div",{children:[G.jsx("p",{className:"pt-1",children:new Date(f.start_datetime).toLocaleDateString()}),G.jsxs("p",{className:"pt-1",children:[new Date(f.start_datetime).toLocaleTimeString()," - ",new Date(f.end_datetime).toLocaleTimeString()]})]},y))]})]}),G.jsx("div",{className:"flex justify-center items-center w-full sm:w-auto",children:G.jsx("button",{className:"rounded-md bg-[#F79E9E] p-2 m-1 w-full sm:w-auto hover:bg-red-600 transition duration-300",onClick:()=>a(c),children:"Revocar"})})]});return G.jsxs("div",{className:"flex flex-col items-center font-roboto_mono p-4",children:[G.jsx("h1",{className:"mt-5 text-2xl text-[#6185A9] text-center font-bold mb-10",children:"Crear permisos de acceso"}),G.jsxs("div",{onClick:l,className:"bg-[#F5CB50] bg-opacity-70 rounded-lg p-3 m-2 flex flex-row justify-between w-full sm:w-44 cursor-pointer hover:bg-yellow-400 transition duration-300",children:[G.jsx("p",{className:"pr-3",children:"nico"}),G.jsx("img",{className:"w-4 h-4",src:Wf,alt:"aadir"})]}),G.jsxs("div",{onClick:I,className:"bg-[#F5CB50] bg-opacity-70 rounded-lg p-3 m-2 flex flex-row items-center justify-between w-full sm:w-44 cursor-pointer hover:bg-yellow-400 transition duration-300",children:[G.jsx("p",{className:"pr-3",children:"Frecuente"}),G.jsx("img",{className:"w-4 h-4",src:Wf,alt:"aadir"})]}),G.jsx("h2",{className:"mt-10 text-2xl text-[#6185A9] text-center font-bold mb-10",children:"Permisos creados"}),s?G.jsx("div",{className:"flex justify-center items-center h-96 w-full",children:G.jsx(Nm,{size:50,color:"#4fa94d"})}):G.jsx("div",{className:"overflow-y-auto h-96 w-full flex justify-center",children:Array.isArray(i)&&i.length>0?G.jsx("div",{className:"w-full sm:w-3/4 lg:w-2/3",children:i.map((c,d)=>G.jsx(C,{id:c.id,name:c.name,pictureUrl:c.pictureurl,dates:c.dates},d))}):G.jsx("p",{className:"text-center",children:"No hay permisos creados"})})]})},GE=()=>{const{showPopup:e}=Og(),[t,n]=H.useState({email:"",date:"",time:"",finalTime:""}),[g,i]=H.useState(""),[o,s]=H.useState({});H.useEffect(()=>{(async()=>{const C=localStorage.getItem("access_token");if(!C){e("Token no encontrado",!1);return}try{const c=await fetch("https://securityflow.onrender.com/user/profile",{method:"GET",headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"}});if(c.ok){const d=await c.json();console.log("Datos del usuario:",d),i(d.home||"")}else e("Error al obtener los datos del usuario",!1)}catch{e("Error de conexin",!1)}})()},[]);const r=a=>{const{name:C,value:c}=a.target;n({...t,[C]:c})},l=async a=>{a.preventDefault();let C={};if(t.email||(C.email="El correo electrnico es obligatorio"),t.date||(C.date="La fecha es obligatoria"),t.time||(C.time="La hora de llegada es obligatoria"),t.finalTime||(C.finalTime="La hora de salida es obligatoria"),Object.keys(C).length>0){s(C);return}const c=localStorage.getItem("access_token");if(!c){e("Token no encontrado",!1);return}const d={house_number:g,user_identifier:t.email,request:!1,initial_dates:[`${t.date}T${t.time}:00`],final_dates:[`${t.date}T${t.finalTime}:00`]};try{(await fetch("https://securityflow.onrender.com/invitation/add/unique",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(d)})).status===201?(e("Solicitud enviada exitosamente",!0),n({email:"",date:"",time:"",finalTime:""}),s({})):e("Error al enviar la solicitud",!1)}catch{e("Error de conexin",!1)}},I=a=>{a.preventDefault(),e("Solicitud cancelada",!1)};return G.jsxs("div",{className:"flex items-center h-screen flex-col w-full font-roboto_mono",children:[G.jsx("h1",{className:"text-2xl text-[#6185A9] text-center pt-4 pb-1",children:"Detalles de la solicitud"}),G.jsxs("form",{onSubmit:l,children:[G.jsxs("div",{className:"flex flex-col mt-4 mb-4 width-auto",children:[G.jsx("label",{className:"text-xl mb-2",children:"Correo electrnico:"}),G.jsx("input",{type:"email",name:"email",placeholder:"Correo electrnico",className:`border ${o.email?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.email,onChange:r}),o.email&&G.jsx("p",{className:"text-red-500 text-sm",children:o.email})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-xl mb-2",children:"Fecha de visita:"}),G.jsx("input",{type:"date",name:"date",className:`border ${o.date?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.date,onChange:r}),o.date&&G.jsx("p",{className:"text-red-500 text-sm",children:o.date})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-xl mb-2",children:"Hora de llegada:"}),G.jsx("input",{type:"time",name:"time",className:`border ${o.time?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.time,onChange:r}),o.time&&G.jsx("p",{className:"text-red-500 text-sm",children:o.time})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-8",children:[G.jsx("label",{className:"text-xl mb-2",children:"Hora de salida:"}),G.jsx("input",{type:"time",name:"finalTime",className:`border ${o.finalTime?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.finalTime,onChange:r}),o.finalTime&&G.jsx("p",{className:"text-red-500 text-sm",children:o.finalTime})]}),G.jsxs("div",{className:"flex flex-row pt-2",children:[G.jsx("div",{className:"p-4 mr-4 rounded-lg bg-[#F8BD0D] bg-opacity-70 hover:bg-yellow-400 transition duration-300 transform hover:scale-105",children:G.jsx("button",{type:"submit",children:"Aceptar"})}),G.jsx("div",{className:"p-4 rounded-lg bg-[#F79E9E] hover:bg-red-600 transition duration-300 transform hover:scale-105",children:G.jsx("button",{type:"button",onClick:I,children:"Cancelar"})})]})]})]})},xC=()=>{const{user:e,setUser:t}=H.useContext(fh),[n,g]=H.useState(Ys),[i,o]=H.useState(""),[s,r]=H.useState(""),[l,I]=H.useState("Casa #No asignado"),[a,C]=H.useState(!1);H.useEffect(()=>{(async()=>{try{const u=await fu();t(u),o(u.name),r(u.dui||"00000000-0");const h=localStorage.getItem("picture")||u.pictureurl;h&&g(h),u.roles.includes("Residente encargado")||u.roles.includes("Residente normal")?I(u.home?`Casa #${u.home}`:"Casa #No asignado"):I(null)}catch(u){console.error("Error fetching user profile:",u)}})()},[t]);const c=async()=>{try{await AY(i),await hY(s),C(!1);const d=await fu();t(d),o(d.name),r(d.dui||"00000000-0");const u=localStorage.getItem("picture")||d.pictureurl;u&&g(u),d.roles.includes("Residente encargado")||d.roles.includes("Residente normal")?I(d.home?`Casa #${d.home}`:"Casa #No asignado"):I(null)}catch(d){console.error("Error updating profile:",d)}};return e?G.jsx("div",{className:"flex items-center justify-center h-screen",children:G.jsxs("div",{className:"flex flex-col items-center bg-gray-900 w-4/5 rounded-2xl font-roboto_mono text-white p-6",children:[G.jsx("div",{className:"mt-12 mb-4",children:G.jsx("img",{src:n,alt:"Avatar",className:"w-40 h-40 rounded-full object-cover"})}),a?G.jsxs("div",{className:"flex flex-col items-center w-full",children:[G.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"text-center text-3xl mb-2 bg-gray-700 p-2 rounded w-full"}),G.jsx("input",{type:"text",value:s,onChange:d=>r(d.target.value),className:"text-center text-base sm:text-2xl mb-2 bg-gray-700 p-2 rounded w-full"}),G.jsx("button",{className:"bg-amarillo-principal text-black py-2 px-4 rounded-md font-roboto_mono mt-4",onClick:c,children:"Guardar Cambios"})]}):G.jsxs("div",{className:"flex flex-col items-center w-full",children:[G.jsx("p",{className:"text-center text-3xl mb-2",children:i}),G.jsx("p",{className:"text-center text-base sm:text-2xl mb-2",children:e.email}),G.jsxs("p",{className:"text-center text-base sm:text-2xl mb-2",children:[G.jsx("span",{className:"font-bold",children:"DUI: "}),s]}),l&&G.jsx("p",{className:"text-center text-2xl mb-2",children:l}),G.jsx("button",{className:"bg-amarillo-principal text-black py-2 px-4 rounded-md font-roboto_mono mt-4",onClick:()=>C(!0),children:"Editar Perfil"})]})]})}):G.jsx("div",{children:"Loading..."})},BE=()=>G.jsx("div",{children:G.jsx(xC,{})}),SE=()=>{const[e,t]=H.useState([]),[n,g]=H.useState(null),[i,o]=H.useState({email:""}),[s,r]=H.useState(!0),[l,I]=H.useState(""),a=u=>{const{name:h,value:f}=u.target;o({...i,[h]:f})},C=async u=>{if(u.preventDefault(),!i.email){I("Todos los campos son obligatorios");return}const h=localStorage.getItem("access_token");if(h)try{const f=await Je.post("https://securityflow.onrender.com/home/assign/normal",{identifier:i.email,num_home:n},{headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});I("Residente aadido"),d(),o({email:""}),setTimeout(()=>{I("")},3e3)}catch(f){I("Error al aadir residente"),o({email:""}),console.error("Error adding resident:",f),setTimeout(()=>{I("")},3e3)}else I("No token found in local storage"),setTimeout(()=>{I("")},3e3)},c=async u=>{const h=localStorage.getItem("access_token");if(h)try{await Je.post("https://securityflow.onrender.com/auth/user-role",{identifier:u,role_name:"VSTT"},{headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}}),I("Residente eliminado"),d(),setTimeout(()=>{I("")},3e3)}catch(f){I("Error al eliminar residente"),console.error("Error deleting resident:",f),setTimeout(()=>{I("")},3e3)}else I("No token found in local storage"),setTimeout(()=>{I("")},3e3)},d=async()=>{const u=localStorage.getItem("access_token");if(u)try{const f=(await Je.get("https://securityflow.onrender.com/user/profile",{headers:{Authorization:`Bearer ${u}`}})).data;if(g(f.home),f.home){const Z=(await Je.get(`https://securityflow.onrender.com/home/residents?numHome=${f.home}`,{headers:{Authorization:`Bearer ${u}`}})).data.filter(p=>p.role==="Residente normal");t(Z)}}catch(h){console.error("Error fetching data:",h)}finally{r(!1)}else console.error("No token found in local storage"),r(!1)};return H.useEffect(()=>{d()},[]),G.jsxs("div",{className:"flex flex-col items-center h-screen w-full font-roboto_mono p-4",children:[G.jsx("h1",{className:"text-2xl text-[#6185A9] text-center font-bold",children:"Aadir residentes al hogar"}),G.jsxs("form",{onSubmit:C,className:"w-full max-w-md mb-8",children:[G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Correo electrnico:"}),G.jsx("input",{type:"email",name:"email",placeholder:"Correo electrnico",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:i.email,onChange:a})]}),G.jsx("button",{type:"submit",className:"p-3 rounded-md bg-[#F79E9E] w-full mb-4 hover:bg-[#F79E9E] hover:shadow-md transition duration-300 ease-in-out transform hover:scale-105 active:scale-95",children:"Aadir"})]}),l&&G.jsx("p",{className:"text-center text-red-500 mb-4",children:l}),G.jsx("h1",{className:"text-2xl text-[#6185A9] text-center font-bold mb-4",children:"Residentes activos"}),s?G.jsx(al,{color:"#6185A9",loading:s,size:50}):G.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 w-full",children:e.map(u=>G.jsxs(Yo.div,{className:"bg-[#D9D9D9] bg-opacity-52 p-4 rounded-md flex flex-col justify-between items-center w-full min-h-[150px]",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[G.jsx("img",{className:"w-16 h-16 mb-4",src:Ys,alt:"profile"}),G.jsxs("div",{className:"flex flex-col justify-center items-center text-center",children:[G.jsx("p",{className:"font-semibold",children:u.username}),G.jsx("p",{children:u.email})]}),G.jsx("button",{onClick:()=>c(u.email),className:"bg-[#F8BD0D] bg-opacity-70 p-2 mt-4 rounded-md hover:bg-[#F8BD0D] hover:shadow-md transition duration-300 ease-in-out transform hover:scale-105 active:scale-95",children:"Eliminar"})]},u.code))})]})},VE=({email:e,fecha:t,hora:n})=>(Og(),G.jsxs("div",{className:"bg-[#D9D9D9] bg-opacity-52 p-2 rounded-md flex flex-col sm:flex-row justify-center items-center m-2 w-auto font-roboto_mono",children:[G.jsx("img",{className:"w-10 h-10 sm:mr-5 m-1",src:Ys,alt:"profile"}),G.jsxs("div",{className:"flex flex-col justify-center items-center sm:mr-5 m-1",children:[G.jsx("p",{className:"pt-1 text-center",children:e}),G.jsx("p",{className:"pt-1 text-center",children:t}),G.jsx("p",{className:"pt-1 text-center",children:n})]})]})),WE=()=>{const[e,t]=H.useState([]),[n,g]=H.useState(""),[i,o]=H.useState(""),[s,r]=H.useState(""),[l,I]=H.useState("");H.useEffect(()=>{(async()=>{try{const u=localStorage.getItem("access_token"),h=await Je.get("https://securityflow.onrender.com/user/profile",{headers:{Authorization:`Bearer ${u}`}});console.log(h.data),I(h.data.home)}catch(u){console.error("Error fetching user profile:",u),r("Error al cargar el perfil del usuario. Intntalo de nuevo ms tarde.")}})()},[]);const a=d=>{g(d.target.value)},C=d=>{o(d.target.value)},c=async()=>{if(!n||!i){r("Por favor, seleccione ambas fechas.");return}if(!l){r("Error al obtener el nmero de casa. Intntalo de nuevo ms tarde.");return}try{const d=localStorage.getItem("access_token"),u=await Je.post("https://securityflow.onrender.com/entry/by-home",{home:l,from:`${n}T00:00:00`,to:`${i}T00:00:00`},{headers:{Authorization:`Bearer ${d}`}});console.log(u.data),t(u.data.details),r("")}catch(d){console.error("Error fetching visits:",d),r("Error al cargar las visitas. Intntalo de nuevo ms tarde.")}};return G.jsxs("div",{className:"flex items-center flex-col w-full font-roboto_mono",children:[G.jsx("h1",{className:"text-2xl text-[#6185A9] text-center mt-4 font-roboto_mono font-bold",children:"Registro de visitas"}),G.jsx("div",{className:"flex flex-col sm:flex-row justify-center items-center w-full mt-4",children:G.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[G.jsxs("div",{className:"flex flex-col items-center",children:[G.jsx("label",{htmlFor:"startDate",className:"text-gray-700 mb-2",children:"Desde"}),G.jsx("input",{id:"startDate",type:"date",value:n,onChange:a,className:"p-2 border border-gray-300 rounded-md shadow-sm"})]}),G.jsxs("div",{className:"flex flex-col items-center",children:[G.jsx("label",{htmlFor:"endDate",className:"text-gray-700 mb-2",children:"Hasta"}),G.jsx("input",{id:"endDate",type:"date",value:i,onChange:C,className:"p-2 border border-gray-300 rounded-md shadow-sm"})]}),G.jsx("button",{onClick:c,className:"bg-amarillo-principal text-black py-1 px-4 rounded-md text-sm font-roboto_mono mt-4 hover:bg-yellow-600 transition duration-300 ease-in-out transform hover:scale-105 active:scale-95",children:"Buscar"})]})}),s&&G.jsx("p",{className:"text-red-500 mt-4",children:s}),G.jsx("div",{className:"mt-7 overflow-y-auto h-96 mb-8 w-full px-4 sm:px-0",children:e.length>0?G.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 ${e.length===1?"justify-center":""}`,children:e.map((d,u)=>G.jsx(Yo.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:G.jsx(VE,{email:d.userEmail,fecha:new Date(d.date).toLocaleDateString(),hora:new Date(d.date).toLocaleTimeString()})},u))}):G.jsx("p",{className:"text-gray-700 mt-4 text-center",children:"No se encontraron resultados"})})]})};var RE=Object.defineProperty,_a=Object.getOwnPropertySymbols,jW=Object.prototype.hasOwnProperty,PW=Object.prototype.propertyIsEnumerable,KZ=(e,t,n)=>t in e?RE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Zl=(e,t)=>{for(var n in t||(t={}))jW.call(t,n)&&KZ(e,n,t[n]);if(_a)for(var n of _a(t))PW.call(t,n)&&KZ(e,n,t[n]);return e},Cb=(e,t)=>{var n={};for(var g in e)jW.call(e,g)&&t.indexOf(g)<0&&(n[g]=e[g]);if(e!=null&&_a)for(var g of _a(e))t.indexOf(g)<0&&PW.call(e,g)&&(n[g]=e[g]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var Ho;(e=>{const t=class{constructor(l,I,a,C){if(this.version=l,this.errorCorrectionLevel=I,this.modules=[],this.isFunction=[],l<t.MIN_VERSION||l>t.MAX_VERSION)throw new RangeError("Version value out of range");if(C<-1||C>7)throw new RangeError("Mask value out of range");this.size=l*4+17;let c=[];for(let u=0;u<this.size;u++)c.push(!1);for(let u=0;u<this.size;u++)this.modules.push(c.slice()),this.isFunction.push(c.slice());this.drawFunctionPatterns();const d=this.addEccAndInterleave(a);if(this.drawCodewords(d),C==-1){let u=1e9;for(let h=0;h<8;h++){this.applyMask(h),this.drawFormatBits(h);const f=this.getPenaltyScore();f<u&&(C=h,u=f),this.applyMask(h)}}o(0<=C&&C<=7),this.mask=C,this.applyMask(C),this.drawFormatBits(C),this.isFunction=[]}static encodeText(l,I){const a=e.QrSegment.makeSegments(l);return t.encodeSegments(a,I)}static encodeBinary(l,I){const a=e.QrSegment.makeBytes(l);return t.encodeSegments([a],I)}static encodeSegments(l,I,a=1,C=40,c=-1,d=!0){if(!(t.MIN_VERSION<=a&&a<=C&&C<=t.MAX_VERSION)||c<-1||c>7)throw new RangeError("Invalid value");let u,h;for(u=a;;u++){const p=t.getNumDataCodewords(u,I)*8,B=r.getTotalBits(l,u);if(B<=p){h=B;break}if(u>=C)throw new RangeError("Data too long")}for(const p of[t.Ecc.MEDIUM,t.Ecc.QUARTILE,t.Ecc.HIGH])d&&h<=t.getNumDataCodewords(u,p)*8&&(I=p);let f=[];for(const p of l){g(p.mode.modeBits,4,f),g(p.numChars,p.mode.numCharCountBits(u),f);for(const B of p.getData())f.push(B)}o(f.length==h);const y=t.getNumDataCodewords(u,I)*8;o(f.length<=y),g(0,Math.min(4,y-f.length),f),g(0,(8-f.length%8)%8,f),o(f.length%8==0);for(let p=236;f.length<y;p^=253)g(p,8,f);let Z=[];for(;Z.length*8<f.length;)Z.push(0);return f.forEach((p,B)=>Z[B>>>3]|=p<<7-(B&7)),new t(u,I,Z,c)}getModule(l,I){return 0<=l&&l<this.size&&0<=I&&I<this.size&&this.modules[I][l]}getModules(){return this.modules}drawFunctionPatterns(){for(let a=0;a<this.size;a++)this.setFunctionModule(6,a,a%2==0),this.setFunctionModule(a,6,a%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const l=this.getAlignmentPatternPositions(),I=l.length;for(let a=0;a<I;a++)for(let C=0;C<I;C++)a==0&&C==0||a==0&&C==I-1||a==I-1&&C==0||this.drawAlignmentPattern(l[a],l[C]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(l){const I=this.errorCorrectionLevel.formatBits<<3|l;let a=I;for(let c=0;c<10;c++)a=a<<1^(a>>>9)*1335;const C=(I<<10|a)^21522;o(C>>>15==0);for(let c=0;c<=5;c++)this.setFunctionModule(8,c,i(C,c));this.setFunctionModule(8,7,i(C,6)),this.setFunctionModule(8,8,i(C,7)),this.setFunctionModule(7,8,i(C,8));for(let c=9;c<15;c++)this.setFunctionModule(14-c,8,i(C,c));for(let c=0;c<8;c++)this.setFunctionModule(this.size-1-c,8,i(C,c));for(let c=8;c<15;c++)this.setFunctionModule(8,this.size-15+c,i(C,c));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let l=this.version;for(let a=0;a<12;a++)l=l<<1^(l>>>11)*7973;const I=this.version<<12|l;o(I>>>18==0);for(let a=0;a<18;a++){const C=i(I,a),c=this.size-11+a%3,d=Math.floor(a/3);this.setFunctionModule(c,d,C),this.setFunctionModule(d,c,C)}}drawFinderPattern(l,I){for(let a=-4;a<=4;a++)for(let C=-4;C<=4;C++){const c=Math.max(Math.abs(C),Math.abs(a)),d=l+C,u=I+a;0<=d&&d<this.size&&0<=u&&u<this.size&&this.setFunctionModule(d,u,c!=2&&c!=4)}}drawAlignmentPattern(l,I){for(let a=-2;a<=2;a++)for(let C=-2;C<=2;C++)this.setFunctionModule(l+C,I+a,Math.max(Math.abs(C),Math.abs(a))!=1)}setFunctionModule(l,I,a){this.modules[I][l]=a,this.isFunction[I][l]=!0}addEccAndInterleave(l){const I=this.version,a=this.errorCorrectionLevel;if(l.length!=t.getNumDataCodewords(I,a))throw new RangeError("Invalid argument");const C=t.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][I],c=t.ECC_CODEWORDS_PER_BLOCK[a.ordinal][I],d=Math.floor(t.getNumRawDataModules(I)/8),u=C-d%C,h=Math.floor(d/C);let f=[];const y=t.reedSolomonComputeDivisor(c);for(let p=0,B=0;p<C;p++){let W=l.slice(B,B+h-c+(p<u?0:1));B+=W.length;const S=t.reedSolomonComputeRemainder(W,y);p<u&&W.push(0),f.push(W.concat(S))}let Z=[];for(let p=0;p<f[0].length;p++)f.forEach((B,W)=>{(p!=h-c||W>=u)&&Z.push(B[p])});return o(Z.length==d),Z}drawCodewords(l){if(l.length!=Math.floor(t.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let I=0;for(let a=this.size-1;a>=1;a-=2){a==6&&(a=5);for(let C=0;C<this.size;C++)for(let c=0;c<2;c++){const d=a-c,h=(a+1&2)==0?this.size-1-C:C;!this.isFunction[h][d]&&I<l.length*8&&(this.modules[h][d]=i(l[I>>>3],7-(I&7)),I++)}}o(I==l.length*8)}applyMask(l){if(l<0||l>7)throw new RangeError("Mask value out of range");for(let I=0;I<this.size;I++)for(let a=0;a<this.size;a++){let C;switch(l){case 0:C=(a+I)%2==0;break;case 1:C=I%2==0;break;case 2:C=a%3==0;break;case 3:C=(a+I)%3==0;break;case 4:C=(Math.floor(a/3)+Math.floor(I/2))%2==0;break;case 5:C=a*I%2+a*I%3==0;break;case 6:C=(a*I%2+a*I%3)%2==0;break;case 7:C=((a+I)%2+a*I%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[I][a]&&C&&(this.modules[I][a]=!this.modules[I][a])}}getPenaltyScore(){let l=0;for(let c=0;c<this.size;c++){let d=!1,u=0,h=[0,0,0,0,0,0,0];for(let f=0;f<this.size;f++)this.modules[c][f]==d?(u++,u==5?l+=t.PENALTY_N1:u>5&&l++):(this.finderPenaltyAddHistory(u,h),d||(l+=this.finderPenaltyCountPatterns(h)*t.PENALTY_N3),d=this.modules[c][f],u=1);l+=this.finderPenaltyTerminateAndCount(d,u,h)*t.PENALTY_N3}for(let c=0;c<this.size;c++){let d=!1,u=0,h=[0,0,0,0,0,0,0];for(let f=0;f<this.size;f++)this.modules[f][c]==d?(u++,u==5?l+=t.PENALTY_N1:u>5&&l++):(this.finderPenaltyAddHistory(u,h),d||(l+=this.finderPenaltyCountPatterns(h)*t.PENALTY_N3),d=this.modules[f][c],u=1);l+=this.finderPenaltyTerminateAndCount(d,u,h)*t.PENALTY_N3}for(let c=0;c<this.size-1;c++)for(let d=0;d<this.size-1;d++){const u=this.modules[c][d];u==this.modules[c][d+1]&&u==this.modules[c+1][d]&&u==this.modules[c+1][d+1]&&(l+=t.PENALTY_N2)}let I=0;for(const c of this.modules)I=c.reduce((d,u)=>d+(u?1:0),I);const a=this.size*this.size,C=Math.ceil(Math.abs(I*20-a*10)/a)-1;return o(0<=C&&C<=9),l+=C*t.PENALTY_N4,o(0<=l&&l<=2568888),l}getAlignmentPatternPositions(){if(this.version==1)return[];{const l=Math.floor(this.version/7)+2,I=this.version==32?26:Math.ceil((this.version*4+4)/(l*2-2))*2;let a=[6];for(let C=this.size-7;a.length<l;C-=I)a.splice(1,0,C);return a}}static getNumRawDataModules(l){if(l<t.MIN_VERSION||l>t.MAX_VERSION)throw new RangeError("Version number out of range");let I=(16*l+128)*l+64;if(l>=2){const a=Math.floor(l/7)+2;I-=(25*a-10)*a-55,l>=7&&(I-=36)}return o(208<=I&&I<=29648),I}static getNumDataCodewords(l,I){return Math.floor(t.getNumRawDataModules(l)/8)-t.ECC_CODEWORDS_PER_BLOCK[I.ordinal][l]*t.NUM_ERROR_CORRECTION_BLOCKS[I.ordinal][l]}static reedSolomonComputeDivisor(l){if(l<1||l>255)throw new RangeError("Degree out of range");let I=[];for(let C=0;C<l-1;C++)I.push(0);I.push(1);let a=1;for(let C=0;C<l;C++){for(let c=0;c<I.length;c++)I[c]=t.reedSolomonMultiply(I[c],a),c+1<I.length&&(I[c]^=I[c+1]);a=t.reedSolomonMultiply(a,2)}return I}static reedSolomonComputeRemainder(l,I){let a=I.map(C=>0);for(const C of l){const c=C^a.shift();a.push(0),I.forEach((d,u)=>a[u]^=t.reedSolomonMultiply(d,c))}return a}static reedSolomonMultiply(l,I){if(l>>>8||I>>>8)throw new RangeError("Byte out of range");let a=0;for(let C=7;C>=0;C--)a=a<<1^(a>>>7)*285,a^=(I>>>C&1)*l;return o(a>>>8==0),a}finderPenaltyCountPatterns(l){const I=l[1];o(I<=this.size*3);const a=I>0&&l[2]==I&&l[3]==I*3&&l[4]==I&&l[5]==I;return(a&&l[0]>=I*4&&l[6]>=I?1:0)+(a&&l[6]>=I*4&&l[0]>=I?1:0)}finderPenaltyTerminateAndCount(l,I,a){return l&&(this.finderPenaltyAddHistory(I,a),I=0),I+=this.size,this.finderPenaltyAddHistory(I,a),this.finderPenaltyCountPatterns(a)}finderPenaltyAddHistory(l,I){I[0]==0&&(l+=this.size),I.pop(),I.unshift(l)}};let n=t;n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=n;function g(l,I,a){if(I<0||I>31||l>>>I)throw new RangeError("Value out of range");for(let C=I-1;C>=0;C--)a.push(l>>>C&1)}function i(l,I){return(l>>>I&1)!=0}function o(l){if(!l)throw new Error("Assertion error")}const s=class{constructor(l,I,a){if(this.mode=l,this.numChars=I,this.bitData=a,I<0)throw new RangeError("Invalid argument");this.bitData=a.slice()}static makeBytes(l){let I=[];for(const a of l)g(a,8,I);return new s(s.Mode.BYTE,l.length,I)}static makeNumeric(l){if(!s.isNumeric(l))throw new RangeError("String contains non-numeric characters");let I=[];for(let a=0;a<l.length;){const C=Math.min(l.length-a,3);g(parseInt(l.substr(a,C),10),C*3+1,I),a+=C}return new s(s.Mode.NUMERIC,l.length,I)}static makeAlphanumeric(l){if(!s.isAlphanumeric(l))throw new RangeError("String contains unencodable characters in alphanumeric mode");let I=[],a;for(a=0;a+2<=l.length;a+=2){let C=s.ALPHANUMERIC_CHARSET.indexOf(l.charAt(a))*45;C+=s.ALPHANUMERIC_CHARSET.indexOf(l.charAt(a+1)),g(C,11,I)}return a<l.length&&g(s.ALPHANUMERIC_CHARSET.indexOf(l.charAt(a)),6,I),new s(s.Mode.ALPHANUMERIC,l.length,I)}static makeSegments(l){return l==""?[]:s.isNumeric(l)?[s.makeNumeric(l)]:s.isAlphanumeric(l)?[s.makeAlphanumeric(l)]:[s.makeBytes(s.toUtf8ByteArray(l))]}static makeEci(l){let I=[];if(l<0)throw new RangeError("ECI assignment value out of range");if(l<128)g(l,8,I);else if(l<16384)g(2,2,I),g(l,14,I);else if(l<1e6)g(6,3,I),g(l,21,I);else throw new RangeError("ECI assignment value out of range");return new s(s.Mode.ECI,0,I)}static isNumeric(l){return s.NUMERIC_REGEX.test(l)}static isAlphanumeric(l){return s.ALPHANUMERIC_REGEX.test(l)}getData(){return this.bitData.slice()}static getTotalBits(l,I){let a=0;for(const C of l){const c=C.mode.numCharCountBits(I);if(C.numChars>=1<<c)return 1/0;a+=4+c+C.bitData.length}return a}static toUtf8ByteArray(l){l=encodeURI(l);let I=[];for(let a=0;a<l.length;a++)l.charAt(a)!="%"?I.push(l.charCodeAt(a)):(I.push(parseInt(l.substr(a+1,2),16)),a+=2);return I}};let r=s;r.NUMERIC_REGEX=/^[0-9]*$/,r.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,r.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e.QrSegment=r})(Ho||(Ho={}));(e=>{(t=>{const n=class{constructor(i,o){this.ordinal=i,this.formatBits=o}};let g=n;g.LOW=new n(0,1),g.MEDIUM=new n(1,0),g.QUARTILE=new n(2,3),g.HIGH=new n(3,2),t.Ecc=g})(e.QrCode||(e.QrCode={}))})(Ho||(Ho={}));(e=>{(t=>{const n=class{constructor(i,o){this.modeBits=i,this.numBitsCharCount=o}numCharCountBits(i){return this.numBitsCharCount[Math.floor((i+7)/17)]}};let g=n;g.NUMERIC=new n(1,[10,12,14]),g.ALPHANUMERIC=new n(2,[9,11,13]),g.BYTE=new n(4,[8,16,16]),g.KANJI=new n(8,[8,10,12]),g.ECI=new n(7,[0,0,0]),t.Mode=g})(e.QrSegment||(e.QrSegment={}))})(Ho||(Ho={}));var As=Ho;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var OW={L:As.QrCode.Ecc.LOW,M:As.QrCode.Ecc.MEDIUM,Q:As.QrCode.Ecc.QUARTILE,H:As.QrCode.Ecc.HIGH},_W=128,qW="L",$W="#FFFFFF",eR="#000000",tR=!1,cb=4,vE=.1;function nR(e,t=0){const n=[];return e.forEach(function(g,i){let o=null;g.forEach(function(s,r){if(!s&&o!==null){n.push(`M${o+t} ${i+t}h${r-o}v1H${o+t}z`),o=null;return}if(r===g.length-1){if(!s)return;o===null?n.push(`M${r+t},${i+t} h1v1H${r+t}z`):n.push(`M${o+t},${i+t} h${r+1-o}v1H${o+t}z`);return}s&&o===null&&(o=r)})}),n.join("")}function gR(e,t){return e.slice().map((n,g)=>g<t.y||g>=t.y+t.h?n:n.map((i,o)=>o<t.x||o>=t.x+t.w?i:!1))}function iR(e,t,n,g){if(g==null)return null;const i=n?cb:0,o=e.length+i*2,s=Math.floor(t*vE),r=o/t,l=(g.width||s)*r,I=(g.height||s)*r,a=g.x==null?e.length/2-l/2:g.x*r,C=g.y==null?e.length/2-I/2:g.y*r;let c=null;if(g.excavate){let d=Math.floor(a),u=Math.floor(C),h=Math.ceil(l+a-d),f=Math.ceil(I+C-u);c={x:d,y:u,w:h,h:f}}return{x:a,y:C,h:I,w:l,excavation:c}}var kE=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}();function XE(e){const t=e,{value:n,size:g=_W,level:i=qW,bgColor:o=$W,fgColor:s=eR,includeMargin:r=tR,style:l,imageSettings:I}=t,a=Cb(t,["value","size","level","bgColor","fgColor","includeMargin","style","imageSettings"]),C=I==null?void 0:I.src,c=H.useRef(null),d=H.useRef(null),[u,h]=H.useState(!1);H.useEffect(()=>{if(c.current!=null){const Z=c.current,p=Z.getContext("2d");if(!p)return;let B=As.QrCode.encodeText(n,OW[i]).getModules();const W=r?cb:0,S=B.length+W*2,V=iR(B,g,r,I),R=d.current,J=V!=null&&R!==null&&R.complete&&R.naturalHeight!==0&&R.naturalWidth!==0;J&&V.excavation!=null&&(B=gR(B,V.excavation));const M=window.devicePixelRatio||1;Z.height=Z.width=g*M;const P=g/S*M;p.scale(P,P),p.fillStyle=o,p.fillRect(0,0,S,S),p.fillStyle=s,kE?p.fill(new Path2D(nR(B,W))):B.forEach(function(X,L){X.forEach(function(ne,D){ne&&p.fillRect(D+W,L+W,1,1)})}),J&&p.drawImage(R,V.x+W,V.y+W,V.w,V.h)}}),H.useEffect(()=>{h(!1)},[C]);const f=Zl({height:g,width:g},l);let y=null;return C!=null&&(y=sn.createElement("img",{src:C,key:C,style:{display:"none"},onLoad:()=>{h(!0)},ref:d})),sn.createElement(sn.Fragment,null,sn.createElement("canvas",Zl({style:f,height:g,width:g,ref:c},a)),y)}function wE(e){const t=e,{value:n,size:g=_W,level:i=qW,bgColor:o=$W,fgColor:s=eR,includeMargin:r=tR,imageSettings:l}=t,I=Cb(t,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let a=As.QrCode.encodeText(n,OW[i]).getModules();const C=r?cb:0,c=a.length+C*2,d=iR(a,g,r,l);let u=null;l!=null&&d!=null&&(d.excavation!=null&&(a=gR(a,d.excavation)),u=sn.createElement("image",{xlinkHref:l.src,height:d.h,width:d.w,x:d.x+C,y:d.y+C,preserveAspectRatio:"none"}));const h=nR(a,C);return sn.createElement("svg",Zl({height:g,width:g,viewBox:`0 0 ${c} ${c}`},I),sn.createElement("path",{fill:o,d:`M0,0 h${c}v${c}H0z`,shapeRendering:"crispEdges"}),sn.createElement("path",{fill:s,d:h,shapeRendering:"crispEdges"}),u)}var oR=e=>{const t=e,{renderAs:n}=t,g=Cb(t,["renderAs"]);return n==="svg"?sn.createElement(wE,Zl({},g)):sn.createElement(XE,Zl({},g))},db={};db.match=xE;db.parse=sR;var JE=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,YE=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,HE=/^(?:(min|max)-)?(.+)/,NE=/(em|rem|px|cm|mm|in|pt|pc)?$/,FE=/(dpi|dpcm|dppx)?$/;function xE(e,t){return sR(e).some(function(n){var g=n.inverse,i=n.type==="all"||t.type===n.type;if(i&&g||!(i||g))return!1;var o=n.expressions.every(function(s){var r=s.feature,l=s.modifier,I=s.value,a=t[r];if(!a)return!1;switch(r){case"orientation":case"scan":return a.toLowerCase()===I.toLowerCase();case"width":case"height":case"device-width":case"device-height":I=TZ(I),a=TZ(a);break;case"resolution":I=MZ(I),a=MZ(a);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":I=EZ(I),a=EZ(a);break;case"grid":case"color":case"color-index":case"monochrome":I=parseInt(I,10)||1,a=parseInt(a,10)||0;break}switch(l){case"min":return a>=I;case"max":return a<=I;default:return a===I}});return o&&!g||!o&&g})}function sR(e){return e.split(",").map(function(t){t=t.trim();var n=t.match(JE),g=n[1],i=n[2],o=n[3]||"",s={};return s.inverse=!!g&&g.toLowerCase()==="not",s.type=i?i.toLowerCase():"all",o=o.match(/\([^\)]+\)/g)||[],s.expressions=o.map(function(r){var l=r.match(YE),I=l[1].toLowerCase().match(HE);return{modifier:I[1],feature:I[2],value:l[2]}}),s})}function EZ(e){var t=Number(e),n;return t||(n=e.match(/^(\d+)\s*\/\s*(\d+)$/),t=n[1]/n[2]),t}function MZ(e){var t=parseFloat(e),n=String(e).match(FE)[1];switch(n){case"dpcm":return t/2.54;case"dppx":return t*96;default:return t}}function TZ(e){var t=parseFloat(e),n=String(e).match(NE)[1];switch(n){case"em":return t*16;case"rem":return t*16;case"cm":return t*96/2.54;case"mm":return t*96/2.54/10;case"in":return t*96;case"pt":return t*72;case"pc":return t*72/12;default:return t}}var KE=db.match,LZ=typeof window<"u"?window.matchMedia:null;function EE(e,t,n){var g=this,i;LZ&&!n&&(i=LZ.call(window,e)),i?(this.matches=i.matches,this.media=i.media,i.addListener(r)):(this.matches=KE(e,t),this.media=e),this.addListener=o,this.removeListener=s,this.dispose=l;function o(I){i&&i.addListener(I)}function s(I){i&&i.removeListener(I)}function r(I){g.matches=I.matches,g.media=I.media}function l(){i&&i.removeListener(r)}}function ME(e,t,n){return new EE(e,t,n)}var TE=ME;const LE=Ah(TE);var UE=/[A-Z]/g,zE=/^ms-/,gd={};function DE(e){return"-"+e.toLowerCase()}function rR(e){if(gd.hasOwnProperty(e))return gd[e];var t=e.replace(UE,DE);return gd[e]=zE.test(t)?"-"+t:t}function QE(e,t){if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),g=Object.keys(t),i=n.length;if(g.length!==i)return!1;for(let o=0;o<i;o++){const s=n[o];if(e[s]!==t[s]||!Object.prototype.hasOwnProperty.call(t,s))return!1}return!0}var lR={exports:{}},jE="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",PE=jE,OE=PE;function IR(){}function aR(){}aR.resetWarningCache=IR;var _E=function(){function e(g,i,o,s,r,l){if(l!==OE){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:aR,resetWarningCache:IR};return n.PropTypes=n,n};lR.exports=_E();var qE=lR.exports;const Ue=Ah(qE),nn=Ue.oneOfType([Ue.string,Ue.number]),ub={all:Ue.bool,grid:Ue.bool,aural:Ue.bool,braille:Ue.bool,handheld:Ue.bool,print:Ue.bool,projection:Ue.bool,screen:Ue.bool,tty:Ue.bool,tv:Ue.bool,embossed:Ue.bool},CR={orientation:Ue.oneOf(["portrait","landscape"]),scan:Ue.oneOf(["progressive","interlace"]),aspectRatio:Ue.string,deviceAspectRatio:Ue.string,height:nn,deviceHeight:nn,width:nn,deviceWidth:nn,color:Ue.bool,colorIndex:Ue.bool,monochrome:Ue.bool,resolution:nn,type:Object.keys(ub)},{type:iL,...$E}=CR,cR={minAspectRatio:Ue.string,maxAspectRatio:Ue.string,minDeviceAspectRatio:Ue.string,maxDeviceAspectRatio:Ue.string,minHeight:nn,maxHeight:nn,minDeviceHeight:nn,maxDeviceHeight:nn,minWidth:nn,maxWidth:nn,minDeviceWidth:nn,maxDeviceWidth:nn,minColor:Ue.number,maxColor:Ue.number,minColorIndex:Ue.number,maxColorIndex:Ue.number,minMonochrome:Ue.number,maxMonochrome:Ue.number,minResolution:nn,maxResolution:nn,...$E},e3={...ub,...cR};var t3={all:e3,types:ub,matchers:CR,features:cR};const n3=e=>`not ${e}`,g3=(e,t)=>{const n=rR(e);return typeof t=="number"&&(t=`${t}px`),t===!0?n:t===!1?n3(n):`(${n}: ${t})`},i3=e=>e.join(" and "),o3=e=>{const t=[];return Object.keys(t3.all).forEach(n=>{const g=e[n];g!=null&&t.push(g3(n,g))}),i3(t)},s3=H.createContext(void 0),r3=e=>e.query||o3(e),UZ=e=>e?Object.keys(e).reduce((n,g)=>(n[rR(g)]=e[g],n),{}):void 0,dR=()=>{const e=H.useRef(!1);return H.useEffect(()=>{e.current=!0},[]),e.current},l3=e=>{const t=H.useContext(s3),n=()=>UZ(e)||UZ(t),[g,i]=H.useState(n);return H.useEffect(()=>{const o=n();QE(g,o)||i(o)},[e,t]),g},I3=e=>{const t=()=>r3(e),[n,g]=H.useState(t);return H.useEffect(()=>{const i=t();n!==i&&g(i)},[e]),n},a3=(e,t)=>{const n=()=>LE(e,t||{},!!t),[g,i]=H.useState(n),o=dR();return H.useEffect(()=>{if(o){const s=n();return i(s),()=>{s&&s.dispose()}}},[e,t]),g},C3=e=>{const[t,n]=H.useState(e.matches);return H.useEffect(()=>{const g=i=>{n(i.matches)};return e.addListener(g),n(e.matches),()=>{e.removeListener(g)}},[e]),t},uR=(e,t,n)=>{const g=l3(t),i=I3(e);if(!i)throw new Error("Invalid or missing MediaQuery!");const o=a3(i,g),s=C3(o),r=dR();return H.useEffect(()=>{r&&n&&n(s)},[s]),H.useEffect(()=>()=>{o&&o.dispose()},[]),s},AR=()=>{const[e,t]=H.useState(""),[n,g]=H.useState({email:"",home:""}),[i,o]=H.useState(!1),s=uR({query:"(min-width: 1224px)"}),r=async()=>{const I=localStorage.getItem("access_token");if(!I){console.error("Token no encontrado");return}try{const a=await Je.get("https://securityflow.onrender.com/qr/general/generate",{headers:{Authorization:`Bearer ${I}`}});console.log("QR string:",a.data),t(a.data),o(!0)}catch(a){console.error("Error fetching QR string:",a),o(!1)}},l=async()=>{const I=localStorage.getItem("access_token");if(!I){console.error("Token no encontrado");return}try{const a=await Je.get("https://securityflow.onrender.com/user/profile",{headers:{Authorization:`Bearer ${I}`}});console.log("User data:",a.data),g({email:a.data.email,home:a.data.home})}catch(a){console.error("Error fetching user data:",a)}};return H.useEffect(()=>{r(),l()},[]),G.jsx("div",{className:"flex flex-col justify-center items-center h-screen",children:i?G.jsxs(Yo.div,{className:"bg-white rounded-lg flex flex-col justify-center items-center",initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5},children:[G.jsx(Yo.div,{className:"",initial:{scale:.8},animate:{scale:1},transition:{duration:.5,ease:"easeInOut"},children:G.jsx(oR,{value:e,size:s?300:175})}),G.jsx("p",{className:"text-2xl text-center m-1 font-bold mt-10",children:n.email}),G.jsx("p",{className:"text-2xl text-center m-1 font-bold",children:n.home})]}):G.jsx(Nm,{size:50,color:"#4fa94d"})})},c3=()=>G.jsx("div",{className:"flex justify-center items-center min-h-screen flex-col  w-full ",children:G.jsx(AR,{})}),d3=()=>{const[e,t]=H.useState([]),[n,g]=H.useState(""),[i,o]=H.useState(null);H.useEffect(()=>{const l=async()=>{try{const C=(await Je.get("https://securityflow.onrender.com/user/profile",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).data.home;if(C)o(C),I(C);else throw new Error("User home not found")}catch(a){console.error("Error fetching user profile:",a),g("Error al cargar el perfil del usuario. Intntalo de nuevo ms tarde.")}},I=async a=>{try{const C=await Je.get(`https://securityflow.onrender.com/invitation/get/requests/${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(Array.isArray(C.data))t(C.data);else throw new Error("Invalid response structure")}catch(C){console.error("Error fetching solicitudes:",C),g("Error al cargar las solicitudes. Intntalo de nuevo ms tarde.")}};l()},[]);const s=async l=>{try{const I=await Je.post(`https://securityflow.onrender.com/invitation/aprove/${l}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});console.log(I.data),t(e.filter(a=>a.id!==l))}catch(I){console.error("Error approving invitation:",I),g("Error al aceptar la invitacin. Intntalo de nuevo ms tarde.")}},r=async l=>{try{const I=await Je.post(`https://securityflow.onrender.com/invitation/deactivate/${l}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});console.log(I.data),t(e.filter(a=>a.id!==l))}catch(I){console.error("Error deactivating invitation:",I),g("Error al rechazar la invitacin. Intntalo de nuevo ms tarde.")}};return G.jsxs("div",{className:"flex flex-col items-center p-4 font-roboto_mono",children:[G.jsx("h1",{className:"mt-5 text-2xl text-[#6185A9] text-center font-bold mb-10",children:"Solicitudes de Invitacin"}),n&&G.jsx("p",{className:"text-red-600 mb-4",children:n}),e.length>0?e.map((l,I)=>l.dates.map((a,C)=>{const c=new Date(a.start_datetime).toLocaleDateString(),d=new Date(a.start_datetime).toLocaleTimeString(),u=new Date(a.end_datetime).toLocaleDateString(),h=new Date(a.end_datetime).toLocaleTimeString();return G.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md w-full sm:w-96 mb-4",children:[G.jsxs("div",{className:"flex items-center mb-4",children:[G.jsx("img",{src:l.pictureurl,alt:l.name,className:"w-16 h-16 rounded-full mr-4"}),G.jsxs("p",{className:"text-gray-700 font-roboto_mono mb-5",children:[G.jsx("span",{className:"font-bold text-black",children:"Nombre:"})," ",l.name]})]}),G.jsxs("p",{className:"text-gray-700 font-roboto_mono mb-5",children:[G.jsx("span",{className:"font-bold text-black",children:"Fecha de inicio:"})," ",c," ",d]}),G.jsxs("p",{className:"text-gray-700 font-roboto_mono mb-5",children:[G.jsx("span",{className:"font-bold text-black",children:"Fecha de fin:"})," ",u," ",h]}),G.jsxs("div",{className:"flex justify-around",children:[G.jsx("button",{className:"bg-amarillo-principal text-black py-2 px-4 rounded-md font-roboto_mono hover:bg-yellow-600 transition duration-300",onClick:()=>s(l.id),children:"Aceptar"}),G.jsx("button",{className:"bg-red-400 text-white py-2 px-4 rounded-md font-roboto_mono",onClick:()=>r(l.id),children:"Rechazar"})]})]},`${I}-${C}`)})):!n&&G.jsx("p",{children:"No hay solicitudes pendientes."})]})},u3=()=>{const e=[{label:"Home",url:"home"},{label:"Crear permisos",url:"MPermissions"},{label:"Solicitudes",url:"Nsolicitudes"},{label:"Entradas",url:"QR"},{label:"Gestionar residentes",url:"addResidents"},{label:"Registro de visitas",url:"visits"}];return G.jsxs(G.Fragment,{children:[G.jsx(Hl,{menuItems:e}),G.jsxs(Ms,{children:[G.jsx(Ye,{path:"home",element:G.jsx(BE,{})}),G.jsx(Ye,{path:"MPermissions",element:G.jsx(yE,{})}),G.jsx(Ye,{path:"Nsolicitudes",element:G.jsx(d3,{})}),G.jsx(Ye,{path:"QR",element:G.jsx(c3,{})}),G.jsx(Ye,{path:"MultipleP",element:G.jsx(qF,{})}),G.jsx(Ye,{path:"UniqueP",element:G.jsx(GE,{})}),G.jsx(Ye,{path:"addResidents",element:G.jsx(SE,{})}),G.jsx(Ye,{path:"visits",element:G.jsx(WE,{})}),G.jsx(Ye,{path:"/",element:G.jsx(Wi,{to:"home"})})]})]})},A3=()=>G.jsx("div",{children:G.jsx(xC,{})}),zZ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAACH0lEQVR4nO2ay0ocQRSGv1XGLBQFo+70OdSlKAFDXHp5hpBh3sLLQlEI2eYRkoyJbyDiWmdGV142oq694ZGCI8jQPd1TXTVd3fjDDw09030+6vTpOlUN7yqvhoAFYB2oAw3gFrhXm+NjPWd+8xUYJBBVgBVgD3gCpEub//wDlvVaPddHoAZcWgQf5wugCvT1CuIzcOoQoN0nwJxPADP0Wx4B2v1LR96pRoHDHkKI+gAYcQUxocMtObmlMWTSJy2jkrNPgTFbiL6c0kk6pJlVif4RQPDS5m2bEiuBejYthBm+ZgABS4xP0r40awEEKwn+nmY0LgIIVBJ8nvTgrwQQpKT0UieQPQ83nASmPFx3t1M/YTMVT/KrXF/3ERiIAlnwlAK+QASYjwLZKCDIWhRIvYAgv6NAWgUEaUSB3BQQ5CoK5D5jibVVltJ85xrEBGOradcgN2VJrWYBQY5LXX7XCwiyWuopymDBJo0PcZNGo/8ebjiVscRKjP/SQcueUsCHF8vS6n4gQdUAApUEf0uCeB2VEJZJJcatblYc5wIIWCL8DMzQpXYCCFzavImFKrpwLIF4P80DHqfhgLYVRsmoCY9tcBo3gXEcaSSnNNvXzSYvm6HPPYL46XvvfdZzqjVsSqytKrq0f+4Q4Ezf2Ll8AVHRVfG6rsV2G/yjzmIXs5RW1zK9wRddxvyj/fT1m49qzPGRtqer2hT1O4/iXYShFwEYOqh4OPqjAAAAAElFTkSuQmCC",h3=()=>{const e=Ei(),t=n=>{e(n)};return G.jsxs("div",{className:" p-4",children:[G.jsx("h1",{className:"text-3xl font-bold font-roboto_mono mb-4 text-center text-azul-claro mt-5 md:mt-8",children:" Crear solicitudes de visita "}),G.jsx("p",{className:"text-2xl font-medium mb-6 text-center text-black mt-5",children:"Selecciona la opcion que desees"}),G.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-10",children:[G.jsxs("button",{className:"bg-amarillo-principal font-roboto_mono font-bold p-3 sm:p-5 md:p-6 lg:p-8 flex items-center justify-center space-x-2 rounded-md w-full sm:w-auto border border-gray-200 hover:shadow-lg transition-shadow duration-300",onClick:()=>t("/normal/unique"),children:[G.jsx("span",{className:"text-sm sm:text-base md:text-lg lg:text-xl",children:"nica vez"}),G.jsx("img",{src:zZ,alt:"Aadir",className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 lg:h-8 lg:w-8"})]}),G.jsxs("button",{className:"bg-amarillo-principal font-roboto_mono font-bold p-3 sm:p-5 md:p-6 lg:p-8 flex items-center justify-center space-x-2 rounded-md w-full sm:w-auto border border-gray-200 hover:shadow-lg transition-shadow duration-300",onClick:()=>t("/normal/frequent"),children:[G.jsx("span",{className:"text-sm sm:text-base md:text-lg lg:text-xl",children:"Frecuente"}),G.jsx("img",{src:zZ,alt:"Aadir",className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 lg:h-8 lg:w-8"})]})]})]})},m3=()=>G.jsx("div",{children:G.jsx("div",{className:"flex pt-10 flex-col",children:G.jsx(AR,{})})}),b3=()=>{const{showPopup:e}=Og(),[t,n]=H.useState({email:"",date:"",time:"",finalTime:""}),[g,i]=H.useState(""),[o,s]=H.useState({});H.useEffect(()=>{(async()=>{const C=localStorage.getItem("access_token");if(!C){e("Token no encontrado",!1);return}try{const c=await fetch("https://securityflow.onrender.com/user/profile",{method:"GET",headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"}});if(c.ok){const d=await c.json();console.log("Datos del usuario:",d),i(d.home||"")}else e("Error al obtener los datos del usuario",!1)}catch{e("Error de conexin",!1)}})()},[]);const r=a=>{const{name:C,value:c}=a.target;n({...t,[C]:c})},l=async a=>{a.preventDefault();let C={};if(t.email||(C.email="El correo electrnico es obligatorio"),t.date||(C.date="La fecha es obligatoria"),t.time||(C.time="La hora de llegada es obligatoria"),t.finalTime||(C.finalTime="La hora de salida es obligatoria"),Object.keys(C).length>0){s(C);return}const c=localStorage.getItem("access_token");if(!c){e("Token no encontrado",!1);return}const d={house_number:g,user_identifier:t.email,request:!0,initial_dates:[`${t.date}T${t.time}:00`],final_dates:[`${t.date}T${t.finalTime}:00`]};try{(await fetch("https://securityflow.onrender.com/invitation/add/unique",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(d)})).status===201?(e("Solicitud enviada exitosamente",!0),n({email:"",date:"",time:"",finalTime:""}),s({})):e("Error al enviar la solicitud",!1)}catch{e("Error de conexin",!1)}},I=a=>{a.preventDefault(),e("Solicitud cancelada",!1)};return G.jsxs("div",{className:"flex items-center h-screen flex-col w-full font-roboto_mono",children:[G.jsx("h1",{className:"text-2xl text-[#6185A9] text-center pt-4 pb-1",children:"Detalles de la solicitud"}),G.jsxs("form",{onSubmit:l,children:[G.jsxs("div",{className:"flex flex-col mt-4 mb-4 width-auto",children:[G.jsx("label",{className:"text-xl mb-2",children:"Correo electrnico:"}),G.jsx("input",{type:"email",name:"email",placeholder:"Correo electrnico",className:`border ${o.email?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.email,onChange:r}),o.email&&G.jsx("p",{className:"text-red-500 text-sm",children:o.email})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-xl mb-2",children:"Fecha de visita:"}),G.jsx("input",{type:"date",name:"date",className:`border ${o.date?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.date,onChange:r}),o.date&&G.jsx("p",{className:"text-red-500 text-sm",children:o.date})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-xl mb-2",children:"Hora de llegada:"}),G.jsx("input",{type:"time",name:"time",className:`border ${o.time?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.time,onChange:r}),o.time&&G.jsx("p",{className:"text-red-500 text-sm",children:o.time})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-8",children:[G.jsx("label",{className:"text-xl mb-2",children:"Hora de salida:"}),G.jsx("input",{type:"time",name:"finalTime",className:`border ${o.finalTime?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.finalTime,onChange:r}),o.finalTime&&G.jsx("p",{className:"text-red-500 text-sm",children:o.finalTime})]}),G.jsxs("div",{className:"flex flex-row pt-2",children:[G.jsx("div",{className:"p-4 mr-4 rounded-lg bg-[#F8BD0D] bg-opacity-70 hover:bg-yellow-400 transition duration-300 transform hover:scale-105",children:G.jsx("button",{type:"submit",children:"Aceptar"})}),G.jsx("div",{className:"p-4 rounded-lg bg-[#F79E9E] hover:bg-red-600 transition duration-300 transform hover:scale-105",children:G.jsx("button",{type:"button",onClick:I,children:"Cancelar"})})]})]})]})},p3=()=>{const{showPopup:e}=Og(),[t,n]=H.useState({email:"",dates:[{date1:"",date2:"",time1:"",time2:""}]}),[g,i]=H.useState(""),[o,s]=H.useState({});H.useEffect(()=>{(async()=>{const d=localStorage.getItem("access_token");if(!d){e("Token no encontrado",!1);return}try{const u=await fetch("https://securityflow.onrender.com/user/profile",{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(u.ok){const h=await u.json();console.log("Datos del usuario:",h),i(h.home||"")}else e("Error al obtener los datos del usuario",!1)}catch{e("Error de conexin",!1)}})()},[]);const r=(c,d)=>{const{name:u,value:h}=c.target,f=[...t.dates];f[d][u]=h,n({...t,dates:f})},l=()=>{const{email:c,dates:d}=t;let u={};return c||(u.email="El correo electrnico es obligatorio"),d.forEach((h,f)=>{h.date1||(u[`date1-${f}`]="La fecha inicial es obligatoria"),h.date2||(u[`date2-${f}`]="La fecha final es obligatoria"),h.time1||(u[`time1-${f}`]="La hora inicial es obligatoria"),h.time2||(u[`time2-${f}`]="La hora final es obligatoria")}),s(u),Object.keys(u).length===0},I=()=>{n({...t,dates:[...t.dates,{date1:"",date2:"",time1:"",time2:""}]})},a=async c=>{if(c.preventDefault(),!l())return;const d=localStorage.getItem("access_token");if(!d){e("Token no encontrado",!1);return}const u=t.dates.map(y=>`${y.date1}T${y.time1}:00`),h=t.dates.map(y=>`${y.date2}T${y.time2}:00`),f={house_number:g,user_identifier:t.email,request:!0,initial_dates:u,final_dates:h};try{(await fetch("https://securityflow.onrender.com/invitation/add/multiple",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(f)})).status===201?(e("Solicitud enviada exitosamente",!0),n({email:"",dates:[{date1:"",date2:"",time1:"",time2:""}]}),s({})):e("Error al enviar la solicitud",!1)}catch{e("Error de conexin",!1)}},C=c=>{c.preventDefault(),e("Solicitud cancelada",!1)};return G.jsxs("div",{className:"flex items-center h-screen flex-col w-full font-roboto_mono",children:[G.jsx("h1",{className:"text-2xl text-[#6185A9] text-center m-2",children:"Detalles de la solicitud"}),G.jsx("h2",{className:"text-center text-xl text-[#6185A9] pb-2",children:"Acceso Frecuente"}),G.jsxs("form",{onSubmit:a,className:"max-w-md mx-auto",children:[G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Correo electrnico:"}),G.jsx("input",{type:"email",name:"email",placeholder:"Correo electrnico",className:`border ${o.email?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:t.email,onChange:c=>n({...t,email:c.target.value})}),o.email&&G.jsx("p",{className:"text-red-500 text-sm",children:o.email})]}),t.dates.map((c,d)=>G.jsxs("div",{children:[G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Fecha inicial de visita:"}),G.jsx("input",{type:"date",name:"date1",className:`border ${o[`date1-${d}`]?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:c.date1,onChange:u=>r(u,d)}),o[`date1-${d}`]&&G.jsx("p",{className:"text-red-500 text-sm",children:o[`date1-${d}`]})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Fecha final de visita:"}),G.jsx("input",{type:"date",name:"date2",className:`border ${o[`date2-${d}`]?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:c.date2,onChange:u=>r(u,d)}),o[`date2-${d}`]&&G.jsx("p",{className:"text-red-500 text-sm",children:o[`date2-${d}`]})]}),G.jsxs("div",{className:"flex flex-col mt-4",children:[G.jsx("label",{className:"text-lg mb-2",children:"Permiso habilitado desde:"}),G.jsx("input",{type:"time",name:"time1",className:`border ${o[`time1-${d}`]?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:c.time1,onChange:u=>r(u,d)}),o[`time1-${d}`]&&G.jsx("p",{className:"text-red-500 text-sm",children:o[`time1-${d}`]})]}),G.jsxs("div",{className:"flex flex-col mt-4 mb-8",children:[G.jsx("label",{className:"text-lg mb-2",children:"Hasta:"}),G.jsx("input",{type:"time",name:"time2",className:`border ${o[`time2-${d}`]?"border-red-500":"border-black"} rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline`,value:c.time2,onChange:u=>r(u,d)}),o[`time2-${d}`]&&G.jsx("p",{className:"text-red-500 text-sm",children:o[`time2-${d}`]})]})]},d)),G.jsx("div",{className:"flex justify-between mb-4",children:G.jsx("button",{type:"button",onClick:I,className:"p-2 rounded-lg bg-[#8BC34A] w-full md:w-1/2 lg:w-1/3 mx-2 transition-transform duration-150 active:scale-95 hover:scale-105",children:"agregar otro"})}),G.jsxs("div",{className:"flex justify-between",children:[G.jsx("button",{type:"submit",className:"p-2 rounded-lg bg-[#F8BD0D] bg-opacity-70 w-full md:w-1/2 lg:w-1/3 mx-2 transition-transform duration-150 active:scale-95 hover:scale-105",children:"Aceptar"}),G.jsx("button",{type:"button",className:"p-2 rounded-lg bg-[#F79E9E] w-full md:w-1/2 lg:w-1/3 mx-2 transition-transform duration-150 active:scale-95 hover:scale-105",onClick:C,children:"Cancelar"})]})]})]})},f3=()=>{const e=[{label:"Mi perfil",url:"perfil"},{label:"Solicitud de visita",url:"solicitud"},{label:"Generar QR",url:"generar-qr"}];return G.jsxs(G.Fragment,{children:[G.jsx(Hl,{menuItems:e}),G.jsxs(Ms,{children:[G.jsx(Ye,{path:"perfil",element:G.jsx(A3,{})}),G.jsx(Ye,{path:"solicitud",element:G.jsx(h3,{})}),G.jsx(Ye,{path:"generar-qr",element:G.jsx(m3,{})}),G.jsx(Ye,{path:"/unique",element:G.jsx(b3,{})}),G.jsx(Ye,{path:"/frequent",element:G.jsx(p3,{})}),G.jsx(Ye,{path:"/",element:G.jsx(Wi,{to:"perfil"})})]})]})},Z3=()=>G.jsx("div",{children:G.jsx(xC,{})}),hR="https://securityflow.onrender.com/invitation",y3=`${hR}/get/invitations`,G3=`${hR}/get/invitations-info`,B3=async()=>{const e=wl();try{return(await Je.get(y3,{headers:{Authorization:`Bearer ${e}`}})).data}catch(t){throw t}},S3=async()=>{const e=wl();try{return(await Je.get(G3,{headers:{Authorization:`Bearer ${e}`}})).data}catch(t){throw t}},V3=()=>{const[e,t]=H.useState([]);return H.useEffect(()=>{(async()=>{try{const i=(await S3()).map(o=>({host:o.name,date:o.arrivalTime.split("T")[0],time:o.arrivalTime.split("T")[1].split(".")[0]}));t(i)}catch(g){console.error("Error fetching invitation info:",g)}})()},[]),G.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4",children:[G.jsx("h1",{className:"mb-6 text-center text-2xl md:text-2xl lg:text-4xl font-bold font-roboto_mono text-azul-claro",children:"Historial de invitaciones"}),G.jsx("div",{className:"overflow-y-auto w-full max-w-4xl max-h-96",children:G.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[G.jsx("thead",{children:G.jsxs("tr",{className:"bg-amarillo-principal",children:[G.jsx("th",{className:"px-2 py-3 text-left text-xs font-roboto_mono font-medium text-white uppercase tracking-wider md:px-6",children:"Anfitrin"}),G.jsx("th",{className:"px-2 py-3 text-left text-xs font-roboto_mono font-medium text-white uppercase tracking-wider md:px-6",children:"Fecha"}),G.jsx("th",{className:"px-2 py-3 text-left text-xs font-roboto_mono font-medium text-white uppercase tracking-wider md:px-6",children:"Hora"})]})}),G.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map((n,g)=>G.jsxs("tr",{children:[G.jsx("td",{className:"px-2 py-4 whitespace-nowrap font-roboto_mono text-xs md:text-base md:px-6",children:n.host}),G.jsx("td",{className:"px-2 py-4 whitespace-nowrap font-roboto_mono text-xs md:text-base md:px-6",children:n.date}),G.jsx("td",{className:"px-2 py-4 whitespace-nowrap font-roboto_mono text-xs md:text-base md:px-6",children:n.time})]},g))})]})})]})},W3=()=>{const e=Ei(),[t,n]=H.useState([]);H.useEffect(()=>{(async()=>{try{const l=(await B3()).map(I=>({...I,anfitrion:I.home||"N/A"}));n(l)}catch(r){console.error("Error fetching invitations:",r)}})()},[]);const g=s=>{e(`/visits/qr/${s}`)},i=(s,r)=>{const l=new Date(s),I=new Date(r),a={day:"2-digit",month:"2-digit",year:"numeric"};return`${new Intl.DateTimeFormat("es-ES",a).format(l)} - ${new Intl.DateTimeFormat("es-ES",a).format(I)}`},o=s=>{const r=new Date(s);return new Intl.DateTimeFormat("es-ES",{hour:"2-digit",minute:"2-digit"}).format(r)};return G.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4",children:[G.jsx("h1",{className:"mb-6 text-3xl font-bold font-roboto_mono text-azul-claro",children:"Mis invitaciones"}),G.jsx("div",{className:"w-full max-w-4xl h-96 overflow-y-auto md:h-auto md:overflow-y-visible",children:G.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map((s,r)=>s.dates.map((l,I)=>G.jsx("div",{className:`w-full max-w-md p-6 ${s.unique_invitation?"":"bg-yellow-100"} shadow-md rounded-lg`,children:G.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4 border",children:[G.jsxs("div",{className:"mb-4",children:[G.jsx("label",{className:"block text-black text-sm font-bold font-roboto_mono mb-2",htmlFor:`anfitrion-${r}`,children:"Casa anfitrin:"}),G.jsx("input",{className:"font-roboto_mono shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`anfitrion-${r}`,type:"text",value:s.anfitrion||"N/A",readOnly:!0})]}),G.jsxs("div",{className:"mb-4",children:[G.jsx("label",{className:"block text-black text-sm font-roboto_mono font-bold mb-2",htmlFor:`fecha-${r}`,children:"Fecha programada:"}),G.jsx("input",{className:"font-roboto_mono shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`fecha-${r}`,type:"text",value:i(l.start_datetime,l.end_datetime),readOnly:!0})]}),G.jsxs("div",{className:"mb-4",children:[G.jsx("label",{className:"block text-black text-sm font-roboto_mono font-bold mb-2",htmlFor:`hora-${r}`,children:"Hora:"}),G.jsx("input",{className:"font-roboto_mono shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`hora-${r}`,type:"text",value:`${o(l.start_datetime)} a ${o(l.end_datetime)}`,readOnly:!0})]}),G.jsx("div",{className:"flex items-center justify-center",children:G.jsx("button",{className:"bg-amarillo-principal hover:bg-yellow-600 text-white font-roboto_mono font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"button",onClick:()=>g(s.id),children:"Validar"})})]})},`${r}-${I}`)))})})]})},R3=()=>{const{id:e}=lS(),[t,n]=H.useState(""),[g,i]=H.useState({email:"",home:""}),[o,s]=H.useState(!1);console.log(e);const r=uR({query:"(min-width: 1224px)"}),l=async()=>{const a=localStorage.getItem("access_token");if(!a){console.error("Token no encontrado");return}try{const C=await Je.get(`https://securityflow.onrender.com/qr/generate/${e}`,{headers:{Authorization:`Bearer ${a}`}});console.log("QR string:",C.data),n(C.data),s(!0)}catch(C){console.error("Error fetching QR string:",C),s(!1)}},I=async()=>{const a=localStorage.getItem("access_token");if(!a){console.error("Token no encontrado");return}try{const C=await Je.get("https://securityflow.onrender.com/user/profile",{headers:{Authorization:`Bearer ${a}`}});console.log("User data:",C.data),i({email:C.data.email,home:C.data.home})}catch(C){console.error("Error fetching user data:",C)}};return H.useEffect(()=>{l(),I()},[e]),G.jsx("div",{className:"flex flex-col justify-center items-center h-screen",children:o?G.jsxs(Yo.div,{className:"bg-white rounded-lg flex flex-col justify-center items-center",initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5},children:[G.jsx(Yo.div,{className:"",initial:{scale:.8},animate:{scale:1},transition:{duration:.5,ease:"easeInOut"},children:G.jsx(oR,{value:t,size:r?300:175})}),G.jsx("p",{className:"text-2xl text-center m-1 font-bold mt-10",children:g.email}),G.jsx("p",{className:"text-2xl text-center m-1 font-bold",children:g.home})]}):G.jsx(Nm,{size:50,color:"#4fa94d"})})},v3=()=>{const e=[{label:"Mi perfil",url:"home"},{label:"Historial",url:"historial"},{label:"Invitaciones",url:"invitaciones"}];return G.jsxs(G.Fragment,{children:[G.jsx(Hl,{menuItems:e}),G.jsxs(Ms,{children:[G.jsx(Ye,{path:"home",element:G.jsx(Z3,{})}),G.jsx(Ye,{path:"historial",element:G.jsx(V3,{})}),G.jsx(Ye,{path:"invitaciones",element:G.jsx(W3,{})}),G.jsx(Ye,{path:"/qr/:id",element:G.jsx(R3,{})}),G.jsx(Ye,{path:"/",element:G.jsx(Wi,{to:"home"})})]})]})},k3=()=>G.jsx("div",{children:G.jsx(xC,{})}),X3=()=>{const{showPopup:e}=Og(),[t,n]=H.useState({identifier:"",motive:""}),[g,i]=H.useState(!1),o=l=>{if(l.preventDefault(),t.identifier===""||t.motive===""){e("Campos vacos",!1);return}const I=localStorage.getItem("access_token");Je.post("https://securityflow.onrender.com/entry/anon-entry",{reason:t.motive,document:t.identifier},{headers:{Authorization:`Bearer ${I}`}}).then(a=>{a.status===201&&(console.log(a),e("Solicitud enviada con xito",!0),i(!0),n({identifier:"",motive:""}))}).catch(a=>{console.error(a),e("Error al enviar la solicitud",!1)})},s=l=>{const{name:I,value:a}=l.target;n({...t,[I]:a})},r=()=>{const l=localStorage.getItem("access_token");Je.get("https://securityflow.onrender.com/mqtt/publish?message=open",{headers:{Authorization:`Bearer ${l}`}}).then(I=>{console.log("Mensaje enviado:",I.data),e("Mensaje enviado con xito",!0),i(!1)}).catch(I=>{console.error("Error al enviar el mensaje:",I),e("Error al enviar el mensaje",!1)})};return G.jsxs("div",{className:"max-w-4xl mx-auto mt-5 px-4 font-roboto_mono",children:[G.jsx("h1",{className:"text-3xl mb-4 text-center mt-8 text-sky-700",children:"Crear entrada annima"}),G.jsx("section",{className:"shadow-md rounded p-6 mb-8 font-roboto_mono",children:G.jsxs("div",{className:"justify-center mb-6 md:container md:mx-auto container mx-auto px-4 font-roboto_mono",children:[G.jsx("p",{className:"font-bold text-center mb-4",children:"Complete los siguientes campos"}),G.jsxs("form",{className:"mt-5",onSubmit:o,children:[G.jsx("label",{className:"block text-gray-700 text-sm font-semibold mb-5",children:"Identificador:"}),G.jsx("input",{type:"text",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:t.identifier,onChange:s,name:"identifier"}),G.jsx("label",{className:"mt-3 block text-gray-700 text-sm font-semibold mb-5",children:"Motivo de ingreso:"}),G.jsx("textarea",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:t.motive,onChange:s,name:"motive"}),G.jsx("div",{className:"flex justify-center",children:G.jsx("button",{type:"submit",className:"bg-yellow-500 hover:bg-yellow-600 text-black font-roboto_mono font-semibold py-2 px-4 mt-5 rounded-md w-full sm:w-auto mx-auto transition-all duration-300",children:"Enviar Solicitud"})})]}),g&&G.jsx("div",{className:"flex justify-center",children:G.jsx("button",{onClick:r,className:"bg-sky-500 hover:bg-sky-600 text-black font-roboto_mono font-semibold py-2 px-4 mt-5 rounded-md w-full sm:w-auto mx-auto transition-all duration-300",children:"Levantar Pluma"})})]})})]})};function Du(){return Du=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var g in n)({}).hasOwnProperty.call(n,g)&&(e[g]=n[g])}return e},Du.apply(null,arguments)}function yl(e){"@babel/helpers - typeof";return yl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yl(e)}function w3(e,t){if(yl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var g=n.call(e,t||"default");if(yl(g)!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function J3(e){var t=w3(e,"string");return yl(t)=="symbol"?t:t+""}function Y3(e,t,n){return(t=J3(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H3(e){if(Array.isArray(e))return e}function N3(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var g,i,o,s,r=[],l=!0,I=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(l=(g=o.call(n)).done)&&(r.push(g.value),r.length!==t);l=!0);}catch(a){I=!0,i=a}finally{try{if(!l&&n.return!=null&&(s=n.return(),Object(s)!==s))return}finally{if(I)throw i}}return r}}function DZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,g=Array(t);n<t;n++)g[n]=e[n];return g}function F3(e,t){if(e){if(typeof e=="string")return DZ(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?DZ(e,t):void 0}}function x3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K3(e,t){return H3(e)||N3(e,t)||F3(e,t)||x3()}function E3(e,t){if(e==null)return{};var n={};for(var g in e)if({}.hasOwnProperty.call(e,g)){if(t.indexOf(g)>=0)continue;n[g]=e[g]}return n}function M3(e,t){if(e==null)return{};var n,g,i=E3(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(g=0;g<o.length;g++)n=o[g],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var mR={exports:{}},qe={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nt=typeof Symbol=="function"&&Symbol.for,Ab=Nt?Symbol.for("react.element"):60103,hb=Nt?Symbol.for("react.portal"):60106,KC=Nt?Symbol.for("react.fragment"):60107,EC=Nt?Symbol.for("react.strict_mode"):60108,MC=Nt?Symbol.for("react.profiler"):60114,TC=Nt?Symbol.for("react.provider"):60109,LC=Nt?Symbol.for("react.context"):60110,mb=Nt?Symbol.for("react.async_mode"):60111,UC=Nt?Symbol.for("react.concurrent_mode"):60111,zC=Nt?Symbol.for("react.forward_ref"):60112,DC=Nt?Symbol.for("react.suspense"):60113,T3=Nt?Symbol.for("react.suspense_list"):60120,QC=Nt?Symbol.for("react.memo"):60115,jC=Nt?Symbol.for("react.lazy"):60116,L3=Nt?Symbol.for("react.block"):60121,U3=Nt?Symbol.for("react.fundamental"):60117,z3=Nt?Symbol.for("react.responder"):60118,D3=Nt?Symbol.for("react.scope"):60119;function wn(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case Ab:switch(e=e.type,e){case mb:case UC:case KC:case MC:case EC:case DC:return e;default:switch(e=e&&e.$$typeof,e){case LC:case zC:case jC:case QC:case TC:return e;default:return t}}case hb:return t}}}function bR(e){return wn(e)===UC}qe.AsyncMode=mb;qe.ConcurrentMode=UC;qe.ContextConsumer=LC;qe.ContextProvider=TC;qe.Element=Ab;qe.ForwardRef=zC;qe.Fragment=KC;qe.Lazy=jC;qe.Memo=QC;qe.Portal=hb;qe.Profiler=MC;qe.StrictMode=EC;qe.Suspense=DC;qe.isAsyncMode=function(e){return bR(e)||wn(e)===mb};qe.isConcurrentMode=bR;qe.isContextConsumer=function(e){return wn(e)===LC};qe.isContextProvider=function(e){return wn(e)===TC};qe.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ab};qe.isForwardRef=function(e){return wn(e)===zC};qe.isFragment=function(e){return wn(e)===KC};qe.isLazy=function(e){return wn(e)===jC};qe.isMemo=function(e){return wn(e)===QC};qe.isPortal=function(e){return wn(e)===hb};qe.isProfiler=function(e){return wn(e)===MC};qe.isStrictMode=function(e){return wn(e)===EC};qe.isSuspense=function(e){return wn(e)===DC};qe.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===KC||e===UC||e===MC||e===EC||e===DC||e===T3||typeof e=="object"&&e!==null&&(e.$$typeof===jC||e.$$typeof===QC||e.$$typeof===TC||e.$$typeof===LC||e.$$typeof===zC||e.$$typeof===U3||e.$$typeof===z3||e.$$typeof===D3||e.$$typeof===L3)};qe.typeOf=wn;/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var QZ=Object.getOwnPropertySymbols,Q3=Object.prototype.hasOwnProperty,j3=Object.prototype.propertyIsEnumerable;function P3(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function O3(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var g=Object.getOwnPropertyNames(t).map(function(o){return t[o]});if(g.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(o){i[o]=o}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}O3();var _3="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",q3=_3;Function.call.bind(Object.prototype.hasOwnProperty);var $3=q3;function pR(){}function fR(){}fR.resetWarningCache=pR;var eM=function(){function e(g,i,o,s,r,l){if(l!==$3){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:fR,resetWarningCache:pR};return n.PropTypes=n,n};mR.exports=eM();var Po=mR.exports;function tM(e,t){var n=atob(e);return n}function nM(e,t,n){var g=tM(e),i=g.indexOf(`
`,10)+1,o=g.substring(i)+"",s=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(s)}function gM(e,t,n){var g;return function(o){return g=g||nM(e),new Worker(g,o)}}var iM=gM("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg=="),oM=["constraints","onError","onLoad","onScan","resolution","qrArea"];function jZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(e);t&&(g=g.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,g)}return n}function PZ(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jZ(Object(n),!0).forEach(function(g){Y3(e,g,n[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jZ(Object(n)).forEach(function(g){Object.defineProperty(e,g,Object.getOwnPropertyDescriptor(n,g))})}return e}var sM=function(){return new iM},OZ=function(t){t&&(t.getVideoTracks&&t.getAudioTracks?(t.getVideoTracks().forEach(function(n){t.removeTrack(n),n.stop()}),t.getAudioTracks().forEach(function(n){t.removeTrack(n),n.stop()})):t.stop())},bb=function(t){var n=t.constraints,g=t.onError,i=t.onLoad,o=t.onScan,s=t.resolution,r=t.qrArea,l=M3(t,oM),I=H.useRef(null),a=H.useRef(null),C=H.useRef(document.createElement("canvas")),c=H.useRef(null),d=H.useRef(),u=H.useState(null),h=K3(u,2),f=h[0],y=h[1],Z=H.useRef(!1),p=H.useRef();H.useEffect(function(){p.current=sM();var V=p.current;return V.onmessage=function(R){o&&o(R.data?PZ(PZ({},R.data),{},{canvas:C.current}):null),Z.current=!1},function(){V.terminate()}},[o]);var B=JSON.stringify(r),W=H.useCallback(function(){var V=JSON.parse(B),R=p.current,J=a.current&&a.current.readyState===a.current.HAVE_ENOUGH_DATA;if(!Z.current&&J){Z.current=!0;var M=a.current.videoWidth,P=a.current.videoHeight,X=M>P?M:P,L=Math.floor(s/X*100)/100;P=Math.floor(L*P),M=Math.floor(L*M),C.current.width=M,C.current.height=P,c.current=C.current.getContext("2d"),c.current.drawImage(a.current,0,0,M,P);var ne;V&&V.length===2&&V[0]>0&&V[1]>0?ne=c.current.getImageData(Math.floor((M-V[0])/2),Math.floor((P-V[1])/2),V[0],V[1]):ne=c.current.getImageData(0,0,M,P),R.postMessage(ne)}d.current=requestAnimationFrame(W)},[s,B]),S=JSON.stringify(n);return H.useEffect(function(){var V=JSON.parse(S),R=!0;return navigator.mediaDevices.getUserMedia(V).then(function(J){if(!R)OZ(J);else{I.current=J;try{a.current&&(a.current.srcObject=J,a.current.setAttribute("playsinline",!0))}catch{y(window.URL.createObjectURL(J))}i&&i(),d.current=requestAnimationFrame(W)}}).catch(function(J){return R?g(J):null}),function(){cancelAnimationFrame(d.current),R=!1,OZ(I.current),f&&window.URL.revokeObjectURL(f)}},[W,S,g,i,f]),H.createElement("video",Du({autoPlay:!0,playsInline:!0,src:f,ref:a},l))};bb.propTypes={constraints:Po.object,onError:Po.func.isRequired,onLoad:Po.func,onScan:Po.func.isRequired,resolution:Po.number,qrArea:Po.array};bb.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]};const rM=()=>{const[e,t]=H.useState(""),[n,g]=H.useState(!0),i=l=>{console.error("QR Scanner Error:",l),t("Error al escanear el QR")},o=async(l,I)=>{try{return(await Je.post(`https://securityflow.onrender.com/qr/validate/${l}`,{},{headers:{Authorization:`Bearer ${I}`}})).status===200?(t("QR validado"),!0):(t("QR incorrecto"),!1)}catch(a){return console.error("Validation Error:",a),t("QR incorrecto"),!1}},s=async l=>{try{const I=await Je.get("https://securityflow.onrender.com/mqtt/publish?message=open",{headers:{Authorization:`Bearer ${l}`}});console.log("Mensaje enviado:",I.data)}catch(I){console.error("Error al enviar el mensaje:",I),t("Error al enviar el mensaje")}},r=async l=>{if(l!=null&&n){const I=l.text;console.log(I);const a=localStorage.getItem("access_token");if(!a){t("No se encontr el token de acceso");return}g(!1),await o(I,a)&&await s(a),setTimeout(()=>{window.location.reload()},3e3)}};return G.jsxs("div",{className:"max-w-4xl mx-auto mt-5 px-4",children:[G.jsx("h1",{className:"text-3xl font-roboto_mono mb-4 text-center mt-8 text-sky-700",children:"Escanear QR"}),G.jsx("section",{className:"bg-gray-300 shadow-md rounded p-6 mb-8 flex flex-col items-center",children:n?G.jsx(bb,{delay:300,onError:i,onScan:r,className:"outline outline-4 outline-slate-600 rounded justify-center"}):G.jsx("p",{children:"Escaneando..."})}),e&&G.jsx("p",{className:"text-center mt-4 p-2 rounded bg-blue-100 text-blue-800 border border-blue-200",children:e})]})},lM=()=>{const e=[{label:"Perfil",url:"home"},{label:"Entrada annima",url:"anonentry"},{label:"Escanear QR",url:"scan"}];return G.jsxs(G.Fragment,{children:[G.jsx(Hl,{menuItems:e}),G.jsxs(Ms,{children:[G.jsx(Ye,{path:"home",element:G.jsx(k3,{})}),G.jsx(Ye,{path:"anonentry",element:G.jsx(X3,{})}),G.jsx(Ye,{path:"scan",element:G.jsx(rM,{})}),G.jsx(Ye,{path:"/",element:G.jsx(Wi,{to:"home"})})]})]})},IM=()=>{const e=localStorage.getItem("access_token");return G.jsx(G.Fragment,{children:G.jsxs(Ms,{children:[G.jsx(Ye,{path:"/",element:G.jsx(bY,{})}),G.jsx(Ye,{element:G.jsx(tr,{canActivate:!!e,requiredRole:"ADMN"}),children:G.jsx(Ye,{path:"/admon/*",element:G.jsx(_F,{})})}),G.jsx(Ye,{element:G.jsx(tr,{canActivate:!!e,requiredRole:"RSDT"}),children:G.jsx(Ye,{path:"/resident/*",element:G.jsx(u3,{})})}),G.jsx(Ye,{element:G.jsx(tr,{canActivate:!!e,requiredRole:"RSNR"}),children:G.jsx(Ye,{path:"/normal/*",element:G.jsx(f3,{})})}),G.jsx(Ye,{element:G.jsx(tr,{canActivate:!!e,requiredRole:"VSTT"}),children:G.jsx(Ye,{path:"/visits/*",element:G.jsx(v3,{})})}),G.jsx(Ye,{element:G.jsx(tr,{canActivate:!!e,requiredRole:"GRDA"}),children:G.jsx(Ye,{path:"/security/*",element:G.jsx(lM,{})})})]})})},aM=()=>G.jsx(G.Fragment,{children:G.jsx(VY,{children:G.jsx(IM,{})})});var pb=Object.defineProperty,CM=Object.getOwnPropertyDescriptor,cM=Object.getOwnPropertyNames,dM=Object.prototype.hasOwnProperty,Tt=(e,t)=>()=>(e&&(t=e(e=0)),t),Ze=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),To=(e,t)=>{for(var n in t)pb(e,n,{get:t[n],enumerable:!0})},uM=(e,t,n,g)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of cM(t))!dM.call(e,i)&&i!==n&&pb(e,i,{get:()=>t[i],enumerable:!(g=CM(t,i))||g.enumerable});return e},$e=e=>uM(pb({},"__esModule",{value:!0}),e),on,ue=Tt(()=>{on={deviceMemory:8,hardwareConcurrency:8,language:"en-US"}}),ze={};To(ze,{_debugEnd:()=>SA,_debugProcess:()=>BA,_events:()=>EA,_eventsCount:()=>MA,_exiting:()=>aA,_fatalExceptions:()=>ZA,_getActiveHandles:()=>WR,_getActiveRequests:()=>VR,_kill:()=>dA,_linkedBinding:()=>BR,_maxListeners:()=>KA,_preload_modules:()=>FA,_rawDebug:()=>rA,_startProfilerIdleNotifier:()=>VA,_stopProfilerIdleNotifier:()=>WA,_tickCallback:()=>GA,abort:()=>XA,addListener:()=>TA,allowedNodeEnvironmentFlags:()=>pA,arch:()=>ju,argv:()=>_u,argv0:()=>NA,assert:()=>RR,binding:()=>nA,chdir:()=>oA,config:()=>CA,cpuUsage:()=>Gr,cwd:()=>iA,debugPort:()=>HA,default:()=>Zb,dlopen:()=>SR,domain:()=>IA,emit:()=>QA,emitWarning:()=>tA,env:()=>Ou,execArgv:()=>qu,execPath:()=>YA,exit:()=>mA,features:()=>fA,hasUncaughtExceptionCaptureCallback:()=>vR,hrtime:()=>OI,kill:()=>hA,listeners:()=>XR,memoryUsage:()=>AA,moduleLoadList:()=>lA,nextTick:()=>yR,off:()=>UA,on:()=>Gg,once:()=>LA,openStdin:()=>bA,pid:()=>wA,platform:()=>Pu,ppid:()=>JA,prependListener:()=>jA,prependOnceListener:()=>PA,reallyExit:()=>cA,release:()=>sA,removeAllListeners:()=>DA,removeListener:()=>zA,resourceUsage:()=>uA,setSourceMapsEnabled:()=>xA,setUncaughtExceptionCaptureCallback:()=>yA,stderr:()=>vA,stdin:()=>kA,stdout:()=>RA,title:()=>Qu,umask:()=>gA,uptime:()=>kR,version:()=>$u,versions:()=>eA});function fb(e){throw new Error("Node.js process "+e+" is not supported by JSPM core outside of Node.js")}function AM(){!yo||!co||(yo=!1,co.length?dg=co.concat(dg):Tr=-1,dg.length&&ZR())}function ZR(){if(!yo){var e=setTimeout(AM,0);yo=!0;for(var t=dg.length;t;){for(co=dg,dg=[];++Tr<t;)co&&co[Tr].run();Tr=-1,t=dg.length}co=null,yo=!1,clearTimeout(e)}}function yR(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];dg.push(new GR(e,t)),dg.length===1&&!yo&&setTimeout(ZR,0)}function GR(e,t){this.fun=e,this.array=t}function Qt(){}function BR(e){fb("_linkedBinding")}function SR(e){fb("dlopen")}function VR(){return[]}function WR(){return[]}function RR(e,t){if(!e)throw new Error(t||"assertion error")}function vR(){return!1}function kR(){return kg.now()/1e3}function OI(e){var t=Math.floor((Date.now()-kg.now())*.001),n=kg.now()*.001,g=Math.floor(n)+t,i=Math.floor(n%1*1e9);return e&&(g=g-e[0],i=i-e[1],i<0&&(g--,i+=_I)),[g,i]}function Gg(){return Zb}function XR(e){return[]}var dg,yo,co,Tr,Qu,ju,Pu,Ou,_u,qu,$u,eA,tA,nA,gA,iA,oA,sA,rA,lA,IA,aA,CA,cA,dA,Gr,uA,AA,hA,mA,bA,pA,fA,ZA,yA,GA,BA,SA,VA,WA,RA,vA,kA,XA,wA,JA,YA,HA,NA,FA,xA,kg,id,_I,KA,EA,MA,TA,LA,UA,zA,DA,QA,jA,PA,Zb,hM=Tt(()=>{he(),Ae(),ue(),dg=[],yo=!1,Tr=-1,GR.prototype.run=function(){this.fun.apply(null,this.array)},Qu="browser",ju="x64",Pu="browser",Ou={PATH:"/usr/bin",LANG:on.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},_u=["/usr/bin/node"],qu=[],$u="v16.8.0",eA={},tA=function(e,t){console.warn((t?t+": ":"")+e)},nA=function(e){fb("binding")},gA=function(e){return 0},iA=function(){return"/"},oA=function(e){},sA={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},rA=Qt,lA=[],IA={},aA=!1,CA={},cA=Qt,dA=Qt,Gr=function(){return{}},uA=Gr,AA=Gr,hA=Qt,mA=Qt,bA=Qt,pA={},fA={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},ZA=Qt,yA=Qt,GA=Qt,BA=Qt,SA=Qt,VA=Qt,WA=Qt,RA=void 0,vA=void 0,kA=void 0,XA=Qt,wA=2,JA=1,YA="/bin/usr/node",HA=9229,NA="node",FA=[],xA=Qt,kg={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},kg.now===void 0&&(id=Date.now(),kg.timing&&kg.timing.navigationStart&&(id=kg.timing.navigationStart),kg.now=()=>Date.now()-id),_I=1e9,OI.bigint=function(e){var t=OI(e);return typeof BigInt>"u"?t[0]*_I+t[1]:BigInt(t[0]*_I)+BigInt(t[1])},KA=10,EA={},MA=0,TA=Gg,LA=Gg,UA=Gg,zA=Gg,DA=Gg,QA=Qt,jA=Gg,PA=Gg,Zb={version:$u,versions:eA,arch:ju,platform:Pu,release:sA,_rawDebug:rA,moduleLoadList:lA,binding:nA,_linkedBinding:BR,_events:EA,_eventsCount:MA,_maxListeners:KA,on:Gg,addListener:TA,once:LA,off:UA,removeListener:zA,removeAllListeners:DA,emit:QA,prependListener:jA,prependOnceListener:PA,listeners:XR,domain:IA,_exiting:aA,config:CA,dlopen:SR,uptime:kR,_getActiveRequests:VR,_getActiveHandles:WR,reallyExit:cA,_kill:dA,cpuUsage:Gr,resourceUsage:uA,memoryUsage:AA,kill:hA,exit:mA,openStdin:bA,allowedNodeEnvironmentFlags:pA,assert:RR,features:fA,_fatalExceptions:ZA,setUncaughtExceptionCaptureCallback:yA,hasUncaughtExceptionCaptureCallback:vR,emitWarning:tA,nextTick:yR,_tickCallback:GA,_debugProcess:BA,_debugEnd:SA,_startProfilerIdleNotifier:VA,_stopProfilerIdleNotifier:WA,stdout:RA,stdin:kA,stderr:vA,abort:XA,umask:gA,chdir:oA,cwd:iA,env:Ou,title:Qu,argv:_u,execArgv:qu,pid:wA,ppid:JA,execPath:YA,debugPort:HA,hrtime:OI,argv0:NA,_preload_modules:FA,setSourceMapsEnabled:xA}}),Ae=Tt(()=>{hM()}),Lt={};To(Lt,{Buffer:()=>qa,INSPECT_MAX_BYTES:()=>wR,default:()=>Bg,kMaxLength:()=>JR});function mM(){if(OA)return _o;OA=!0,_o.byteLength=r,_o.toByteArray=I,_o.fromByteArray=c;for(var e=[],t=[],n=typeof Uint8Array<"u"?Uint8Array:Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=g.length;i<o;++i)e[i]=g[i],t[g.charCodeAt(i)]=i;t[45]=62,t[95]=63;function s(d){var u=d.length;if(u%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=d.indexOf("=");h===-1&&(h=u);var f=h===u?0:4-h%4;return[h,f]}function r(d){var u=s(d),h=u[0],f=u[1];return(h+f)*3/4-f}function l(d,u,h){return(u+h)*3/4-h}function I(d){var u,h=s(d),f=h[0],y=h[1],Z=new n(l(d,f,y)),p=0,B=y>0?f-4:f,W;for(W=0;W<B;W+=4)u=t[d.charCodeAt(W)]<<18|t[d.charCodeAt(W+1)]<<12|t[d.charCodeAt(W+2)]<<6|t[d.charCodeAt(W+3)],Z[p++]=u>>16&255,Z[p++]=u>>8&255,Z[p++]=u&255;return y===2&&(u=t[d.charCodeAt(W)]<<2|t[d.charCodeAt(W+1)]>>4,Z[p++]=u&255),y===1&&(u=t[d.charCodeAt(W)]<<10|t[d.charCodeAt(W+1)]<<4|t[d.charCodeAt(W+2)]>>2,Z[p++]=u>>8&255,Z[p++]=u&255),Z}function a(d){return e[d>>18&63]+e[d>>12&63]+e[d>>6&63]+e[d&63]}function C(d,u,h){for(var f,y=[],Z=u;Z<h;Z+=3)f=(d[Z]<<16&16711680)+(d[Z+1]<<8&65280)+(d[Z+2]&255),y.push(a(f));return y.join("")}function c(d){for(var u,h=d.length,f=h%3,y=[],Z=16383,p=0,B=h-f;p<B;p+=Z)y.push(C(d,p,p+Z>B?B:p+Z));return f===1?(u=d[h-1],y.push(e[u>>2]+e[u<<4&63]+"==")):f===2&&(u=(d[h-2]<<8)+d[h-1],y.push(e[u>>10]+e[u>>4&63]+e[u<<2&63]+"=")),y.join("")}return _o}function bM(){return _A?Br:(_A=!0,Br.read=function(e,t,n,g,i){var o,s,r=i*8-g-1,l=(1<<r)-1,I=l>>1,a=-7,C=n?i-1:0,c=n?-1:1,d=e[t+C];for(C+=c,o=d&(1<<-a)-1,d>>=-a,a+=r;a>0;o=o*256+e[t+C],C+=c,a-=8);for(s=o&(1<<-a)-1,o>>=-a,a+=g;a>0;s=s*256+e[t+C],C+=c,a-=8);if(o===0)o=1-I;else{if(o===l)return s?NaN:(d?-1:1)*(1/0);s=s+Math.pow(2,g),o=o-I}return(d?-1:1)*s*Math.pow(2,o-g)},Br.write=function(e,t,n,g,i,o){var s,r,l,I=o*8-i-1,a=(1<<I)-1,C=a>>1,c=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=g?0:o-1,u=g?1:-1,h=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(r=isNaN(t)?1:0,s=a):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+C>=1?t+=c/l:t+=c*Math.pow(2,1-C),t*l>=2&&(s++,l/=2),s+C>=a?(r=0,s=a):s+C>=1?(r=(t*l-1)*Math.pow(2,i),s=s+C):(r=t*Math.pow(2,C-1)*Math.pow(2,i),s=0));i>=8;e[n+d]=r&255,d+=u,r/=256,i-=8);for(s=s<<i|r,I+=i;I>0;e[n+d]=s&255,d+=u,s/=256,I-=8);e[n+d-u]|=h*128},Br)}function pM(){if(qA)return ii;qA=!0;let e=mM(),t=bM(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;ii.Buffer=s,ii.SlowBuffer=y,ii.INSPECT_MAX_BYTES=50;let g=2147483647;ii.kMaxLength=g,s.TYPED_ARRAY_SUPPORT=i(),!s.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{let m=new Uint8Array(1),A={foo:function(){return 42}};return Object.setPrototypeOf(A,Uint8Array.prototype),Object.setPrototypeOf(m,A),m.foo()===42}catch{return!1}}Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}});function o(m){if(m>g)throw new RangeError('The value "'+m+'" is invalid for option "size"');let A=new Uint8Array(m);return Object.setPrototypeOf(A,s.prototype),A}function s(m,A,b){if(typeof m=="number"){if(typeof A=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return a(m)}return r(m,A,b)}s.poolSize=8192;function r(m,A,b){if(typeof m=="string")return C(m,A);if(ArrayBuffer.isView(m))return d(m);if(m==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m);if(_(m,ArrayBuffer)||m&&_(m.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(_(m,SharedArrayBuffer)||m&&_(m.buffer,SharedArrayBuffer)))return u(m,A,b);if(typeof m=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let k=m.valueOf&&m.valueOf();if(k!=null&&k!==m)return s.from(k,A,b);let Y=h(m);if(Y)return Y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof m[Symbol.toPrimitive]=="function")return s.from(m[Symbol.toPrimitive]("string"),A,b);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m)}s.from=function(m,A,b){return r(m,A,b)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array);function l(m){if(typeof m!="number")throw new TypeError('"size" argument must be of type number');if(m<0)throw new RangeError('The value "'+m+'" is invalid for option "size"')}function I(m,A,b){return l(m),m<=0?o(m):A!==void 0?typeof b=="string"?o(m).fill(A,b):o(m).fill(A):o(m)}s.alloc=function(m,A,b){return I(m,A,b)};function a(m){return l(m),o(m<0?0:f(m)|0)}s.allocUnsafe=function(m){return a(m)},s.allocUnsafeSlow=function(m){return a(m)};function C(m,A){if((typeof A!="string"||A==="")&&(A="utf8"),!s.isEncoding(A))throw new TypeError("Unknown encoding: "+A);let b=Z(m,A)|0,k=o(b),Y=k.write(m,A);return Y!==b&&(k=k.slice(0,Y)),k}function c(m){let A=m.length<0?0:f(m.length)|0,b=o(A);for(let k=0;k<A;k+=1)b[k]=m[k]&255;return b}function d(m){if(_(m,Uint8Array)){let A=new Uint8Array(m);return u(A.buffer,A.byteOffset,A.byteLength)}return c(m)}function u(m,A,b){if(A<0||m.byteLength<A)throw new RangeError('"offset" is outside of buffer bounds');if(m.byteLength<A+(b||0))throw new RangeError('"length" is outside of buffer bounds');let k;return A===void 0&&b===void 0?k=new Uint8Array(m):b===void 0?k=new Uint8Array(m,A):k=new Uint8Array(m,A,b),Object.setPrototypeOf(k,s.prototype),k}function h(m){if(s.isBuffer(m)){let A=f(m.length)|0,b=o(A);return b.length===0||m.copy(b,0,0,A),b}if(m.length!==void 0)return typeof m.length!="number"||F(m.length)?o(0):c(m);if(m.type==="Buffer"&&Array.isArray(m.data))return c(m.data)}function f(m){if(m>=g)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+g.toString(16)+" bytes");return m|0}function y(m){return+m!=m&&(m=0),s.alloc(+m)}s.isBuffer=function(m){return m!=null&&m._isBuffer===!0&&m!==s.prototype},s.compare=function(m,A){if(_(m,Uint8Array)&&(m=s.from(m,m.offset,m.byteLength)),_(A,Uint8Array)&&(A=s.from(A,A.offset,A.byteLength)),!s.isBuffer(m)||!s.isBuffer(A))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(m===A)return 0;let b=m.length,k=A.length;for(let Y=0,j=Math.min(b,k);Y<j;++Y)if(m[Y]!==A[Y]){b=m[Y],k=A[Y];break}return b<k?-1:k<b?1:0},s.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(m,A){if(!Array.isArray(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return s.alloc(0);let b;if(A===void 0)for(A=0,b=0;b<m.length;++b)A+=m[b].length;let k=s.allocUnsafe(A),Y=0;for(b=0;b<m.length;++b){let j=m[b];if(_(j,Uint8Array))Y+j.length>k.length?(s.isBuffer(j)||(j=s.from(j)),j.copy(k,Y)):Uint8Array.prototype.set.call(k,j,Y);else if(s.isBuffer(j))j.copy(k,Y);else throw new TypeError('"list" argument must be an Array of Buffers');Y+=j.length}return k};function Z(m,A){if(s.isBuffer(m))return m.length;if(ArrayBuffer.isView(m)||_(m,ArrayBuffer))return m.byteLength;if(typeof m!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof m);let b=m.length,k=arguments.length>2&&arguments[2]===!0;if(!k&&b===0)return 0;let Y=!1;for(;;)switch(A){case"ascii":case"latin1":case"binary":return b;case"utf8":case"utf-8":return z(m).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b*2;case"hex":return b>>>1;case"base64":return se(m).length;default:if(Y)return k?-1:z(m).length;A=(""+A).toLowerCase(),Y=!0}}s.byteLength=Z;function p(m,A,b){let k=!1;if((A===void 0||A<0)&&(A=0),A>this.length||((b===void 0||b>this.length)&&(b=this.length),b<=0)||(b>>>=0,A>>>=0,b<=A))return"";for(m||(m="utf8");;)switch(m){case"hex":return N(this,A,b);case"utf8":case"utf-8":return L(this,A,b);case"ascii":return ie(this,A,b);case"latin1":case"binary":return ge(this,A,b);case"base64":return X(this,A,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return te(this,A,b);default:if(k)throw new TypeError("Unknown encoding: "+m);m=(m+"").toLowerCase(),k=!0}}s.prototype._isBuffer=!0;function B(m,A,b){let k=m[A];m[A]=m[b],m[b]=k}s.prototype.swap16=function(){let m=this.length;if(m%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let A=0;A<m;A+=2)B(this,A,A+1);return this},s.prototype.swap32=function(){let m=this.length;if(m%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let A=0;A<m;A+=4)B(this,A,A+3),B(this,A+1,A+2);return this},s.prototype.swap64=function(){let m=this.length;if(m%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let A=0;A<m;A+=8)B(this,A,A+7),B(this,A+1,A+6),B(this,A+2,A+5),B(this,A+3,A+4);return this},s.prototype.toString=function(){let m=this.length;return m===0?"":arguments.length===0?L(this,0,m):p.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(m){if(!s.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m?!0:s.compare(this,m)===0},s.prototype.inspect=function(){let m="",A=ii.INSPECT_MAX_BYTES;return m=this.toString("hex",0,A).replace(/(.{2})/g,"$1 ").trim(),this.length>A&&(m+=" ... "),"<Buffer "+m+">"},n&&(s.prototype[n]=s.prototype.inspect),s.prototype.compare=function(m,A,b,k,Y){if(_(m,Uint8Array)&&(m=s.from(m,m.offset,m.byteLength)),!s.isBuffer(m))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof m);if(A===void 0&&(A=0),b===void 0&&(b=m?m.length:0),k===void 0&&(k=0),Y===void 0&&(Y=this.length),A<0||b>m.length||k<0||Y>this.length)throw new RangeError("out of range index");if(k>=Y&&A>=b)return 0;if(k>=Y)return-1;if(A>=b)return 1;if(A>>>=0,b>>>=0,k>>>=0,Y>>>=0,this===m)return 0;let j=Y-k,le=b-A,Xe=Math.min(j,le),Fe=this.slice(k,Y),xe=m.slice(A,b);for(let Re=0;Re<Xe;++Re)if(Fe[Re]!==xe[Re]){j=Fe[Re],le=xe[Re];break}return j<le?-1:le<j?1:0};function W(m,A,b,k,Y){if(m.length===0)return-1;if(typeof b=="string"?(k=b,b=0):b>2147483647?b=2147483647:b<-2147483648&&(b=-2147483648),b=+b,F(b)&&(b=Y?0:m.length-1),b<0&&(b=m.length+b),b>=m.length){if(Y)return-1;b=m.length-1}else if(b<0)if(Y)b=0;else return-1;if(typeof A=="string"&&(A=s.from(A,k)),s.isBuffer(A))return A.length===0?-1:S(m,A,b,k,Y);if(typeof A=="number")return A=A&255,typeof Uint8Array.prototype.indexOf=="function"?Y?Uint8Array.prototype.indexOf.call(m,A,b):Uint8Array.prototype.lastIndexOf.call(m,A,b):S(m,[A],b,k,Y);throw new TypeError("val must be string, number or Buffer")}function S(m,A,b,k,Y){let j=1,le=m.length,Xe=A.length;if(k!==void 0&&(k=String(k).toLowerCase(),k==="ucs2"||k==="ucs-2"||k==="utf16le"||k==="utf-16le")){if(m.length<2||A.length<2)return-1;j=2,le/=2,Xe/=2,b/=2}function Fe(Re,Ne){return j===1?Re[Ne]:Re.readUInt16BE(Ne*j)}let xe;if(Y){let Re=-1;for(xe=b;xe<le;xe++)if(Fe(m,xe)===Fe(A,Re===-1?0:xe-Re)){if(Re===-1&&(Re=xe),xe-Re+1===Xe)return Re*j}else Re!==-1&&(xe-=xe-Re),Re=-1}else for(b+Xe>le&&(b=le-Xe),xe=b;xe>=0;xe--){let Re=!0;for(let Ne=0;Ne<Xe;Ne++)if(Fe(m,xe+Ne)!==Fe(A,Ne)){Re=!1;break}if(Re)return xe}return-1}s.prototype.includes=function(m,A,b){return this.indexOf(m,A,b)!==-1},s.prototype.indexOf=function(m,A,b){return W(this,m,A,b,!0)},s.prototype.lastIndexOf=function(m,A,b){return W(this,m,A,b,!1)};function V(m,A,b,k){b=Number(b)||0;let Y=m.length-b;k?(k=Number(k),k>Y&&(k=Y)):k=Y;let j=A.length;k>j/2&&(k=j/2);let le;for(le=0;le<k;++le){let Xe=parseInt(A.substr(le*2,2),16);if(F(Xe))return le;m[b+le]=Xe}return le}function R(m,A,b,k){return T(z(A,m.length-b),m,b,k)}function J(m,A,b,k){return T(Q(A),m,b,k)}function M(m,A,b,k){return T(se(A),m,b,k)}function P(m,A,b,k){return T(ce(A,m.length-b),m,b,k)}s.prototype.write=function(m,A,b,k){if(A===void 0)k="utf8",b=this.length,A=0;else if(b===void 0&&typeof A=="string")k=A,b=this.length,A=0;else if(isFinite(A))A=A>>>0,isFinite(b)?(b=b>>>0,k===void 0&&(k="utf8")):(k=b,b=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let Y=this.length-A;if((b===void 0||b>Y)&&(b=Y),m.length>0&&(b<0||A<0)||A>this.length)throw new RangeError("Attempt to write outside buffer bounds");k||(k="utf8");let j=!1;for(;;)switch(k){case"hex":return V(this,m,A,b);case"utf8":case"utf-8":return R(this,m,A,b);case"ascii":case"latin1":case"binary":return J(this,m,A,b);case"base64":return M(this,m,A,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,m,A,b);default:if(j)throw new TypeError("Unknown encoding: "+k);k=(""+k).toLowerCase(),j=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(m,A,b){return A===0&&b===m.length?e.fromByteArray(m):e.fromByteArray(m.slice(A,b))}function L(m,A,b){b=Math.min(m.length,b);let k=[],Y=A;for(;Y<b;){let j=m[Y],le=null,Xe=j>239?4:j>223?3:j>191?2:1;if(Y+Xe<=b){let Fe,xe,Re,Ne;switch(Xe){case 1:j<128&&(le=j);break;case 2:Fe=m[Y+1],(Fe&192)===128&&(Ne=(j&31)<<6|Fe&63,Ne>127&&(le=Ne));break;case 3:Fe=m[Y+1],xe=m[Y+2],(Fe&192)===128&&(xe&192)===128&&(Ne=(j&15)<<12|(Fe&63)<<6|xe&63,Ne>2047&&(Ne<55296||Ne>57343)&&(le=Ne));break;case 4:Fe=m[Y+1],xe=m[Y+2],Re=m[Y+3],(Fe&192)===128&&(xe&192)===128&&(Re&192)===128&&(Ne=(j&15)<<18|(Fe&63)<<12|(xe&63)<<6|Re&63,Ne>65535&&Ne<1114112&&(le=Ne))}}le===null?(le=65533,Xe=1):le>65535&&(le-=65536,k.push(le>>>10&1023|55296),le=56320|le&1023),k.push(le),Y+=Xe}return D(k)}let ne=4096;function D(m){let A=m.length;if(A<=ne)return String.fromCharCode.apply(String,m);let b="",k=0;for(;k<A;)b+=String.fromCharCode.apply(String,m.slice(k,k+=ne));return b}function ie(m,A,b){let k="";b=Math.min(m.length,b);for(let Y=A;Y<b;++Y)k+=String.fromCharCode(m[Y]&127);return k}function ge(m,A,b){let k="";b=Math.min(m.length,b);for(let Y=A;Y<b;++Y)k+=String.fromCharCode(m[Y]);return k}function N(m,A,b){let k=m.length;(!A||A<0)&&(A=0),(!b||b<0||b>k)&&(b=k);let Y="";for(let j=A;j<b;++j)Y+=U[m[j]];return Y}function te(m,A,b){let k=m.slice(A,b),Y="";for(let j=0;j<k.length-1;j+=2)Y+=String.fromCharCode(k[j]+k[j+1]*256);return Y}s.prototype.slice=function(m,A){let b=this.length;m=~~m,A=A===void 0?b:~~A,m<0?(m+=b,m<0&&(m=0)):m>b&&(m=b),A<0?(A+=b,A<0&&(A=0)):A>b&&(A=b),A<m&&(A=m);let k=this.subarray(m,A);return Object.setPrototypeOf(k,s.prototype),k};function q(m,A,b){if(m%1!==0||m<0)throw new RangeError("offset is not uint");if(m+A>b)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUintLE=s.prototype.readUIntLE=function(m,A,b){m=m>>>0,A=A>>>0,b||q(m,A,this.length);let k=this[m],Y=1,j=0;for(;++j<A&&(Y*=256);)k+=this[m+j]*Y;return k},s.prototype.readUintBE=s.prototype.readUIntBE=function(m,A,b){m=m>>>0,A=A>>>0,b||q(m,A,this.length);let k=this[m+--A],Y=1;for(;A>0&&(Y*=256);)k+=this[m+--A]*Y;return k},s.prototype.readUint8=s.prototype.readUInt8=function(m,A){return m=m>>>0,A||q(m,1,this.length),this[m]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(m,A){return m=m>>>0,A||q(m,2,this.length),this[m]|this[m+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(m,A){return m=m>>>0,A||q(m,2,this.length),this[m]<<8|this[m+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(m,A){return m=m>>>0,A||q(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+this[m+3]*16777216},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(m,A){return m=m>>>0,A||q(m,4,this.length),this[m]*16777216+(this[m+1]<<16|this[m+2]<<8|this[m+3])},s.prototype.readBigUInt64LE=O(function(m){m=m>>>0,re(m,"offset");let A=this[m],b=this[m+7];(A===void 0||b===void 0)&&ye(m,this.length-8);let k=A+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24,Y=this[++m]+this[++m]*2**8+this[++m]*2**16+b*2**24;return BigInt(k)+(BigInt(Y)<<BigInt(32))}),s.prototype.readBigUInt64BE=O(function(m){m=m>>>0,re(m,"offset");let A=this[m],b=this[m+7];(A===void 0||b===void 0)&&ye(m,this.length-8);let k=A*2**24+this[++m]*2**16+this[++m]*2**8+this[++m],Y=this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+b;return(BigInt(k)<<BigInt(32))+BigInt(Y)}),s.prototype.readIntLE=function(m,A,b){m=m>>>0,A=A>>>0,b||q(m,A,this.length);let k=this[m],Y=1,j=0;for(;++j<A&&(Y*=256);)k+=this[m+j]*Y;return Y*=128,k>=Y&&(k-=Math.pow(2,8*A)),k},s.prototype.readIntBE=function(m,A,b){m=m>>>0,A=A>>>0,b||q(m,A,this.length);let k=A,Y=1,j=this[m+--k];for(;k>0&&(Y*=256);)j+=this[m+--k]*Y;return Y*=128,j>=Y&&(j-=Math.pow(2,8*A)),j},s.prototype.readInt8=function(m,A){return m=m>>>0,A||q(m,1,this.length),this[m]&128?(255-this[m]+1)*-1:this[m]},s.prototype.readInt16LE=function(m,A){m=m>>>0,A||q(m,2,this.length);let b=this[m]|this[m+1]<<8;return b&32768?b|4294901760:b},s.prototype.readInt16BE=function(m,A){m=m>>>0,A||q(m,2,this.length);let b=this[m+1]|this[m]<<8;return b&32768?b|4294901760:b},s.prototype.readInt32LE=function(m,A){return m=m>>>0,A||q(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},s.prototype.readInt32BE=function(m,A){return m=m>>>0,A||q(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},s.prototype.readBigInt64LE=O(function(m){m=m>>>0,re(m,"offset");let A=this[m],b=this[m+7];(A===void 0||b===void 0)&&ye(m,this.length-8);let k=this[m+4]+this[m+5]*2**8+this[m+6]*2**16+(b<<24);return(BigInt(k)<<BigInt(32))+BigInt(A+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24)}),s.prototype.readBigInt64BE=O(function(m){m=m>>>0,re(m,"offset");let A=this[m],b=this[m+7];(A===void 0||b===void 0)&&ye(m,this.length-8);let k=(A<<24)+this[++m]*2**16+this[++m]*2**8+this[++m];return(BigInt(k)<<BigInt(32))+BigInt(this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+b)}),s.prototype.readFloatLE=function(m,A){return m=m>>>0,A||q(m,4,this.length),t.read(this,m,!0,23,4)},s.prototype.readFloatBE=function(m,A){return m=m>>>0,A||q(m,4,this.length),t.read(this,m,!1,23,4)},s.prototype.readDoubleLE=function(m,A){return m=m>>>0,A||q(m,8,this.length),t.read(this,m,!0,52,8)},s.prototype.readDoubleBE=function(m,A){return m=m>>>0,A||q(m,8,this.length),t.read(this,m,!1,52,8)};function me(m,A,b,k,Y,j){if(!s.isBuffer(m))throw new TypeError('"buffer" argument must be a Buffer instance');if(A>Y||A<j)throw new RangeError('"value" argument is out of bounds');if(b+k>m.length)throw new RangeError("Index out of range")}s.prototype.writeUintLE=s.prototype.writeUIntLE=function(m,A,b,k){if(m=+m,A=A>>>0,b=b>>>0,!k){let le=Math.pow(2,8*b)-1;me(this,m,A,b,le,0)}let Y=1,j=0;for(this[A]=m&255;++j<b&&(Y*=256);)this[A+j]=m/Y&255;return A+b},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(m,A,b,k){if(m=+m,A=A>>>0,b=b>>>0,!k){let le=Math.pow(2,8*b)-1;me(this,m,A,b,le,0)}let Y=b-1,j=1;for(this[A+Y]=m&255;--Y>=0&&(j*=256);)this[A+Y]=m/j&255;return A+b},s.prototype.writeUint8=s.prototype.writeUInt8=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,1,255,0),this[A]=m&255,A+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,2,65535,0),this[A]=m&255,this[A+1]=m>>>8,A+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,2,65535,0),this[A]=m>>>8,this[A+1]=m&255,A+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,4,4294967295,0),this[A+3]=m>>>24,this[A+2]=m>>>16,this[A+1]=m>>>8,this[A]=m&255,A+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,4,4294967295,0),this[A]=m>>>24,this[A+1]=m>>>16,this[A+2]=m>>>8,this[A+3]=m&255,A+4};function v(m,A,b,k,Y){ae(A,k,Y,m,b,7);let j=Number(A&BigInt(4294967295));m[b++]=j,j=j>>8,m[b++]=j,j=j>>8,m[b++]=j,j=j>>8,m[b++]=j;let le=Number(A>>BigInt(32)&BigInt(4294967295));return m[b++]=le,le=le>>8,m[b++]=le,le=le>>8,m[b++]=le,le=le>>8,m[b++]=le,b}function $(m,A,b,k,Y){ae(A,k,Y,m,b,7);let j=Number(A&BigInt(4294967295));m[b+7]=j,j=j>>8,m[b+6]=j,j=j>>8,m[b+5]=j,j=j>>8,m[b+4]=j;let le=Number(A>>BigInt(32)&BigInt(4294967295));return m[b+3]=le,le=le>>8,m[b+2]=le,le=le>>8,m[b+1]=le,le=le>>8,m[b]=le,b+8}s.prototype.writeBigUInt64LE=O(function(m,A=0){return v(this,m,A,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeBigUInt64BE=O(function(m,A=0){return $(this,m,A,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeIntLE=function(m,A,b,k){if(m=+m,A=A>>>0,!k){let Xe=Math.pow(2,8*b-1);me(this,m,A,b,Xe-1,-Xe)}let Y=0,j=1,le=0;for(this[A]=m&255;++Y<b&&(j*=256);)m<0&&le===0&&this[A+Y-1]!==0&&(le=1),this[A+Y]=(m/j>>0)-le&255;return A+b},s.prototype.writeIntBE=function(m,A,b,k){if(m=+m,A=A>>>0,!k){let Xe=Math.pow(2,8*b-1);me(this,m,A,b,Xe-1,-Xe)}let Y=b-1,j=1,le=0;for(this[A+Y]=m&255;--Y>=0&&(j*=256);)m<0&&le===0&&this[A+Y+1]!==0&&(le=1),this[A+Y]=(m/j>>0)-le&255;return A+b},s.prototype.writeInt8=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,1,127,-128),m<0&&(m=255+m+1),this[A]=m&255,A+1},s.prototype.writeInt16LE=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,2,32767,-32768),this[A]=m&255,this[A+1]=m>>>8,A+2},s.prototype.writeInt16BE=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,2,32767,-32768),this[A]=m>>>8,this[A+1]=m&255,A+2},s.prototype.writeInt32LE=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,4,2147483647,-2147483648),this[A]=m&255,this[A+1]=m>>>8,this[A+2]=m>>>16,this[A+3]=m>>>24,A+4},s.prototype.writeInt32BE=function(m,A,b){return m=+m,A=A>>>0,b||me(this,m,A,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),this[A]=m>>>24,this[A+1]=m>>>16,this[A+2]=m>>>8,this[A+3]=m&255,A+4},s.prototype.writeBigInt64LE=O(function(m,A=0){return v(this,m,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeBigInt64BE=O(function(m,A=0){return $(this,m,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ce(m,A,b,k,Y,j){if(b+k>m.length)throw new RangeError("Index out of range");if(b<0)throw new RangeError("Index out of range")}function Be(m,A,b,k,Y){return A=+A,b=b>>>0,Y||Ce(m,A,b,4),t.write(m,A,b,k,23,4),b+4}s.prototype.writeFloatLE=function(m,A,b){return Be(this,m,A,!0,b)},s.prototype.writeFloatBE=function(m,A,b){return Be(this,m,A,!1,b)};function Ie(m,A,b,k,Y){return A=+A,b=b>>>0,Y||Ce(m,A,b,8),t.write(m,A,b,k,52,8),b+8}s.prototype.writeDoubleLE=function(m,A,b){return Ie(this,m,A,!0,b)},s.prototype.writeDoubleBE=function(m,A,b){return Ie(this,m,A,!1,b)},s.prototype.copy=function(m,A,b,k){if(!s.isBuffer(m))throw new TypeError("argument should be a Buffer");if(b||(b=0),!k&&k!==0&&(k=this.length),A>=m.length&&(A=m.length),A||(A=0),k>0&&k<b&&(k=b),k===b||m.length===0||this.length===0)return 0;if(A<0)throw new RangeError("targetStart out of bounds");if(b<0||b>=this.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("sourceEnd out of bounds");k>this.length&&(k=this.length),m.length-A<k-b&&(k=m.length-A+b);let Y=k-b;return this===m&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(A,b,k):Uint8Array.prototype.set.call(m,this.subarray(b,k),A),Y},s.prototype.fill=function(m,A,b,k){if(typeof m=="string"){if(typeof A=="string"?(k=A,A=0,b=this.length):typeof b=="string"&&(k=b,b=this.length),k!==void 0&&typeof k!="string")throw new TypeError("encoding must be a string");if(typeof k=="string"&&!s.isEncoding(k))throw new TypeError("Unknown encoding: "+k);if(m.length===1){let j=m.charCodeAt(0);(k==="utf8"&&j<128||k==="latin1")&&(m=j)}}else typeof m=="number"?m=m&255:typeof m=="boolean"&&(m=Number(m));if(A<0||this.length<A||this.length<b)throw new RangeError("Out of range index");if(b<=A)return this;A=A>>>0,b=b===void 0?this.length:b>>>0,m||(m=0);let Y;if(typeof m=="number")for(Y=A;Y<b;++Y)this[Y]=m;else{let j=s.isBuffer(m)?m:s.from(m,k),le=j.length;if(le===0)throw new TypeError('The value "'+m+'" is invalid for argument "value"');for(Y=0;Y<b-A;++Y)this[Y+A]=j[Y%le]}return this};let K={};function w(m,A,b){K[m]=class extends b{constructor(){super(),Object.defineProperty(this,"message",{value:A.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${m}]`,this.stack,delete this.name}get code(){return m}set code(k){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:k,writable:!0})}toString(){return`${this.name} [${m}]: ${this.message}`}}}w("ERR_BUFFER_OUT_OF_BOUNDS",function(m){return m?`${m} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),w("ERR_INVALID_ARG_TYPE",function(m,A){return`The "${m}" argument must be of type number. Received type ${typeof A}`},TypeError),w("ERR_OUT_OF_RANGE",function(m,A,b){let k=`The value of "${m}" is out of range.`,Y=b;return Number.isInteger(b)&&Math.abs(b)>2**32?Y=ee(String(b)):typeof b=="bigint"&&(Y=String(b),(b>BigInt(2)**BigInt(32)||b<-(BigInt(2)**BigInt(32)))&&(Y=ee(Y)),Y+="n"),k+=` It must be ${A}. Received ${Y}`,k},RangeError);function ee(m){let A="",b=m.length,k=m[0]==="-"?1:0;for(;b>=k+4;b-=3)A=`_${m.slice(b-3,b)}${A}`;return`${m.slice(0,b)}${A}`}function be(m,A,b){re(A,"offset"),(m[A]===void 0||m[A+b]===void 0)&&ye(A,m.length-(b+1))}function ae(m,A,b,k,Y,j){if(m>b||m<A){let le=typeof A=="bigint"?"n":"",Xe;throw A===0||A===BigInt(0)?Xe=`>= 0${le} and < 2${le} ** ${(j+1)*8}${le}`:Xe=`>= -(2${le} ** ${(j+1)*8-1}${le}) and < 2 ** ${(j+1)*8-1}${le}`,new K.ERR_OUT_OF_RANGE("value",Xe,m)}be(k,Y,j)}function re(m,A){if(typeof m!="number")throw new K.ERR_INVALID_ARG_TYPE(A,"number",m)}function ye(m,A,b){throw Math.floor(m)!==m?(re(m,b),new K.ERR_OUT_OF_RANGE("offset","an integer",m)):A<0?new K.ERR_BUFFER_OUT_OF_BOUNDS:new K.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${A}`,m)}let pe=/[^+/0-9A-Za-z-_]/g;function x(m){if(m=m.split("=")[0],m=m.trim().replace(pe,""),m.length<2)return"";for(;m.length%4!==0;)m=m+"=";return m}function z(m,A){A=A||1/0;let b,k=m.length,Y=null,j=[];for(let le=0;le<k;++le){if(b=m.charCodeAt(le),b>55295&&b<57344){if(!Y){if(b>56319){(A-=3)>-1&&j.push(239,191,189);continue}else if(le+1===k){(A-=3)>-1&&j.push(239,191,189);continue}Y=b;continue}if(b<56320){(A-=3)>-1&&j.push(239,191,189),Y=b;continue}b=(Y-55296<<10|b-56320)+65536}else Y&&(A-=3)>-1&&j.push(239,191,189);if(Y=null,b<128){if((A-=1)<0)break;j.push(b)}else if(b<2048){if((A-=2)<0)break;j.push(b>>6|192,b&63|128)}else if(b<65536){if((A-=3)<0)break;j.push(b>>12|224,b>>6&63|128,b&63|128)}else if(b<1114112){if((A-=4)<0)break;j.push(b>>18|240,b>>12&63|128,b>>6&63|128,b&63|128)}else throw new Error("Invalid code point")}return j}function Q(m){let A=[];for(let b=0;b<m.length;++b)A.push(m.charCodeAt(b)&255);return A}function ce(m,A){let b,k,Y,j=[];for(let le=0;le<m.length&&!((A-=2)<0);++le)b=m.charCodeAt(le),k=b>>8,Y=b%256,j.push(Y),j.push(k);return j}function se(m){return e.toByteArray(x(m))}function T(m,A,b,k){let Y;for(Y=0;Y<k&&!(Y+b>=A.length||Y>=m.length);++Y)A[Y+b]=m[Y];return Y}function _(m,A){return m instanceof A||m!=null&&m.constructor!=null&&m.constructor.name!=null&&m.constructor.name===A.name}function F(m){return m!==m}let U=function(){let m="0123456789abcdef",A=new Array(256);for(let b=0;b<16;++b){let k=b*16;for(let Y=0;Y<16;++Y)A[k+Y]=m[b]+m[Y]}return A}();function O(m){return typeof BigInt>"u"?de:m}function de(){throw new Error("BigInt not supported")}return ii}var _o,OA,Br,_A,ii,qA,Bg,qa,wR,JR,Ut=Tt(()=>{he(),Ae(),ue(),_o={},OA=!1,Br={},_A=!1,ii={},qA=!1,Bg=pM(),Bg.Buffer,Bg.SlowBuffer,Bg.INSPECT_MAX_BYTES,Bg.kMaxLength,qa=Bg.Buffer,wR=Bg.INSPECT_MAX_BYTES,JR=Bg.kMaxLength}),he=Tt(()=>{Ut()}),fM=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=class{constructor(n){this.aliasToTopic={},this.max=n}put(n,g){return g===0||g>this.max?!1:(this.aliasToTopic[g]=n,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(n){return this.aliasToTopic[n]}clear(){this.aliasToTopic={}}};e.default=t}),vt=Ze((e,t)=>{he(),Ae(),ue(),t.exports={ArrayIsArray(n){return Array.isArray(n)},ArrayPrototypeIncludes(n,g){return n.includes(g)},ArrayPrototypeIndexOf(n,g){return n.indexOf(g)},ArrayPrototypeJoin(n,g){return n.join(g)},ArrayPrototypeMap(n,g){return n.map(g)},ArrayPrototypePop(n,g){return n.pop(g)},ArrayPrototypePush(n,g){return n.push(g)},ArrayPrototypeSlice(n,g,i){return n.slice(g,i)},Error,FunctionPrototypeCall(n,g,...i){return n.call(g,...i)},FunctionPrototypeSymbolHasInstance(n,g){return Function.prototype[Symbol.hasInstance].call(n,g)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(n,g){return Object.defineProperties(n,g)},ObjectDefineProperty(n,g,i){return Object.defineProperty(n,g,i)},ObjectGetOwnPropertyDescriptor(n,g){return Object.getOwnPropertyDescriptor(n,g)},ObjectKeys(n){return Object.keys(n)},ObjectSetPrototypeOf(n,g){return Object.setPrototypeOf(n,g)},Promise,PromisePrototypeCatch(n,g){return n.catch(g)},PromisePrototypeThen(n,g,i){return n.then(g,i)},PromiseReject(n){return Promise.reject(n)},ReflectApply:Reflect.apply,RegExpPrototypeTest(n,g){return n.test(g)},SafeSet:Set,String,StringPrototypeSlice(n,g,i){return n.slice(g,i)},StringPrototypeToLowerCase(n){return n.toLowerCase()},StringPrototypeToUpperCase(n){return n.toUpperCase()},StringPrototypeTrim(n){return n.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(n,g,i){return n.set(g,i)},Uint8Array}}),zg=Ze((e,t)=>{he(),Ae(),ue();var n=(Ut(),$e(Lt)),g=Object.getPrototypeOf(async function(){}).constructor,i=globalThis.Blob||n.Blob,o=typeof i<"u"?function(r){return r instanceof i}:function(r){return!1},s=class extends Error{constructor(r){if(!Array.isArray(r))throw new TypeError(`Expected input to be an Array, got ${typeof r}`);let l="";for(let I=0;I<r.length;I++)l+=`    ${r[I].stack}
`;super(l),this.name="AggregateError",this.errors=r}};t.exports={AggregateError:s,kEmptyObject:Object.freeze({}),once(r){let l=!1;return function(...I){l||(l=!0,r.apply(this,I))}},createDeferredPromise:function(){let r,l;return{promise:new Promise((I,a)=>{r=I,l=a}),resolve:r,reject:l}},promisify(r){return new Promise((l,I)=>{r((a,...C)=>a?I(a):l(...C))})},debuglog(){return function(){}},format(r,...l){return r.replace(/%([sdifj])/g,function(...[I,a]){let C=l.shift();return a==="f"?C.toFixed(6):a==="j"?JSON.stringify(C):a==="s"&&typeof C=="object"?`${C.constructor!==Object?C.constructor.name:""} {}`.trim():C.toString()})},inspect(r){switch(typeof r){case"string":if(r.includes("'"))if(r.includes('"')){if(!r.includes("`")&&!r.includes("${"))return`\`${r}\``}else return`"${r}"`;return`'${r}'`;case"number":return isNaN(r)?"NaN":Object.is(r,-0)?String(r):r;case"bigint":return`${String(r)}n`;case"boolean":case"undefined":return String(r);case"object":return"{}"}},types:{isAsyncFunction(r){return r instanceof g},isArrayBufferView(r){return ArrayBuffer.isView(r)}},isBlob:o},t.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),yb=Ze((e,t)=>{he(),Ae(),ue();var{AbortController:n,AbortSignal:g}=typeof self<"u"?self:typeof window<"u"?window:void 0;t.exports=n,t.exports.AbortSignal=g,t.exports.default=n}),fn=Ze((e,t)=>{he(),Ae(),ue();var{format:n,inspect:g,AggregateError:i}=zg(),o=globalThis.AggregateError||i,s=Symbol("kIsNodeError"),r=["string","function","number","object","Function","Object","boolean","bigint","symbol"],l=/^([A-Z][a-z0-9]*)+$/,I="__node_internal_",a={};function C(Z,p){if(!Z)throw new a.ERR_INTERNAL_ASSERTION(p)}function c(Z){let p="",B=Z.length,W=Z[0]==="-"?1:0;for(;B>=W+4;B-=3)p=`_${Z.slice(B-3,B)}${p}`;return`${Z.slice(0,B)}${p}`}function d(Z,p,B){if(typeof p=="function")return C(p.length<=B.length,`Code: ${Z}; The provided arguments length (${B.length}) does not match the required ones (${p.length}).`),p(...B);let W=(p.match(/%[dfijoOs]/g)||[]).length;return C(W===B.length,`Code: ${Z}; The provided arguments length (${B.length}) does not match the required ones (${W}).`),B.length===0?p:n(p,...B)}function u(Z,p,B){B||(B=Error);class W extends B{constructor(...V){super(d(Z,p,V))}toString(){return`${this.name} [${Z}]: ${this.message}`}}Object.defineProperties(W.prototype,{name:{value:B.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${Z}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),W.prototype.code=Z,W.prototype[s]=!0,a[Z]=W}function h(Z){let p=I+Z.name;return Object.defineProperty(Z,"name",{value:p}),Z}function f(Z,p){if(Z&&p&&Z!==p){if(Array.isArray(p.errors))return p.errors.push(Z),p;let B=new o([p,Z],p.message);return B.code=p.code,B}return Z||p}var y=class extends Error{constructor(Z="The operation was aborted",p=void 0){if(p!==void 0&&typeof p!="object")throw new a.ERR_INVALID_ARG_TYPE("options","Object",p);super(Z,p),this.code="ABORT_ERR",this.name="AbortError"}};u("ERR_ASSERTION","%s",Error),u("ERR_INVALID_ARG_TYPE",(Z,p,B)=>{C(typeof Z=="string","'name' must be a string"),Array.isArray(p)||(p=[p]);let W="The ";Z.endsWith(" argument")?W+=`${Z} `:W+=`"${Z}" ${Z.includes(".")?"property":"argument"} `,W+="must be ";let S=[],V=[],R=[];for(let M of p)C(typeof M=="string","All expected entries have to be of type string"),r.includes(M)?S.push(M.toLowerCase()):l.test(M)?V.push(M):(C(M!=="object",'The value "object" should be written as "Object"'),R.push(M));if(V.length>0){let M=S.indexOf("object");M!==-1&&(S.splice(S,M,1),V.push("Object"))}if(S.length>0){switch(S.length){case 1:W+=`of type ${S[0]}`;break;case 2:W+=`one of type ${S[0]} or ${S[1]}`;break;default:{let M=S.pop();W+=`one of type ${S.join(", ")}, or ${M}`}}(V.length>0||R.length>0)&&(W+=" or ")}if(V.length>0){switch(V.length){case 1:W+=`an instance of ${V[0]}`;break;case 2:W+=`an instance of ${V[0]} or ${V[1]}`;break;default:{let M=V.pop();W+=`an instance of ${V.join(", ")}, or ${M}`}}R.length>0&&(W+=" or ")}switch(R.length){case 0:break;case 1:R[0].toLowerCase()!==R[0]&&(W+="an "),W+=`${R[0]}`;break;case 2:W+=`one of ${R[0]} or ${R[1]}`;break;default:{let M=R.pop();W+=`one of ${R.join(", ")}, or ${M}`}}if(B==null)W+=`. Received ${B}`;else if(typeof B=="function"&&B.name)W+=`. Received function ${B.name}`;else if(typeof B=="object"){var J;if((J=B.constructor)!==null&&J!==void 0&&J.name)W+=`. Received an instance of ${B.constructor.name}`;else{let M=g(B,{depth:-1});W+=`. Received ${M}`}}else{let M=g(B,{colors:!1});M.length>25&&(M=`${M.slice(0,25)}...`),W+=`. Received type ${typeof B} (${M})`}return W},TypeError),u("ERR_INVALID_ARG_VALUE",(Z,p,B="is invalid")=>{let W=g(p);return W.length>128&&(W=W.slice(0,128)+"..."),`The ${Z.includes(".")?"property":"argument"} '${Z}' ${B}. Received ${W}`},TypeError),u("ERR_INVALID_RETURN_VALUE",(Z,p,B)=>{var W;let S=B!=null&&(W=B.constructor)!==null&&W!==void 0&&W.name?`instance of ${B.constructor.name}`:`type ${typeof B}`;return`Expected ${Z} to be returned from the "${p}" function but got ${S}.`},TypeError),u("ERR_MISSING_ARGS",(...Z)=>{C(Z.length>0,"At least one arg needs to be specified");let p,B=Z.length;switch(Z=(Array.isArray(Z)?Z:[Z]).map(W=>`"${W}"`).join(" or "),B){case 1:p+=`The ${Z[0]} argument`;break;case 2:p+=`The ${Z[0]} and ${Z[1]} arguments`;break;default:{let W=Z.pop();p+=`The ${Z.join(", ")}, and ${W} arguments`}break}return`${p} must be specified`},TypeError),u("ERR_OUT_OF_RANGE",(Z,p,B)=>{C(p,'Missing "range" argument');let W;return Number.isInteger(B)&&Math.abs(B)>2**32?W=c(String(B)):typeof B=="bigint"?(W=String(B),(B>2n**32n||B<-(2n**32n))&&(W=c(W)),W+="n"):W=g(B),`The value of "${Z}" is out of range. It must be ${p}. Received ${W}`},RangeError),u("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),u("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),u("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),u("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),u("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),u("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),u("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),u("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),u("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),u("ERR_STREAM_WRITE_AFTER_END","write after end",Error),u("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),t.exports={AbortError:y,aggregateTwoErrors:h(f),hideStackFrames:h,codes:a}}),PC=Ze((e,t)=>{he(),Ae(),ue();var{ArrayIsArray:n,ArrayPrototypeIncludes:g,ArrayPrototypeJoin:i,ArrayPrototypeMap:o,NumberIsInteger:s,NumberIsNaN:r,NumberMAX_SAFE_INTEGER:l,NumberMIN_SAFE_INTEGER:I,NumberParseInt:a,ObjectPrototypeHasOwnProperty:C,RegExpPrototypeExec:c,String:d,StringPrototypeToUpperCase:u,StringPrototypeTrim:h}=vt(),{hideStackFrames:f,codes:{ERR_SOCKET_BAD_PORT:y,ERR_INVALID_ARG_TYPE:Z,ERR_INVALID_ARG_VALUE:p,ERR_OUT_OF_RANGE:B,ERR_UNKNOWN_SIGNAL:W}}=fn(),{normalizeEncoding:S}=zg(),{isAsyncFunction:V,isArrayBufferView:R}=zg().types,J={};function M(T){return T===(T|0)}function P(T){return T===T>>>0}var X=/^[0-7]+$/,L="must be a 32-bit unsigned integer or an octal string";function ne(T,_,F){if(typeof T>"u"&&(T=F),typeof T=="string"){if(c(X,T)===null)throw new p(_,T,L);T=a(T,8)}return ge(T,_),T}var D=f((T,_,F=I,U=l)=>{if(typeof T!="number")throw new Z(_,"number",T);if(!s(T))throw new B(_,"an integer",T);if(T<F||T>U)throw new B(_,`>= ${F} && <= ${U}`,T)}),ie=f((T,_,F=-2147483648,U=2147483647)=>{if(typeof T!="number")throw new Z(_,"number",T);if(!s(T))throw new B(_,"an integer",T);if(T<F||T>U)throw new B(_,`>= ${F} && <= ${U}`,T)}),ge=f((T,_,F=!1)=>{if(typeof T!="number")throw new Z(_,"number",T);if(!s(T))throw new B(_,"an integer",T);let U=F?1:0,O=4294967295;if(T<U||T>O)throw new B(_,`>= ${U} && <= ${O}`,T)});function N(T,_){if(typeof T!="string")throw new Z(_,"string",T)}function te(T,_,F=void 0,U){if(typeof T!="number")throw new Z(_,"number",T);if(F!=null&&T<F||U!=null&&T>U||(F!=null||U!=null)&&r(T))throw new B(_,`${F!=null?`>= ${F}`:""}${F!=null&&U!=null?" && ":""}${U!=null?`<= ${U}`:""}`,T)}var q=f((T,_,F)=>{if(!g(F,T)){let U="must be one of: "+i(o(F,O=>typeof O=="string"?`'${O}'`:d(O)),", ");throw new p(_,T,U)}});function me(T,_){if(typeof T!="boolean")throw new Z(_,"boolean",T)}function v(T,_,F){return T==null||!C(T,_)?F:T[_]}var $=f((T,_,F=null)=>{let U=v(F,"allowArray",!1),O=v(F,"allowFunction",!1);if(!v(F,"nullable",!1)&&T===null||!U&&n(T)||typeof T!="object"&&(!O||typeof T!="function"))throw new Z(_,"Object",T)}),Ce=f((T,_)=>{if(T!=null&&typeof T!="object"&&typeof T!="function")throw new Z(_,"a dictionary",T)}),Be=f((T,_,F=0)=>{if(!n(T))throw new Z(_,"Array",T);if(T.length<F){let U=`must be longer than ${F}`;throw new p(_,T,U)}});function Ie(T,_){Be(T,_);for(let F=0;F<T.length;F++)N(T[F],`${_}[${F}]`)}function K(T,_){Be(T,_);for(let F=0;F<T.length;F++)me(T[F],`${_}[${F}]`)}function w(T,_="signal"){if(N(T,_),J[T]===void 0)throw J[u(T)]!==void 0?new W(T+" (signals must use all capital letters)"):new W(T)}var ee=f((T,_="buffer")=>{if(!R(T))throw new Z(_,["Buffer","TypedArray","DataView"],T)});function be(T,_){let F=S(_),U=T.length;if(F==="hex"&&U%2!==0)throw new p("encoding",_,`is invalid for data of length ${U}`)}function ae(T,_="Port",F=!0){if(typeof T!="number"&&typeof T!="string"||typeof T=="string"&&h(T).length===0||+T!==+T>>>0||T>65535||T===0&&!F)throw new y(_,T,F);return T|0}var re=f((T,_)=>{if(T!==void 0&&(T===null||typeof T!="object"||!("aborted"in T)))throw new Z(_,"AbortSignal",T)}),ye=f((T,_)=>{if(typeof T!="function")throw new Z(_,"Function",T)}),pe=f((T,_)=>{if(typeof T!="function"||V(T))throw new Z(_,"Function",T)}),x=f((T,_)=>{if(T!==void 0)throw new Z(_,"undefined",T)});function z(T,_,F){if(!g(F,T))throw new Z(_,`('${i(F,"|")}')`,T)}var Q=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function ce(T,_){if(typeof T>"u"||!c(Q,T))throw new p(_,T,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function se(T){if(typeof T=="string")return ce(T,"hints"),T;if(n(T)){let _=T.length,F="";if(_===0)return F;for(let U=0;U<_;U++){let O=T[U];ce(O,"hints"),F+=O,U!==_-1&&(F+=", ")}return F}throw new p("hints",T,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}t.exports={isInt32:M,isUint32:P,parseFileMode:ne,validateArray:Be,validateStringArray:Ie,validateBooleanArray:K,validateBoolean:me,validateBuffer:ee,validateDictionary:Ce,validateEncoding:be,validateFunction:ye,validateInt32:ie,validateInteger:D,validateNumber:te,validateObject:$,validateOneOf:q,validatePlainFunction:pe,validatePort:ae,validateSignalName:w,validateString:N,validateUint32:ge,validateUndefined:x,validateUnion:z,validateAbortSignal:re,validateLinkHeaderValue:se}}),Lo=Ze((e,t)=>{he(),Ae(),ue();var n=t.exports={},g,i;function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?g=setTimeout:g=o}catch{g=o}try{typeof clearTimeout=="function"?i=clearTimeout:i=s}catch{i=s}})();function r(y){if(g===setTimeout)return setTimeout(y,0);if((g===o||!g)&&setTimeout)return g=setTimeout,setTimeout(y,0);try{return g(y,0)}catch{try{return g.call(null,y,0)}catch{return g.call(this,y,0)}}}function l(y){if(i===clearTimeout)return clearTimeout(y);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(y);try{return i(y)}catch{try{return i.call(null,y)}catch{return i.call(this,y)}}}var I=[],a=!1,C,c=-1;function d(){!a||!C||(a=!1,C.length?I=C.concat(I):c=-1,I.length&&u())}function u(){if(!a){var y=r(d);a=!0;for(var Z=I.length;Z;){for(C=I,I=[];++c<Z;)C&&C[c].run();c=-1,Z=I.length}C=null,a=!1,l(y)}}n.nextTick=function(y){var Z=new Array(arguments.length-1);if(arguments.length>1)for(var p=1;p<arguments.length;p++)Z[p-1]=arguments[p];I.push(new h(y,Z)),I.length===1&&!a&&r(u)};function h(y,Z){this.fun=y,this.array=Z}h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={};function f(){}n.on=f,n.addListener=f,n.once=f,n.off=f,n.removeListener=f,n.removeAllListeners=f,n.emit=f,n.prependListener=f,n.prependOnceListener=f,n.listeners=function(y){return[]},n.binding=function(y){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(y){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}),_g=Ze((e,t)=>{he(),Ae(),ue();var{Symbol:n,SymbolAsyncIterator:g,SymbolIterator:i,SymbolFor:o}=vt(),s=n("kDestroyed"),r=n("kIsErrored"),l=n("kIsReadable"),I=n("kIsDisturbed"),a=o("nodejs.webstream.isClosedPromise"),C=o("nodejs.webstream.controllerErrorFunction");function c(v,$=!1){var Ce;return!!(v&&typeof v.pipe=="function"&&typeof v.on=="function"&&(!$||typeof v.pause=="function"&&typeof v.resume=="function")&&(!v._writableState||((Ce=v._readableState)===null||Ce===void 0?void 0:Ce.readable)!==!1)&&(!v._writableState||v._readableState))}function d(v){var $;return!!(v&&typeof v.write=="function"&&typeof v.on=="function"&&(!v._readableState||(($=v._writableState)===null||$===void 0?void 0:$.writable)!==!1))}function u(v){return!!(v&&typeof v.pipe=="function"&&v._readableState&&typeof v.on=="function"&&typeof v.write=="function")}function h(v){return v&&(v._readableState||v._writableState||typeof v.write=="function"&&typeof v.on=="function"||typeof v.pipe=="function"&&typeof v.on=="function")}function f(v){return!!(v&&!h(v)&&typeof v.pipeThrough=="function"&&typeof v.getReader=="function"&&typeof v.cancel=="function")}function y(v){return!!(v&&!h(v)&&typeof v.getWriter=="function"&&typeof v.abort=="function")}function Z(v){return!!(v&&!h(v)&&typeof v.readable=="object"&&typeof v.writable=="object")}function p(v){return f(v)||y(v)||Z(v)}function B(v,$){return v==null?!1:$===!0?typeof v[g]=="function":$===!1?typeof v[i]=="function":typeof v[g]=="function"||typeof v[i]=="function"}function W(v){if(!h(v))return null;let $=v._writableState,Ce=v._readableState,Be=$||Ce;return!!(v.destroyed||v[s]||Be!=null&&Be.destroyed)}function S(v){if(!d(v))return null;if(v.writableEnded===!0)return!0;let $=v._writableState;return $!=null&&$.errored?!1:typeof($==null?void 0:$.ended)!="boolean"?null:$.ended}function V(v,$){if(!d(v))return null;if(v.writableFinished===!0)return!0;let Ce=v._writableState;return Ce!=null&&Ce.errored?!1:typeof(Ce==null?void 0:Ce.finished)!="boolean"?null:!!(Ce.finished||$===!1&&Ce.ended===!0&&Ce.length===0)}function R(v){if(!c(v))return null;if(v.readableEnded===!0)return!0;let $=v._readableState;return!$||$.errored?!1:typeof($==null?void 0:$.ended)!="boolean"?null:$.ended}function J(v,$){if(!c(v))return null;let Ce=v._readableState;return Ce!=null&&Ce.errored?!1:typeof(Ce==null?void 0:Ce.endEmitted)!="boolean"?null:!!(Ce.endEmitted||$===!1&&Ce.ended===!0&&Ce.length===0)}function M(v){return v&&v[l]!=null?v[l]:typeof(v==null?void 0:v.readable)!="boolean"?null:W(v)?!1:c(v)&&v.readable&&!J(v)}function P(v){return typeof(v==null?void 0:v.writable)!="boolean"?null:W(v)?!1:d(v)&&v.writable&&!S(v)}function X(v,$){return h(v)?W(v)?!0:!(($==null?void 0:$.readable)!==!1&&M(v)||($==null?void 0:$.writable)!==!1&&P(v)):null}function L(v){var $,Ce;return h(v)?v.writableErrored?v.writableErrored:($=(Ce=v._writableState)===null||Ce===void 0?void 0:Ce.errored)!==null&&$!==void 0?$:null:null}function ne(v){var $,Ce;return h(v)?v.readableErrored?v.readableErrored:($=(Ce=v._readableState)===null||Ce===void 0?void 0:Ce.errored)!==null&&$!==void 0?$:null:null}function D(v){if(!h(v))return null;if(typeof v.closed=="boolean")return v.closed;let $=v._writableState,Ce=v._readableState;return typeof($==null?void 0:$.closed)=="boolean"||typeof(Ce==null?void 0:Ce.closed)=="boolean"?($==null?void 0:$.closed)||(Ce==null?void 0:Ce.closed):typeof v._closed=="boolean"&&ie(v)?v._closed:null}function ie(v){return typeof v._closed=="boolean"&&typeof v._defaultKeepAlive=="boolean"&&typeof v._removedConnection=="boolean"&&typeof v._removedContLen=="boolean"}function ge(v){return typeof v._sent100=="boolean"&&ie(v)}function N(v){var $;return typeof v._consuming=="boolean"&&typeof v._dumped=="boolean"&&(($=v.req)===null||$===void 0?void 0:$.upgradeOrConnect)===void 0}function te(v){if(!h(v))return null;let $=v._writableState,Ce=v._readableState,Be=$||Ce;return!Be&&ge(v)||!!(Be&&Be.autoDestroy&&Be.emitClose&&Be.closed===!1)}function q(v){var $;return!!(v&&(($=v[I])!==null&&$!==void 0?$:v.readableDidRead||v.readableAborted))}function me(v){var $,Ce,Be,Ie,K,w,ee,be,ae,re;return!!(v&&(($=(Ce=(Be=(Ie=(K=(w=v[r])!==null&&w!==void 0?w:v.readableErrored)!==null&&K!==void 0?K:v.writableErrored)!==null&&Ie!==void 0?Ie:(ee=v._readableState)===null||ee===void 0?void 0:ee.errorEmitted)!==null&&Be!==void 0?Be:(be=v._writableState)===null||be===void 0?void 0:be.errorEmitted)!==null&&Ce!==void 0?Ce:(ae=v._readableState)===null||ae===void 0?void 0:ae.errored)!==null&&$!==void 0?$:!((re=v._writableState)===null||re===void 0)&&re.errored))}t.exports={kDestroyed:s,isDisturbed:q,kIsDisturbed:I,isErrored:me,kIsErrored:r,isReadable:M,kIsReadable:l,kIsClosedPromise:a,kControllerErrorFunction:C,isClosed:D,isDestroyed:W,isDuplexNodeStream:u,isFinished:X,isIterable:B,isReadableNodeStream:c,isReadableStream:f,isReadableEnded:R,isReadableFinished:J,isReadableErrored:ne,isNodeStream:h,isWebStream:p,isWritable:P,isWritableNodeStream:d,isWritableStream:y,isWritableEnded:S,isWritableFinished:V,isWritableErrored:L,isServerRequest:N,isServerResponse:ge,willEmitClose:te,isTransformStream:Z}}),Ti=Ze((e,t)=>{he(),Ae(),ue();var n=Lo(),{AbortError:g,codes:i}=fn(),{ERR_INVALID_ARG_TYPE:o,ERR_STREAM_PREMATURE_CLOSE:s}=i,{kEmptyObject:r,once:l}=zg(),{validateAbortSignal:I,validateFunction:a,validateObject:C,validateBoolean:c}=PC(),{Promise:d,PromisePrototypeThen:u}=vt(),{isClosed:h,isReadable:f,isReadableNodeStream:y,isReadableStream:Z,isReadableFinished:p,isReadableErrored:B,isWritable:W,isWritableNodeStream:S,isWritableStream:V,isWritableFinished:R,isWritableErrored:J,isNodeStream:M,willEmitClose:P,kIsClosedPromise:X}=_g();function L(N){return N.setHeader&&typeof N.abort=="function"}var ne=()=>{};function D(N,te,q){var me,v;if(arguments.length===2?(q=te,te=r):te==null?te=r:C(te,"options"),a(q,"callback"),I(te.signal,"options.signal"),q=l(q),Z(N)||V(N))return ie(N,te,q);if(!M(N))throw new o("stream",["ReadableStream","WritableStream","Stream"],N);let $=(me=te.readable)!==null&&me!==void 0?me:y(N),Ce=(v=te.writable)!==null&&v!==void 0?v:S(N),Be=N._writableState,Ie=N._readableState,K=()=>{N.writable||be()},w=P(N)&&y(N)===$&&S(N)===Ce,ee=R(N,!1),be=()=>{ee=!0,N.destroyed&&(w=!1),!(w&&(!N.readable||$))&&(!$||ae)&&q.call(N)},ae=p(N,!1),re=()=>{ae=!0,N.destroyed&&(w=!1),!(w&&(!N.writable||Ce))&&(!Ce||ee)&&q.call(N)},ye=se=>{q.call(N,se)},pe=h(N),x=()=>{pe=!0;let se=J(N)||B(N);if(se&&typeof se!="boolean")return q.call(N,se);if($&&!ae&&y(N,!0)&&!p(N,!1))return q.call(N,new s);if(Ce&&!ee&&!R(N,!1))return q.call(N,new s);q.call(N)},z=()=>{pe=!0;let se=J(N)||B(N);if(se&&typeof se!="boolean")return q.call(N,se);q.call(N)},Q=()=>{N.req.on("finish",be)};L(N)?(N.on("complete",be),w||N.on("abort",x),N.req?Q():N.on("request",Q)):Ce&&!Be&&(N.on("end",K),N.on("close",K)),!w&&typeof N.aborted=="boolean"&&N.on("aborted",x),N.on("end",re),N.on("finish",be),te.error!==!1&&N.on("error",ye),N.on("close",x),pe?n.nextTick(x):Be!=null&&Be.errorEmitted||Ie!=null&&Ie.errorEmitted?w||n.nextTick(z):(!$&&(!w||f(N))&&(ee||W(N)===!1)||!Ce&&(!w||W(N))&&(ae||f(N)===!1)||Ie&&N.req&&N.aborted)&&n.nextTick(z);let ce=()=>{q=ne,N.removeListener("aborted",x),N.removeListener("complete",be),N.removeListener("abort",x),N.removeListener("request",Q),N.req&&N.req.removeListener("finish",be),N.removeListener("end",K),N.removeListener("close",K),N.removeListener("finish",be),N.removeListener("end",re),N.removeListener("error",ye),N.removeListener("close",x)};if(te.signal&&!pe){let se=()=>{let T=q;ce(),T.call(N,new g(void 0,{cause:te.signal.reason}))};if(te.signal.aborted)n.nextTick(se);else{let T=q;q=l((..._)=>{te.signal.removeEventListener("abort",se),T.apply(N,_)}),te.signal.addEventListener("abort",se)}}return ce}function ie(N,te,q){let me=!1,v=ne;if(te.signal)if(v=()=>{me=!0,q.call(N,new g(void 0,{cause:te.signal.reason}))},te.signal.aborted)n.nextTick(v);else{let Ce=q;q=l((...Be)=>{te.signal.removeEventListener("abort",v),Ce.apply(N,Be)}),te.signal.addEventListener("abort",v)}let $=(...Ce)=>{me||n.nextTick(()=>q.apply(N,Ce))};return u(N[X].promise,$,$),ne}function ge(N,te){var q;let me=!1;return te===null&&(te=r),(q=te)!==null&&q!==void 0&&q.cleanup&&(c(te.cleanup,"cleanup"),me=te.cleanup),new d((v,$)=>{let Ce=D(N,te,Be=>{me&&Ce(),Be?$(Be):v()})})}t.exports=D,t.exports.finished=ge}),zs=Ze((e,t)=>{he(),Ae(),ue();var n=Lo(),{aggregateTwoErrors:g,codes:{ERR_MULTIPLE_CALLBACK:i},AbortError:o}=fn(),{Symbol:s}=vt(),{kDestroyed:r,isDestroyed:l,isFinished:I,isServerRequest:a}=_g(),C=s("kDestroy"),c=s("kConstruct");function d(X,L,ne){X&&(X.stack,L&&!L.errored&&(L.errored=X),ne&&!ne.errored&&(ne.errored=X))}function u(X,L){let ne=this._readableState,D=this._writableState,ie=D||ne;return D!=null&&D.destroyed||ne!=null&&ne.destroyed?(typeof L=="function"&&L(),this):(d(X,D,ne),D&&(D.destroyed=!0),ne&&(ne.destroyed=!0),ie.constructed?h(this,X,L):this.once(C,function(ge){h(this,g(ge,X),L)}),this)}function h(X,L,ne){let D=!1;function ie(ge){if(D)return;D=!0;let N=X._readableState,te=X._writableState;d(ge,te,N),te&&(te.closed=!0),N&&(N.closed=!0),typeof ne=="function"&&ne(ge),ge?n.nextTick(f,X,ge):n.nextTick(y,X)}try{X._destroy(L||null,ie)}catch(ge){ie(ge)}}function f(X,L){Z(X,L),y(X)}function y(X){let L=X._readableState,ne=X._writableState;ne&&(ne.closeEmitted=!0),L&&(L.closeEmitted=!0),(ne!=null&&ne.emitClose||L!=null&&L.emitClose)&&X.emit("close")}function Z(X,L){let ne=X._readableState,D=X._writableState;D!=null&&D.errorEmitted||ne!=null&&ne.errorEmitted||(D&&(D.errorEmitted=!0),ne&&(ne.errorEmitted=!0),X.emit("error",L))}function p(){let X=this._readableState,L=this._writableState;X&&(X.constructed=!0,X.closed=!1,X.closeEmitted=!1,X.destroyed=!1,X.errored=null,X.errorEmitted=!1,X.reading=!1,X.ended=X.readable===!1,X.endEmitted=X.readable===!1),L&&(L.constructed=!0,L.destroyed=!1,L.closed=!1,L.closeEmitted=!1,L.errored=null,L.errorEmitted=!1,L.finalCalled=!1,L.prefinished=!1,L.ended=L.writable===!1,L.ending=L.writable===!1,L.finished=L.writable===!1)}function B(X,L,ne){let D=X._readableState,ie=X._writableState;if(ie!=null&&ie.destroyed||D!=null&&D.destroyed)return this;D!=null&&D.autoDestroy||ie!=null&&ie.autoDestroy?X.destroy(L):L&&(L.stack,ie&&!ie.errored&&(ie.errored=L),D&&!D.errored&&(D.errored=L),ne?n.nextTick(Z,X,L):Z(X,L))}function W(X,L){if(typeof X._construct!="function")return;let ne=X._readableState,D=X._writableState;ne&&(ne.constructed=!1),D&&(D.constructed=!1),X.once(c,L),!(X.listenerCount(c)>1)&&n.nextTick(S,X)}function S(X){let L=!1;function ne(D){if(L){B(X,D??new i);return}L=!0;let ie=X._readableState,ge=X._writableState,N=ge||ie;ie&&(ie.constructed=!0),ge&&(ge.constructed=!0),N.destroyed?X.emit(C,D):D?B(X,D,!0):n.nextTick(V,X)}try{X._construct(D=>{n.nextTick(ne,D)})}catch(D){n.nextTick(ne,D)}}function V(X){X.emit(c)}function R(X){return(X==null?void 0:X.setHeader)&&typeof X.abort=="function"}function J(X){X.emit("close")}function M(X,L){X.emit("error",L),n.nextTick(J,X)}function P(X,L){!X||l(X)||(!L&&!I(X)&&(L=new o),a(X)?(X.socket=null,X.destroy(L)):R(X)?X.abort():R(X.req)?X.req.abort():typeof X.destroy=="function"?X.destroy(L):typeof X.close=="function"?X.close():L?n.nextTick(M,X,L):n.nextTick(J,X),X.destroyed||(X[r]=!0))}t.exports={construct:W,destroyer:P,destroy:u,undestroy:p,errorOrDestroy:B}});function Oe(){Oe.init.call(this)}function qI(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function YR(e){return e._maxListeners===void 0?Oe.defaultMaxListeners:e._maxListeners}function _Z(e,t,n,g){var i,o,s,r;if(qI(n),(o=e._events)===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),s===void 0)s=o[t]=n,++e._eventsCount;else if(typeof s=="function"?s=o[t]=g?[n,s]:[s,n]:g?s.unshift(n):s.push(n),(i=YR(e))>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,r=l,console&&console.warn&&console.warn(r)}return e}function ZM(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qZ(e,t,n){var g={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=ZM.bind(g);return i.listener=n,g.wrapFn=i,i}function $Z(e,t,n){var g=e._events;if(g===void 0)return[];var i=g[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?function(o){for(var s=new Array(o.length),r=0;r<s.length;++r)s[r]=o[r].listener||o[r];return s}(i):HR(i,i.length)}function ey(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}function HR(e,t){for(var n=new Array(t),g=0;g<t;++g)n[g]=e[g];return n}var ty,ny,ji,od,sd,rd,Gn,gy=Tt(()=>{he(),Ae(),ue(),ji=typeof Reflect=="object"?Reflect:null,od=ji&&typeof ji.apply=="function"?ji.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ny=ji&&typeof ji.ownKeys=="function"?ji.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},sd=Number.isNaN||function(e){return e!=e},ty=Oe,Oe.EventEmitter=Oe,Oe.prototype._events=void 0,Oe.prototype._eventsCount=0,Oe.prototype._maxListeners=void 0,rd=10,Object.defineProperty(Oe,"defaultMaxListeners",{enumerable:!0,get:function(){return rd},set:function(e){if(typeof e!="number"||e<0||sd(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");rd=e}}),Oe.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Oe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||sd(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},Oe.prototype.getMaxListeners=function(){return YR(this)},Oe.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var g=e==="error",i=this._events;if(i!==void 0)g=g&&i.error===void 0;else if(!g)return!1;if(g){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var r=i[e];if(r===void 0)return!1;if(typeof r=="function")od(r,this,t);else{var l=r.length,I=HR(r,l);for(n=0;n<l;++n)od(I[n],this,t)}return!0},Oe.prototype.addListener=function(e,t){return _Z(this,e,t,!1)},Oe.prototype.on=Oe.prototype.addListener,Oe.prototype.prependListener=function(e,t){return _Z(this,e,t,!0)},Oe.prototype.once=function(e,t){return qI(t),this.on(e,qZ(this,e,t)),this},Oe.prototype.prependOnceListener=function(e,t){return qI(t),this.prependListener(e,qZ(this,e,t)),this},Oe.prototype.removeListener=function(e,t){var n,g,i,o,s;if(qI(t),(g=this._events)===void 0)return this;if((n=g[e])===void 0)return this;if(n===t||n.listener===t)--this._eventsCount==0?this._events=Object.create(null):(delete g[e],g.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;i===0?n.shift():function(r,l){for(;l+1<r.length;l++)r[l]=r[l+1];r.pop()}(n,i),n.length===1&&(g[e]=n[0]),g.removeListener!==void 0&&this.emit("removeListener",e,s||t)}return this},Oe.prototype.off=Oe.prototype.removeListener,Oe.prototype.removeAllListeners=function(e){var t,n,g;if((n=this._events)===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var i,o=Object.keys(n);for(g=0;g<o.length;++g)(i=o[g])!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(t=n[e])=="function")this.removeListener(e,t);else if(t!==void 0)for(g=t.length-1;g>=0;g--)this.removeListener(e,t[g]);return this},Oe.prototype.listeners=function(e){return $Z(this,e,!0)},Oe.prototype.rawListeners=function(e){return $Z(this,e,!1)},Oe.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):ey.call(e,t)},Oe.prototype.listenerCount=ey,Oe.prototype.eventNames=function(){return this._eventsCount>0?ny(this._events):[]},Gn=ty,Gn.EventEmitter,Gn.defaultMaxListeners,Gn.init,Gn.listenerCount,Gn.EventEmitter,Gn.defaultMaxListeners,Gn.init,Gn.listenerCount}),Uo={};To(Uo,{EventEmitter:()=>NR,default:()=>Gn,defaultMaxListeners:()=>FR,init:()=>xR,listenerCount:()=>KR,on:()=>ER,once:()=>MR});var NR,FR,xR,KR,ER,MR,Ds=Tt(()=>{he(),Ae(),ue(),gy(),gy(),Gn.once=function(e,t){return new Promise((n,g)=>{function i(...s){o!==void 0&&e.removeListener("error",o),n(s)}let o;t!=="error"&&(o=s=>{e.removeListener(name,i),g(s)},e.once("error",o)),e.once(t,i)})},Gn.on=function(e,t){let n=[],g=[],i=null,o=!1,s={async next(){let I=n.shift();if(I)return createIterResult(I,!1);if(i){let a=Promise.reject(i);return i=null,a}return o?createIterResult(void 0,!0):new Promise((a,C)=>g.push({resolve:a,reject:C}))},async return(){e.removeListener(t,r),e.removeListener("error",l),o=!0;for(let I of g)I.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(I){i=I,e.removeListener(t,r),e.removeListener("error",l)},[Symbol.asyncIterator](){return this}};return e.on(t,r),e.on("error",l),s;function r(...I){let a=g.shift();a?a.resolve(createIterResult(I,!1)):n.push(I)}function l(I){o=!0;let a=g.shift();a?a.reject(I):i=I,s.return()}},{EventEmitter:NR,defaultMaxListeners:FR,init:xR,listenerCount:KR,on:ER,once:MR}=Gn}),Gb=Ze((e,t)=>{he(),Ae(),ue();var{ArrayIsArray:n,ObjectSetPrototypeOf:g}=vt(),{EventEmitter:i}=(Ds(),$e(Uo));function o(r){i.call(this,r)}g(o.prototype,i.prototype),g(o,i),o.prototype.pipe=function(r,l){let I=this;function a(y){r.writable&&r.write(y)===!1&&I.pause&&I.pause()}I.on("data",a);function C(){I.readable&&I.resume&&I.resume()}r.on("drain",C),!r._isStdio&&(!l||l.end!==!1)&&(I.on("end",d),I.on("close",u));let c=!1;function d(){c||(c=!0,r.end())}function u(){c||(c=!0,typeof r.destroy=="function"&&r.destroy())}function h(y){f(),i.listenerCount(this,"error")===0&&this.emit("error",y)}s(I,"error",h),s(r,"error",h);function f(){I.removeListener("data",a),r.removeListener("drain",C),I.removeListener("end",d),I.removeListener("close",u),I.removeListener("error",h),r.removeListener("error",h),I.removeListener("end",f),I.removeListener("close",f),r.removeListener("close",f)}return I.on("end",f),I.on("close",f),r.on("close",f),r.emit("pipe",I),r};function s(r,l,I){if(typeof r.prependListener=="function")return r.prependListener(l,I);!r._events||!r._events[l]?r.on(l,I):n(r._events[l])?r._events[l].unshift(I):r._events[l]=[I,r._events[l]]}t.exports={Stream:o,prependListener:s}}),OC=Ze((e,t)=>{he(),Ae(),ue();var{AbortError:n,codes:g}=fn(),{isNodeStream:i,isWebStream:o,kControllerErrorFunction:s}=_g(),r=Ti(),{ERR_INVALID_ARG_TYPE:l}=g,I=(a,C)=>{if(typeof a!="object"||!("aborted"in a))throw new l(C,"AbortSignal",a)};t.exports.addAbortSignal=function(a,C){if(I(a,"signal"),!i(C)&&!o(C))throw new l("stream",["ReadableStream","WritableStream","Stream"],C);return t.exports.addAbortSignalNoValidate(a,C)},t.exports.addAbortSignalNoValidate=function(a,C){if(typeof a!="object"||!("aborted"in a))return C;let c=i(C)?()=>{C.destroy(new n(void 0,{cause:a.reason}))}:()=>{C[s](new n(void 0,{cause:a.reason}))};return a.aborted?c():(a.addEventListener("abort",c),r(C,()=>a.removeEventListener("abort",c))),C}}),yM=Ze((e,t)=>{he(),Ae(),ue();var{StringPrototypeSlice:n,SymbolIterator:g,TypedArrayPrototypeSet:i,Uint8Array:o}=vt(),{Buffer:s}=(Ut(),$e(Lt)),{inspect:r}=zg();t.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(l){let I={data:l,next:null};this.length>0?this.tail.next=I:this.head=I,this.tail=I,++this.length}unshift(l){let I={data:l,next:this.head};this.length===0&&(this.tail=I),this.head=I,++this.length}shift(){if(this.length===0)return;let l=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,l}clear(){this.head=this.tail=null,this.length=0}join(l){if(this.length===0)return"";let I=this.head,a=""+I.data;for(;(I=I.next)!==null;)a+=l+I.data;return a}concat(l){if(this.length===0)return s.alloc(0);let I=s.allocUnsafe(l>>>0),a=this.head,C=0;for(;a;)i(I,a.data,C),C+=a.data.length,a=a.next;return I}consume(l,I){let a=this.head.data;if(l<a.length){let C=a.slice(0,l);return this.head.data=a.slice(l),C}return l===a.length?this.shift():I?this._getString(l):this._getBuffer(l)}first(){return this.head.data}*[g](){for(let l=this.head;l;l=l.next)yield l.data}_getString(l){let I="",a=this.head,C=0;do{let c=a.data;if(l>c.length)I+=c,l-=c.length;else{l===c.length?(I+=c,++C,a.next?this.head=a.next:this.head=this.tail=null):(I+=n(c,0,l),this.head=a,a.data=n(c,l));break}++C}while((a=a.next)!==null);return this.length-=C,I}_getBuffer(l){let I=s.allocUnsafe(l),a=l,C=this.head,c=0;do{let d=C.data;if(l>d.length)i(I,d,a-l),l-=d.length;else{l===d.length?(i(I,d,a-l),++c,C.next?this.head=C.next:this.head=this.tail=null):(i(I,new o(d.buffer,d.byteOffset,l),a-l),this.head=C,C.data=d.slice(l));break}++c}while((C=C.next)!==null);return this.length-=c,I}[Symbol.for("nodejs.util.inspect.custom")](l,I){return r(this,{...I,depth:0,customInspect:!1})}}}),Bb=Ze((e,t)=>{he(),Ae(),ue();var{MathFloor:n,NumberIsInteger:g}=vt(),{ERR_INVALID_ARG_VALUE:i}=fn().codes;function o(l,I,a){return l.highWaterMark!=null?l.highWaterMark:I?l[a]:null}function s(l){return l?16:16*1024}function r(l,I,a,C){let c=o(I,C,a);if(c!=null){if(!g(c)||c<0){let d=C?`options.${a}`:"options.highWaterMark";throw new i(d,c)}return n(c)}return s(l.objectMode)}t.exports={getHighWaterMark:r,getDefaultHighWaterMark:s}});function iy(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return n===-1&&(n=t),[n,n===t?0:4-n%4]}function GM(e,t,n){for(var g,i,o=[],s=t;s<n;s+=3)g=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(_n[(i=g)>>18&63]+_n[i>>12&63]+_n[i>>6&63]+_n[63&i]);return o.join("")}function Yg(e){if(e>2147483647)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,fe.prototype),t}function fe(e,t,n){if(typeof e=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return $A(e)}return TR(e,t,n)}function TR(e,t,n){if(typeof e=="string")return function(o,s){if(typeof s=="string"&&s!==""||(s="utf8"),!fe.isEncoding(s))throw new TypeError("Unknown encoding: "+s);var r=0|UR(o,s),l=Yg(r),I=l.write(o,s);return I!==r&&(l=l.slice(0,I)),l}(e,t);if(ArrayBuffer.isView(e))return ld(e);if(e==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Hg(e,ArrayBuffer)||e&&Hg(e.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Hg(e,SharedArrayBuffer)||e&&Hg(e.buffer,SharedArrayBuffer)))return BM(e,t,n);if(typeof e=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var g=e.valueOf&&e.valueOf();if(g!=null&&g!==e)return fe.from(g,t,n);var i=function(o){if(fe.isBuffer(o)){var s=0|Sb(o.length),r=Yg(s);return r.length===0||o.copy(r,0,0,s),r}if(o.length!==void 0)return typeof o.length!="number"||Vb(o.length)?Yg(0):ld(o);if(o.type==="Buffer"&&Array.isArray(o.data))return ld(o.data)}(e);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof e[Symbol.toPrimitive]=="function")return fe.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function LR(e){if(typeof e!="number")throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function $A(e){return LR(e),Yg(e<0?0:0|Sb(e))}function ld(e){for(var t=e.length<0?0:0|Sb(e.length),n=Yg(t),g=0;g<t;g+=1)n[g]=255&e[g];return n}function BM(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var g;return g=t===void 0&&n===void 0?new Uint8Array(e):n===void 0?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(g,fe.prototype),g}function Sb(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function UR(e,t){if(fe.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Hg(e,ArrayBuffer))return e.byteLength;if(typeof e!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,g=arguments.length>2&&arguments[2]===!0;if(!g&&n===0)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return eh(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return jR(e).length;default:if(i)return g?-1:eh(e).length;t=(""+t).toLowerCase(),i=!0}}function SM(e,t,n){var g=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((n===void 0||n>this.length)&&(n=this.length),n<=0)||(n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return YM(this,t,n);case"utf8":case"utf-8":return DR(this,t,n);case"ascii":return wM(this,t,n);case"latin1":case"binary":return JM(this,t,n);case"base64":return XM(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return HM(this,t,n);default:if(g)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),g=!0}}function Pi(e,t,n){var g=e[t];e[t]=e[n],e[n]=g}function oy(e,t,n,g,i){if(e.length===0)return-1;if(typeof n=="string"?(g=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Vb(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if(typeof t=="string"&&(t=fe.from(t,g)),fe.isBuffer(t))return t.length===0?-1:sy(e,t,n,g,i);if(typeof t=="number")return t&=255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):sy(e,[t],n,g,i);throw new TypeError("val must be string, number or Buffer")}function sy(e,t,n,g,i){var o,s=1,r=e.length,l=t.length;if(g!==void 0&&((g=String(g).toLowerCase())==="ucs2"||g==="ucs-2"||g==="utf16le"||g==="utf-16le")){if(e.length<2||t.length<2)return-1;s=2,r/=2,l/=2,n/=2}function I(d,u){return s===1?d[u]:d.readUInt16BE(u*s)}if(i){var a=-1;for(o=n;o<r;o++)if(I(e,o)===I(t,a===-1?0:o-a)){if(a===-1&&(a=o),o-a+1===l)return a*s}else a!==-1&&(o-=o-a),a=-1}else for(n+l>r&&(n=r-l),o=n;o>=0;o--){for(var C=!0,c=0;c<l;c++)if(I(e,o+c)!==I(t,c)){C=!1;break}if(C)return o}return-1}function VM(e,t,n,g){n=Number(n)||0;var i=e.length-n;g?(g=Number(g))>i&&(g=i):g=i;var o=t.length;g>o/2&&(g=o/2);for(var s=0;s<g;++s){var r=parseInt(t.substr(2*s,2),16);if(Vb(r))return s;e[n+s]=r}return s}function WM(e,t,n,g){return _C(eh(t,e.length-n),e,n,g)}function zR(e,t,n,g){return _C(function(i){for(var o=[],s=0;s<i.length;++s)o.push(255&i.charCodeAt(s));return o}(t),e,n,g)}function RM(e,t,n,g){return zR(e,t,n,g)}function vM(e,t,n,g){return _C(jR(t),e,n,g)}function kM(e,t,n,g){return _C(function(i,o){for(var s,r,l,I=[],a=0;a<i.length&&!((o-=2)<0);++a)s=i.charCodeAt(a),r=s>>8,l=s%256,I.push(l),I.push(r);return I}(t,e.length-n),e,n,g)}function XM(e,t,n){return t===0&&n===e.length?$a.fromByteArray(e):$a.fromByteArray(e.slice(t,n))}function DR(e,t,n){n=Math.min(e.length,n);for(var g=[],i=t;i<n;){var o,s,r,l,I=e[i],a=null,C=I>239?4:I>223?3:I>191?2:1;if(i+C<=n)switch(C){case 1:I<128&&(a=I);break;case 2:(192&(o=e[i+1]))==128&&(l=(31&I)<<6|63&o)>127&&(a=l);break;case 3:o=e[i+1],s=e[i+2],(192&o)==128&&(192&s)==128&&(l=(15&I)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(a=l);break;case 4:o=e[i+1],s=e[i+2],r=e[i+3],(192&o)==128&&(192&s)==128&&(192&r)==128&&(l=(15&I)<<18|(63&o)<<12|(63&s)<<6|63&r)>65535&&l<1114112&&(a=l)}a===null?(a=65533,C=1):a>65535&&(a-=65536,g.push(a>>>10&1023|55296),a=56320|1023&a),g.push(a),i+=C}return function(c){var d=c.length;if(d<=4096)return String.fromCharCode.apply(String,c);for(var u="",h=0;h<d;)u+=String.fromCharCode.apply(String,c.slice(h,h+=4096));return u}(g)}function wM(e,t,n){var g="";n=Math.min(e.length,n);for(var i=t;i<n;++i)g+=String.fromCharCode(127&e[i]);return g}function JM(e,t,n){var g="";n=Math.min(e.length,n);for(var i=t;i<n;++i)g+=String.fromCharCode(e[i]);return g}function YM(e,t,n){var g=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>g)&&(n=g);for(var i="",o=t;o<n;++o)i+=OR[e[o]];return i}function HM(e,t,n){for(var g=e.slice(t,n),i="",o=0;o<g.length;o+=2)i+=String.fromCharCode(g[o]+256*g[o+1]);return i}function wt(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function Cn(e,t,n,g,i,o){if(!fe.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+g>e.length)throw new RangeError("Index out of range")}function QR(e,t,n,g,i,o){if(n+g>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function ry(e,t,n,g,i){return t=+t,n>>>=0,i||QR(e,0,n,4),so.write(e,t,n,g,23,4),n+4}function ly(e,t,n,g,i){return t=+t,n>>>=0,i||QR(e,0,n,8),so.write(e,t,n,g,52,8),n+8}function eh(e,t){var n;t=t||1/0;for(var g=e.length,i=null,o=[],s=0;s<g;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===g){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function jR(e){return $a.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(PR,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(e))}function _C(e,t,n,g){for(var i=0;i<g&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Hg(e,t){return e instanceof t||e!=null&&e.constructor!=null&&e.constructor.name!=null&&e.constructor.name===t.name}function Vb(e){return e!=e}function Iy(e,t){for(var n in e)t[n]=e[n]}function Oi(e,t,n){return Qn(e,t,n)}function Ir(e){var t;switch(this.encoding=function(n){var g=function(i){if(!i)return"utf8";for(var o;;)switch(i){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return i;default:if(o)return;i=(""+i).toLowerCase(),o=!0}}(n);if(typeof g!="string"&&(eC.isEncoding===th||!th(n)))throw new Error("Unknown encoding: "+n);return g||n}(e),this.encoding){case"utf16le":this.text=FM,this.end=xM,t=4;break;case"utf8":this.fillLast=NM,t=4;break;case"base64":this.text=KM,this.end=EM,t=3;break;default:return this.write=MM,this.end=TM,void 0}this.lastNeed=0,this.lastTotal=0,this.lastChar=eC.allocUnsafe(t)}function Id(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function NM(e){var t=this.lastTotal-this.lastNeed,n=function(g,i,o){if((192&i[0])!=128)return g.lastNeed=0,"";if(g.lastNeed>1&&i.length>1){if((192&i[1])!=128)return g.lastNeed=1,"";if(g.lastNeed>2&&i.length>2&&(192&i[2])!=128)return g.lastNeed=2,""}}(this,e);return n!==void 0?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length,void 0)}function FM(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var g=n.charCodeAt(n.length-1);if(g>=55296&&g<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function xM(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function KM(e,t){var n=(e.length-t)%3;return n===0?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,n===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function EM(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function MM(e){return e.toString(this.encoding)}function TM(e){return e&&e.length?this.write(e):""}var ay,_n,Zn,Cy,yI,_i,cy,dy,og,$a,so,ad,PR,OR,ar,Cr,Qn,uy,hs,eC,th,Ay=Tt(()=>{for(he(),Ae(),ue(),ay={byteLength:function(e){var t=iy(e),n=t[0],g=t[1];return 3*(n+g)/4-g},toByteArray:function(e){var t,n,g=iy(e),i=g[0],o=g[1],s=new Cy(function(I,a,C){return 3*(a+C)/4-C}(0,i,o)),r=0,l=o>0?i-4:i;for(n=0;n<l;n+=4)t=Zn[e.charCodeAt(n)]<<18|Zn[e.charCodeAt(n+1)]<<12|Zn[e.charCodeAt(n+2)]<<6|Zn[e.charCodeAt(n+3)],s[r++]=t>>16&255,s[r++]=t>>8&255,s[r++]=255&t;return o===2&&(t=Zn[e.charCodeAt(n)]<<2|Zn[e.charCodeAt(n+1)]>>4,s[r++]=255&t),o===1&&(t=Zn[e.charCodeAt(n)]<<10|Zn[e.charCodeAt(n+1)]<<4|Zn[e.charCodeAt(n+2)]>>2,s[r++]=t>>8&255,s[r++]=255&t),s},fromByteArray:function(e){for(var t,n=e.length,g=n%3,i=[],o=0,s=n-g;o<s;o+=16383)i.push(GM(e,o,o+16383>s?s:o+16383));return g===1?(t=e[n-1],i.push(_n[t>>2]+_n[t<<4&63]+"==")):g===2&&(t=(e[n-2]<<8)+e[n-1],i.push(_n[t>>10]+_n[t>>4&63]+_n[t<<2&63]+"=")),i.join("")}},_n=[],Zn=[],Cy=typeof Uint8Array<"u"?Uint8Array:Array,yI="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_i=0,cy=yI.length;_i<cy;++_i)_n[_i]=yI[_i],Zn[yI.charCodeAt(_i)]=_i;Zn[45]=62,Zn[95]=63,dy={read:function(e,t,n,g,i){var o,s,r=8*i-g-1,l=(1<<r)-1,I=l>>1,a=-7,C=n?i-1:0,c=n?-1:1,d=e[t+C];for(C+=c,o=d&(1<<-a)-1,d>>=-a,a+=r;a>0;o=256*o+e[t+C],C+=c,a-=8);for(s=o&(1<<-a)-1,o>>=-a,a+=g;a>0;s=256*s+e[t+C],C+=c,a-=8);if(o===0)o=1-I;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,g),o-=I}return(d?-1:1)*s*Math.pow(2,o-g)},write:function(e,t,n,g,i,o){var s,r,l,I=8*o-i-1,a=(1<<I)-1,C=a>>1,c=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=g?0:o-1,u=g?1:-1,h=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(r=isNaN(t)?1:0,s=a):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+C>=1?c/l:c*Math.pow(2,1-C))*l>=2&&(s++,l/=2),s+C>=a?(r=0,s=a):s+C>=1?(r=(t*l-1)*Math.pow(2,i),s+=C):(r=t*Math.pow(2,C-1)*Math.pow(2,i),s=0));i>=8;e[n+d]=255&r,d+=u,r/=256,i-=8);for(s=s<<i|r,I+=i;I>0;e[n+d]=255&s,d+=u,s/=256,I-=8);e[n+d-u]|=128*h}},og={},$a=ay,so=dy,ad=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null,og.Buffer=fe,og.SlowBuffer=function(e){return+e!=e&&(e=0),fe.alloc(+e)},og.INSPECT_MAX_BYTES=50,og.kMaxLength=2147483647,fe.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),e.foo()===42}catch{return!1}}(),fe.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(fe.prototype,"parent",{enumerable:!0,get:function(){if(fe.isBuffer(this))return this.buffer}}),Object.defineProperty(fe.prototype,"offset",{enumerable:!0,get:function(){if(fe.isBuffer(this))return this.byteOffset}}),fe.poolSize=8192,fe.from=function(e,t,n){return TR(e,t,n)},Object.setPrototypeOf(fe.prototype,Uint8Array.prototype),Object.setPrototypeOf(fe,Uint8Array),fe.alloc=function(e,t,n){return function(g,i,o){return LR(g),g<=0?Yg(g):i!==void 0?typeof o=="string"?Yg(g).fill(i,o):Yg(g).fill(i):Yg(g)}(e,t,n)},fe.allocUnsafe=function(e){return $A(e)},fe.allocUnsafeSlow=function(e){return $A(e)},fe.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==fe.prototype},fe.compare=function(e,t){if(Hg(e,Uint8Array)&&(e=fe.from(e,e.offset,e.byteLength)),Hg(t,Uint8Array)&&(t=fe.from(t,t.offset,t.byteLength)),!fe.isBuffer(e)||!fe.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,g=t.length,i=0,o=Math.min(n,g);i<o;++i)if(e[i]!==t[i]){n=e[i],g=t[i];break}return n<g?-1:g<n?1:0},fe.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},fe.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return fe.alloc(0);var n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var g=fe.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(Hg(o,Uint8Array)&&(o=fe.from(o)),!fe.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(g,i),i+=o.length}return g},fe.byteLength=UR,fe.prototype._isBuffer=!0,fe.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Pi(this,t,t+1);return this},fe.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Pi(this,t,t+3),Pi(this,t+1,t+2);return this},fe.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Pi(this,t,t+7),Pi(this,t+1,t+6),Pi(this,t+2,t+5),Pi(this,t+3,t+4);return this},fe.prototype.toString=function(){var e=this.length;return e===0?"":arguments.length===0?DR(this,0,e):SM.apply(this,arguments)},fe.prototype.toLocaleString=fe.prototype.toString,fe.prototype.equals=function(e){if(!fe.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||fe.compare(this,e)===0},fe.prototype.inspect=function(){var e="",t=og.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},ad&&(fe.prototype[ad]=fe.prototype.inspect),fe.prototype.compare=function(e,t,n,g,i){if(Hg(e,Uint8Array)&&(e=fe.from(e,e.offset,e.byteLength)),!fe.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),g===void 0&&(g=0),i===void 0&&(i=this.length),t<0||n>e.length||g<0||i>this.length)throw new RangeError("out of range index");if(g>=i&&t>=n)return 0;if(g>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(g>>>=0),s=(n>>>=0)-(t>>>=0),r=Math.min(o,s),l=this.slice(g,i),I=e.slice(t,n),a=0;a<r;++a)if(l[a]!==I[a]){o=l[a],s=I[a];break}return o<s?-1:s<o?1:0},fe.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},fe.prototype.indexOf=function(e,t,n){return oy(this,e,t,n,!0)},fe.prototype.lastIndexOf=function(e,t,n){return oy(this,e,t,n,!1)},fe.prototype.write=function(e,t,n,g){if(t===void 0)g="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")g=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,g===void 0&&(g="utf8")):(g=n,n=void 0)}var i=this.length-t;if((n===void 0||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");g||(g="utf8");for(var o=!1;;)switch(g){case"hex":return VM(this,e,t,n);case"utf8":case"utf-8":return WM(this,e,t,n);case"ascii":return zR(this,e,t,n);case"latin1":case"binary":return RM(this,e,t,n);case"base64":return vM(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return kM(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+g);g=(""+g).toLowerCase(),o=!0}},fe.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},fe.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=t===void 0?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var g=this.subarray(e,t);return Object.setPrototypeOf(g,fe.prototype),g},fe.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||wt(e,t,this.length);for(var g=this[e],i=1,o=0;++o<t&&(i*=256);)g+=this[e+o]*i;return g},fe.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||wt(e,t,this.length);for(var g=this[e+--t],i=1;t>0&&(i*=256);)g+=this[e+--t]*i;return g},fe.prototype.readUInt8=function(e,t){return e>>>=0,t||wt(e,1,this.length),this[e]},fe.prototype.readUInt16LE=function(e,t){return e>>>=0,t||wt(e,2,this.length),this[e]|this[e+1]<<8},fe.prototype.readUInt16BE=function(e,t){return e>>>=0,t||wt(e,2,this.length),this[e]<<8|this[e+1]},fe.prototype.readUInt32LE=function(e,t){return e>>>=0,t||wt(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},fe.prototype.readUInt32BE=function(e,t){return e>>>=0,t||wt(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},fe.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||wt(e,t,this.length);for(var g=this[e],i=1,o=0;++o<t&&(i*=256);)g+=this[e+o]*i;return g>=(i*=128)&&(g-=Math.pow(2,8*t)),g},fe.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||wt(e,t,this.length);for(var g=t,i=1,o=this[e+--g];g>0&&(i*=256);)o+=this[e+--g]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},fe.prototype.readInt8=function(e,t){return e>>>=0,t||wt(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},fe.prototype.readInt16LE=function(e,t){e>>>=0,t||wt(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},fe.prototype.readInt16BE=function(e,t){e>>>=0,t||wt(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},fe.prototype.readInt32LE=function(e,t){return e>>>=0,t||wt(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},fe.prototype.readInt32BE=function(e,t){return e>>>=0,t||wt(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},fe.prototype.readFloatLE=function(e,t){return e>>>=0,t||wt(e,4,this.length),so.read(this,e,!0,23,4)},fe.prototype.readFloatBE=function(e,t){return e>>>=0,t||wt(e,4,this.length),so.read(this,e,!1,23,4)},fe.prototype.readDoubleLE=function(e,t){return e>>>=0,t||wt(e,8,this.length),so.read(this,e,!0,52,8)},fe.prototype.readDoubleBE=function(e,t){return e>>>=0,t||wt(e,8,this.length),so.read(this,e,!1,52,8)},fe.prototype.writeUIntLE=function(e,t,n,g){e=+e,t>>>=0,n>>>=0,g||Cn(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},fe.prototype.writeUIntBE=function(e,t,n,g){e=+e,t>>>=0,n>>>=0,g||Cn(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},fe.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,1,255,0),this[t]=255&e,t+1},fe.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},fe.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},fe.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},fe.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},fe.prototype.writeIntLE=function(e,t,n,g){if(e=+e,t>>>=0,!g){var i=Math.pow(2,8*n-1);Cn(this,e,t,n,i-1,-i)}var o=0,s=1,r=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&r===0&&this[t+o-1]!==0&&(r=1),this[t+o]=(e/s>>0)-r&255;return t+n},fe.prototype.writeIntBE=function(e,t,n,g){if(e=+e,t>>>=0,!g){var i=Math.pow(2,8*n-1);Cn(this,e,t,n,i-1,-i)}var o=n-1,s=1,r=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&r===0&&this[t+o+1]!==0&&(r=1),this[t+o]=(e/s>>0)-r&255;return t+n},fe.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},fe.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},fe.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},fe.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},fe.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||Cn(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},fe.prototype.writeFloatLE=function(e,t,n){return ry(this,e,t,!0,n)},fe.prototype.writeFloatBE=function(e,t,n){return ry(this,e,t,!1,n)},fe.prototype.writeDoubleLE=function(e,t,n){return ly(this,e,t,!0,n)},fe.prototype.writeDoubleBE=function(e,t,n){return ly(this,e,t,!1,n)},fe.prototype.copy=function(e,t,n,g){if(!fe.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),g||g===0||(g=this.length),t>=e.length&&(t=e.length),t||(t=0),g>0&&g<n&&(g=n),g===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("sourceEnd out of bounds");g>this.length&&(g=this.length),e.length-t<g-n&&(g=e.length-t+n);var i=g-n;if(this===e&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(t,n,g);else if(this===e&&n<t&&t<g)for(var o=i-1;o>=0;--o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,g),t);return i},fe.prototype.fill=function(e,t,n,g){if(typeof e=="string"){if(typeof t=="string"?(g=t,t=0,n=this.length):typeof n=="string"&&(g=n,n=this.length),g!==void 0&&typeof g!="string")throw new TypeError("encoding must be a string");if(typeof g=="string"&&!fe.isEncoding(g))throw new TypeError("Unknown encoding: "+g);if(e.length===1){var i=e.charCodeAt(0);(g==="utf8"&&i<128||g==="latin1")&&(e=i)}}else typeof e=="number"?e&=255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=n===void 0?this.length:n>>>0,e||(e=0),typeof e=="number")for(o=t;o<n;++o)this[o]=e;else{var s=fe.isBuffer(e)?e:fe.from(e,g),r=s.length;if(r===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%r]}return this},PR=/[^+/0-9A-Za-z-_]/g,OR=function(){for(var e=new Array(256),t=0;t<16;++t)for(var n=16*t,g=0;g<16;++g)e[n+g]="0123456789abcdef"[t]+"0123456789abcdef"[g];return e}(),og.Buffer,og.INSPECT_MAX_BYTES,og.kMaxLength,ar={},Cr=og,Qn=Cr.Buffer,Qn.from&&Qn.alloc&&Qn.allocUnsafe&&Qn.allocUnsafeSlow?ar=Cr:(Iy(Cr,ar),ar.Buffer=Oi),Oi.prototype=Object.create(Qn.prototype),Iy(Qn,Oi),Oi.from=function(e,t,n){if(typeof e=="number")throw new TypeError("Argument must not be a number");return Qn(e,t,n)},Oi.alloc=function(e,t,n){if(typeof e!="number")throw new TypeError("Argument must be a number");var g=Qn(e);return t!==void 0?typeof n=="string"?g.fill(t,n):g.fill(t):g.fill(0),g},Oi.allocUnsafe=function(e){if(typeof e!="number")throw new TypeError("Argument must be a number");return Qn(e)},Oi.allocUnsafeSlow=function(e){if(typeof e!="number")throw new TypeError("Argument must be a number");return Cr.SlowBuffer(e)},uy=ar,hs={},eC=uy.Buffer,th=eC.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},hs.StringDecoder=Ir,Ir.prototype.write=function(e){if(e.length===0)return"";var t,n;if(this.lastNeed){if((t=this.fillLast(e))===void 0)return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},Ir.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},Ir.prototype.text=function(e,t){var n=function(i,o,s){var r=o.length-1;if(r<s)return 0;var l=Id(o[r]);return l>=0?(l>0&&(i.lastNeed=l-1),l):--r<s||l===-2?0:(l=Id(o[r]))>=0?(l>0&&(i.lastNeed=l-2),l):--r<s||l===-2?0:(l=Id(o[r]))>=0?(l>0&&(l===2?l=0:i.lastNeed=l-3),l):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var g=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,g),e.toString("utf8",t,g)},Ir.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length},hs.StringDecoder,hs.StringDecoder}),_R={};To(_R,{StringDecoder:()=>qR,default:()=>hs});var qR,LM=Tt(()=>{he(),Ae(),ue(),Ay(),Ay(),qR=hs.StringDecoder}),$R=Ze((e,t)=>{he(),Ae(),ue();var n=Lo(),{PromisePrototypeThen:g,SymbolAsyncIterator:i,SymbolIterator:o}=vt(),{Buffer:s}=(Ut(),$e(Lt)),{ERR_INVALID_ARG_TYPE:r,ERR_STREAM_NULL_VALUES:l}=fn().codes;function I(a,C,c){let d;if(typeof C=="string"||C instanceof s)return new a({objectMode:!0,...c,read(){this.push(C),this.push(null)}});let u;if(C&&C[i])u=!0,d=C[i]();else if(C&&C[o])u=!1,d=C[o]();else throw new r("iterable",["Iterable"],C);let h=new a({objectMode:!0,highWaterMark:1,...c}),f=!1;h._read=function(){f||(f=!0,Z())},h._destroy=function(p,B){g(y(p),()=>n.nextTick(B,p),W=>n.nextTick(B,W||p))};async function y(p){let B=p!=null,W=typeof d.throw=="function";if(B&&W){let{value:S,done:V}=await d.throw(p);if(await S,V)return}if(typeof d.return=="function"){let{value:S}=await d.return();await S}}async function Z(){for(;;){try{let{value:p,done:B}=u?await d.next():d.next();if(B)h.push(null);else{let W=p&&typeof p.then=="function"?await p:p;if(W===null)throw f=!1,new l;if(h.push(W))continue;f=!1}}catch(p){h.destroy(p)}break}}return h}t.exports=I}),qC=Ze((e,t)=>{he(),Ae(),ue();var n=Lo(),{ArrayPrototypeIndexOf:g,NumberIsInteger:i,NumberIsNaN:o,NumberParseInt:s,ObjectDefineProperties:r,ObjectKeys:l,ObjectSetPrototypeOf:I,Promise:a,SafeSet:C,SymbolAsyncIterator:c,Symbol:d}=vt();t.exports=v,v.ReadableState=me;var{EventEmitter:u}=(Ds(),$e(Uo)),{Stream:h,prependListener:f}=Gb(),{Buffer:y}=(Ut(),$e(Lt)),{addAbortSignal:Z}=OC(),p=Ti(),B=zg().debuglog("stream",A=>{B=A}),W=yM(),S=zs(),{getHighWaterMark:V,getDefaultHighWaterMark:R}=Bb(),{aggregateTwoErrors:J,codes:{ERR_INVALID_ARG_TYPE:M,ERR_METHOD_NOT_IMPLEMENTED:P,ERR_OUT_OF_RANGE:X,ERR_STREAM_PUSH_AFTER_EOF:L,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:ne}}=fn(),{validateObject:D}=PC(),ie=d("kPaused"),{StringDecoder:ge}=(LM(),$e(_R)),N=$R();I(v.prototype,h.prototype),I(v,h);var te=()=>{},{errorOrDestroy:q}=S;function me(A,b,k){typeof k!="boolean"&&(k=b instanceof Dg()),this.objectMode=!!(A&&A.objectMode),k&&(this.objectMode=this.objectMode||!!(A&&A.readableObjectMode)),this.highWaterMark=A?V(this,A,"readableHighWaterMark",k):R(!1),this.buffer=new W,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[ie]=null,this.errorEmitted=!1,this.emitClose=!A||A.emitClose!==!1,this.autoDestroy=!A||A.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=A&&A.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,A&&A.encoding&&(this.decoder=new ge(A.encoding),this.encoding=A.encoding)}function v(A){if(!(this instanceof v))return new v(A);let b=this instanceof Dg();this._readableState=new me(A,this,b),A&&(typeof A.read=="function"&&(this._read=A.read),typeof A.destroy=="function"&&(this._destroy=A.destroy),typeof A.construct=="function"&&(this._construct=A.construct),A.signal&&!b&&Z(A.signal,this)),h.call(this,A),S.construct(this,()=>{this._readableState.needReadable&&ae(this,this._readableState)})}v.prototype.destroy=S.destroy,v.prototype._undestroy=S.undestroy,v.prototype._destroy=function(A,b){b(A)},v.prototype[u.captureRejectionSymbol]=function(A){this.destroy(A)},v.prototype.push=function(A,b){return $(this,A,b,!1)},v.prototype.unshift=function(A,b){return $(this,A,b,!0)};function $(A,b,k,Y){B("readableAddChunk",b);let j=A._readableState,le;if(j.objectMode||(typeof b=="string"?(k=k||j.defaultEncoding,j.encoding!==k&&(Y&&j.encoding?b=y.from(b,k).toString(j.encoding):(b=y.from(b,k),k=""))):b instanceof y?k="":h._isUint8Array(b)?(b=h._uint8ArrayToBuffer(b),k=""):b!=null&&(le=new M("chunk",["string","Buffer","Uint8Array"],b))),le)q(A,le);else if(b===null)j.reading=!1,w(A,j);else if(j.objectMode||b&&b.length>0)if(Y)if(j.endEmitted)q(A,new ne);else{if(j.destroyed||j.errored)return!1;Ce(A,j,b,!0)}else if(j.ended)q(A,new L);else{if(j.destroyed||j.errored)return!1;j.reading=!1,j.decoder&&!k?(b=j.decoder.write(b),j.objectMode||b.length!==0?Ce(A,j,b,!1):ae(A,j)):Ce(A,j,b,!1)}else Y||(j.reading=!1,ae(A,j));return!j.ended&&(j.length<j.highWaterMark||j.length===0)}function Ce(A,b,k,Y){b.flowing&&b.length===0&&!b.sync&&A.listenerCount("data")>0?(b.multiAwaitDrain?b.awaitDrainWriters.clear():b.awaitDrainWriters=null,b.dataEmitted=!0,A.emit("data",k)):(b.length+=b.objectMode?1:k.length,Y?b.buffer.unshift(k):b.buffer.push(k),b.needReadable&&ee(A)),ae(A,b)}v.prototype.isPaused=function(){let A=this._readableState;return A[ie]===!0||A.flowing===!1},v.prototype.setEncoding=function(A){let b=new ge(A);this._readableState.decoder=b,this._readableState.encoding=this._readableState.decoder.encoding;let k=this._readableState.buffer,Y="";for(let j of k)Y+=b.write(j);return k.clear(),Y!==""&&k.push(Y),this._readableState.length=Y.length,this};var Be=1073741824;function Ie(A){if(A>Be)throw new X("size","<= 1GiB",A);return A--,A|=A>>>1,A|=A>>>2,A|=A>>>4,A|=A>>>8,A|=A>>>16,A++,A}function K(A,b){return A<=0||b.length===0&&b.ended?0:b.objectMode?1:o(A)?b.flowing&&b.length?b.buffer.first().length:b.length:A<=b.length?A:b.ended?b.length:0}v.prototype.read=function(A){B("read",A),A===void 0?A=NaN:i(A)||(A=s(A,10));let b=this._readableState,k=A;if(A>b.highWaterMark&&(b.highWaterMark=Ie(A)),A!==0&&(b.emittedReadable=!1),A===0&&b.needReadable&&((b.highWaterMark!==0?b.length>=b.highWaterMark:b.length>0)||b.ended))return B("read: emitReadable",b.length,b.ended),b.length===0&&b.ended?F(this):ee(this),null;if(A=K(A,b),A===0&&b.ended)return b.length===0&&F(this),null;let Y=b.needReadable;if(B("need readable",Y),(b.length===0||b.length-A<b.highWaterMark)&&(Y=!0,B("length less than watermark",Y)),b.ended||b.reading||b.destroyed||b.errored||!b.constructed)Y=!1,B("reading, ended or constructing",Y);else if(Y){B("do read"),b.reading=!0,b.sync=!0,b.length===0&&(b.needReadable=!0);try{this._read(b.highWaterMark)}catch(le){q(this,le)}b.sync=!1,b.reading||(A=K(k,b))}let j;return A>0?j=_(A,b):j=null,j===null?(b.needReadable=b.length<=b.highWaterMark,A=0):(b.length-=A,b.multiAwaitDrain?b.awaitDrainWriters.clear():b.awaitDrainWriters=null),b.length===0&&(b.ended||(b.needReadable=!0),k!==A&&b.ended&&F(this)),j!==null&&!b.errorEmitted&&!b.closeEmitted&&(b.dataEmitted=!0,this.emit("data",j)),j};function w(A,b){if(B("onEofChunk"),!b.ended){if(b.decoder){let k=b.decoder.end();k&&k.length&&(b.buffer.push(k),b.length+=b.objectMode?1:k.length)}b.ended=!0,b.sync?ee(A):(b.needReadable=!1,b.emittedReadable=!0,be(A))}}function ee(A){let b=A._readableState;B("emitReadable",b.needReadable,b.emittedReadable),b.needReadable=!1,b.emittedReadable||(B("emitReadable",b.flowing),b.emittedReadable=!0,n.nextTick(be,A))}function be(A){let b=A._readableState;B("emitReadable_",b.destroyed,b.length,b.ended),!b.destroyed&&!b.errored&&(b.length||b.ended)&&(A.emit("readable"),b.emittedReadable=!1),b.needReadable=!b.flowing&&!b.ended&&b.length<=b.highWaterMark,ce(A)}function ae(A,b){!b.readingMore&&b.constructed&&(b.readingMore=!0,n.nextTick(re,A,b))}function re(A,b){for(;!b.reading&&!b.ended&&(b.length<b.highWaterMark||b.flowing&&b.length===0);){let k=b.length;if(B("maybeReadMore read 0"),A.read(0),k===b.length)break}b.readingMore=!1}v.prototype._read=function(A){throw new P("_read()")},v.prototype.pipe=function(A,b){let k=this,Y=this._readableState;Y.pipes.length===1&&(Y.multiAwaitDrain||(Y.multiAwaitDrain=!0,Y.awaitDrainWriters=new C(Y.awaitDrainWriters?[Y.awaitDrainWriters]:[]))),Y.pipes.push(A),B("pipe count=%d opts=%j",Y.pipes.length,b);let j=(!b||b.end!==!1)&&A!==n.stdout&&A!==n.stderr?Xe:Ft;Y.endEmitted?n.nextTick(j):k.once("end",j),A.on("unpipe",le);function le(tn,Xt){B("onunpipe"),tn===k&&Xt&&Xt.hasUnpiped===!1&&(Xt.hasUnpiped=!0,Re())}function Xe(){B("onend"),A.end()}let Fe,xe=!1;function Re(){B("cleanup"),A.removeListener("close",kt),A.removeListener("finish",ft),Fe&&A.removeListener("drain",Fe),A.removeListener("error",et),A.removeListener("unpipe",le),k.removeListener("end",Xe),k.removeListener("end",Ft),k.removeListener("data",we),xe=!0,Fe&&Y.awaitDrainWriters&&(!A._writableState||A._writableState.needDrain)&&Fe()}function Ne(){xe||(Y.pipes.length===1&&Y.pipes[0]===A?(B("false write response, pause",0),Y.awaitDrainWriters=A,Y.multiAwaitDrain=!1):Y.pipes.length>1&&Y.pipes.includes(A)&&(B("false write response, pause",Y.awaitDrainWriters.size),Y.awaitDrainWriters.add(A)),k.pause()),Fe||(Fe=ye(k,A),A.on("drain",Fe))}k.on("data",we);function we(tn){B("ondata");let Xt=A.write(tn);B("dest.write",Xt),Xt===!1&&Ne()}function et(tn){if(B("onerror",tn),Ft(),A.removeListener("error",et),A.listenerCount("error")===0){let Xt=A._writableState||A._readableState;Xt&&!Xt.errorEmitted?q(A,tn):A.emit("error",tn)}}f(A,"error",et);function kt(){A.removeListener("finish",ft),Ft()}A.once("close",kt);function ft(){B("onfinish"),A.removeListener("close",kt),Ft()}A.once("finish",ft);function Ft(){B("unpipe"),k.unpipe(A)}return A.emit("pipe",k),A.writableNeedDrain===!0?Y.flowing&&Ne():Y.flowing||(B("pipe resume"),k.resume()),A};function ye(A,b){return function(){let k=A._readableState;k.awaitDrainWriters===b?(B("pipeOnDrain",1),k.awaitDrainWriters=null):k.multiAwaitDrain&&(B("pipeOnDrain",k.awaitDrainWriters.size),k.awaitDrainWriters.delete(b)),(!k.awaitDrainWriters||k.awaitDrainWriters.size===0)&&A.listenerCount("data")&&A.resume()}}v.prototype.unpipe=function(A){let b=this._readableState,k={hasUnpiped:!1};if(b.pipes.length===0)return this;if(!A){let j=b.pipes;b.pipes=[],this.pause();for(let le=0;le<j.length;le++)j[le].emit("unpipe",this,{hasUnpiped:!1});return this}let Y=g(b.pipes,A);return Y===-1?this:(b.pipes.splice(Y,1),b.pipes.length===0&&this.pause(),A.emit("unpipe",this,k),this)},v.prototype.on=function(A,b){let k=h.prototype.on.call(this,A,b),Y=this._readableState;return A==="data"?(Y.readableListening=this.listenerCount("readable")>0,Y.flowing!==!1&&this.resume()):A==="readable"&&!Y.endEmitted&&!Y.readableListening&&(Y.readableListening=Y.needReadable=!0,Y.flowing=!1,Y.emittedReadable=!1,B("on readable",Y.length,Y.reading),Y.length?ee(this):Y.reading||n.nextTick(x,this)),k},v.prototype.addListener=v.prototype.on,v.prototype.removeListener=function(A,b){let k=h.prototype.removeListener.call(this,A,b);return A==="readable"&&n.nextTick(pe,this),k},v.prototype.off=v.prototype.removeListener,v.prototype.removeAllListeners=function(A){let b=h.prototype.removeAllListeners.apply(this,arguments);return(A==="readable"||A===void 0)&&n.nextTick(pe,this),b};function pe(A){let b=A._readableState;b.readableListening=A.listenerCount("readable")>0,b.resumeScheduled&&b[ie]===!1?b.flowing=!0:A.listenerCount("data")>0?A.resume():b.readableListening||(b.flowing=null)}function x(A){B("readable nexttick read 0"),A.read(0)}v.prototype.resume=function(){let A=this._readableState;return A.flowing||(B("resume"),A.flowing=!A.readableListening,z(this,A)),A[ie]=!1,this};function z(A,b){b.resumeScheduled||(b.resumeScheduled=!0,n.nextTick(Q,A,b))}function Q(A,b){B("resume",b.reading),b.reading||A.read(0),b.resumeScheduled=!1,A.emit("resume"),ce(A),b.flowing&&!b.reading&&A.read(0)}v.prototype.pause=function(){return B("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(B("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[ie]=!0,this};function ce(A){let b=A._readableState;for(B("flow",b.flowing);b.flowing&&A.read()!==null;);}v.prototype.wrap=function(A){let b=!1;A.on("data",Y=>{!this.push(Y)&&A.pause&&(b=!0,A.pause())}),A.on("end",()=>{this.push(null)}),A.on("error",Y=>{q(this,Y)}),A.on("close",()=>{this.destroy()}),A.on("destroy",()=>{this.destroy()}),this._read=()=>{b&&A.resume&&(b=!1,A.resume())};let k=l(A);for(let Y=1;Y<k.length;Y++){let j=k[Y];this[j]===void 0&&typeof A[j]=="function"&&(this[j]=A[j].bind(A))}return this},v.prototype[c]=function(){return se(this)},v.prototype.iterator=function(A){return A!==void 0&&D(A,"options"),se(this,A)};function se(A,b){typeof A.read!="function"&&(A=v.wrap(A,{objectMode:!0}));let k=T(A,b);return k.stream=A,k}async function*T(A,b){let k=te;function Y(Xe){this===A?(k(),k=te):k=Xe}A.on("readable",Y);let j,le=p(A,{writable:!1},Xe=>{j=Xe?J(j,Xe):null,k(),k=te});try{for(;;){let Xe=A.destroyed?null:A.read();if(Xe!==null)yield Xe;else{if(j)throw j;if(j===null)return;await new a(Y)}}}catch(Xe){throw j=J(j,Xe),j}finally{(j||(b==null?void 0:b.destroyOnReturn)!==!1)&&(j===void 0||A._readableState.autoDestroy)?S.destroyer(A,null):(A.off("readable",Y),le())}}r(v.prototype,{readable:{__proto__:null,get(){let A=this._readableState;return!!A&&A.readable!==!1&&!A.destroyed&&!A.errorEmitted&&!A.endEmitted},set(A){this._readableState&&(this._readableState.readable=!!A)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(A){this._readableState&&(this._readableState.flowing=A)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(A){this._readableState&&(this._readableState.destroyed=A)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),r(me.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[ie]!==!1},set(A){this[ie]=!!A}}}),v._fromList=_;function _(A,b){if(b.length===0)return null;let k;return b.objectMode?k=b.buffer.shift():!A||A>=b.length?(b.decoder?k=b.buffer.join(""):b.buffer.length===1?k=b.buffer.first():k=b.buffer.concat(b.length),b.buffer.clear()):k=b.buffer.consume(A,b.decoder),k}function F(A){let b=A._readableState;B("endReadable",b.endEmitted),b.endEmitted||(b.ended=!0,n.nextTick(U,b,A))}function U(A,b){if(B("endReadableNT",A.endEmitted,A.length),!A.errored&&!A.closeEmitted&&!A.endEmitted&&A.length===0){if(A.endEmitted=!0,b.emit("end"),b.writable&&b.allowHalfOpen===!1)n.nextTick(O,b);else if(A.autoDestroy){let k=b._writableState;(!k||k.autoDestroy&&(k.finished||k.writable===!1))&&b.destroy()}}}function O(A){A.writable&&!A.writableEnded&&!A.destroyed&&A.end()}v.from=function(A,b){return N(v,A,b)};var de;function m(){return de===void 0&&(de={}),de}v.fromWeb=function(A,b){return m().newStreamReadableFromReadableStream(A,b)},v.toWeb=function(A,b){return m().newReadableStreamFromStreamReadable(A,b)},v.wrap=function(A,b){var k,Y;return new v({objectMode:(k=(Y=A.readableObjectMode)!==null&&Y!==void 0?Y:A.objectMode)!==null&&k!==void 0?k:!0,...b,destroy(j,le){S.destroyer(A,j),le(j)}}).wrap(A)}}),ev=Ze((e,t)=>{he(),Ae(),ue();var n=Lo(),{ArrayPrototypeSlice:g,Error:i,FunctionPrototypeSymbolHasInstance:o,ObjectDefineProperty:s,ObjectDefineProperties:r,ObjectSetPrototypeOf:l,StringPrototypeToLowerCase:I,Symbol:a,SymbolHasInstance:C}=vt();t.exports=ge,ge.WritableState=D;var{EventEmitter:c}=(Ds(),$e(Uo)),d=Gb().Stream,{Buffer:u}=(Ut(),$e(Lt)),h=zs(),{addAbortSignal:f}=OC(),{getHighWaterMark:y,getDefaultHighWaterMark:Z}=Bb(),{ERR_INVALID_ARG_TYPE:p,ERR_METHOD_NOT_IMPLEMENTED:B,ERR_MULTIPLE_CALLBACK:W,ERR_STREAM_CANNOT_PIPE:S,ERR_STREAM_DESTROYED:V,ERR_STREAM_ALREADY_FINISHED:R,ERR_STREAM_NULL_VALUES:J,ERR_STREAM_WRITE_AFTER_END:M,ERR_UNKNOWN_ENCODING:P}=fn().codes,{errorOrDestroy:X}=h;l(ge.prototype,d.prototype),l(ge,d);function L(){}var ne=a("kOnFinished");function D(x,z,Q){typeof Q!="boolean"&&(Q=z instanceof Dg()),this.objectMode=!!(x&&x.objectMode),Q&&(this.objectMode=this.objectMode||!!(x&&x.writableObjectMode)),this.highWaterMark=x?y(this,x,"writableHighWaterMark",Q):Z(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let ce=!!(x&&x.decodeStrings===!1);this.decodeStrings=!ce,this.defaultEncoding=x&&x.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=v.bind(void 0,z),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,ie(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!x||x.emitClose!==!1,this.autoDestroy=!x||x.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[ne]=[]}function ie(x){x.buffered=[],x.bufferedIndex=0,x.allBuffers=!0,x.allNoop=!0}D.prototype.getBuffer=function(){return g(this.buffered,this.bufferedIndex)},s(D.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function ge(x){let z=this instanceof Dg();if(!z&&!o(ge,this))return new ge(x);this._writableState=new D(x,this,z),x&&(typeof x.write=="function"&&(this._write=x.write),typeof x.writev=="function"&&(this._writev=x.writev),typeof x.destroy=="function"&&(this._destroy=x.destroy),typeof x.final=="function"&&(this._final=x.final),typeof x.construct=="function"&&(this._construct=x.construct),x.signal&&f(x.signal,this)),d.call(this,x),h.construct(this,()=>{let Q=this._writableState;Q.writing||Ie(this,Q),be(this,Q)})}s(ge,C,{__proto__:null,value:function(x){return o(this,x)?!0:this!==ge?!1:x&&x._writableState instanceof D}}),ge.prototype.pipe=function(){X(this,new S)};function N(x,z,Q,ce){let se=x._writableState;if(typeof Q=="function")ce=Q,Q=se.defaultEncoding;else{if(!Q)Q=se.defaultEncoding;else if(Q!=="buffer"&&!u.isEncoding(Q))throw new P(Q);typeof ce!="function"&&(ce=L)}if(z===null)throw new J;if(!se.objectMode)if(typeof z=="string")se.decodeStrings!==!1&&(z=u.from(z,Q),Q="buffer");else if(z instanceof u)Q="buffer";else if(d._isUint8Array(z))z=d._uint8ArrayToBuffer(z),Q="buffer";else throw new p("chunk",["string","Buffer","Uint8Array"],z);let T;return se.ending?T=new M:se.destroyed&&(T=new V("write")),T?(n.nextTick(ce,T),X(x,T,!0),T):(se.pendingcb++,te(x,se,z,Q,ce))}ge.prototype.write=function(x,z,Q){return N(this,x,z,Q)===!0},ge.prototype.cork=function(){this._writableState.corked++},ge.prototype.uncork=function(){let x=this._writableState;x.corked&&(x.corked--,x.writing||Ie(this,x))},ge.prototype.setDefaultEncoding=function(x){if(typeof x=="string"&&(x=I(x)),!u.isEncoding(x))throw new P(x);return this._writableState.defaultEncoding=x,this};function te(x,z,Q,ce,se){let T=z.objectMode?1:Q.length;z.length+=T;let _=z.length<z.highWaterMark;return _||(z.needDrain=!0),z.writing||z.corked||z.errored||!z.constructed?(z.buffered.push({chunk:Q,encoding:ce,callback:se}),z.allBuffers&&ce!=="buffer"&&(z.allBuffers=!1),z.allNoop&&se!==L&&(z.allNoop=!1)):(z.writelen=T,z.writecb=se,z.writing=!0,z.sync=!0,x._write(Q,ce,z.onwrite),z.sync=!1),_&&!z.errored&&!z.destroyed}function q(x,z,Q,ce,se,T,_){z.writelen=ce,z.writecb=_,z.writing=!0,z.sync=!0,z.destroyed?z.onwrite(new V("write")):Q?x._writev(se,z.onwrite):x._write(se,T,z.onwrite),z.sync=!1}function me(x,z,Q,ce){--z.pendingcb,ce(Q),Be(z),X(x,Q)}function v(x,z){let Q=x._writableState,ce=Q.sync,se=Q.writecb;if(typeof se!="function"){X(x,new W);return}Q.writing=!1,Q.writecb=null,Q.length-=Q.writelen,Q.writelen=0,z?(z.stack,Q.errored||(Q.errored=z),x._readableState&&!x._readableState.errored&&(x._readableState.errored=z),ce?n.nextTick(me,x,Q,z,se):me(x,Q,z,se)):(Q.buffered.length>Q.bufferedIndex&&Ie(x,Q),ce?Q.afterWriteTickInfo!==null&&Q.afterWriteTickInfo.cb===se?Q.afterWriteTickInfo.count++:(Q.afterWriteTickInfo={count:1,cb:se,stream:x,state:Q},n.nextTick($,Q.afterWriteTickInfo)):Ce(x,Q,1,se))}function $({stream:x,state:z,count:Q,cb:ce}){return z.afterWriteTickInfo=null,Ce(x,z,Q,ce)}function Ce(x,z,Q,ce){for(!z.ending&&!x.destroyed&&z.length===0&&z.needDrain&&(z.needDrain=!1,x.emit("drain"));Q-- >0;)z.pendingcb--,ce();z.destroyed&&Be(z),be(x,z)}function Be(x){if(x.writing)return;for(let se=x.bufferedIndex;se<x.buffered.length;++se){var z;let{chunk:T,callback:_}=x.buffered[se],F=x.objectMode?1:T.length;x.length-=F,_((z=x.errored)!==null&&z!==void 0?z:new V("write"))}let Q=x[ne].splice(0);for(let se=0;se<Q.length;se++){var ce;Q[se]((ce=x.errored)!==null&&ce!==void 0?ce:new V("end"))}ie(x)}function Ie(x,z){if(z.corked||z.bufferProcessing||z.destroyed||!z.constructed)return;let{buffered:Q,bufferedIndex:ce,objectMode:se}=z,T=Q.length-ce;if(!T)return;let _=ce;if(z.bufferProcessing=!0,T>1&&x._writev){z.pendingcb-=T-1;let F=z.allNoop?L:O=>{for(let de=_;de<Q.length;++de)Q[de].callback(O)},U=z.allNoop&&_===0?Q:g(Q,_);U.allBuffers=z.allBuffers,q(x,z,!0,z.length,U,"",F),ie(z)}else{do{let{chunk:F,encoding:U,callback:O}=Q[_];Q[_++]=null;let de=se?1:F.length;q(x,z,!1,de,F,U,O)}while(_<Q.length&&!z.writing);_===Q.length?ie(z):_>256?(Q.splice(0,_),z.bufferedIndex=0):z.bufferedIndex=_}z.bufferProcessing=!1}ge.prototype._write=function(x,z,Q){if(this._writev)this._writev([{chunk:x,encoding:z}],Q);else throw new B("_write()")},ge.prototype._writev=null,ge.prototype.end=function(x,z,Q){let ce=this._writableState;typeof x=="function"?(Q=x,x=null,z=null):typeof z=="function"&&(Q=z,z=null);let se;if(x!=null){let T=N(this,x,z);T instanceof i&&(se=T)}return ce.corked&&(ce.corked=1,this.uncork()),se||(!ce.errored&&!ce.ending?(ce.ending=!0,be(this,ce,!0),ce.ended=!0):ce.finished?se=new R("end"):ce.destroyed&&(se=new V("end"))),typeof Q=="function"&&(se||ce.finished?n.nextTick(Q,se):ce[ne].push(Q)),this};function K(x){return x.ending&&!x.destroyed&&x.constructed&&x.length===0&&!x.errored&&x.buffered.length===0&&!x.finished&&!x.writing&&!x.errorEmitted&&!x.closeEmitted}function w(x,z){let Q=!1;function ce(se){if(Q){X(x,se??W());return}if(Q=!0,z.pendingcb--,se){let T=z[ne].splice(0);for(let _=0;_<T.length;_++)T[_](se);X(x,se,z.sync)}else K(z)&&(z.prefinished=!0,x.emit("prefinish"),z.pendingcb++,n.nextTick(ae,x,z))}z.sync=!0,z.pendingcb++;try{x._final(ce)}catch(se){ce(se)}z.sync=!1}function ee(x,z){!z.prefinished&&!z.finalCalled&&(typeof x._final=="function"&&!z.destroyed?(z.finalCalled=!0,w(x,z)):(z.prefinished=!0,x.emit("prefinish")))}function be(x,z,Q){K(z)&&(ee(x,z),z.pendingcb===0&&(Q?(z.pendingcb++,n.nextTick((ce,se)=>{K(se)?ae(ce,se):se.pendingcb--},x,z)):K(z)&&(z.pendingcb++,ae(x,z))))}function ae(x,z){z.pendingcb--,z.finished=!0;let Q=z[ne].splice(0);for(let ce=0;ce<Q.length;ce++)Q[ce]();if(x.emit("finish"),z.autoDestroy){let ce=x._readableState;(!ce||ce.autoDestroy&&(ce.endEmitted||ce.readable===!1))&&x.destroy()}}r(ge.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(x){this._writableState&&(this._writableState.destroyed=x)}},writable:{__proto__:null,get(){let x=this._writableState;return!!x&&x.writable!==!1&&!x.destroyed&&!x.errored&&!x.ending&&!x.ended},set(x){this._writableState&&(this._writableState.writable=!!x)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let x=this._writableState;return x?!x.destroyed&&!x.ending&&x.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var re=h.destroy;ge.prototype.destroy=function(x,z){let Q=this._writableState;return!Q.destroyed&&(Q.bufferedIndex<Q.buffered.length||Q[ne].length)&&n.nextTick(Be,Q),re.call(this,x,z),this},ge.prototype._undestroy=h.undestroy,ge.prototype._destroy=function(x,z){z(x)},ge.prototype[c.captureRejectionSymbol]=function(x){this.destroy(x)};var ye;function pe(){return ye===void 0&&(ye={}),ye}ge.fromWeb=function(x,z){return pe().newStreamWritableFromWritableStream(x,z)},ge.toWeb=function(x){return pe().newWritableStreamFromStreamWritable(x)}}),UM=Ze((e,t)=>{he(),Ae(),ue();var n=Lo(),g=(Ut(),$e(Lt)),{isReadable:i,isWritable:o,isIterable:s,isNodeStream:r,isReadableNodeStream:l,isWritableNodeStream:I,isDuplexNodeStream:a}=_g(),C=Ti(),{AbortError:c,codes:{ERR_INVALID_ARG_TYPE:d,ERR_INVALID_RETURN_VALUE:u}}=fn(),{destroyer:h}=zs(),f=Dg(),y=qC(),{createDeferredPromise:Z}=zg(),p=$R(),B=globalThis.Blob||g.Blob,W=typeof B<"u"?function(P){return P instanceof B}:function(P){return!1},S=globalThis.AbortController||yb().AbortController,{FunctionPrototypeCall:V}=vt(),R=class extends f{constructor(P){super(P),(P==null?void 0:P.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(P==null?void 0:P.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};t.exports=function P(X,L){if(a(X))return X;if(l(X))return M({readable:X});if(I(X))return M({writable:X});if(r(X))return M({writable:!1,readable:!1});if(typeof X=="function"){let{value:D,write:ie,final:ge,destroy:N}=J(X);if(s(D))return p(R,D,{objectMode:!0,write:ie,final:ge,destroy:N});let te=D==null?void 0:D.then;if(typeof te=="function"){let q,me=V(te,D,v=>{if(v!=null)throw new u("nully","body",v)},v=>{h(q,v)});return q=new R({objectMode:!0,readable:!1,write:ie,final(v){ge(async()=>{try{await me,n.nextTick(v,null)}catch($){n.nextTick(v,$)}})},destroy:N})}throw new u("Iterable, AsyncIterable or AsyncFunction",L,D)}if(W(X))return P(X.arrayBuffer());if(s(X))return p(R,X,{objectMode:!0,writable:!1});if(typeof(X==null?void 0:X.writable)=="object"||typeof(X==null?void 0:X.readable)=="object"){let D=X!=null&&X.readable?l(X==null?void 0:X.readable)?X==null?void 0:X.readable:P(X.readable):void 0,ie=X!=null&&X.writable?I(X==null?void 0:X.writable)?X==null?void 0:X.writable:P(X.writable):void 0;return M({readable:D,writable:ie})}let ne=X==null?void 0:X.then;if(typeof ne=="function"){let D;return V(ne,X,ie=>{ie!=null&&D.push(ie),D.push(null)},ie=>{h(D,ie)}),D=new R({objectMode:!0,writable:!1,read(){}})}throw new d(L,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],X)};function J(P){let{promise:X,resolve:L}=Z(),ne=new S,D=ne.signal;return{value:P(async function*(){for(;;){let ie=X;X=null;let{chunk:ge,done:N,cb:te}=await ie;if(n.nextTick(te),N)return;if(D.aborted)throw new c(void 0,{cause:D.reason});({promise:X,resolve:L}=Z()),yield ge}}(),{signal:D}),write(ie,ge,N){let te=L;L=null,te({chunk:ie,done:!1,cb:N})},final(ie){let ge=L;L=null,ge({done:!0,cb:ie})},destroy(ie,ge){ne.abort(),ge(ie)}}}function M(P){let X=P.readable&&typeof P.readable.read!="function"?y.wrap(P.readable):P.readable,L=P.writable,ne=!!i(X),D=!!o(L),ie,ge,N,te,q;function me(v){let $=te;te=null,$?$(v):v&&q.destroy(v)}return q=new R({readableObjectMode:!!(X!=null&&X.readableObjectMode),writableObjectMode:!!(L!=null&&L.writableObjectMode),readable:ne,writable:D}),D&&(C(L,v=>{D=!1,v&&h(X,v),me(v)}),q._write=function(v,$,Ce){L.write(v,$)?Ce():ie=Ce},q._final=function(v){L.end(),ge=v},L.on("drain",function(){if(ie){let v=ie;ie=null,v()}}),L.on("finish",function(){if(ge){let v=ge;ge=null,v()}})),ne&&(C(X,v=>{ne=!1,v&&h(X,v),me(v)}),X.on("readable",function(){if(N){let v=N;N=null,v()}}),X.on("end",function(){q.push(null)}),q._read=function(){for(;;){let v=X.read();if(v===null){N=q._read;return}if(!q.push(v))return}}),q._destroy=function(v,$){!v&&te!==null&&(v=new c),N=null,ie=null,ge=null,te===null?$(v):(te=$,h(L,v),h(X,v))},q}}),Dg=Ze((e,t)=>{he(),Ae(),ue();var{ObjectDefineProperties:n,ObjectGetOwnPropertyDescriptor:g,ObjectKeys:i,ObjectSetPrototypeOf:o}=vt();t.exports=l;var s=qC(),r=ev();o(l.prototype,s.prototype),o(l,s);{let c=i(r.prototype);for(let d=0;d<c.length;d++){let u=c[d];l.prototype[u]||(l.prototype[u]=r.prototype[u])}}function l(c){if(!(this instanceof l))return new l(c);s.call(this,c),r.call(this,c),c?(this.allowHalfOpen=c.allowHalfOpen!==!1,c.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),c.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}n(l.prototype,{writable:{__proto__:null,...g(r.prototype,"writable")},writableHighWaterMark:{__proto__:null,...g(r.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...g(r.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...g(r.prototype,"writableBuffer")},writableLength:{__proto__:null,...g(r.prototype,"writableLength")},writableFinished:{__proto__:null,...g(r.prototype,"writableFinished")},writableCorked:{__proto__:null,...g(r.prototype,"writableCorked")},writableEnded:{__proto__:null,...g(r.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...g(r.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(c){this._readableState&&this._writableState&&(this._readableState.destroyed=c,this._writableState.destroyed=c)}}});var I;function a(){return I===void 0&&(I={}),I}l.fromWeb=function(c,d){return a().newStreamDuplexFromReadableWritablePair(c,d)},l.toWeb=function(c){return a().newReadableWritablePairFromDuplex(c)};var C;l.from=function(c){return C||(C=UM()),C(c,"body")}}),tv=Ze((e,t)=>{he(),Ae(),ue();var{ObjectSetPrototypeOf:n,Symbol:g}=vt();t.exports=l;var{ERR_METHOD_NOT_IMPLEMENTED:i}=fn().codes,o=Dg(),{getHighWaterMark:s}=Bb();n(l.prototype,o.prototype),n(l,o);var r=g("kCallback");function l(C){if(!(this instanceof l))return new l(C);let c=C?s(this,C,"readableHighWaterMark",!0):null;c===0&&(C={...C,highWaterMark:null,readableHighWaterMark:c,writableHighWaterMark:C.writableHighWaterMark||0}),o.call(this,C),this._readableState.sync=!1,this[r]=null,C&&(typeof C.transform=="function"&&(this._transform=C.transform),typeof C.flush=="function"&&(this._flush=C.flush)),this.on("prefinish",a)}function I(C){typeof this._flush=="function"&&!this.destroyed?this._flush((c,d)=>{if(c){C?C(c):this.destroy(c);return}d!=null&&this.push(d),this.push(null),C&&C()}):(this.push(null),C&&C())}function a(){this._final!==I&&I.call(this)}l.prototype._final=I,l.prototype._transform=function(C,c,d){throw new i("_transform()")},l.prototype._write=function(C,c,d){let u=this._readableState,h=this._writableState,f=u.length;this._transform(C,c,(y,Z)=>{if(y){d(y);return}Z!=null&&this.push(Z),h.ended||f===u.length||u.length<u.highWaterMark?d():this[r]=d})},l.prototype._read=function(){if(this[r]){let C=this[r];this[r]=null,C()}}}),nv=Ze((e,t)=>{he(),Ae(),ue();var{ObjectSetPrototypeOf:n}=vt();t.exports=i;var g=tv();n(i.prototype,g.prototype),n(i,g);function i(o){if(!(this instanceof i))return new i(o);g.call(this,o)}i.prototype._transform=function(o,s,r){r(null,o)}}),Wb=Ze((e,t)=>{he(),Ae(),ue();var n=Lo(),{ArrayIsArray:g,Promise:i,SymbolAsyncIterator:o}=vt(),s=Ti(),{once:r}=zg(),l=zs(),I=Dg(),{aggregateTwoErrors:a,codes:{ERR_INVALID_ARG_TYPE:C,ERR_INVALID_RETURN_VALUE:c,ERR_MISSING_ARGS:d,ERR_STREAM_DESTROYED:u,ERR_STREAM_PREMATURE_CLOSE:h},AbortError:f}=fn(),{validateFunction:y,validateAbortSignal:Z}=PC(),{isIterable:p,isReadable:B,isReadableNodeStream:W,isNodeStream:S,isTransformStream:V,isWebStream:R,isReadableStream:J,isReadableEnded:M}=_g(),P=globalThis.AbortController||yb().AbortController,X,L;function ne($,Ce,Be){let Ie=!1;$.on("close",()=>{Ie=!0});let K=s($,{readable:Ce,writable:Be},w=>{Ie=!w});return{destroy:w=>{Ie||(Ie=!0,l.destroyer($,w||new u("pipe")))},cleanup:K}}function D($){return y($[$.length-1],"streams[stream.length - 1]"),$.pop()}function ie($){if(p($))return $;if(W($))return ge($);throw new C("val",["Readable","Iterable","AsyncIterable"],$)}async function*ge($){L||(L=qC()),yield*L.prototype[o].call($)}async function N($,Ce,Be,{end:Ie}){let K,w=null,ee=re=>{if(re&&(K=re),w){let ye=w;w=null,ye()}},be=()=>new i((re,ye)=>{K?ye(K):w=()=>{K?ye(K):re()}});Ce.on("drain",ee);let ae=s(Ce,{readable:!1},ee);try{Ce.writableNeedDrain&&await be();for await(let re of $)Ce.write(re)||await be();Ie&&Ce.end(),await be(),Be()}catch(re){Be(K!==re?a(K,re):re)}finally{ae(),Ce.off("drain",ee)}}async function te($,Ce,Be,{end:Ie}){V(Ce)&&(Ce=Ce.writable);let K=Ce.getWriter();try{for await(let w of $)await K.ready,K.write(w).catch(()=>{});await K.ready,Ie&&await K.close(),Be()}catch(w){try{await K.abort(w),Be(w)}catch(ee){Be(ee)}}}function q(...$){return me($,r(D($)))}function me($,Ce,Be){if($.length===1&&g($[0])&&($=$[0]),$.length<2)throw new d("streams");let Ie=new P,K=Ie.signal,w=Be==null?void 0:Be.signal,ee=[];Z(w,"options.signal");function be(){z(new f)}w==null||w.addEventListener("abort",be);let ae,re,ye=[],pe=0;function x(T){z(T,--pe===0)}function z(T,_){if(T&&(!ae||ae.code==="ERR_STREAM_PREMATURE_CLOSE")&&(ae=T),!(!ae&&!_)){for(;ye.length;)ye.shift()(ae);w==null||w.removeEventListener("abort",be),Ie.abort(),_&&(ae||ee.forEach(F=>F()),n.nextTick(Ce,ae,re))}}let Q;for(let T=0;T<$.length;T++){let _=$[T],F=T<$.length-1,U=T>0,O=F||(Be==null?void 0:Be.end)!==!1,de=T===$.length-1;if(S(_)){let m=function(A){A&&A.name!=="AbortError"&&A.code!=="ERR_STREAM_PREMATURE_CLOSE"&&x(A)};if(O){let{destroy:A,cleanup:b}=ne(_,F,U);ye.push(A),B(_)&&de&&ee.push(b)}_.on("error",m),B(_)&&de&&ee.push(()=>{_.removeListener("error",m)})}if(T===0)if(typeof _=="function"){if(Q=_({signal:K}),!p(Q))throw new c("Iterable, AsyncIterable or Stream","source",Q)}else p(_)||W(_)||V(_)?Q=_:Q=I.from(_);else if(typeof _=="function"){if(V(Q)){var ce;Q=ie((ce=Q)===null||ce===void 0?void 0:ce.readable)}else Q=ie(Q);if(Q=_(Q,{signal:K}),F){if(!p(Q,!0))throw new c("AsyncIterable",`transform[${T-1}]`,Q)}else{var se;X||(X=nv());let m=new X({objectMode:!0}),A=(se=Q)===null||se===void 0?void 0:se.then;if(typeof A=="function")pe++,A.call(Q,Y=>{re=Y,Y!=null&&m.write(Y),O&&m.end(),n.nextTick(x)},Y=>{m.destroy(Y),n.nextTick(x,Y)});else if(p(Q,!0))pe++,N(Q,m,x,{end:O});else if(J(Q)||V(Q)){let Y=Q.readable||Q;pe++,N(Y,m,x,{end:O})}else throw new c("AsyncIterable or Promise","destination",Q);Q=m;let{destroy:b,cleanup:k}=ne(Q,!1,!0);ye.push(b),de&&ee.push(k)}}else if(S(_)){if(W(Q)){pe+=2;let m=v(Q,_,x,{end:O});B(_)&&de&&ee.push(m)}else if(V(Q)||J(Q)){let m=Q.readable||Q;pe++,N(m,_,x,{end:O})}else if(p(Q))pe++,N(Q,_,x,{end:O});else throw new C("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Q);Q=_}else if(R(_)){if(W(Q))pe++,te(ie(Q),_,x,{end:O});else if(J(Q)||p(Q))pe++,te(Q,_,x,{end:O});else if(V(Q))pe++,te(Q.readable,_,x,{end:O});else throw new C("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Q);Q=_}else Q=I.from(_)}return(K!=null&&K.aborted||w!=null&&w.aborted)&&n.nextTick(be),Q}function v($,Ce,Be,{end:Ie}){let K=!1;if(Ce.on("close",()=>{K||Be(new h)}),$.pipe(Ce,{end:!1}),Ie){let w=function(){K=!0,Ce.end()};M($)?n.nextTick(w):$.once("end",w)}else Be();return s($,{readable:!0,writable:!1},w=>{let ee=$._readableState;w&&w.code==="ERR_STREAM_PREMATURE_CLOSE"&&ee&&ee.ended&&!ee.errored&&!ee.errorEmitted?$.once("end",Be).once("error",Be):Be(w)}),s(Ce,{readable:!1,writable:!0},Be)}t.exports={pipelineImpl:me,pipeline:q}}),gv=Ze((e,t)=>{he(),Ae(),ue();var{pipeline:n}=Wb(),g=Dg(),{destroyer:i}=zs(),{isNodeStream:o,isReadable:s,isWritable:r,isWebStream:l,isTransformStream:I,isWritableStream:a,isReadableStream:C}=_g(),{AbortError:c,codes:{ERR_INVALID_ARG_VALUE:d,ERR_MISSING_ARGS:u}}=fn(),h=Ti();t.exports=function(...f){if(f.length===0)throw new u("streams");if(f.length===1)return g.from(f[0]);let y=[...f];if(typeof f[0]=="function"&&(f[0]=g.from(f[0])),typeof f[f.length-1]=="function"){let X=f.length-1;f[X]=g.from(f[X])}for(let X=0;X<f.length;++X)if(!(!o(f[X])&&!l(f[X]))){if(X<f.length-1&&!(s(f[X])||C(f[X])||I(f[X])))throw new d(`streams[${X}]`,y[X],"must be readable");if(X>0&&!(r(f[X])||a(f[X])||I(f[X])))throw new d(`streams[${X}]`,y[X],"must be writable")}let Z,p,B,W,S;function V(X){let L=W;W=null,L?L(X):X?S.destroy(X):!P&&!M&&S.destroy()}let R=f[0],J=n(f,V),M=!!(r(R)||a(R)||I(R)),P=!!(s(J)||C(J)||I(J));if(S=new g({writableObjectMode:!!(R!=null&&R.writableObjectMode),readableObjectMode:!!(J!=null&&J.writableObjectMode),writable:M,readable:P}),M){if(o(R))S._write=function(L,ne,D){R.write(L,ne)?D():Z=D},S._final=function(L){R.end(),p=L},R.on("drain",function(){if(Z){let L=Z;Z=null,L()}});else if(l(R)){let L=(I(R)?R.writable:R).getWriter();S._write=async function(ne,D,ie){try{await L.ready,L.write(ne).catch(()=>{}),ie()}catch(ge){ie(ge)}},S._final=async function(ne){try{await L.ready,L.close().catch(()=>{}),p=ne}catch(D){ne(D)}}}let X=I(J)?J.readable:J;h(X,()=>{if(p){let L=p;p=null,L()}})}if(P){if(o(J))J.on("readable",function(){if(B){let X=B;B=null,X()}}),J.on("end",function(){S.push(null)}),S._read=function(){for(;;){let X=J.read();if(X===null){B=S._read;return}if(!S.push(X))return}};else if(l(J)){let X=(I(J)?J.readable:J).getReader();S._read=async function(){for(;;)try{let{value:L,done:ne}=await X.read();if(!S.push(L))return;if(ne){S.push(null);return}}catch{return}}}}return S._destroy=function(X,L){!X&&W!==null&&(X=new c),B=null,Z=null,p=null,W===null?L(X):(W=L,o(J)&&i(J,X))},S}}),zM=Ze((e,t)=>{he(),Ae(),ue();var n=globalThis.AbortController||yb().AbortController,{codes:{ERR_INVALID_ARG_VALUE:g,ERR_INVALID_ARG_TYPE:i,ERR_MISSING_ARGS:o,ERR_OUT_OF_RANGE:s},AbortError:r}=fn(),{validateAbortSignal:l,validateInteger:I,validateObject:a}=PC(),C=vt().Symbol("kWeak"),{finished:c}=Ti(),d=gv(),{addAbortSignalNoValidate:u}=OC(),{isWritable:h,isNodeStream:f}=_g(),{ArrayPrototypePush:y,MathFloor:Z,Number:p,NumberIsNaN:B,Promise:W,PromiseReject:S,PromisePrototypeThen:V,Symbol:R}=vt(),J=R("kEmpty"),M=R("kEof");function P(Ie,K){if(K!=null&&a(K,"options"),(K==null?void 0:K.signal)!=null&&l(K.signal,"options.signal"),f(Ie)&&!h(Ie))throw new g("stream",Ie,"must be writable");let w=d(this,Ie);return K!=null&&K.signal&&u(K.signal,w),w}function X(Ie,K){if(typeof Ie!="function")throw new i("fn",["Function","AsyncFunction"],Ie);K!=null&&a(K,"options"),(K==null?void 0:K.signal)!=null&&l(K.signal,"options.signal");let w=1;return(K==null?void 0:K.concurrency)!=null&&(w=Z(K.concurrency)),I(w,"concurrency",1),(async function*(){var ee,be;let ae=new n,re=this,ye=[],pe=ae.signal,x={signal:pe},z=()=>ae.abort();K!=null&&(ee=K.signal)!==null&&ee!==void 0&&ee.aborted&&z(),K==null||(be=K.signal)===null||be===void 0||be.addEventListener("abort",z);let Q,ce,se=!1;function T(){se=!0}async function _(){try{for await(let O of re){var F;if(se)return;if(pe.aborted)throw new r;try{O=Ie(O,x)}catch(de){O=S(de)}O!==J&&(typeof((F=O)===null||F===void 0?void 0:F.catch)=="function"&&O.catch(T),ye.push(O),Q&&(Q(),Q=null),!se&&ye.length&&ye.length>=w&&await new W(de=>{ce=de}))}ye.push(M)}catch(O){let de=S(O);V(de,void 0,T),ye.push(de)}finally{var U;se=!0,Q&&(Q(),Q=null),K==null||(U=K.signal)===null||U===void 0||U.removeEventListener("abort",z)}}_();try{for(;;){for(;ye.length>0;){let F=await ye[0];if(F===M)return;if(pe.aborted)throw new r;F!==J&&(yield F),ye.shift(),ce&&(ce(),ce=null)}await new W(F=>{Q=F})}}finally{ae.abort(),se=!0,ce&&(ce(),ce=null)}}).call(this)}function L(Ie=void 0){return Ie!=null&&a(Ie,"options"),(Ie==null?void 0:Ie.signal)!=null&&l(Ie.signal,"options.signal"),(async function*(){let K=0;for await(let ee of this){var w;if(Ie!=null&&(w=Ie.signal)!==null&&w!==void 0&&w.aborted)throw new r({cause:Ie.signal.reason});yield[K++,ee]}}).call(this)}async function ne(Ie,K=void 0){for await(let w of N.call(this,Ie,K))return!0;return!1}async function D(Ie,K=void 0){if(typeof Ie!="function")throw new i("fn",["Function","AsyncFunction"],Ie);return!await ne.call(this,async(...w)=>!await Ie(...w),K)}async function ie(Ie,K){for await(let w of N.call(this,Ie,K))return w}async function ge(Ie,K){if(typeof Ie!="function")throw new i("fn",["Function","AsyncFunction"],Ie);async function w(ee,be){return await Ie(ee,be),J}for await(let ee of X.call(this,w,K));}function N(Ie,K){if(typeof Ie!="function")throw new i("fn",["Function","AsyncFunction"],Ie);async function w(ee,be){return await Ie(ee,be)?ee:J}return X.call(this,w,K)}var te=class extends o{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function q(Ie,K,w){var ee;if(typeof Ie!="function")throw new i("reducer",["Function","AsyncFunction"],Ie);w!=null&&a(w,"options"),(w==null?void 0:w.signal)!=null&&l(w.signal,"options.signal");let be=arguments.length>1;if(w!=null&&(ee=w.signal)!==null&&ee!==void 0&&ee.aborted){let x=new r(void 0,{cause:w.signal.reason});throw this.once("error",()=>{}),await c(this.destroy(x)),x}let ae=new n,re=ae.signal;if(w!=null&&w.signal){let x={once:!0,[C]:this};w.signal.addEventListener("abort",()=>ae.abort(),x)}let ye=!1;try{for await(let x of this){var pe;if(ye=!0,w!=null&&(pe=w.signal)!==null&&pe!==void 0&&pe.aborted)throw new r;be?K=await Ie(K,x,{signal:re}):(K=x,be=!0)}if(!ye&&!be)throw new te}finally{ae.abort()}return K}async function me(Ie){Ie!=null&&a(Ie,"options"),(Ie==null?void 0:Ie.signal)!=null&&l(Ie.signal,"options.signal");let K=[];for await(let ee of this){var w;if(Ie!=null&&(w=Ie.signal)!==null&&w!==void 0&&w.aborted)throw new r(void 0,{cause:Ie.signal.reason});y(K,ee)}return K}function v(Ie,K){let w=X.call(this,Ie,K);return(async function*(){for await(let ee of w)yield*ee}).call(this)}function $(Ie){if(Ie=p(Ie),B(Ie))return 0;if(Ie<0)throw new s("number",">= 0",Ie);return Ie}function Ce(Ie,K=void 0){return K!=null&&a(K,"options"),(K==null?void 0:K.signal)!=null&&l(K.signal,"options.signal"),Ie=$(Ie),(async function*(){var w;if(K!=null&&(w=K.signal)!==null&&w!==void 0&&w.aborted)throw new r;for await(let be of this){var ee;if(K!=null&&(ee=K.signal)!==null&&ee!==void 0&&ee.aborted)throw new r;Ie--<=0&&(yield be)}}).call(this)}function Be(Ie,K=void 0){return K!=null&&a(K,"options"),(K==null?void 0:K.signal)!=null&&l(K.signal,"options.signal"),Ie=$(Ie),(async function*(){var w;if(K!=null&&(w=K.signal)!==null&&w!==void 0&&w.aborted)throw new r;for await(let be of this){var ee;if(K!=null&&(ee=K.signal)!==null&&ee!==void 0&&ee.aborted)throw new r;if(Ie-- >0)yield be;else return}}).call(this)}t.exports.streamReturningOperators={asIndexedPairs:L,drop:Ce,filter:N,flatMap:v,map:X,take:Be,compose:P},t.exports.promiseReturningOperators={every:D,forEach:ge,reduce:q,toArray:me,some:ne,find:ie}}),iv=Ze((e,t)=>{he(),Ae(),ue();var{ArrayPrototypePop:n,Promise:g}=vt(),{isIterable:i,isNodeStream:o,isWebStream:s}=_g(),{pipelineImpl:r}=Wb(),{finished:l}=Ti();ov();function I(...a){return new g((C,c)=>{let d,u,h=a[a.length-1];if(h&&typeof h=="object"&&!o(h)&&!i(h)&&!s(h)){let f=n(a);d=f.signal,u=f.end}r(a,(f,y)=>{f?c(f):C(y)},{signal:d,end:u})})}t.exports={finished:l,pipeline:I}}),ov=Ze((e,t)=>{he(),Ae(),ue();var{Buffer:n}=(Ut(),$e(Lt)),{ObjectDefineProperty:g,ObjectKeys:i,ReflectApply:o}=vt(),{promisify:{custom:s}}=zg(),{streamReturningOperators:r,promiseReturningOperators:l}=zM(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:I}}=fn(),a=gv(),{pipeline:C}=Wb(),{destroyer:c}=zs(),d=Ti(),u=iv(),h=_g(),f=t.exports=Gb().Stream;f.isDisturbed=h.isDisturbed,f.isErrored=h.isErrored,f.isReadable=h.isReadable,f.Readable=qC();for(let Z of i(r)){let p=function(...W){if(new.target)throw I();return f.Readable.from(o(B,this,W))},B=r[Z];g(p,"name",{__proto__:null,value:B.name}),g(p,"length",{__proto__:null,value:B.length}),g(f.Readable.prototype,Z,{__proto__:null,value:p,enumerable:!1,configurable:!0,writable:!0})}for(let Z of i(l)){let p=function(...W){if(new.target)throw I();return o(B,this,W)},B=l[Z];g(p,"name",{__proto__:null,value:B.name}),g(p,"length",{__proto__:null,value:B.length}),g(f.Readable.prototype,Z,{__proto__:null,value:p,enumerable:!1,configurable:!0,writable:!0})}f.Writable=ev(),f.Duplex=Dg(),f.Transform=tv(),f.PassThrough=nv(),f.pipeline=C;var{addAbortSignal:y}=OC();f.addAbortSignal=y,f.finished=d,f.destroy=c,f.compose=a,g(f,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return u}}),g(C,s,{__proto__:null,enumerable:!0,get(){return u.pipeline}}),g(d,s,{__proto__:null,enumerable:!0,get(){return u.finished}}),f.Stream=f,f._isUint8Array=function(Z){return Z instanceof Uint8Array},f._uint8ArrayToBuffer=function(Z){return n.from(Z.buffer,Z.byteOffset,Z.byteLength)}}),zo=Ze((e,t)=>{he(),Ae(),ue();var n=ov(),g=iv(),i=n.Readable.destroy;t.exports=n.Readable,t.exports._uint8ArrayToBuffer=n._uint8ArrayToBuffer,t.exports._isUint8Array=n._isUint8Array,t.exports.isDisturbed=n.isDisturbed,t.exports.isErrored=n.isErrored,t.exports.isReadable=n.isReadable,t.exports.Readable=n.Readable,t.exports.Writable=n.Writable,t.exports.Duplex=n.Duplex,t.exports.Transform=n.Transform,t.exports.PassThrough=n.PassThrough,t.exports.addAbortSignal=n.addAbortSignal,t.exports.finished=n.finished,t.exports.destroy=n.destroy,t.exports.destroy=i,t.exports.pipeline=n.pipeline,t.exports.compose=n.compose,Object.defineProperty(n,"promises",{configurable:!0,enumerable:!0,get(){return g}}),t.exports.Stream=n.Stream,t.exports.default=t.exports}),DM=Ze((e,t)=>{he(),Ae(),ue(),typeof Object.create=="function"?t.exports=function(n,g){g&&(n.super_=g,n.prototype=Object.create(g.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(n,g){if(g){n.super_=g;var i=function(){};i.prototype=g.prototype,n.prototype=new i,n.prototype.constructor=n}}}),QM=Ze((e,t)=>{he(),Ae(),ue();var{Buffer:n}=(Ut(),$e(Lt)),g=Symbol.for("BufferList");function i(o){if(!(this instanceof i))return new i(o);i._init.call(this,o)}i._init=function(o){Object.defineProperty(this,g,{value:!0}),this._bufs=[],this.length=0,o&&this.append(o)},i.prototype._new=function(o){return new i(o)},i.prototype._offset=function(o){if(o===0)return[0,0];let s=0;for(let r=0;r<this._bufs.length;r++){let l=s+this._bufs[r].length;if(o<l||r===this._bufs.length-1)return[r,o-s];s=l}},i.prototype._reverseOffset=function(o){let s=o[0],r=o[1];for(let l=0;l<s;l++)r+=this._bufs[l].length;return r},i.prototype.get=function(o){if(o>this.length||o<0)return;let s=this._offset(o);return this._bufs[s[0]][s[1]]},i.prototype.slice=function(o,s){return typeof o=="number"&&o<0&&(o+=this.length),typeof s=="number"&&s<0&&(s+=this.length),this.copy(null,0,o,s)},i.prototype.copy=function(o,s,r,l){if((typeof r!="number"||r<0)&&(r=0),(typeof l!="number"||l>this.length)&&(l=this.length),r>=this.length||l<=0)return o||n.alloc(0);let I=!!o,a=this._offset(r),C=l-r,c=C,d=I&&s||0,u=a[1];if(r===0&&l===this.length){if(!I)return this._bufs.length===1?this._bufs[0]:n.concat(this._bufs,this.length);for(let h=0;h<this._bufs.length;h++)this._bufs[h].copy(o,d),d+=this._bufs[h].length;return o}if(c<=this._bufs[a[0]].length-u)return I?this._bufs[a[0]].copy(o,s,u,u+c):this._bufs[a[0]].slice(u,u+c);I||(o=n.allocUnsafe(C));for(let h=a[0];h<this._bufs.length;h++){let f=this._bufs[h].length-u;if(c>f)this._bufs[h].copy(o,d,u),d+=f;else{this._bufs[h].copy(o,d,u,u+c),d+=f;break}c-=f,u&&(u=0)}return o.length>d?o.slice(0,d):o},i.prototype.shallowSlice=function(o,s){if(o=o||0,s=typeof s!="number"?this.length:s,o<0&&(o+=this.length),s<0&&(s+=this.length),o===s)return this._new();let r=this._offset(o),l=this._offset(s),I=this._bufs.slice(r[0],l[0]+1);return l[1]===0?I.pop():I[I.length-1]=I[I.length-1].slice(0,l[1]),r[1]!==0&&(I[0]=I[0].slice(r[1])),this._new(I)},i.prototype.toString=function(o,s,r){return this.slice(s,r).toString(o)},i.prototype.consume=function(o){if(o=Math.trunc(o),Number.isNaN(o)||o<=0)return this;for(;this._bufs.length;)if(o>=this._bufs[0].length)o-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(o),this.length-=o;break}return this},i.prototype.duplicate=function(){let o=this._new();for(let s=0;s<this._bufs.length;s++)o.append(this._bufs[s]);return o},i.prototype.append=function(o){if(o==null)return this;if(o.buffer)this._appendBuffer(n.from(o.buffer,o.byteOffset,o.byteLength));else if(Array.isArray(o))for(let s=0;s<o.length;s++)this.append(o[s]);else if(this._isBufferList(o))for(let s=0;s<o._bufs.length;s++)this.append(o._bufs[s]);else typeof o=="number"&&(o=o.toString()),this._appendBuffer(n.from(o));return this},i.prototype._appendBuffer=function(o){this._bufs.push(o),this.length+=o.length},i.prototype.indexOf=function(o,s,r){if(r===void 0&&typeof s=="string"&&(r=s,s=void 0),typeof o=="function"||Array.isArray(o))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof o=="number"?o=n.from([o]):typeof o=="string"?o=n.from(o,r):this._isBufferList(o)?o=o.slice():Array.isArray(o.buffer)?o=n.from(o.buffer,o.byteOffset,o.byteLength):n.isBuffer(o)||(o=n.from(o)),s=Number(s||0),isNaN(s)&&(s=0),s<0&&(s=this.length+s),s<0&&(s=0),o.length===0)return s>this.length?this.length:s;let l=this._offset(s),I=l[0],a=l[1];for(;I<this._bufs.length;I++){let C=this._bufs[I];for(;a<C.length;)if(C.length-a>=o.length){let c=C.indexOf(o,a);if(c!==-1)return this._reverseOffset([I,c]);a=C.length-o.length+1}else{let c=this._reverseOffset([I,a]);if(this._match(c,o))return c;a++}a=0}return-1},i.prototype._match=function(o,s){if(this.length-o<s.length)return!1;for(let r=0;r<s.length;r++)if(this.get(o+r)!==s[r])return!1;return!0},function(){let o={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let s in o)(function(r){o[r]===null?i.prototype[r]=function(l,I){return this.slice(l,l+I)[r](0,I)}:i.prototype[r]=function(l=0){return this.slice(l,l+o[r])[r](0)}})(s)}(),i.prototype._isBufferList=function(o){return o instanceof i||i.isBufferList(o)},i.isBufferList=function(o){return o!=null&&o[g]},t.exports=i}),jM=Ze((e,t)=>{he(),Ae(),ue();var n=zo().Duplex,g=DM(),i=QM();function o(s){if(!(this instanceof o))return new o(s);if(typeof s=="function"){this._callback=s;let r=(function(l){this._callback&&(this._callback(l),this._callback=null)}).bind(this);this.on("pipe",function(l){l.on("error",r)}),this.on("unpipe",function(l){l.removeListener("error",r)}),s=null}i._init.call(this,s),n.call(this)}g(o,n),Object.assign(o.prototype,i.prototype),o.prototype._new=function(s){return new o(s)},o.prototype._write=function(s,r,l){this._appendBuffer(s),typeof l=="function"&&l()},o.prototype._read=function(s){if(!this.length)return this.push(null);s=Math.min(s,this.length),this.push(this.slice(0,s)),this.consume(s)},o.prototype.end=function(s){n.prototype.end.call(this,s),this._callback&&(this._callback(null,this.slice()),this._callback=null)},o.prototype._destroy=function(s,r){this._bufs.length=0,this.length=0,r(s)},o.prototype._isBufferList=function(s){return s instanceof o||s instanceof i||o.isBufferList(s)},o.isBufferList=i.isBufferList,t.exports=o,t.exports.BufferListStream=o,t.exports.BufferList=i}),PM=Ze((e,t)=>{he(),Ae(),ue();var n=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};t.exports=n}),sv=Ze((e,t)=>{he(),Ae(),ue();var n=t.exports,{Buffer:g}=(Ut(),$e(Lt));n.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},n.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0},n.requiredHeaderFlagsErrors={};for(let o in n.requiredHeaderFlags){let s=n.requiredHeaderFlags[o];n.requiredHeaderFlagsErrors[o]="Invalid header flag bits, must be 0x"+s.toString(16)+" for "+n.types[o]+" packet"}n.codes={};for(let o in n.types){let s=n.types[o];n.codes[s]=o}n.CMD_SHIFT=4,n.CMD_MASK=240,n.DUP_MASK=8,n.QOS_MASK=3,n.QOS_SHIFT=1,n.RETAIN_MASK=1,n.VARBYTEINT_MASK=127,n.VARBYTEINT_FIN_MASK=128,n.VARBYTEINT_MAX=268435455,n.SESSIONPRESENT_MASK=1,n.SESSIONPRESENT_HEADER=g.from([n.SESSIONPRESENT_MASK]),n.CONNACK_HEADER=g.from([n.codes.connack<<n.CMD_SHIFT]),n.USERNAME_MASK=128,n.PASSWORD_MASK=64,n.WILL_RETAIN_MASK=32,n.WILL_QOS_MASK=24,n.WILL_QOS_SHIFT=3,n.WILL_FLAG_MASK=4,n.CLEAN_SESSION_MASK=2,n.CONNECT_HEADER=g.from([n.codes.connect<<n.CMD_SHIFT]),n.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},n.propertiesCodes={};for(let o in n.properties){let s=n.properties[o];n.propertiesCodes[s]=o}n.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function i(o){return[0,1,2].map(s=>[0,1].map(r=>[0,1].map(l=>{let I=g.alloc(1);return I.writeUInt8(n.codes[o]<<n.CMD_SHIFT|(r?n.DUP_MASK:0)|s<<n.QOS_SHIFT|l,0,!0),I})))}n.PUBLISH_HEADER=i("publish"),n.SUBSCRIBE_HEADER=i("subscribe"),n.SUBSCRIBE_OPTIONS_QOS_MASK=3,n.SUBSCRIBE_OPTIONS_NL_MASK=1,n.SUBSCRIBE_OPTIONS_NL_SHIFT=2,n.SUBSCRIBE_OPTIONS_RAP_MASK=1,n.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,n.SUBSCRIBE_OPTIONS_RH_MASK=3,n.SUBSCRIBE_OPTIONS_RH_SHIFT=4,n.SUBSCRIBE_OPTIONS_RH=[0,16,32],n.SUBSCRIBE_OPTIONS_NL=4,n.SUBSCRIBE_OPTIONS_RAP=8,n.SUBSCRIBE_OPTIONS_QOS=[0,1,2],n.UNSUBSCRIBE_HEADER=i("unsubscribe"),n.ACKS={unsuback:i("unsuback"),puback:i("puback"),pubcomp:i("pubcomp"),pubrel:i("pubrel"),pubrec:i("pubrec")},n.SUBACK_HEADER=g.from([n.codes.suback<<n.CMD_SHIFT]),n.VERSION3=g.from([3]),n.VERSION4=g.from([4]),n.VERSION5=g.from([5]),n.VERSION131=g.from([131]),n.VERSION132=g.from([132]),n.QOS=[0,1,2].map(o=>g.from([o])),n.EMPTY={pingreq:g.from([n.codes.pingreq<<4,0]),pingresp:g.from([n.codes.pingresp<<4,0]),disconnect:g.from([n.codes.disconnect<<4,0])},n.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"},n.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"},n.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},n.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"},n.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},n.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}}),OM=Ze((e,t)=>{he(),Ae(),ue();var n=1e3,g=n*60,i=g*60,o=i*24,s=o*7,r=o*365.25;t.exports=function(c,d){d=d||{};var u=typeof c;if(u==="string"&&c.length>0)return l(c);if(u==="number"&&isFinite(c))return d.long?a(c):I(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function l(c){if(c=String(c),!(c.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(d){var u=parseFloat(d[1]),h=(d[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return u*r;case"weeks":case"week":case"w":return u*s;case"days":case"day":case"d":return u*o;case"hours":case"hour":case"hrs":case"hr":case"h":return u*i;case"minutes":case"minute":case"mins":case"min":case"m":return u*g;case"seconds":case"second":case"secs":case"sec":case"s":return u*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function I(c){var d=Math.abs(c);return d>=o?Math.round(c/o)+"d":d>=i?Math.round(c/i)+"h":d>=g?Math.round(c/g)+"m":d>=n?Math.round(c/n)+"s":c+"ms"}function a(c){var d=Math.abs(c);return d>=o?C(c,d,o,"day"):d>=i?C(c,d,i,"hour"):d>=g?C(c,d,g,"minute"):d>=n?C(c,d,n,"second"):c+" ms"}function C(c,d,u,h){var f=d>=u*1.5;return Math.round(c/u)+" "+h+(f?"s":"")}}),_M=Ze((e,t)=>{he(),Ae(),ue();function n(g){o.debug=o,o.default=o,o.coerce=C,o.disable=l,o.enable=r,o.enabled=I,o.humanize=OM(),o.destroy=c,Object.keys(g).forEach(d=>{o[d]=g[d]}),o.names=[],o.skips=[],o.formatters={};function i(d){let u=0;for(let h=0;h<d.length;h++)u=(u<<5)-u+d.charCodeAt(h),u|=0;return o.colors[Math.abs(u)%o.colors.length]}o.selectColor=i;function o(d){let u,h=null,f,y;function Z(...p){if(!Z.enabled)return;let B=Z,W=Number(new Date),S=W-(u||W);B.diff=S,B.prev=u,B.curr=W,u=W,p[0]=o.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let V=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(R,J)=>{if(R==="%%")return"%";V++;let M=o.formatters[J];if(typeof M=="function"){let P=p[V];R=M.call(B,P),p.splice(V,1),V--}return R}),o.formatArgs.call(B,p),(B.log||o.log).apply(B,p)}return Z.namespace=d,Z.useColors=o.useColors(),Z.color=o.selectColor(d),Z.extend=s,Z.destroy=o.destroy,Object.defineProperty(Z,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(f!==o.namespaces&&(f=o.namespaces,y=o.enabled(d)),y),set:p=>{h=p}}),typeof o.init=="function"&&o.init(Z),Z}function s(d,u){let h=o(this.namespace+(typeof u>"u"?":":u)+d);return h.log=this.log,h}function r(d){o.save(d),o.namespaces=d,o.names=[],o.skips=[];let u,h=(typeof d=="string"?d:"").split(/[\s,]+/),f=h.length;for(u=0;u<f;u++)h[u]&&(d=h[u].replace(/\*/g,".*?"),d[0]==="-"?o.skips.push(new RegExp("^"+d.slice(1)+"$")):o.names.push(new RegExp("^"+d+"$")))}function l(){let d=[...o.names.map(a),...o.skips.map(a).map(u=>"-"+u)].join(",");return o.enable(""),d}function I(d){if(d[d.length-1]==="*")return!0;let u,h;for(u=0,h=o.skips.length;u<h;u++)if(o.skips[u].test(d))return!1;for(u=0,h=o.names.length;u<h;u++)if(o.names[u].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function C(d){return d instanceof Error?d.stack||d.message:d}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return o.enable(o.load()),o}t.exports=n}),Qg=Ze((e,t)=>{he(),Ae(),ue(),e.formatArgs=g,e.save=i,e.load=o,e.useColors=n,e.storage=s(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof on<"u"&&on.userAgent&&on.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof on<"u"&&on.userAgent&&on.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof on<"u"&&on.userAgent&&on.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function g(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;let I="color: "+this.color;l.splice(1,0,I,"color: inherit");let a=0,C=0;l[0].replace(/%[a-zA-Z%]/g,c=>{c!=="%%"&&(a++,c==="%c"&&(C=a))}),l.splice(C,0,I)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function o(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof ze<"u"&&"env"in ze&&(l=ze.env.DEBUG),l}function s(){try{return localStorage}catch{}}t.exports=_M()(e);var{formatters:r}=t.exports;r.j=function(l){try{return JSON.stringify(l)}catch(I){return"[UnexpectedJSONParseError]: "+I.message}}}),qM=Ze((e,t)=>{he(),Ae(),ue();var n=jM(),{EventEmitter:g}=(Ds(),$e(Uo)),i=PM(),o=sv(),s=Qg()("mqtt-packet:parser"),r=class nh extends g{constructor(){super(),this.parser=this.constructor.parser}static parser(I){return this instanceof nh?(this.settings=I||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new nh().parser(I)}_resetState(){s("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new i,this.error=null,this._list=n(),this._stateCounter=0}parse(I){for(this.error&&this._resetState(),this._list.append(I),s("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,s("parse: state complete. _stateCounter is now: %d",this._stateCounter),s("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return s("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let I=this._list.readUInt8(0),a=I>>o.CMD_SHIFT;this.packet.cmd=o.types[a];let C=I&15,c=o.requiredHeaderFlags[a];return c!=null&&C!==c?this._emitError(new Error(o.requiredHeaderFlagsErrors[a])):(this.packet.retain=(I&o.RETAIN_MASK)!==0,this.packet.qos=I>>o.QOS_SHIFT&o.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=(I&o.DUP_MASK)!==0,s("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let I=this._parseVarByteNum(!0);return I&&(this.packet.length=I.value,this._list.consume(I.bytes)),s("_parseLength %d",I.value),!!I}_parsePayload(){s("_parsePayload: payload %O",this._list);let I=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}I=!0}return s("_parsePayload complete result: %s",I),I}_parseConnect(){s("_parseConnect");let I,a,C,c,d={},u=this.packet,h=this._parseString();if(h===null)return this._emitError(new Error("Cannot parse protocolId"));if(h!=="MQTT"&&h!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(u.protocolId=h,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(u.protocolVersion=this._list.readUInt8(this._pos),u.protocolVersion>=128&&(u.bridgeMode=!0,u.protocolVersion=u.protocolVersion-128),u.protocolVersion!==3&&u.protocolVersion!==4&&u.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(this._list.readUInt8(this._pos)&1)return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));d.username=this._list.readUInt8(this._pos)&o.USERNAME_MASK,d.password=this._list.readUInt8(this._pos)&o.PASSWORD_MASK,d.will=this._list.readUInt8(this._pos)&o.WILL_FLAG_MASK;let f=!!(this._list.readUInt8(this._pos)&o.WILL_RETAIN_MASK),y=(this._list.readUInt8(this._pos)&o.WILL_QOS_MASK)>>o.WILL_QOS_SHIFT;if(d.will)u.will={},u.will.retain=f,u.will.qos=y;else{if(f)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(y)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(u.clean=(this._list.readUInt8(this._pos)&o.CLEAN_SESSION_MASK)!==0,this._pos++,u.keepalive=this._parseNum(),u.keepalive===-1)return this._emitError(new Error("Packet too short"));if(u.protocolVersion===5){let p=this._parseProperties();Object.getOwnPropertyNames(p).length&&(u.properties=p)}let Z=this._parseString();if(Z===null)return this._emitError(new Error("Packet too short"));if(u.clientId=Z,s("_parseConnect: packet.clientId: %s",u.clientId),d.will){if(u.protocolVersion===5){let p=this._parseProperties();Object.getOwnPropertyNames(p).length&&(u.will.properties=p)}if(I=this._parseString(),I===null)return this._emitError(new Error("Cannot parse will topic"));if(u.will.topic=I,s("_parseConnect: packet.will.topic: %s",u.will.topic),a=this._parseBuffer(),a===null)return this._emitError(new Error("Cannot parse will payload"));u.will.payload=a,s("_parseConnect: packet.will.paylaod: %s",u.will.payload)}if(d.username){if(c=this._parseString(),c===null)return this._emitError(new Error("Cannot parse username"));u.username=c,s("_parseConnect: packet.username: %s",u.username)}if(d.password){if(C=this._parseBuffer(),C===null)return this._emitError(new Error("Cannot parse password"));u.password=C}return this.settings=u,s("_parseConnect: complete"),u}_parseConnack(){s("_parseConnack");let I=this.packet;if(this._list.length<1)return null;let a=this._list.readUInt8(this._pos++);if(a>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(I.sessionPresent=!!(a&o.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?I.reasonCode=this._list.readUInt8(this._pos++):I.reasonCode=0;else{if(this._list.length<2)return null;I.returnCode=this._list.readUInt8(this._pos++)}if(I.returnCode===-1||I.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){let C=this._parseProperties();Object.getOwnPropertyNames(C).length&&(I.properties=C)}s("_parseConnack: complete")}_parsePublish(){s("_parsePublish");let I=this.packet;if(I.topic=this._parseString(),I.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(I.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){let a=this._parseProperties();Object.getOwnPropertyNames(a).length&&(I.properties=a)}I.payload=this._list.slice(this._pos,I.length),s("_parsePublish: payload from buffer list: %o",I.payload)}}_parseSubscribe(){s("_parseSubscribe");let I=this.packet,a,C,c,d,u,h,f;if(I.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let y=this._parseProperties();Object.getOwnPropertyNames(y).length&&(I.properties=y)}if(I.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<I.length;){if(a=this._parseString(),a===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=I.length)return this._emitError(new Error("Malformed Subscribe Payload"));if(C=this._parseByte(),this.settings.protocolVersion===5){if(C&192)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if(C&252)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(c=C&o.SUBSCRIBE_OPTIONS_QOS_MASK,c>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(h=(C>>o.SUBSCRIBE_OPTIONS_NL_SHIFT&o.SUBSCRIBE_OPTIONS_NL_MASK)!==0,u=(C>>o.SUBSCRIBE_OPTIONS_RAP_SHIFT&o.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,d=C>>o.SUBSCRIBE_OPTIONS_RH_SHIFT&o.SUBSCRIBE_OPTIONS_RH_MASK,d>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));f={topic:a,qos:c},this.settings.protocolVersion===5?(f.nl=h,f.rap=u,f.rh=d):this.settings.bridgeMode&&(f.rh=0,f.rap=!0,f.nl=!0),s("_parseSubscribe: push subscription `%s` to subscription",f),I.subscriptions.push(f)}}}_parseSuback(){s("_parseSuback");let I=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let a=this._parseProperties();Object.getOwnPropertyNames(a).length&&(I.properties=a)}if(I.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let a=this._list.readUInt8(this._pos++);if(this.settings.protocolVersion===5){if(!o.MQTT5_SUBACK_CODES[a])return this._emitError(new Error("Invalid suback code"))}else if(a>2&&a!==128)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(a)}}}_parseUnsubscribe(){s("_parseUnsubscribe");let I=this.packet;if(I.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let a=this._parseProperties();Object.getOwnPropertyNames(a).length&&(I.properties=a)}if(I.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<I.length;){let a=this._parseString();if(a===null)return this._emitError(new Error("Cannot parse topic"));s("_parseUnsubscribe: push topic `%s` to unsubscriptions",a),I.unsubscriptions.push(a)}}}_parseUnsuback(){s("_parseUnsuback");let I=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((this.settings.protocolVersion===3||this.settings.protocolVersion===4)&&I.length!==2)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(I.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(this.settings.protocolVersion===5){let a=this._parseProperties();for(Object.getOwnPropertyNames(a).length&&(I.properties=a),I.granted=[];this._pos<this.packet.length;){let C=this._list.readUInt8(this._pos++);if(!o.MQTT5_UNSUBACK_CODES[C])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push(C)}}}_parseConfirmation(){s("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let I=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5){if(I.length>2){switch(I.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!o.MQTT5_PUBACK_PUBREC_CODES[I.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!o.MQTT5_PUBREL_PUBCOMP_CODES[I.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break}s("_parseConfirmation: packet.reasonCode `%d`",I.reasonCode)}else I.reasonCode=0;if(I.length>3){let a=this._parseProperties();Object.getOwnPropertyNames(a).length&&(I.properties=a)}}return!0}_parseDisconnect(){let I=this.packet;if(s("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?(I.reasonCode=this._parseByte(),o.MQTT5_DISCONNECT_CODES[I.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):I.reasonCode=0;let a=this._parseProperties();Object.getOwnPropertyNames(a).length&&(I.properties=a)}return s("_parseDisconnect result: true"),!0}_parseAuth(){s("_parseAuth");let I=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(I.reasonCode=this._parseByte(),!o.MQTT5_AUTH_CODES[I.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let a=this._parseProperties();return Object.getOwnPropertyNames(a).length&&(I.properties=a),s("_parseAuth: result: true"),!0}_parseMessageId(){let I=this.packet;return I.messageId=this._parseNum(),I.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(s("_parseMessageId: packet.messageId %d",I.messageId),!0)}_parseString(I){let a=this._parseNum(),C=a+this._pos;if(a===-1||C>this._list.length||C>this.packet.length)return null;let c=this._list.toString("utf8",this._pos,C);return this._pos+=a,s("_parseString: result: %s",c),c}_parseStringPair(){return s("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let I=this._parseNum(),a=I+this._pos;if(I===-1||a>this._list.length||a>this.packet.length)return null;let C=this._list.slice(this._pos,a);return this._pos+=I,s("_parseBuffer: result: %o",C),C}_parseNum(){if(this._list.length-this._pos<2)return-1;let I=this._list.readUInt16BE(this._pos);return this._pos+=2,s("_parseNum: result: %s",I),I}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let I=this._list.readUInt32BE(this._pos);return this._pos+=4,s("_parse4ByteNum: result: %s",I),I}_parseVarByteNum(I){s("_parseVarByteNum");let a=4,C=0,c=1,d=0,u=!1,h,f=this._pos?this._pos:0;for(;C<a&&f+C<this._list.length;){if(h=this._list.readUInt8(f+C++),d+=c*(h&o.VARBYTEINT_MASK),c*=128,!(h&o.VARBYTEINT_FIN_MASK)){u=!0;break}if(this._list.length<=C)break}return!u&&C===a&&this._list.length>=C&&this._emitError(new Error("Invalid variable byte integer")),f&&(this._pos+=C),u?I?u={bytes:C,value:d}:u=d:u=!1,s("_parseVarByteNum: result: %o",u),u}_parseByte(){let I;return this._pos<this._list.length&&(I=this._list.readUInt8(this._pos),this._pos++),s("_parseByte: result: %o",I),I}_parseByType(I){switch(s("_parseByType: type: %s",I),I){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){s("_parseProperties");let I=this._parseVarByteNum(),a=this._pos+I,C={};for(;this._pos<a;){let c=this._parseByte();if(!c)return this._emitError(new Error("Cannot parse property code type")),!1;let d=o.propertiesCodes[c];if(!d)return this._emitError(new Error("Unknown property")),!1;if(d==="userProperties"){C[d]||(C[d]=Object.create(null));let u=this._parseByType(o.propertiesTypes[d]);if(C[d][u.name])if(Array.isArray(C[d][u.name]))C[d][u.name].push(u.value);else{let h=C[d][u.name];C[d][u.name]=[h],C[d][u.name].push(u.value)}else C[d][u.name]=u.value;continue}C[d]?Array.isArray(C[d])?C[d].push(this._parseByType(o.propertiesTypes[d])):(C[d]=[C[d]],C[d].push(this._parseByType(o.propertiesTypes[d]))):C[d]=this._parseByType(o.propertiesTypes[d])}return C}_newPacket(){return s("_newPacket"),this.packet&&(this._list.consume(this.packet.length),s("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),s("_newPacket: new packet"),this.packet=new i,this._pos=0,!0}_emitError(I){s("_emitError",I),this.error=I,this.emit("error",I)}};t.exports=r}),$M=Ze((e,t)=>{he(),Ae(),ue();var{Buffer:n}=(Ut(),$e(Lt)),g=65536,i={},o=n.isBuffer(n.from([1,2]).subarray(0,1));function s(a){let C=n.allocUnsafe(2);return C.writeUInt8(a>>8,0),C.writeUInt8(a&255,1),C}function r(){for(let a=0;a<g;a++)i[a]=s(a)}function l(a){let C=0,c=0,d=n.allocUnsafe(4);do C=a%128|0,a=a/128|0,a>0&&(C=C|128),d.writeUInt8(C,c++);while(a>0&&c<4);return a>0&&(c=0),o?d.subarray(0,c):d.slice(0,c)}function I(a){let C=n.allocUnsafe(4);return C.writeUInt32BE(a,0),C}t.exports={cache:i,generateCache:r,generateNumber:s,genBufVariableByteInt:l,generate4ByteBuffer:I}}),eT=Ze((e,t)=>{he(),Ae(),ue(),typeof ze>"u"||!ze.version||ze.version.indexOf("v0.")===0||ze.version.indexOf("v1.")===0&&ze.version.indexOf("v1.8.")!==0?t.exports={nextTick:n}:t.exports=ze;function n(g,i,o,s){if(typeof g!="function")throw new TypeError('"callback" argument must be a function');var r=arguments.length,l,I;switch(r){case 0:case 1:return ze.nextTick(g);case 2:return ze.nextTick(function(){g.call(null,i)});case 3:return ze.nextTick(function(){g.call(null,i,o)});case 4:return ze.nextTick(function(){g.call(null,i,o,s)});default:for(l=new Array(r-1),I=0;I<l.length;)l[I++]=arguments[I];return ze.nextTick(function(){g.apply(null,l)})}}}),rv=Ze((e,t)=>{he(),Ae(),ue();var n=sv(),{Buffer:g}=(Ut(),$e(Lt)),i=g.allocUnsafe(0),o=g.from([0]),s=$M(),r=eT().nextTick,l=Qg()("mqtt-packet:writeToStream"),I=s.cache,a=s.generateNumber,C=s.generateCache,c=s.genBufVariableByteInt,d=s.generate4ByteBuffer,u=ge,h=!0;function f(K,w,ee){switch(l("generate called"),w.cork&&(w.cork(),r(y,w)),h&&(h=!1,C()),l("generate: packet.cmd: %s",K.cmd),K.cmd){case"connect":return Z(K,w);case"connack":return p(K,w,ee);case"publish":return B(K,w,ee);case"puback":case"pubrec":case"pubrel":case"pubcomp":return W(K,w,ee);case"subscribe":return S(K,w,ee);case"suback":return V(K,w,ee);case"unsubscribe":return R(K,w,ee);case"unsuback":return J(K,w,ee);case"pingreq":case"pingresp":return M(K,w);case"disconnect":return P(K,w,ee);case"auth":return X(K,w,ee);default:return w.destroy(new Error("Unknown command")),!1}}Object.defineProperty(f,"cacheNumbers",{get(){return u===ge},set(K){K?((!I||Object.keys(I).length===0)&&(h=!0),u=ge):(h=!1,u=N)}});function y(K){K.uncork()}function Z(K,w,ee){let be=K||{},ae=be.protocolId||"MQTT",re=be.protocolVersion||4,ye=be.will,pe=be.clean,x=be.keepalive||0,z=be.clientId||"",Q=be.username,ce=be.password,se=be.properties;pe===void 0&&(pe=!0);let T=0;if(!ae||typeof ae!="string"&&!g.isBuffer(ae))return w.destroy(new Error("Invalid protocolId")),!1;if(T+=ae.length+2,re!==3&&re!==4&&re!==5)return w.destroy(new Error("Invalid protocol version")),!1;if(T+=1,(typeof z=="string"||g.isBuffer(z))&&(z||re>=4)&&(z||pe))T+=g.byteLength(z)+2;else{if(re<4)return w.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(pe*1===0)return w.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof x!="number"||x<0||x>65535||x%1!==0)return w.destroy(new Error("Invalid keepalive")),!1;T+=2,T+=1;let _,F;if(re===5){if(_=me(w,se),!_)return!1;T+=_.length}if(ye){if(typeof ye!="object")return w.destroy(new Error("Invalid will")),!1;if(!ye.topic||typeof ye.topic!="string")return w.destroy(new Error("Invalid will topic")),!1;if(T+=g.byteLength(ye.topic)+2,T+=2,ye.payload)if(ye.payload.length>=0)typeof ye.payload=="string"?T+=g.byteLength(ye.payload):T+=ye.payload.length;else return w.destroy(new Error("Invalid will payload")),!1;if(F={},re===5){if(F=me(w,ye.properties),!F)return!1;T+=F.length}}let U=!1;if(Q!=null)if(Ie(Q))U=!0,T+=g.byteLength(Q)+2;else return w.destroy(new Error("Invalid username")),!1;if(ce!=null){if(!U)return w.destroy(new Error("Username is required to use password")),!1;if(Ie(ce))T+=Be(ce)+2;else return w.destroy(new Error("Invalid password")),!1}w.write(n.CONNECT_HEADER),ne(w,T),q(w,ae),be.bridgeMode&&(re+=128),w.write(re===131?n.VERSION131:re===132?n.VERSION132:re===4?n.VERSION4:re===5?n.VERSION5:n.VERSION3);let O=0;return O|=Q!=null?n.USERNAME_MASK:0,O|=ce!=null?n.PASSWORD_MASK:0,O|=ye&&ye.retain?n.WILL_RETAIN_MASK:0,O|=ye&&ye.qos?ye.qos<<n.WILL_QOS_SHIFT:0,O|=ye?n.WILL_FLAG_MASK:0,O|=pe?n.CLEAN_SESSION_MASK:0,w.write(g.from([O])),u(w,x),re===5&&_.write(),q(w,z),ye&&(re===5&&F.write(),D(w,ye.topic),q(w,ye.payload)),Q!=null&&q(w,Q),ce!=null&&q(w,ce),!0}function p(K,w,ee){let be=ee?ee.protocolVersion:4,ae=K||{},re=be===5?ae.reasonCode:ae.returnCode,ye=ae.properties,pe=2;if(typeof re!="number")return w.destroy(new Error("Invalid return code")),!1;let x=null;if(be===5){if(x=me(w,ye),!x)return!1;pe+=x.length}return w.write(n.CONNACK_HEADER),ne(w,pe),w.write(ae.sessionPresent?n.SESSIONPRESENT_HEADER:o),w.write(g.from([re])),x==null||x.write(),!0}function B(K,w,ee){l("publish: packet: %o",K);let be=ee?ee.protocolVersion:4,ae=K||{},re=ae.qos||0,ye=ae.retain?n.RETAIN_MASK:0,pe=ae.topic,x=ae.payload||i,z=ae.messageId,Q=ae.properties,ce=0;if(typeof pe=="string")ce+=g.byteLength(pe)+2;else if(g.isBuffer(pe))ce+=pe.length+2;else return w.destroy(new Error("Invalid topic")),!1;if(g.isBuffer(x)?ce+=x.length:ce+=g.byteLength(x),re&&typeof z!="number")return w.destroy(new Error("Invalid messageId")),!1;re&&(ce+=2);let se=null;if(be===5){if(se=me(w,Q),!se)return!1;ce+=se.length}return w.write(n.PUBLISH_HEADER[re][ae.dup?1:0][ye?1:0]),ne(w,ce),u(w,Be(pe)),w.write(pe),re>0&&u(w,z),se==null||se.write(),l("publish: payload: %o",x),w.write(x)}function W(K,w,ee){let be=ee?ee.protocolVersion:4,ae=K||{},re=ae.cmd||"puback",ye=ae.messageId,pe=ae.dup&&re==="pubrel"?n.DUP_MASK:0,x=0,z=ae.reasonCode,Q=ae.properties,ce=be===5?3:2;if(re==="pubrel"&&(x=1),typeof ye!="number")return w.destroy(new Error("Invalid messageId")),!1;let se=null;if(be===5&&typeof Q=="object"){if(se=v(w,Q,ee,ce),!se)return!1;ce+=se.length}return w.write(n.ACKS[re][x][pe][0]),ce===3&&(ce+=z!==0?1:-1),ne(w,ce),u(w,ye),be===5&&ce!==2&&w.write(g.from([z])),se!==null?se.write():ce===4&&w.write(g.from([0])),!0}function S(K,w,ee){l("subscribe: packet: ");let be=ee?ee.protocolVersion:4,ae=K||{},re=ae.dup?n.DUP_MASK:0,ye=ae.messageId,pe=ae.subscriptions,x=ae.properties,z=0;if(typeof ye!="number")return w.destroy(new Error("Invalid messageId")),!1;z+=2;let Q=null;if(be===5){if(Q=me(w,x),!Q)return!1;z+=Q.length}if(typeof pe=="object"&&pe.length)for(let se=0;se<pe.length;se+=1){let T=pe[se].topic,_=pe[se].qos;if(typeof T!="string")return w.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if(typeof _!="number")return w.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(be===5){if(typeof(pe[se].nl||!1)!="boolean")return w.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(pe[se].rap||!1)!="boolean")return w.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let F=pe[se].rh||0;if(typeof F!="number"||F>2)return w.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}z+=g.byteLength(T)+2+1}else return w.destroy(new Error("Invalid subscriptions")),!1;l("subscribe: writing to stream: %o",n.SUBSCRIBE_HEADER),w.write(n.SUBSCRIBE_HEADER[1][re?1:0][0]),ne(w,z),u(w,ye),Q!==null&&Q.write();let ce=!0;for(let se of pe){let T=se.topic,_=se.qos,F=+se.nl,U=+se.rap,O=se.rh,de;D(w,T),de=n.SUBSCRIBE_OPTIONS_QOS[_],be===5&&(de|=F?n.SUBSCRIBE_OPTIONS_NL:0,de|=U?n.SUBSCRIBE_OPTIONS_RAP:0,de|=O?n.SUBSCRIBE_OPTIONS_RH[O]:0),ce=w.write(g.from([de]))}return ce}function V(K,w,ee){let be=ee?ee.protocolVersion:4,ae=K||{},re=ae.messageId,ye=ae.granted,pe=ae.properties,x=0;if(typeof re!="number")return w.destroy(new Error("Invalid messageId")),!1;if(x+=2,typeof ye=="object"&&ye.length)for(let Q=0;Q<ye.length;Q+=1){if(typeof ye[Q]!="number")return w.destroy(new Error("Invalid qos vector")),!1;x+=1}else return w.destroy(new Error("Invalid qos vector")),!1;let z=null;if(be===5){if(z=v(w,pe,ee,x),!z)return!1;x+=z.length}return w.write(n.SUBACK_HEADER),ne(w,x),u(w,re),z!==null&&z.write(),w.write(g.from(ye))}function R(K,w,ee){let be=ee?ee.protocolVersion:4,ae=K||{},re=ae.messageId,ye=ae.dup?n.DUP_MASK:0,pe=ae.unsubscriptions,x=ae.properties,z=0;if(typeof re!="number")return w.destroy(new Error("Invalid messageId")),!1;if(z+=2,typeof pe=="object"&&pe.length)for(let se=0;se<pe.length;se+=1){if(typeof pe[se]!="string")return w.destroy(new Error("Invalid unsubscriptions")),!1;z+=g.byteLength(pe[se])+2}else return w.destroy(new Error("Invalid unsubscriptions")),!1;let Q=null;if(be===5){if(Q=me(w,x),!Q)return!1;z+=Q.length}w.write(n.UNSUBSCRIBE_HEADER[1][ye?1:0][0]),ne(w,z),u(w,re),Q!==null&&Q.write();let ce=!0;for(let se=0;se<pe.length;se++)ce=D(w,pe[se]);return ce}function J(K,w,ee){let be=ee?ee.protocolVersion:4,ae=K||{},re=ae.messageId,ye=ae.dup?n.DUP_MASK:0,pe=ae.granted,x=ae.properties,z=ae.cmd,Q=0,ce=2;if(typeof re!="number")return w.destroy(new Error("Invalid messageId")),!1;if(be===5)if(typeof pe=="object"&&pe.length)for(let T=0;T<pe.length;T+=1){if(typeof pe[T]!="number")return w.destroy(new Error("Invalid qos vector")),!1;ce+=1}else return w.destroy(new Error("Invalid qos vector")),!1;let se=null;if(be===5){if(se=v(w,x,ee,ce),!se)return!1;ce+=se.length}return w.write(n.ACKS[z][Q][ye][0]),ne(w,ce),u(w,re),se!==null&&se.write(),be===5&&w.write(g.from(pe)),!0}function M(K,w,ee){return w.write(n.EMPTY[K.cmd])}function P(K,w,ee){let be=ee?ee.protocolVersion:4,ae=K||{},re=ae.reasonCode,ye=ae.properties,pe=be===5?1:0,x=null;if(be===5){if(x=v(w,ye,ee,pe),!x)return!1;pe+=x.length}return w.write(g.from([n.codes.disconnect<<4])),ne(w,pe),be===5&&w.write(g.from([re])),x!==null&&x.write(),!0}function X(K,w,ee){let be=ee?ee.protocolVersion:4,ae=K||{},re=ae.reasonCode,ye=ae.properties,pe=be===5?1:0;be!==5&&w.destroy(new Error("Invalid mqtt version for auth packet"));let x=v(w,ye,ee,pe);return x?(pe+=x.length,w.write(g.from([n.codes.auth<<4])),ne(w,pe),w.write(g.from([re])),x!==null&&x.write(),!0):!1}var L={};function ne(K,w){if(w>n.VARBYTEINT_MAX)return K.destroy(new Error(`Invalid variable byte integer: ${w}`)),!1;let ee=L[w];return ee||(ee=c(w),w<16384&&(L[w]=ee)),l("writeVarByteInt: writing to stream: %o",ee),K.write(ee)}function D(K,w){let ee=g.byteLength(w);return u(K,ee),l("writeString: %s",w),K.write(w,"utf8")}function ie(K,w,ee){D(K,w),D(K,ee)}function ge(K,w){return l("writeNumberCached: number: %d",w),l("writeNumberCached: %o",I[w]),K.write(I[w])}function N(K,w){let ee=a(w);return l("writeNumberGenerated: %o",ee),K.write(ee)}function te(K,w){let ee=d(w);return l("write4ByteNumber: %o",ee),K.write(ee)}function q(K,w){typeof w=="string"?D(K,w):w?(u(K,w.length),K.write(w)):u(K,0)}function me(K,w){if(typeof w!="object"||w.length!=null)return{length:1,write(){Ce(K,{},0)}};let ee=0;function be(ae,re){let ye=n.propertiesTypes[ae],pe=0;switch(ye){case"byte":{if(typeof re!="boolean")return K.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;pe+=2;break}case"int8":{if(typeof re!="number"||re<0||re>255)return K.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;pe+=2;break}case"binary":{if(re&&re===null)return K.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;pe+=1+g.byteLength(re)+2;break}case"int16":{if(typeof re!="number"||re<0||re>65535)return K.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;pe+=3;break}case"int32":{if(typeof re!="number"||re<0||re>4294967295)return K.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;pe+=5;break}case"var":{if(typeof re!="number"||re<0||re>268435455)return K.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;pe+=1+g.byteLength(c(re));break}case"string":{if(typeof re!="string")return K.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;pe+=3+g.byteLength(re.toString());break}case"pair":{if(typeof re!="object")return K.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;pe+=Object.getOwnPropertyNames(re).reduce((x,z)=>{let Q=re[z];return Array.isArray(Q)?x+=Q.reduce((ce,se)=>(ce+=3+g.byteLength(z.toString())+2+g.byteLength(se.toString()),ce),0):x+=3+g.byteLength(z.toString())+2+g.byteLength(re[z].toString()),x},0);break}default:return K.destroy(new Error(`Invalid property ${ae}: ${re}`)),!1}return pe}if(w)for(let ae in w){let re=0,ye=0,pe=w[ae];if(Array.isArray(pe))for(let x=0;x<pe.length;x++){if(ye=be(ae,pe[x]),!ye)return!1;re+=ye}else{if(ye=be(ae,pe),!ye)return!1;re=ye}if(!re)return!1;ee+=re}return{length:g.byteLength(c(ee))+ee,write(){Ce(K,w,ee)}}}function v(K,w,ee,be){let ae=["reasonString","userProperties"],re=ee&&ee.properties&&ee.properties.maximumPacketSize?ee.properties.maximumPacketSize:0,ye=me(K,w);if(re)for(;be+ye.length>re;){let pe=ae.shift();if(pe&&w[pe])delete w[pe],ye=me(K,w);else return!1}return ye}function $(K,w,ee){switch(n.propertiesTypes[w]){case"byte":{K.write(g.from([n.properties[w]])),K.write(g.from([+ee]));break}case"int8":{K.write(g.from([n.properties[w]])),K.write(g.from([ee]));break}case"binary":{K.write(g.from([n.properties[w]])),q(K,ee);break}case"int16":{K.write(g.from([n.properties[w]])),u(K,ee);break}case"int32":{K.write(g.from([n.properties[w]])),te(K,ee);break}case"var":{K.write(g.from([n.properties[w]])),ne(K,ee);break}case"string":{K.write(g.from([n.properties[w]])),D(K,ee);break}case"pair":{Object.getOwnPropertyNames(ee).forEach(be=>{let ae=ee[be];Array.isArray(ae)?ae.forEach(re=>{K.write(g.from([n.properties[w]])),ie(K,be.toString(),re.toString())}):(K.write(g.from([n.properties[w]])),ie(K,be.toString(),ae.toString()))});break}default:return K.destroy(new Error(`Invalid property ${w} value: ${ee}`)),!1}}function Ce(K,w,ee){ne(K,ee);for(let be in w)if(Object.prototype.hasOwnProperty.call(w,be)&&w[be]!==null){let ae=w[be];if(Array.isArray(ae))for(let re=0;re<ae.length;re++)$(K,be,ae[re]);else $(K,be,ae)}}function Be(K){return K?K instanceof g?K.length:g.byteLength(K):0}function Ie(K){return typeof K=="string"||K instanceof g}t.exports=f}),tT=Ze((e,t)=>{he(),Ae(),ue();var n=rv(),{EventEmitter:g}=(Ds(),$e(Uo)),{Buffer:i}=(Ut(),$e(Lt));function o(r,l){let I=new s;return n(r,I,l),I.concat()}var s=class extends g{constructor(){super(),this._array=new Array(20),this._i=0}write(r){return this._array[this._i++]=r,!0}concat(){let r=0,l=new Array(this._array.length),I=this._array,a=0,C;for(C=0;C<I.length&&I[C]!==void 0;C++)typeof I[C]!="string"?l[C]=I[C].length:l[C]=i.byteLength(I[C]),r+=l[C];let c=i.allocUnsafe(r);for(C=0;C<I.length&&I[C]!==void 0;C++)typeof I[C]!="string"?(I[C].copy(c,a),a+=l[C]):(c.write(I[C],a),a+=l[C]);return c}destroy(r){r&&this.emit("error",r)}};t.exports=o}),nT=Ze(e=>{he(),Ae(),ue(),e.parser=qM().parser,e.generate=tT(),e.writeToStream=rv()}),lv=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=class{constructor(){this.nextId=Math.max(1,Math.floor(Math.random()*65535))}allocate(){let n=this.nextId++;return this.nextId===65536&&(this.nextId=1),n}getLastAllocated(){return this.nextId===1?65535:this.nextId-1}register(n){return!0}deallocate(n){}clear(){}};e.default=t}),gT=Ze((e,t)=>{he(),Ae(),ue(),t.exports=g;function n(o){return o instanceof qa?qa.from(o):new o.constructor(o.buffer.slice(),o.byteOffset,o.length)}function g(o){if(o=o||{},o.circles)return i(o);return o.proto?l:r;function s(I,a){for(var C=Object.keys(I),c=new Array(C.length),d=0;d<C.length;d++){var u=C[d],h=I[u];typeof h!="object"||h===null?c[u]=h:h instanceof Date?c[u]=new Date(h):ArrayBuffer.isView(h)?c[u]=n(h):c[u]=a(h)}return c}function r(I){if(typeof I!="object"||I===null)return I;if(I instanceof Date)return new Date(I);if(Array.isArray(I))return s(I,r);if(I instanceof Map)return new Map(s(Array.from(I),r));if(I instanceof Set)return new Set(s(Array.from(I),r));var a={};for(var C in I)if(Object.hasOwnProperty.call(I,C)!==!1){var c=I[C];typeof c!="object"||c===null?a[C]=c:c instanceof Date?a[C]=new Date(c):c instanceof Map?a[C]=new Map(s(Array.from(c),r)):c instanceof Set?a[C]=new Set(s(Array.from(c),r)):ArrayBuffer.isView(c)?a[C]=n(c):a[C]=r(c)}return a}function l(I){if(typeof I!="object"||I===null)return I;if(I instanceof Date)return new Date(I);if(Array.isArray(I))return s(I,l);if(I instanceof Map)return new Map(s(Array.from(I),l));if(I instanceof Set)return new Set(s(Array.from(I),l));var a={};for(var C in I){var c=I[C];typeof c!="object"||c===null?a[C]=c:c instanceof Date?a[C]=new Date(c):c instanceof Map?a[C]=new Map(s(Array.from(c),l)):c instanceof Set?a[C]=new Set(s(Array.from(c),l)):ArrayBuffer.isView(c)?a[C]=n(c):a[C]=l(c)}return a}}function i(o){var s=[],r=[];return o.proto?a:I;function l(C,c){for(var d=Object.keys(C),u=new Array(d.length),h=0;h<d.length;h++){var f=d[h],y=C[f];if(typeof y!="object"||y===null)u[f]=y;else if(y instanceof Date)u[f]=new Date(y);else if(ArrayBuffer.isView(y))u[f]=n(y);else{var Z=s.indexOf(y);Z!==-1?u[f]=r[Z]:u[f]=c(y)}}return u}function I(C){if(typeof C!="object"||C===null)return C;if(C instanceof Date)return new Date(C);if(Array.isArray(C))return l(C,I);if(C instanceof Map)return new Map(l(Array.from(C),I));if(C instanceof Set)return new Set(l(Array.from(C),I));var c={};s.push(C),r.push(c);for(var d in C)if(Object.hasOwnProperty.call(C,d)!==!1){var u=C[d];if(typeof u!="object"||u===null)c[d]=u;else if(u instanceof Date)c[d]=new Date(u);else if(u instanceof Map)c[d]=new Map(l(Array.from(u),I));else if(u instanceof Set)c[d]=new Set(l(Array.from(u),I));else if(ArrayBuffer.isView(u))c[d]=n(u);else{var h=s.indexOf(u);h!==-1?c[d]=r[h]:c[d]=I(u)}}return s.pop(),r.pop(),c}function a(C){if(typeof C!="object"||C===null)return C;if(C instanceof Date)return new Date(C);if(Array.isArray(C))return l(C,a);if(C instanceof Map)return new Map(l(Array.from(C),a));if(C instanceof Set)return new Set(l(Array.from(C),a));var c={};s.push(C),r.push(c);for(var d in C){var u=C[d];if(typeof u!="object"||u===null)c[d]=u;else if(u instanceof Date)c[d]=new Date(u);else if(u instanceof Map)c[d]=new Map(l(Array.from(u),a));else if(u instanceof Set)c[d]=new Set(l(Array.from(u),a));else if(ArrayBuffer.isView(u))c[d]=n(u);else{var h=s.indexOf(u);h!==-1?c[d]=r[h]:c[d]=a(u)}}return s.pop(),r.pop(),c}}}),iT=Ze((e,t)=>{he(),Ae(),ue(),t.exports=gT()()}),oT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0}),e.validateTopics=e.validateTopic=void 0;function t(g){let i=g.split("/");for(let o=0;o<i.length;o++)if(i[o]!=="+"){if(i[o]==="#")return o===i.length-1;if(i[o].indexOf("+")!==-1||i[o].indexOf("#")!==-1)return!1}return!0}e.validateTopic=t;function n(g){if(g.length===0)return"empty_topic_list";for(let i=0;i<g.length;i++)if(!t(g[i]))return g[i];return null}e.validateTopics=n}),Iv=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=zo(),n={objectMode:!0},g={clean:!0},i=class{constructor(o){this.options=o||{},this.options=Object.assign(Object.assign({},g),o),this._inflights=new Map}put(o,s){return this._inflights.set(o.messageId,o),s&&s(),this}createStream(){let o=new t.Readable(n),s=[],r=!1,l=0;return this._inflights.forEach((I,a)=>{s.push(I)}),o._read=()=>{!r&&l<s.length?o.push(s[l++]):o.push(null)},o.destroy=I=>{if(!r)return r=!0,setTimeout(()=>{o.emit("close")},0),o},o}del(o,s){let r=this._inflights.get(o.messageId);return r?(this._inflights.delete(o.messageId),s(null,r)):s&&s(new Error("missing packet")),this}get(o,s){let r=this._inflights.get(o.messageId);return r?s(null,r):s&&s(new Error("missing packet")),this}close(o){this.options.clean&&(this._inflights=null),o&&o()}};e.default=i}),sT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=[0,16,128,131,135,144,145,151,153],n=(g,i,o)=>{g.log("handlePublish: packet %o",i),o=typeof o<"u"?o:g.noop;let s=i.topic.toString(),r=i.payload,{qos:l}=i,{messageId:I}=i,{options:a}=g;if(g.options.protocolVersion===5){let C;if(i.properties&&(C=i.properties.topicAlias),typeof C<"u")if(s.length===0)if(C>0&&C<=65535){let c=g.topicAliasRecv.getTopicByAlias(C);if(c)s=c,g.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",s,C);else{g.log("handlePublish :: unregistered topic alias. alias: %d",C),g.emit("error",new Error("Received unregistered Topic Alias"));return}}else{g.log("handlePublish :: topic alias out of range. alias: %d",C),g.emit("error",new Error("Received Topic Alias is out of range"));return}else if(g.topicAliasRecv.put(s,C))g.log("handlePublish :: registered topic: %s - alias: %d",s,C);else{g.log("handlePublish :: topic alias out of range. alias: %d",C),g.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(g.log("handlePublish: qos %d",l),l){case 2:{a.customHandleAcks(s,r,i,(C,c)=>{if(typeof C=="number"&&(c=C,C=null),C)return g.emit("error",C);if(t.indexOf(c)===-1)return g.emit("error",new Error("Wrong reason code for pubrec"));c?g._sendPacket({cmd:"pubrec",messageId:I,reasonCode:c},o):g.incomingStore.put(i,()=>{g._sendPacket({cmd:"pubrec",messageId:I},o)})});break}case 1:{a.customHandleAcks(s,r,i,(C,c)=>{if(typeof C=="number"&&(c=C,C=null),C)return g.emit("error",C);if(t.indexOf(c)===-1)return g.emit("error",new Error("Wrong reason code for puback"));c||g.emit("message",s,r,i),g.handleMessage(i,d=>{if(d)return o&&o(d);g._sendPacket({cmd:"puback",messageId:I,reasonCode:c},o)})});break}case 0:g.emit("message",s,r,i),g.handleMessage(i,o);break;default:g.log("handlePublish: unknown QoS. Doing nothing.");break}};e.default=n}),rT=Ze((e,t)=>{t.exports={version:"5.7.3"}}),El=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0}),e.MQTTJS_VERSION=e.nextTick=e.applyMixin=e.ErrorWithReasonCode=void 0;var t=class av extends Error{constructor(i,o){super(i),this.code=o,Object.setPrototypeOf(this,av.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};e.ErrorWithReasonCode=t;function n(g,i,o=!1){var s;let r=[i];for(;;){let l=r[0],I=Object.getPrototypeOf(l);if(I!=null&&I.prototype)r.unshift(I);else break}for(let l of r)for(let I of Object.getOwnPropertyNames(l.prototype))(o||I!=="constructor")&&Object.defineProperty(g.prototype,I,(s=Object.getOwnPropertyDescriptor(l.prototype,I))!==null&&s!==void 0?s:Object.create(null))}e.applyMixin=n,e.nextTick=typeof(ze==null?void 0:ze.nextTick)=="function"?ze.nextTick:g=>{setTimeout(g,0)},e.MQTTJS_VERSION=rT().version}),$C=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0}),e.ReasonCodes=void 0,e.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};var t=(n,g)=>{let{messageId:i}=g,o=g.cmd,s=null,r=n.outgoing[i]?n.outgoing[i].cb:null,l=null;if(!r){n.log("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(n.log("_handleAck :: packet type",o),o){case"pubcomp":case"puback":{let I=g.reasonCode;I&&I>0&&I!==16?(l=new Error(`Publish error: ${e.ReasonCodes[I]}`),l.code=I,n._removeOutgoingAndStoreMessage(i,()=>{r(l,g)})):n._removeOutgoingAndStoreMessage(i,r);break}case"pubrec":{s={cmd:"pubrel",qos:2,messageId:i};let I=g.reasonCode;I&&I>0&&I!==16?(l=new Error(`Publish error: ${e.ReasonCodes[I]}`),l.code=I,n._removeOutgoingAndStoreMessage(i,()=>{r(l,g)})):n._sendPacket(s);break}case"suback":{delete n.outgoing[i],n.messageIdProvider.deallocate(i);let I=g.granted;for(let a=0;a<I.length;a++){let C=I[a];if(C&128){l=new Error(`Subscribe error: ${e.ReasonCodes[C]}`),l.code=C;let c=n.messageIdToTopic[i];c&&c.forEach(d=>{delete n._resubscribeTopics[d]})}}delete n.messageIdToTopic[i],n._invokeStoreProcessingQueue(),r(l,g);break}case"unsuback":{delete n.outgoing[i],n.messageIdProvider.deallocate(i),n._invokeStoreProcessingQueue(),r(null);break}default:n.emit("error",new Error("unrecognized packet type"))}n.disconnecting&&Object.keys(n.outgoing).length===0&&n.emit("outgoingEmpty")};e.default=t}),lT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=El(),n=$C(),g=(i,o)=>{let{options:s}=i,r=s.protocolVersion,l=r===5?o.reasonCode:o.returnCode;if(r!==5){let I=new t.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${r}`,l);i.emit("error",I);return}i.handleAuth(o,(I,a)=>{if(I){i.emit("error",I);return}if(l===24)i.reconnecting=!1,i._sendPacket(a);else{let C=new t.ErrorWithReasonCode(`Connection refused: ${n.ReasonCodes[l]}`,l);i.emit("error",C)}})};e.default=g}),IT=Ze(e=>{var d,u,h,f,y,Z,p,B,W,S,V,R,J,M,P,X,L,ne,D,ie,ge,N,te,q,me,v,gh,Ce,Be,Ie,K,Cv,ee,be,ae,oi,si,ih,$I,ea,ot,oh,Sr,T;he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0}),e.LRUCache=void 0;var t=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,n=new Set,g=typeof ze=="object"&&ze?ze:{},i=(_,F,U,O)=>{typeof g.emitWarning=="function"?g.emitWarning(_,F,U,O):console.error(`[${U}] ${F}: ${_}`)},o=globalThis.AbortController,s=globalThis.AbortSignal;if(typeof o>"u"){s=class{constructor(){Se(this,"onabort");Se(this,"_onabort",[]);Se(this,"reason");Se(this,"aborted",!1)}addEventListener(U,O){this._onabort.push(O)}},o=class{constructor(){Se(this,"signal",new s);F()}abort(U){var O,de;if(!this.signal.aborted){this.signal.reason=U,this.signal.aborted=!0;for(let m of this.signal._onabort)m(U);(de=(O=this.signal).onabort)==null||de.call(O,U)}}};let _=((d=g.env)==null?void 0:d.LRU_CACHE_IGNORE_AC_WARNING)!=="1",F=()=>{_&&(_=!1,i("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",F))}}var r=_=>!n.has(_),l=_=>_&&_===Math.floor(_)&&_>0&&isFinite(_),I=_=>l(_)?_<=Math.pow(2,8)?Uint8Array:_<=Math.pow(2,16)?Uint16Array:_<=Math.pow(2,32)?Uint32Array:_<=Number.MAX_SAFE_INTEGER?a:null:null,a=class extends Array{constructor(_){super(_),this.fill(0)}},C=(u=class{constructor(F,U){Se(this,"heap");Se(this,"length");if(!E(u,h))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new U(F),this.length=0}static create(F){let U=I(F);if(!U)return[];ve(u,h,!0);let O=new u(F,U);return ve(u,h,!1),O}push(F){this.heap[this.length++]=F}pop(){return this.heap[--this.length]}},h=new WeakMap,Te(u,h,!1),u),c=(T=class{constructor(F){Te(this,v);Te(this,f);Te(this,y);Te(this,Z);Te(this,p);Te(this,B);Se(this,"ttl");Se(this,"ttlResolution");Se(this,"ttlAutopurge");Se(this,"updateAgeOnGet");Se(this,"updateAgeOnHas");Se(this,"allowStale");Se(this,"noDisposeOnSet");Se(this,"noUpdateTTL");Se(this,"maxEntrySize");Se(this,"sizeCalculation");Se(this,"noDeleteOnFetchRejection");Se(this,"noDeleteOnStaleGet");Se(this,"allowStaleOnFetchAbort");Se(this,"allowStaleOnFetchRejection");Se(this,"ignoreFetchAbort");Te(this,W);Te(this,S);Te(this,V);Te(this,R);Te(this,J);Te(this,M);Te(this,P);Te(this,X);Te(this,L);Te(this,ne);Te(this,D);Te(this,ie);Te(this,ge);Te(this,N);Te(this,te);Te(this,q);Te(this,me);Te(this,Ce,()=>{});Te(this,Be,()=>{});Te(this,Ie,()=>{});Te(this,K,()=>!1);Te(this,ee,F=>{});Te(this,be,(F,U,O)=>{});Te(this,ae,(F,U,O,de)=>{if(O||de)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});let{max:U=0,ttl:O,ttlResolution:de=1,ttlAutopurge:m,updateAgeOnGet:A,updateAgeOnHas:b,allowStale:k,dispose:Y,disposeAfter:j,noDisposeOnSet:le,noUpdateTTL:Xe,maxSize:Fe=0,maxEntrySize:xe=0,sizeCalculation:Re,fetchMethod:Ne,noDeleteOnFetchRejection:we,noDeleteOnStaleGet:et,allowStaleOnFetchRejection:kt,allowStaleOnFetchAbort:ft,ignoreFetchAbort:Ft}=F;if(U!==0&&!l(U))throw new TypeError("max option must be a nonnegative integer");let tn=U?I(U):Array;if(!tn)throw new Error("invalid max value: "+U);if(ve(this,f,U),ve(this,y,Fe),this.maxEntrySize=xe||E(this,y),this.sizeCalculation=Re,this.sizeCalculation){if(!E(this,y)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(Ne!==void 0&&typeof Ne!="function")throw new TypeError("fetchMethod must be a function if specified");if(ve(this,B,Ne),ve(this,q,!!Ne),ve(this,V,new Map),ve(this,R,new Array(U).fill(void 0)),ve(this,J,new Array(U).fill(void 0)),ve(this,M,new tn(U)),ve(this,P,new tn(U)),ve(this,X,0),ve(this,L,0),ve(this,ne,C.create(U)),ve(this,W,0),ve(this,S,0),typeof Y=="function"&&ve(this,Z,Y),typeof j=="function"?(ve(this,p,j),ve(this,D,[])):(ve(this,p,void 0),ve(this,D,void 0)),ve(this,te,!!E(this,Z)),ve(this,me,!!E(this,p)),this.noDisposeOnSet=!!le,this.noUpdateTTL=!!Xe,this.noDeleteOnFetchRejection=!!we,this.allowStaleOnFetchRejection=!!kt,this.allowStaleOnFetchAbort=!!ft,this.ignoreFetchAbort=!!Ft,this.maxEntrySize!==0){if(E(this,y)!==0&&!l(E(this,y)))throw new TypeError("maxSize must be a positive integer if specified");if(!l(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");We(this,v,Cv).call(this)}if(this.allowStale=!!k,this.noDeleteOnStaleGet=!!et,this.updateAgeOnGet=!!A,this.updateAgeOnHas=!!b,this.ttlResolution=l(de)||de===0?de:1,this.ttlAutopurge=!!m,this.ttl=O||0,this.ttl){if(!l(this.ttl))throw new TypeError("ttl must be a positive integer if specified");We(this,v,gh).call(this)}if(E(this,f)===0&&this.ttl===0&&E(this,y)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!E(this,f)&&!E(this,y)){let Xt="LRU_CACHE_UNBOUNDED";r(Xt)&&(n.add(Xt),i("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Xt,T))}}static unsafeExposeInternals(F){return{starts:E(F,ge),ttls:E(F,N),sizes:E(F,ie),keyMap:E(F,V),keyList:E(F,R),valList:E(F,J),next:E(F,M),prev:E(F,P),get head(){return E(F,X)},get tail(){return E(F,L)},free:E(F,ne),isBackgroundFetch:U=>{var O;return We(O=F,v,ot).call(O,U)},backgroundFetch:(U,O,de,m)=>{var A;return We(A=F,v,ea).call(A,U,O,de,m)},moveToTail:U=>{var O;return We(O=F,v,Sr).call(O,U)},indexes:U=>{var O;return We(O=F,v,oi).call(O,U)},rindexes:U=>{var O;return We(O=F,v,si).call(O,U)},isStale:U=>{var O;return E(O=F,K).call(O,U)}}}get max(){return E(this,f)}get maxSize(){return E(this,y)}get calculatedSize(){return E(this,S)}get size(){return E(this,W)}get fetchMethod(){return E(this,B)}get dispose(){return E(this,Z)}get disposeAfter(){return E(this,p)}getRemainingTTL(F){return E(this,V).has(F)?1/0:0}*entries(){for(let F of We(this,v,oi).call(this))E(this,J)[F]!==void 0&&E(this,R)[F]!==void 0&&!We(this,v,ot).call(this,E(this,J)[F])&&(yield[E(this,R)[F],E(this,J)[F]])}*rentries(){for(let F of We(this,v,si).call(this))E(this,J)[F]!==void 0&&E(this,R)[F]!==void 0&&!We(this,v,ot).call(this,E(this,J)[F])&&(yield[E(this,R)[F],E(this,J)[F]])}*keys(){for(let F of We(this,v,oi).call(this)){let U=E(this,R)[F];U!==void 0&&!We(this,v,ot).call(this,E(this,J)[F])&&(yield U)}}*rkeys(){for(let F of We(this,v,si).call(this)){let U=E(this,R)[F];U!==void 0&&!We(this,v,ot).call(this,E(this,J)[F])&&(yield U)}}*values(){for(let F of We(this,v,oi).call(this))E(this,J)[F]!==void 0&&!We(this,v,ot).call(this,E(this,J)[F])&&(yield E(this,J)[F])}*rvalues(){for(let F of We(this,v,si).call(this))E(this,J)[F]!==void 0&&!We(this,v,ot).call(this,E(this,J)[F])&&(yield E(this,J)[F])}[Symbol.iterator](){return this.entries()}find(F,U={}){for(let O of We(this,v,oi).call(this)){let de=E(this,J)[O],m=We(this,v,ot).call(this,de)?de.__staleWhileFetching:de;if(m!==void 0&&F(m,E(this,R)[O],this))return this.get(E(this,R)[O],U)}}forEach(F,U=this){for(let O of We(this,v,oi).call(this)){let de=E(this,J)[O],m=We(this,v,ot).call(this,de)?de.__staleWhileFetching:de;m!==void 0&&F.call(U,m,E(this,R)[O],this)}}rforEach(F,U=this){for(let O of We(this,v,si).call(this)){let de=E(this,J)[O],m=We(this,v,ot).call(this,de)?de.__staleWhileFetching:de;m!==void 0&&F.call(U,m,E(this,R)[O],this)}}purgeStale(){let F=!1;for(let U of We(this,v,si).call(this,{allowStale:!0}))E(this,K).call(this,U)&&(this.delete(E(this,R)[U]),F=!0);return F}dump(){let F=[];for(let U of We(this,v,oi).call(this,{allowStale:!0})){let O=E(this,R)[U],de=E(this,J)[U],m=We(this,v,ot).call(this,de)?de.__staleWhileFetching:de;if(m===void 0||O===void 0)continue;let A={value:m};if(E(this,N)&&E(this,ge)){A.ttl=E(this,N)[U];let b=t.now()-E(this,ge)[U];A.start=Math.floor(Date.now()-b)}E(this,ie)&&(A.size=E(this,ie)[U]),F.unshift([O,A])}return F}load(F){this.clear();for(let[U,O]of F){if(O.start){let de=Date.now()-O.start;O.start=t.now()-de}this.set(U,O.value,O)}}set(F,U,O={}){var Xe,Fe,xe,Re,Ne;if(U===void 0)return this.delete(F),this;let{ttl:de=this.ttl,start:m,noDisposeOnSet:A=this.noDisposeOnSet,sizeCalculation:b=this.sizeCalculation,status:k}=O,{noUpdateTTL:Y=this.noUpdateTTL}=O,j=E(this,ae).call(this,F,U,O.size||0,b);if(this.maxEntrySize&&j>this.maxEntrySize)return k&&(k.set="miss",k.maxEntrySizeExceeded=!0),this.delete(F),this;let le=E(this,W)===0?void 0:E(this,V).get(F);if(le===void 0)le=E(this,W)===0?E(this,L):E(this,ne).length!==0?E(this,ne).pop():E(this,W)===E(this,f)?We(this,v,$I).call(this,!1):E(this,W),E(this,R)[le]=F,E(this,J)[le]=U,E(this,V).set(F,le),E(this,M)[E(this,L)]=le,E(this,P)[le]=E(this,L),ve(this,L,le),Ml(this,W)._++,E(this,be).call(this,le,j,k),k&&(k.set="add"),Y=!1;else{We(this,v,Sr).call(this,le);let we=E(this,J)[le];if(U!==we){if(E(this,q)&&We(this,v,ot).call(this,we)){we.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:et}=we;et!==void 0&&!A&&(E(this,te)&&((Xe=E(this,Z))==null||Xe.call(this,et,F,"set")),E(this,me)&&((Fe=E(this,D))==null||Fe.push([et,F,"set"])))}else A||(E(this,te)&&((xe=E(this,Z))==null||xe.call(this,we,F,"set")),E(this,me)&&((Re=E(this,D))==null||Re.push([we,F,"set"])));if(E(this,ee).call(this,le),E(this,be).call(this,le,j,k),E(this,J)[le]=U,k){k.set="replace";let et=we&&We(this,v,ot).call(this,we)?we.__staleWhileFetching:we;et!==void 0&&(k.oldValue=et)}}else k&&(k.set="update")}if(de!==0&&!E(this,N)&&We(this,v,gh).call(this),E(this,N)&&(Y||E(this,Ie).call(this,le,de,m),k&&E(this,Be).call(this,k,le)),!A&&E(this,me)&&E(this,D)){let we=E(this,D),et;for(;et=we==null?void 0:we.shift();)(Ne=E(this,p))==null||Ne.call(this,...et)}return this}pop(){var F;try{for(;E(this,W);){let U=E(this,J)[E(this,X)];if(We(this,v,$I).call(this,!0),We(this,v,ot).call(this,U)){if(U.__staleWhileFetching)return U.__staleWhileFetching}else if(U!==void 0)return U}}finally{if(E(this,me)&&E(this,D)){let U=E(this,D),O;for(;O=U==null?void 0:U.shift();)(F=E(this,p))==null||F.call(this,...O)}}}has(F,U={}){let{updateAgeOnHas:O=this.updateAgeOnHas,status:de}=U,m=E(this,V).get(F);if(m!==void 0){let A=E(this,J)[m];if(We(this,v,ot).call(this,A)&&A.__staleWhileFetching===void 0)return!1;if(E(this,K).call(this,m))de&&(de.has="stale",E(this,Be).call(this,de,m));else return O&&E(this,Ce).call(this,m),de&&(de.has="hit",E(this,Be).call(this,de,m)),!0}else de&&(de.has="miss");return!1}peek(F,U={}){let{allowStale:O=this.allowStale}=U,de=E(this,V).get(F);if(de!==void 0&&(O||!E(this,K).call(this,de))){let m=E(this,J)[de];return We(this,v,ot).call(this,m)?m.__staleWhileFetching:m}}async fetch(F,U={}){let{allowStale:O=this.allowStale,updateAgeOnGet:de=this.updateAgeOnGet,noDeleteOnStaleGet:m=this.noDeleteOnStaleGet,ttl:A=this.ttl,noDisposeOnSet:b=this.noDisposeOnSet,size:k=0,sizeCalculation:Y=this.sizeCalculation,noUpdateTTL:j=this.noUpdateTTL,noDeleteOnFetchRejection:le=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:Xe=this.allowStaleOnFetchRejection,ignoreFetchAbort:Fe=this.ignoreFetchAbort,allowStaleOnFetchAbort:xe=this.allowStaleOnFetchAbort,context:Re,forceRefresh:Ne=!1,status:we,signal:et}=U;if(!E(this,q))return we&&(we.fetch="get"),this.get(F,{allowStale:O,updateAgeOnGet:de,noDeleteOnStaleGet:m,status:we});let kt={allowStale:O,updateAgeOnGet:de,noDeleteOnStaleGet:m,ttl:A,noDisposeOnSet:b,size:k,sizeCalculation:Y,noUpdateTTL:j,noDeleteOnFetchRejection:le,allowStaleOnFetchRejection:Xe,allowStaleOnFetchAbort:xe,ignoreFetchAbort:Fe,status:we,signal:et},ft=E(this,V).get(F);if(ft===void 0){we&&(we.fetch="miss");let Ft=We(this,v,ea).call(this,F,ft,kt,Re);return Ft.__returned=Ft}else{let Ft=E(this,J)[ft];if(We(this,v,ot).call(this,Ft)){let wb=O&&Ft.__staleWhileFetching!==void 0;return we&&(we.fetch="inflight",wb&&(we.returnedStale=!0)),wb?Ft.__staleWhileFetching:Ft.__returned=Ft}let tn=E(this,K).call(this,ft);if(!Ne&&!tn)return we&&(we.fetch="hit"),We(this,v,Sr).call(this,ft),de&&E(this,Ce).call(this,ft),we&&E(this,Be).call(this,we,ft),Ft;let Xt=We(this,v,ea).call(this,F,ft,kt,Re),Xb=Xt.__staleWhileFetching!==void 0&&O;return we&&(we.fetch=tn?"stale":"refresh",Xb&&tn&&(we.returnedStale=!0)),Xb?Xt.__staleWhileFetching:Xt.__returned=Xt}}get(F,U={}){let{allowStale:O=this.allowStale,updateAgeOnGet:de=this.updateAgeOnGet,noDeleteOnStaleGet:m=this.noDeleteOnStaleGet,status:A}=U,b=E(this,V).get(F);if(b!==void 0){let k=E(this,J)[b],Y=We(this,v,ot).call(this,k);return A&&E(this,Be).call(this,A,b),E(this,K).call(this,b)?(A&&(A.get="stale"),Y?(A&&O&&k.__staleWhileFetching!==void 0&&(A.returnedStale=!0),O?k.__staleWhileFetching:void 0):(m||this.delete(F),A&&O&&(A.returnedStale=!0),O?k:void 0)):(A&&(A.get="hit"),Y?k.__staleWhileFetching:(We(this,v,Sr).call(this,b),de&&E(this,Ce).call(this,b),k))}else A&&(A.get="miss")}delete(F){var O,de,m,A;let U=!1;if(E(this,W)!==0){let b=E(this,V).get(F);if(b!==void 0)if(U=!0,E(this,W)===1)this.clear();else{E(this,ee).call(this,b);let k=E(this,J)[b];We(this,v,ot).call(this,k)?k.__abortController.abort(new Error("deleted")):(E(this,te)||E(this,me))&&(E(this,te)&&((O=E(this,Z))==null||O.call(this,k,F,"delete")),E(this,me)&&((de=E(this,D))==null||de.push([k,F,"delete"]))),E(this,V).delete(F),E(this,R)[b]=void 0,E(this,J)[b]=void 0,b===E(this,L)?ve(this,L,E(this,P)[b]):b===E(this,X)?ve(this,X,E(this,M)[b]):(E(this,M)[E(this,P)[b]]=E(this,M)[b],E(this,P)[E(this,M)[b]]=E(this,P)[b]),Ml(this,W)._--,E(this,ne).push(b)}}if(E(this,me)&&((m=E(this,D))!=null&&m.length)){let b=E(this,D),k;for(;k=b==null?void 0:b.shift();)(A=E(this,p))==null||A.call(this,...k)}return U}clear(){var F,U,O;for(let de of We(this,v,si).call(this,{allowStale:!0})){let m=E(this,J)[de];if(We(this,v,ot).call(this,m))m.__abortController.abort(new Error("deleted"));else{let A=E(this,R)[de];E(this,te)&&((F=E(this,Z))==null||F.call(this,m,A,"delete")),E(this,me)&&((U=E(this,D))==null||U.push([m,A,"delete"]))}}if(E(this,V).clear(),E(this,J).fill(void 0),E(this,R).fill(void 0),E(this,N)&&E(this,ge)&&(E(this,N).fill(0),E(this,ge).fill(0)),E(this,ie)&&E(this,ie).fill(0),ve(this,X,0),ve(this,L,0),E(this,ne).length=0,ve(this,S,0),ve(this,W,0),E(this,me)&&E(this,D)){let de=E(this,D),m;for(;m=de==null?void 0:de.shift();)(O=E(this,p))==null||O.call(this,...m)}}},f=new WeakMap,y=new WeakMap,Z=new WeakMap,p=new WeakMap,B=new WeakMap,W=new WeakMap,S=new WeakMap,V=new WeakMap,R=new WeakMap,J=new WeakMap,M=new WeakMap,P=new WeakMap,X=new WeakMap,L=new WeakMap,ne=new WeakMap,D=new WeakMap,ie=new WeakMap,ge=new WeakMap,N=new WeakMap,te=new WeakMap,q=new WeakMap,me=new WeakMap,v=new WeakSet,gh=function(){let F=new a(E(this,f)),U=new a(E(this,f));ve(this,N,F),ve(this,ge,U),ve(this,Ie,(m,A,b=t.now())=>{if(U[m]=A!==0?b:0,F[m]=A,A!==0&&this.ttlAutopurge){let k=setTimeout(()=>{E(this,K).call(this,m)&&this.delete(E(this,R)[m])},A+1);k.unref&&k.unref()}}),ve(this,Ce,m=>{U[m]=F[m]!==0?t.now():0}),ve(this,Be,(m,A)=>{if(F[A]){let b=F[A],k=U[A];m.ttl=b,m.start=k,m.now=O||de();let Y=m.now-k;m.remainingTTL=b-Y}});let O=0,de=()=>{let m=t.now();if(this.ttlResolution>0){O=m;let A=setTimeout(()=>O=0,this.ttlResolution);A.unref&&A.unref()}return m};this.getRemainingTTL=m=>{let A=E(this,V).get(m);if(A===void 0)return 0;let b=F[A],k=U[A];if(b===0||k===0)return 1/0;let Y=(O||de())-k;return b-Y},ve(this,K,m=>F[m]!==0&&U[m]!==0&&(O||de())-U[m]>F[m])},Ce=new WeakMap,Be=new WeakMap,Ie=new WeakMap,K=new WeakMap,Cv=function(){let F=new a(E(this,f));ve(this,S,0),ve(this,ie,F),ve(this,ee,U=>{ve(this,S,E(this,S)-F[U]),F[U]=0}),ve(this,ae,(U,O,de,m)=>{if(We(this,v,ot).call(this,O))return 0;if(!l(de))if(m){if(typeof m!="function")throw new TypeError("sizeCalculation must be a function");if(de=m(O,U),!l(de))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return de}),ve(this,be,(U,O,de)=>{if(F[U]=O,E(this,y)){let m=E(this,y)-F[U];for(;E(this,S)>m;)We(this,v,$I).call(this,!0)}ve(this,S,E(this,S)+F[U]),de&&(de.entrySize=O,de.totalCalculatedSize=E(this,S))})},ee=new WeakMap,be=new WeakMap,ae=new WeakMap,oi=function*({allowStale:F=this.allowStale}={}){if(E(this,W))for(let U=E(this,L);!(!We(this,v,ih).call(this,U)||((F||!E(this,K).call(this,U))&&(yield U),U===E(this,X)));)U=E(this,P)[U]},si=function*({allowStale:F=this.allowStale}={}){if(E(this,W))for(let U=E(this,X);!(!We(this,v,ih).call(this,U)||((F||!E(this,K).call(this,U))&&(yield U),U===E(this,L)));)U=E(this,M)[U]},ih=function(F){return F!==void 0&&E(this,V).get(E(this,R)[F])===F},$I=function(F){var m,A;let U=E(this,X),O=E(this,R)[U],de=E(this,J)[U];return E(this,q)&&We(this,v,ot).call(this,de)?de.__abortController.abort(new Error("evicted")):(E(this,te)||E(this,me))&&(E(this,te)&&((m=E(this,Z))==null||m.call(this,de,O,"evict")),E(this,me)&&((A=E(this,D))==null||A.push([de,O,"evict"]))),E(this,ee).call(this,U),F&&(E(this,R)[U]=void 0,E(this,J)[U]=void 0,E(this,ne).push(U)),E(this,W)===1?(ve(this,X,ve(this,L,0)),E(this,ne).length=0):ve(this,X,E(this,M)[U]),E(this,V).delete(O),Ml(this,W)._--,U},ea=function(F,U,O,de){let m=U===void 0?void 0:E(this,J)[U];if(We(this,v,ot).call(this,m))return m;let A=new o,{signal:b}=O;b==null||b.addEventListener("abort",()=>A.abort(b.reason),{signal:A.signal});let k={signal:A.signal,options:O,context:de},Y=(Re,Ne=!1)=>{let{aborted:we}=A.signal,et=O.ignoreFetchAbort&&Re!==void 0;if(O.status&&(we&&!Ne?(O.status.fetchAborted=!0,O.status.fetchError=A.signal.reason,et&&(O.status.fetchAbortIgnored=!0)):O.status.fetchResolved=!0),we&&!et&&!Ne)return le(A.signal.reason);let kt=Fe;return E(this,J)[U]===Fe&&(Re===void 0?kt.__staleWhileFetching?E(this,J)[U]=kt.__staleWhileFetching:this.delete(F):(O.status&&(O.status.fetchUpdated=!0),this.set(F,Re,k.options))),Re},j=Re=>(O.status&&(O.status.fetchRejected=!0,O.status.fetchError=Re),le(Re)),le=Re=>{let{aborted:Ne}=A.signal,we=Ne&&O.allowStaleOnFetchAbort,et=we||O.allowStaleOnFetchRejection,kt=et||O.noDeleteOnFetchRejection,ft=Fe;if(E(this,J)[U]===Fe&&(!kt||ft.__staleWhileFetching===void 0?this.delete(F):we||(E(this,J)[U]=ft.__staleWhileFetching)),et)return O.status&&ft.__staleWhileFetching!==void 0&&(O.status.returnedStale=!0),ft.__staleWhileFetching;if(ft.__returned===ft)throw Re},Xe=(Re,Ne)=>{var et;let we=(et=E(this,B))==null?void 0:et.call(this,F,m,k);we&&we instanceof Promise&&we.then(kt=>Re(kt===void 0?void 0:kt),Ne),A.signal.addEventListener("abort",()=>{(!O.ignoreFetchAbort||O.allowStaleOnFetchAbort)&&(Re(void 0),O.allowStaleOnFetchAbort&&(Re=kt=>Y(kt,!0)))})};O.status&&(O.status.fetchDispatched=!0);let Fe=new Promise(Xe).then(Y,j),xe=Object.assign(Fe,{__abortController:A,__staleWhileFetching:m,__returned:void 0});return U===void 0?(this.set(F,xe,{...k.options,status:void 0}),U=E(this,V).get(F)):E(this,J)[U]=xe,xe},ot=function(F){if(!E(this,q))return!1;let U=F;return!!U&&U instanceof Promise&&U.hasOwnProperty("__staleWhileFetching")&&U.__abortController instanceof o},oh=function(F,U){E(this,P)[U]=F,E(this,M)[F]=U},Sr=function(F){F!==E(this,L)&&(F===E(this,X)?ve(this,X,E(this,M)[F]):We(this,v,oh).call(this,E(this,P)[F],E(this,M)[F]),We(this,v,oh).call(this,E(this,L),F),ve(this,L,F))},T);e.LRUCache=c}),qg=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.ContainerIterator=e.Container=e.Base=void 0;var t=class{constructor(i=0){this.iteratorType=i}equals(i){return this.o===i.o}};e.ContainerIterator=t;var n=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return this.i===0}};e.Base=n;var g=class extends n{};e.Container=g}),aT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=qg(),n=class extends t.Base{constructor(i=[]){super(),this.S=[];let o=this;i.forEach(function(s){o.push(s)})}clear(){this.i=0,this.S=[]}push(i){return this.S.push(i),this.i+=1,this.i}pop(){if(this.i!==0)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}},g=n;e.default=g}),CT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=qg(),n=class extends t.Base{constructor(i=[]){super(),this.j=0,this.q=[];let o=this;i.forEach(function(s){o.push(s)})}clear(){this.q=[],this.i=this.j=0}push(i){let o=this.q.length;if(this.j/o>.5&&this.j+this.i>=o&&o>4096){let s=this.i;for(let r=0;r<s;++r)this.q[r]=this.q[this.j+r];this.j=0,this.q[this.i]=i}else this.q[this.j+this.i]=i;return++this.i}pop(){if(this.i===0)return;let i=this.q[this.j++];return this.i-=1,i}front(){if(this.i!==0)return this.q[this.j]}},g=n;e.default=g}),cT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=qg(),n=class extends t.Base{constructor(i=[],o=function(r,l){return r>l?-1:r<l?1:0},s=!0){if(super(),this.v=o,Array.isArray(i))this.C=s?[...i]:i;else{this.C=[];let l=this;i.forEach(function(I){l.C.push(I)})}this.i=this.C.length;let r=this.i>>1;for(let l=this.i-1>>1;l>=0;--l)this.k(l,r)}m(i){let o=this.C[i];for(;i>0;){let s=i-1>>1,r=this.C[s];if(this.v(r,o)<=0)break;this.C[i]=r,i=s}this.C[i]=o}k(i,o){let s=this.C[i];for(;i<o;){let r=i<<1|1,l=r+1,I=this.C[r];if(l<this.i&&this.v(I,this.C[l])>0&&(r=l,I=this.C[l]),this.v(I,s)>=0)break;this.C[i]=I,i=r}this.C[i]=s}clear(){this.i=0,this.C.length=0}push(i){this.C.push(i),this.m(this.i),this.i+=1}pop(){if(this.i===0)return;let i=this.C[0],o=this.C.pop();return this.i-=1,this.i&&(this.C[0]=o,this.k(0,this.i>>1)),i}top(){return this.C[0]}find(i){return this.C.indexOf(i)>=0}remove(i){let o=this.C.indexOf(i);return o<0?!1:(o===0?this.pop():o===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(o,1,this.C.pop()),this.i-=1,this.m(o),this.k(o,this.i>>1)),!0)}updateItem(i){let o=this.C.indexOf(i);return o<0?!1:(this.m(o),this.k(o,this.i>>1),!0)}toArray(){return[...this.C]}},g=n;e.default=g}),Rb=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=qg(),n=class extends t.Container{},g=n;e.default=g}),$g=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.throwIteratorAccessError=t;function t(){throw new RangeError("Iterator access denied!")}}),cv=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.RandomIterator=void 0;var t=qg(),n=$g(),g=class extends t.ContainerIterator{constructor(i,o){super(o),this.o=i,this.iteratorType===0?(this.pre=function(){return this.o===0&&(0,n.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,n.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,n.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return this.o===-1&&(0,n.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(i){this.container.setElementByPos(this.o,i)}};e.RandomIterator=g}),dT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=g(Rb()),n=cv();function g(r){return r&&r.t?r:{default:r}}var i=class dv extends n.RandomIterator{constructor(l,I,a){super(l,a),this.container=I}copy(){return new dv(this.o,this.container,this.iteratorType)}},o=class extends t.default{constructor(r=[],l=!0){if(super(),Array.isArray(r))this.J=l?[...r]:r,this.i=r.length;else{this.J=[];let I=this;r.forEach(function(a){I.pushBack(a)})}}clear(){this.i=0,this.J.length=0}begin(){return new i(0,this)}end(){return new i(this.i,this)}rBegin(){return new i(this.i-1,this,1)}rEnd(){return new i(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(r){if(r<0||r>this.i-1)throw new RangeError;return this.J[r]}eraseElementByPos(r){if(r<0||r>this.i-1)throw new RangeError;return this.J.splice(r,1),this.i-=1,this.i}eraseElementByValue(r){let l=0;for(let I=0;I<this.i;++I)this.J[I]!==r&&(this.J[l++]=this.J[I]);return this.i=this.J.length=l,this.i}eraseElementByIterator(r){let l=r.o;return r=r.next(),this.eraseElementByPos(l),r}pushBack(r){return this.J.push(r),this.i+=1,this.i}popBack(){if(this.i!==0)return this.i-=1,this.J.pop()}setElementByPos(r,l){if(r<0||r>this.i-1)throw new RangeError;this.J[r]=l}insert(r,l,I=1){if(r<0||r>this.i)throw new RangeError;return this.J.splice(r,0,...new Array(I).fill(l)),this.i+=I,this.i}find(r){for(let l=0;l<this.i;++l)if(this.J[l]===r)return new i(l,this);return this.end()}reverse(){this.J.reverse()}unique(){let r=1;for(let l=1;l<this.i;++l)this.J[l]!==this.J[l-1]&&(this.J[r++]=this.J[l]);return this.i=this.J.length=r,this.i}sort(r){this.J.sort(r)}forEach(r){for(let l=0;l<this.i;++l)r(this.J[l],l,this)}[Symbol.iterator](){return(function*(){yield*this.J}).bind(this)()}},s=o;e.default=s}),uT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=i(Rb()),n=qg(),g=$g();function i(l){return l&&l.t?l:{default:l}}var o=class uv extends n.ContainerIterator{constructor(I,a,C,c){super(c),this.o=I,this.h=a,this.container=C,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,g.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,g.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,g.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,g.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,g.throwIteratorAccessError)(),this.o.l}set pointer(I){this.o===this.h&&(0,g.throwIteratorAccessError)(),this.o.l=I}copy(){return new uv(this.o,this.h,this.container,this.iteratorType)}},s=class extends t.default{constructor(l=[]){super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let I=this;l.forEach(function(a){I.pushBack(a)})}V(l){let{L:I,B:a}=l;I.B=a,a.L=I,l===this.p&&(this.p=a),l===this._&&(this._=I),this.i-=1}G(l,I){let a=I.B,C={l,L:I,B:a};I.B=C,a.L=C,I===this.h&&(this.p=C),a===this.h&&(this._=C),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new o(this.p,this.h,this)}end(){return new o(this.h,this.h,this)}rBegin(){return new o(this._,this.h,this,1)}rEnd(){return new o(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let I=this.p;for(;l--;)I=I.B;return I.l}eraseElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let I=this.p;for(;l--;)I=I.B;return this.V(I),this.i}eraseElementByValue(l){let I=this.p;for(;I!==this.h;)I.l===l&&this.V(I),I=I.B;return this.i}eraseElementByIterator(l){let I=l.o;return I===this.h&&(0,g.throwIteratorAccessError)(),l=l.next(),this.V(I),l}pushBack(l){return this.G(l,this._),this.i}popBack(){if(this.i===0)return;let l=this._.l;return this.V(this._),l}pushFront(l){return this.G(l,this.h),this.i}popFront(){if(this.i===0)return;let l=this.p.l;return this.V(this.p),l}setElementByPos(l,I){if(l<0||l>this.i-1)throw new RangeError;let a=this.p;for(;l--;)a=a.B;a.l=I}insert(l,I,a=1){if(l<0||l>this.i)throw new RangeError;if(a<=0)return this.i;if(l===0)for(;a--;)this.pushFront(I);else if(l===this.i)for(;a--;)this.pushBack(I);else{let C=this.p;for(let d=1;d<l;++d)C=C.B;let c=C.B;for(this.i+=a;a--;)C.B={l:I,L:C},C.B.L=C,C=C.B;C.B=c,c.L=C}return this.i}find(l){let I=this.p;for(;I!==this.h;){if(I.l===l)return new o(I,this.h,this);I=I.B}return this.end()}reverse(){if(this.i<=1)return;let l=this.p,I=this._,a=0;for(;a<<1<this.i;){let C=l.l;l.l=I.l,I.l=C,l=l.B,I=I.L,a+=1}}unique(){if(this.i<=1)return this.i;let l=this.p;for(;l!==this.h;){let I=l;for(;I.B!==this.h&&I.l===I.B.l;)I=I.B,this.i-=1;l.B=I.B,l.B.L=l,l=l.B}return this.i}sort(l){if(this.i<=1)return;let I=[];this.forEach(function(C){I.push(C)}),I.sort(l);let a=this.p;I.forEach(function(C){a.l=C,a=a.B})}merge(l){let I=this;if(this.i===0)l.forEach(function(a){I.pushBack(a)});else{let a=this.p;l.forEach(function(C){for(;a!==I.h&&a.l<=C;)a=a.B;I.G(C,a.L)})}return this.i}forEach(l){let I=this.p,a=0;for(;I!==this.h;)l(I.l,a++,this),I=I.B}[Symbol.iterator](){return(function*(){if(this.i===0)return;let l=this.p;for(;l!==this.h;)yield l.l,l=l.B}).bind(this)()}},r=s;e.default=r}),AT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=g(Rb()),n=cv();function g(r){return r&&r.t?r:{default:r}}var i=class Av extends n.RandomIterator{constructor(l,I,a){super(l,a),this.container=I}copy(){return new Av(this.o,this.container,this.iteratorType)}},o=class extends t.default{constructor(r=[],l=4096){super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let I=(()=>{if(typeof r.length=="number")return r.length;if(typeof r.size=="number")return r.size;if(typeof r.size=="function")return r.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=l,this.P=Math.max(Math.ceil(I/this.F),1);for(let c=0;c<this.P;++c)this.A.push(new Array(this.F));let a=Math.ceil(I/this.F);this.j=this.R=(this.P>>1)-(a>>1),this.D=this.N=this.F-I%this.F>>1;let C=this;r.forEach(function(c){C.pushBack(c)})}T(){let r=[],l=Math.max(this.P>>1,1);for(let I=0;I<l;++I)r[I]=new Array(this.F);for(let I=this.j;I<this.P;++I)r[r.length]=this.A[I];for(let I=0;I<this.R;++I)r[r.length]=this.A[I];r[r.length]=[...this.A[this.R]],this.j=l,this.R=r.length-1;for(let I=0;I<l;++I)r[r.length]=new Array(this.F);this.A=r,this.P=r.length}O(r){let l=this.D+r+1,I=l%this.F,a=I-1,C=this.j+(l-I)/this.F;return I===0&&(C-=1),C%=this.P,a<0&&(a+=this.F),{curNodeBucketIndex:C,curNodePointerIndex:a}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new i(0,this)}end(){return new i(this.i,this)}rBegin(){return new i(this.i-1,this,1)}rEnd(){return new i(-1,this,1)}front(){if(this.i!==0)return this.A[this.j][this.D]}back(){if(this.i!==0)return this.A[this.R][this.N]}pushBack(r){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=r,this.i}popBack(){if(this.i===0)return;let r=this.A[this.R][this.N];return this.i!==1&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,r}pushFront(r){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=r,this.i}popFront(){if(this.i===0)return;let r=this.A[this.j][this.D];return this.i!==1&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,r}getElementByPos(r){if(r<0||r>this.i-1)throw new RangeError;let{curNodeBucketIndex:l,curNodePointerIndex:I}=this.O(r);return this.A[l][I]}setElementByPos(r,l){if(r<0||r>this.i-1)throw new RangeError;let{curNodeBucketIndex:I,curNodePointerIndex:a}=this.O(r);this.A[I][a]=l}insert(r,l,I=1){if(r<0||r>this.i)throw new RangeError;if(r===0)for(;I--;)this.pushFront(l);else if(r===this.i)for(;I--;)this.pushBack(l);else{let a=[];for(let C=r;C<this.i;++C)a.push(this.getElementByPos(C));this.cut(r-1);for(let C=0;C<I;++C)this.pushBack(l);for(let C=0;C<a.length;++C)this.pushBack(a[C])}return this.i}cut(r){if(r<0)return this.clear(),0;let{curNodeBucketIndex:l,curNodePointerIndex:I}=this.O(r);return this.R=l,this.N=I,this.i=r+1,this.i}eraseElementByPos(r){if(r<0||r>this.i-1)throw new RangeError;if(r===0)this.popFront();else if(r===this.i-1)this.popBack();else{let l=[];for(let a=r+1;a<this.i;++a)l.push(this.getElementByPos(a));this.cut(r),this.popBack();let I=this;l.forEach(function(a){I.pushBack(a)})}return this.i}eraseElementByValue(r){if(this.i===0)return 0;let l=[];for(let a=0;a<this.i;++a){let C=this.getElementByPos(a);C!==r&&l.push(C)}let I=l.length;for(let a=0;a<I;++a)this.setElementByPos(a,l[a]);return this.cut(I-1)}eraseElementByIterator(r){let l=r.o;return this.eraseElementByPos(l),r=r.next(),r}find(r){for(let l=0;l<this.i;++l)if(this.getElementByPos(l)===r)return new i(l,this);return this.end()}reverse(){let r=0,l=this.i-1;for(;r<l;){let I=this.getElementByPos(r);this.setElementByPos(r,this.getElementByPos(l)),this.setElementByPos(l,I),r+=1,l-=1}}unique(){if(this.i<=1)return this.i;let r=1,l=this.getElementByPos(0);for(let I=1;I<this.i;++I){let a=this.getElementByPos(I);a!==l&&(l=a,this.setElementByPos(r++,a))}for(;this.i>r;)this.popBack();return this.i}sort(r){let l=[];for(let I=0;I<this.i;++I)l.push(this.getElementByPos(I));l.sort(r);for(let I=0;I<this.i;++I)this.setElementByPos(I,l[I])}shrinkToFit(){if(this.i===0)return;let r=[];this.forEach(function(l){r.push(l)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let l=0;l<this.P;++l)this.A.push(new Array(this.F));for(let l=0;l<r.length;++l)this.pushBack(r[l])}forEach(r){for(let l=0;l<this.i;++l)r(this.getElementByPos(l),l,this)}[Symbol.iterator](){return(function*(){for(let r=0;r<this.i;++r)yield this.getElementByPos(r)}).bind(this)()}},s=o;e.default=s}),hT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.TreeNodeEnableIndex=e.TreeNode=void 0;var t=class{constructor(g,i){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=g,this.l=i}L(){let g=this;if(g.ee===1&&g.tt.tt===g)g=g.W;else if(g.U)for(g=g.U;g.W;)g=g.W;else{let i=g.tt;for(;i.U===g;)g=i,i=g.tt;g=i}return g}B(){let g=this;if(g.W){for(g=g.W;g.U;)g=g.U;return g}else{let i=g.tt;for(;i.W===g;)g=i,i=g.tt;return g.W!==i?i:g}}te(){let g=this.tt,i=this.W,o=i.U;return g.tt===this?g.tt=i:g.U===this?g.U=i:g.W=i,i.tt=g,i.U=this,this.tt=i,this.W=o,o&&(o.tt=this),i}se(){let g=this.tt,i=this.U,o=i.W;return g.tt===this?g.tt=i:g.U===this?g.U=i:g.W=i,i.tt=g,i.W=this,this.tt=i,this.U=o,o&&(o.tt=this),i}};e.TreeNode=t;var n=class extends t{constructor(){super(...arguments),this.rt=1}te(){let g=super.te();return this.ie(),g.ie(),g}se(){let g=super.se();return this.ie(),g.ie(),g}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}};e.TreeNodeEnableIndex=n}),hv=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=hT(),n=qg(),g=$g(),i=class extends n.Container{constructor(s=function(l,I){return l<I?-1:l>I?1:0},r=!1){super(),this.Y=void 0,this.v=s,r?(this.re=t.TreeNodeEnableIndex,this.M=function(l,I,a){let C=this.ne(l,I,a);if(C){let c=C.tt;for(;c!==this.h;)c.rt+=1,c=c.tt;let d=this.he(C);if(d){let{parentNode:u,grandParent:h,curNode:f}=d;u.ie(),h.ie(),f.ie()}}return this.i},this.V=function(l){let I=this.fe(l);for(;I!==this.h;)I.rt-=1,I=I.tt}):(this.re=t.TreeNode,this.M=function(l,I,a){let C=this.ne(l,I,a);return C&&this.he(C),this.i},this.V=this.fe),this.h=new this.re}X(s,r){let l=this.h;for(;s;){let I=this.v(s.u,r);if(I<0)s=s.W;else if(I>0)l=s,s=s.U;else return s}return l}Z(s,r){let l=this.h;for(;s;)this.v(s.u,r)<=0?s=s.W:(l=s,s=s.U);return l}$(s,r){let l=this.h;for(;s;){let I=this.v(s.u,r);if(I<0)l=s,s=s.W;else if(I>0)s=s.U;else return s}return l}rr(s,r){let l=this.h;for(;s;)this.v(s.u,r)<0?(l=s,s=s.W):s=s.U;return l}ue(s){for(;;){let r=s.tt;if(r===this.h)return;if(s.ee===1){s.ee=0;return}if(s===r.U){let l=r.W;if(l.ee===1)l.ee=0,r.ee=1,r===this.Y?this.Y=r.te():r.te();else if(l.W&&l.W.ee===1){l.ee=r.ee,r.ee=0,l.W.ee=0,r===this.Y?this.Y=r.te():r.te();return}else l.U&&l.U.ee===1?(l.ee=1,l.U.ee=0,l.se()):(l.ee=1,s=r)}else{let l=r.U;if(l.ee===1)l.ee=0,r.ee=1,r===this.Y?this.Y=r.se():r.se();else if(l.U&&l.U.ee===1){l.ee=r.ee,r.ee=0,l.U.ee=0,r===this.Y?this.Y=r.se():r.se();return}else l.W&&l.W.ee===1?(l.ee=1,l.W.ee=0,l.te()):(l.ee=1,s=r)}}}fe(s){if(this.i===1)return this.clear(),this.h;let r=s;for(;r.U||r.W;){if(r.W)for(r=r.W;r.U;)r=r.U;else r=r.U;[s.u,r.u]=[r.u,s.u],[s.l,r.l]=[r.l,s.l],s=r}this.h.U===r?this.h.U=r.tt:this.h.W===r&&(this.h.W=r.tt),this.ue(r);let l=r.tt;return r===l.U?l.U=void 0:l.W=void 0,this.i-=1,this.Y.ee=0,l}oe(s,r){return s===void 0?!1:this.oe(s.U,r)||r(s)?!0:this.oe(s.W,r)}he(s){for(;;){let r=s.tt;if(r.ee===0)return;let l=r.tt;if(r===l.U){let I=l.W;if(I&&I.ee===1){if(I.ee=r.ee=0,l===this.Y)return;l.ee=1,s=l;continue}else if(s===r.W){if(s.ee=0,s.U&&(s.U.tt=r),s.W&&(s.W.tt=l),r.W=s.U,l.U=s.W,s.U=r,s.W=l,l===this.Y)this.Y=s,this.h.tt=s;else{let a=l.tt;a.U===l?a.U=s:a.W=s}return s.tt=l.tt,r.tt=s,l.tt=s,l.ee=1,{parentNode:r,grandParent:l,curNode:s}}else r.ee=0,l===this.Y?this.Y=l.se():l.se(),l.ee=1}else{let I=l.U;if(I&&I.ee===1){if(I.ee=r.ee=0,l===this.Y)return;l.ee=1,s=l;continue}else if(s===r.U){if(s.ee=0,s.U&&(s.U.tt=l),s.W&&(s.W.tt=r),l.W=s.U,r.U=s.W,s.U=l,s.W=r,l===this.Y)this.Y=s,this.h.tt=s;else{let a=l.tt;a.U===l?a.U=s:a.W=s}return s.tt=l.tt,r.tt=s,l.tt=s,l.ee=1,{parentNode:r,grandParent:l,curNode:s}}else r.ee=0,l===this.Y?this.Y=l.te():l.te(),l.ee=1}return}}ne(s,r,l){if(this.Y===void 0){this.i+=1,this.Y=new this.re(s,r),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,this.h.W=this.Y;return}let I,a=this.h.U,C=this.v(a.u,s);if(C===0){a.l=r;return}else if(C>0)a.U=new this.re(s,r),a.U.tt=a,I=a.U,this.h.U=I;else{let c=this.h.W,d=this.v(c.u,s);if(d===0){c.l=r;return}else if(d<0)c.W=new this.re(s,r),c.W.tt=c,I=c.W,this.h.W=I;else{if(l!==void 0){let u=l.o;if(u!==this.h){let h=this.v(u.u,s);if(h===0){u.l=r;return}else if(h>0){let f=u.L(),y=this.v(f.u,s);if(y===0){f.l=r;return}else y<0&&(I=new this.re(s,r),f.W===void 0?(f.W=I,I.tt=f):(u.U=I,I.tt=u))}}}if(I===void 0)for(I=this.Y;;){let u=this.v(I.u,s);if(u>0){if(I.U===void 0){I.U=new this.re(s,r),I.U.tt=I,I=I.U;break}I=I.U}else if(u<0){if(I.W===void 0){I.W=new this.re(s,r),I.W.tt=I,I=I.W;break}I=I.W}else{I.l=r;return}}}}return this.i+=1,I}I(s,r){for(;s;){let l=this.v(s.u,r);if(l<0)s=s.W;else if(l>0)s=s.U;else return s}return s||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(s,r){let l=s.o;if(l===this.h&&(0,g.throwIteratorAccessError)(),this.i===1)return l.u=r,!0;if(l===this.h.U)return this.v(l.B().u,r)>0?(l.u=r,!0):!1;if(l===this.h.W)return this.v(l.L().u,r)<0?(l.u=r,!0):!1;let I=l.L().u;if(this.v(I,r)>=0)return!1;let a=l.B().u;return this.v(a,r)<=0?!1:(l.u=r,!0)}eraseElementByPos(s){if(s<0||s>this.i-1)throw new RangeError;let r=0,l=this;return this.oe(this.Y,function(I){return s===r?(l.V(I),!0):(r+=1,!1)}),this.i}eraseElementByKey(s){if(this.i===0)return!1;let r=this.I(this.Y,s);return r===this.h?!1:(this.V(r),!0)}eraseElementByIterator(s){let r=s.o;r===this.h&&(0,g.throwIteratorAccessError)();let l=r.W===void 0;return s.iteratorType===0?l&&s.next():(!l||r.U===void 0)&&s.next(),this.V(r),s}forEach(s){let r=0;for(let l of this)s(l,r++,this)}getElementByPos(s){if(s<0||s>this.i-1)throw new RangeError;let r,l=0;for(let I of this){if(l===s){r=I;break}l+=1}return r}getHeight(){if(this.i===0)return 0;let s=function(r){return r?Math.max(s(r.U),s(r.W))+1:0};return s(this.Y)}},o=i;e.default=o}),mv=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=qg(),n=$g(),g=class extends t.ContainerIterator{constructor(o,s,r){super(r),this.o=o,this.h=s,this.iteratorType===0?(this.pre=function(){return this.o===this.h.U&&(0,n.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,n.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let o=this.o,s=this.h.tt;if(o===this.h)return s?s.rt-1:0;let r=0;for(o.U&&(r+=o.U.rt);o!==s;){let l=o.tt;o===l.W&&(r+=1,l.U&&(r+=l.U.rt)),o=l}return r}},i=g;e.default=i}),mT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=i(hv()),n=i(mv()),g=$g();function i(l){return l&&l.t?l:{default:l}}var o=class bv extends n.default{constructor(I,a,C,c){super(I,a,c),this.container=C}get pointer(){return this.o===this.h&&(0,g.throwIteratorAccessError)(),this.o.u}copy(){return new bv(this.o,this.h,this.container,this.iteratorType)}},s=class extends t.default{constructor(l=[],I,a){super(I,a);let C=this;l.forEach(function(c){C.insert(c)})}*K(l){l!==void 0&&(yield*this.K(l.U),yield l.u,yield*this.K(l.W))}begin(){return new o(this.h.U||this.h,this.h,this)}end(){return new o(this.h,this.h,this)}rBegin(){return new o(this.h.W||this.h,this.h,this,1)}rEnd(){return new o(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(l,I){return this.M(l,void 0,I)}find(l){let I=this.I(this.Y,l);return new o(I,this.h,this)}lowerBound(l){let I=this.X(this.Y,l);return new o(I,this.h,this)}upperBound(l){let I=this.Z(this.Y,l);return new o(I,this.h,this)}reverseLowerBound(l){let I=this.$(this.Y,l);return new o(I,this.h,this)}reverseUpperBound(l){let I=this.rr(this.Y,l);return new o(I,this.h,this)}union(l){let I=this;return l.forEach(function(a){I.insert(a)}),this.i}[Symbol.iterator](){return this.K(this.Y)}},r=s;e.default=r}),bT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=i(hv()),n=i(mv()),g=$g();function i(l){return l&&l.t?l:{default:l}}var o=class pv extends n.default{constructor(I,a,C,c){super(I,a,c),this.container=C}get pointer(){this.o===this.h&&(0,g.throwIteratorAccessError)();let I=this;return new Proxy([],{get(a,C){if(C==="0")return I.o.u;if(C==="1")return I.o.l},set(a,C,c){if(C!=="1")throw new TypeError("props must be 1");return I.o.l=c,!0}})}copy(){return new pv(this.o,this.h,this.container,this.iteratorType)}},s=class extends t.default{constructor(l=[],I,a){super(I,a);let C=this;l.forEach(function(c){C.setElement(c[0],c[1])})}*K(l){l!==void 0&&(yield*this.K(l.U),yield[l.u,l.l],yield*this.K(l.W))}begin(){return new o(this.h.U||this.h,this.h,this)}end(){return new o(this.h,this.h,this)}rBegin(){return new o(this.h.W||this.h,this.h,this,1)}rEnd(){return new o(this.h,this.h,this,1)}front(){if(this.i===0)return;let l=this.h.U;return[l.u,l.l]}back(){if(this.i===0)return;let l=this.h.W;return[l.u,l.l]}lowerBound(l){let I=this.X(this.Y,l);return new o(I,this.h,this)}upperBound(l){let I=this.Z(this.Y,l);return new o(I,this.h,this)}reverseLowerBound(l){let I=this.$(this.Y,l);return new o(I,this.h,this)}reverseUpperBound(l){let I=this.rr(this.Y,l);return new o(I,this.h,this)}setElement(l,I,a){return this.M(l,I,a)}find(l){let I=this.I(this.Y,l);return new o(I,this.h,this)}getElementByKey(l){return this.I(this.Y,l).l}union(l){let I=this;return l.forEach(function(a){I.setElement(a[0],a[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}},r=s;e.default=r}),fv=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=t;function t(n){let g=typeof n;return g==="object"&&n!==null||g==="function"}}),Zv=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.HashContainerIterator=e.HashContainer=void 0;var t=qg(),n=i(fv()),g=$g();function i(r){return r&&r.t?r:{default:r}}var o=class extends t.ContainerIterator{constructor(r,l,I){super(I),this.o=r,this.h=l,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,g.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,g.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,g.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,g.throwIteratorAccessError)(),this.o=this.o.L,this})}};e.HashContainerIterator=o;var s=class extends t.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(r){let{L:l,B:I}=r;l.B=I,I.L=l,r===this.p&&(this.p=I),r===this._&&(this._=l),this.i-=1}M(r,l,I){I===void 0&&(I=(0,n.default)(r));let a;if(I){let C=r[this.HASH_TAG];if(C!==void 0)return this.H[C].l=l,this.i;Object.defineProperty(r,this.HASH_TAG,{value:this.H.length,configurable:!0}),a={u:r,l,L:this._,B:this.h},this.H.push(a)}else{let C=this.g[r];if(C)return C.l=l,this.i;a={u:r,l,L:this._,B:this.h},this.g[r]=a}return this.i===0?(this.p=a,this.h.B=a):this._.B=a,this._=a,this.h.L=a,++this.i}I(r,l){if(l===void 0&&(l=(0,n.default)(r)),l){let I=r[this.HASH_TAG];return I===void 0?this.h:this.H[I]}else return this.g[r]||this.h}clear(){let r=this.HASH_TAG;this.H.forEach(function(l){delete l.u[r]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(r,l){let I;if(l===void 0&&(l=(0,n.default)(r)),l){let a=r[this.HASH_TAG];if(a===void 0)return!1;delete r[this.HASH_TAG],I=this.H[a],delete this.H[a]}else{if(I=this.g[r],I===void 0)return!1;delete this.g[r]}return this.V(I),!0}eraseElementByIterator(r){let l=r.o;return l===this.h&&(0,g.throwIteratorAccessError)(),this.V(l),r.next()}eraseElementByPos(r){if(r<0||r>this.i-1)throw new RangeError;let l=this.p;for(;r--;)l=l.B;return this.V(l),this.i}};e.HashContainer=s}),pT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=Zv(),n=$g(),g=class yv extends t.HashContainerIterator{constructor(r,l,I,a){super(r,l,a),this.container=I}get pointer(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o.u}copy(){return new yv(this.o,this.h,this.container,this.iteratorType)}},i=class extends t.HashContainer{constructor(s=[]){super();let r=this;s.forEach(function(l){r.insert(l)})}begin(){return new g(this.p,this.h,this)}end(){return new g(this.h,this.h,this)}rBegin(){return new g(this._,this.h,this,1)}rEnd(){return new g(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(s,r){return this.M(s,void 0,r)}getElementByPos(s){if(s<0||s>this.i-1)throw new RangeError;let r=this.p;for(;s--;)r=r.B;return r.u}find(s,r){let l=this.I(s,r);return new g(l,this.h,this)}forEach(s){let r=0,l=this.p;for(;l!==this.h;)s(l.u,r++,this),l=l.B}[Symbol.iterator](){return(function*(){let s=this.p;for(;s!==this.h;)yield s.u,s=s.B}).bind(this)()}},o=i;e.default=o}),fT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=Zv(),n=i(fv()),g=$g();function i(l){return l&&l.t?l:{default:l}}var o=class Gv extends t.HashContainerIterator{constructor(I,a,C,c){super(I,a,c),this.container=C}get pointer(){this.o===this.h&&(0,g.throwIteratorAccessError)();let I=this;return new Proxy([],{get(a,C){if(C==="0")return I.o.u;if(C==="1")return I.o.l},set(a,C,c){if(C!=="1")throw new TypeError("props must be 1");return I.o.l=c,!0}})}copy(){return new Gv(this.o,this.h,this.container,this.iteratorType)}},s=class extends t.HashContainer{constructor(l=[]){super();let I=this;l.forEach(function(a){I.setElement(a[0],a[1])})}begin(){return new o(this.p,this.h,this)}end(){return new o(this.h,this.h,this)}rBegin(){return new o(this._,this.h,this,1)}rEnd(){return new o(this.h,this.h,this,1)}front(){if(this.i!==0)return[this.p.u,this.p.l]}back(){if(this.i!==0)return[this._.u,this._.l]}setElement(l,I,a){return this.M(l,I,a)}getElementByKey(l,I){if(I===void 0&&(I=(0,n.default)(l)),I){let C=l[this.HASH_TAG];return C!==void 0?this.H[C].l:void 0}let a=this.g[l];return a?a.l:void 0}getElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let I=this.p;for(;l--;)I=I.B;return[I.u,I.l]}find(l,I){let a=this.I(l,I);return new o(a,this.h,this)}forEach(l){let I=0,a=this.p;for(;a!==this.h;)l([a.u,a.l],I++,this),a=a.B}[Symbol.iterator](){return(function*(){let l=this.p;for(;l!==this.h;)yield[l.u,l.l],l=l.B}).bind(this)()}},r=s;e.default=r}),ZT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"t",{value:!0}),Object.defineProperty(e,"Deque",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"HashMap",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"HashSet",{enumerable:!0,get:function(){return I.default}}),Object.defineProperty(e,"LinkList",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"OrderedMap",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"OrderedSet",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"PriorityQueue",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"Queue",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"Stack",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"Vector",{enumerable:!0,get:function(){return i.default}});var t=C(aT()),n=C(CT()),g=C(cT()),i=C(dT()),o=C(uT()),s=C(AT()),r=C(mT()),l=C(bT()),I=C(pT()),a=C(fT());function C(c){return c&&c.t?c:{default:c}}}),yT=Ze((e,t)=>{he(),Ae(),ue();var n=ZT().OrderedSet,g=Qg()("number-allocator:trace"),i=Qg()("number-allocator:error");function o(r,l){this.low=r,this.high=l}o.prototype.equals=function(r){return this.low===r.low&&this.high===r.high},o.prototype.compare=function(r){return this.low<r.low&&this.high<r.low?-1:r.low<this.low&&r.high<this.low?1:0};function s(r,l){if(!(this instanceof s))return new s(r,l);this.min=r,this.max=l,this.ss=new n([],(I,a)=>I.compare(a)),g("Create"),this.clear()}s.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},s.prototype.alloc=function(){if(this.ss.size()===0)return g("alloc():empty"),null;let r=this.ss.begin(),l=r.pointer.low,I=r.pointer.high,a=l;return a+1<=I?this.ss.updateKeyByIterator(r,new o(l+1,I)):this.ss.eraseElementByPos(0),g("alloc():"+a),a},s.prototype.use=function(r){let l=new o(r,r),I=this.ss.lowerBound(l);if(!I.equals(this.ss.end())){let a=I.pointer.low,C=I.pointer.high;return I.pointer.equals(l)?(this.ss.eraseElementByIterator(I),g("use():"+r),!0):a>r?!1:a===r?(this.ss.updateKeyByIterator(I,new o(a+1,C)),g("use():"+r),!0):C===r?(this.ss.updateKeyByIterator(I,new o(a,C-1)),g("use():"+r),!0):(this.ss.updateKeyByIterator(I,new o(r+1,C)),this.ss.insert(new o(a,r-1)),g("use():"+r),!0)}return g("use():failed"),!1},s.prototype.free=function(r){if(r<this.min||r>this.max){i("free():"+r+" is out of range");return}let l=new o(r,r),I=this.ss.upperBound(l);if(I.equals(this.ss.end())){if(I.equals(this.ss.begin())){this.ss.insert(l);return}I.pre();let a=I.pointer.high;I.pointer.high+1===r?this.ss.updateKeyByIterator(I,new o(a,r)):this.ss.insert(l)}else if(I.equals(this.ss.begin()))if(r+1===I.pointer.low){let a=I.pointer.high;this.ss.updateKeyByIterator(I,new o(r,a))}else this.ss.insert(l);else{let a=I.pointer.low,C=I.pointer.high;I.pre();let c=I.pointer.low;I.pointer.high+1===r?r+1===a?(this.ss.eraseElementByIterator(I),this.ss.updateKeyByIterator(I,new o(c,C))):this.ss.updateKeyByIterator(I,new o(c,r)):r+1===a?(this.ss.eraseElementByIterator(I.next()),this.ss.insert(new o(r,C))):this.ss.insert(l)}g("free():"+r)},s.prototype.clear=function(){g("clear()"),this.ss.clear(),this.ss.insert(new o(this.min,this.max))},s.prototype.intervalCount=function(){return this.ss.size()},s.prototype.dump=function(){console.log("length:"+this.ss.size());for(let r of this.ss)console.log(r)},t.exports=s}),Bv=Ze((e,t)=>{he(),Ae(),ue();var n=yT();t.exports.NumberAllocator=n}),GT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=IT(),n=Bv(),g=class{constructor(i){i>0&&(this.aliasToTopic=new t.LRUCache({max:i}),this.topicToAlias={},this.numberAllocator=new n.NumberAllocator(1,i),this.max=i,this.length=0)}put(i,o){if(o===0||o>this.max)return!1;let s=this.aliasToTopic.get(o);return s&&delete this.topicToAlias[s],this.aliasToTopic.set(o,i),this.topicToAlias[i]=o,this.numberAllocator.use(o),this.length=this.aliasToTopic.size,!0}getTopicByAlias(i){return this.aliasToTopic.get(i)}getAliasByTopic(i){let o=this.topicToAlias[i];return typeof o<"u"&&this.aliasToTopic.get(o),o}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){return this.numberAllocator.firstVacant()||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}};e.default=g}),BT=Ze(e=>{he(),Ae(),ue();var t=e&&e.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0});var n=$C(),g=t(GT()),i=El(),o=(s,r)=>{s.log("_handleConnack");let{options:l}=s,I=l.protocolVersion===5?r.reasonCode:r.returnCode;if(clearTimeout(s.connackTimer),delete s.topicAliasSend,r.properties){if(r.properties.topicAliasMaximum){if(r.properties.topicAliasMaximum>65535){s.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}r.properties.topicAliasMaximum>0&&(s.topicAliasSend=new g.default(r.properties.topicAliasMaximum))}r.properties.serverKeepAlive&&l.keepalive&&(l.keepalive=r.properties.serverKeepAlive),r.properties.maximumPacketSize&&(l.properties||(l.properties={}),l.properties.maximumPacketSize=r.properties.maximumPacketSize)}if(I===0)s.reconnecting=!1,s._onConnect(r);else if(I>0){let a=new i.ErrorWithReasonCode(`Connection refused: ${n.ReasonCodes[I]}`,I);s.emit("error",a)}};e.default=o}),ST=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=(n,g,i)=>{n.log("handling pubrel packet");let o=typeof i<"u"?i:n.noop,{messageId:s}=g,r={cmd:"pubcomp",messageId:s};n.incomingStore.get(g,(l,I)=>{l?n._sendPacket(r,o):(n.emit("message",I.topic,I.payload,I),n.handleMessage(I,a=>{if(a)return o(a);n.incomingStore.del(I,n.noop),n._sendPacket(r,o)}))})};e.default=t}),VT=Ze(e=>{he(),Ae(),ue();var t=e&&e.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(e,"__esModule",{value:!0});var n=t(sT()),g=t(lT()),i=t(BT()),o=t($C()),s=t(ST()),r=(l,I,a)=>{let{options:C}=l;if(C.protocolVersion===5&&C.properties&&C.properties.maximumPacketSize&&C.properties.maximumPacketSize<I.length)return l.emit("error",new Error(`exceeding packets size ${I.cmd}`)),l.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),l;switch(l.log("_handlePacket :: emitting packetreceive"),l.emit("packetreceive",I),I.cmd){case"publish":(0,n.default)(l,I,a);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":l.reschedulePing(),(0,o.default)(l,I),a();break;case"pubrel":l.reschedulePing(),(0,s.default)(l,I,a);break;case"connack":(0,i.default)(l,I),a();break;case"auth":l.reschedulePing(),(0,g.default)(l,I),a();break;case"pingresp":l.log("_handlePacket :: received pingresp"),l.reschedulePing(),a();break;case"disconnect":l.emit("disconnect",I),a();break;default:l.log("_handlePacket :: unknown command"),a();break}};e.default=r}),WT=Ze(e=>{he(),Ae(),ue();var t=e&&e.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.TypedEventEmitter=void 0;var n=t((Ds(),$e(Uo))),g=El(),i=class{};e.TypedEventEmitter=i,(0,g.applyMixin)(i,n.default)}),ec=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0}),e.isReactNativeBrowser=e.isWebWorker=void 0;var t=()=>{var o;return typeof window<"u"?typeof on<"u"&&((o=on.userAgent)===null||o===void 0?void 0:o.toLowerCase().indexOf(" electron/"))>-1&&ze!=null&&ze.versions?!Object.prototype.hasOwnProperty.call(ze.versions,"electron"):typeof window.document<"u":!1},n=()=>{var o,s;return!!(typeof self=="object"&&!((s=(o=self==null?void 0:self.constructor)===null||o===void 0?void 0:o.name)===null||s===void 0)&&s.includes("WorkerGlobalScope"))},g=()=>typeof on<"u"&&on.product==="ReactNative",i=t()||n()||g();e.isWebWorker=n(),e.isReactNativeBrowser=g(),e.default=i}),RT=Ze((e,t)=>{he(),Ae(),ue(),function(n,g){typeof e=="object"&&typeof t<"u"?g(e):typeof define=="function"&&define.amd?define(["exports"],g):(n=typeof globalThis<"u"?globalThis:n||self,g(n.fastUniqueNumbers={}))}(e,function(n){var g=function(d){return function(u){var h=d(u);return u.add(h),h}},i=function(d){return function(u,h){return d.set(u,h),h}},o=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,s=536870912,r=s*2,l=function(d,u){return function(h){var f=u.get(h),y=f===void 0?h.size:f<r?f+1:0;if(!h.has(y))return d(h,y);if(h.size<s){for(;h.has(y);)y=Math.floor(Math.random()*r);return d(h,y)}if(h.size>o)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;h.has(y);)y=Math.floor(Math.random()*o);return d(h,y)}},I=new WeakMap,a=i(I),C=l(a,I),c=g(C);n.addUniqueNumber=c,n.generateUniqueNumber=C})}),vT=Ze((e,t)=>{he(),Ae(),ue(),function(n,g){typeof e=="object"&&typeof t<"u"?g(e,RT()):typeof define=="function"&&define.amd?define(["exports","fast-unique-numbers"],g):(n=typeof globalThis<"u"?globalThis:n||self,g(n.workerTimersBroker={},n.fastUniqueNumbers))}(e,function(n,g){var i=function(r){return r.method!==void 0&&r.method==="call"},o=function(r){return r.error===null&&typeof r.id=="number"},s=function(r){var l=new Map([[0,function(){}]]),I=new Map([[0,function(){}]]),a=new Map,C=new Worker(r);C.addEventListener("message",function(f){var y=f.data;if(i(y)){var Z=y.params,p=Z.timerId,B=Z.timerType;if(B==="interval"){var W=l.get(p);if(typeof W=="number"){var S=a.get(W);if(S===void 0||S.timerId!==p||S.timerType!==B)throw new Error("The timer is in an undefined state.")}else if(typeof W<"u")W();else throw new Error("The timer is in an undefined state.")}else if(B==="timeout"){var V=I.get(p);if(typeof V=="number"){var R=a.get(V);if(R===void 0||R.timerId!==p||R.timerType!==B)throw new Error("The timer is in an undefined state.")}else if(typeof V<"u")V(),I.delete(p);else throw new Error("The timer is in an undefined state.")}}else if(o(y)){var J=y.id,M=a.get(J);if(M===void 0)throw new Error("The timer is in an undefined state.");var P=M.timerId,X=M.timerType;a.delete(J),X==="interval"?l.delete(P):I.delete(P)}else{var L=y.error.message;throw new Error(L)}});var c=function(f){var y=g.generateUniqueNumber(a);a.set(y,{timerId:f,timerType:"interval"}),l.set(f,y),C.postMessage({id:y,method:"clear",params:{timerId:f,timerType:"interval"}})},d=function(f){var y=g.generateUniqueNumber(a);a.set(y,{timerId:f,timerType:"timeout"}),I.set(f,y),C.postMessage({id:y,method:"clear",params:{timerId:f,timerType:"timeout"}})},u=function(f){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Z=g.generateUniqueNumber(l);return l.set(Z,function(){f(),typeof l.get(Z)=="function"&&C.postMessage({id:null,method:"set",params:{delay:y,now:performance.now(),timerId:Z,timerType:"interval"}})}),C.postMessage({id:null,method:"set",params:{delay:y,now:performance.now(),timerId:Z,timerType:"interval"}}),Z},h=function(f){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Z=g.generateUniqueNumber(I);return I.set(Z,f),C.postMessage({id:null,method:"set",params:{delay:y,now:performance.now(),timerId:Z,timerType:"timeout"}}),Z};return{clearInterval:c,clearTimeout:d,setInterval:u,setTimeout:h}};n.load=s})}),kT=Ze((e,t)=>{he(),Ae(),ue(),function(n,g){typeof e=="object"&&typeof t<"u"?g(e,vT()):typeof define=="function"&&define.amd?define(["exports","worker-timers-broker"],g):(n=typeof globalThis<"u"?globalThis:n||self,g(n.workerTimers={},n.workerTimersBroker))}(e,function(n,g){var i=function(C,c){var d=null;return function(){if(d!==null)return d;var u=new Blob([c],{type:"application/javascript; charset=utf-8"}),h=URL.createObjectURL(u);return d=C(h),setTimeout(function(){return URL.revokeObjectURL(h)}),d}},o=`(()=>{var e={472:(e,t,r)=>{var o,i;void 0===(i="function"==typeof(o=function(){"use strict";var e=new Map,t=new Map,r=function(t){var r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)},o=function(e){var r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)},i=function(e,t){var r,o=performance.now();return{expected:o+(r=e-Math.max(0,o-t)),remainingDelay:r}},n=function e(t,r,o,i){var n=performance.now();n>o?postMessage({id:null,method:"call",params:{timerId:r,timerType:i}}):t.set(r,setTimeout(e,o-n,t,r,o,i))},a=function(t,r,o){var a=i(t,o),s=a.expected,d=a.remainingDelay;e.set(r,setTimeout(n,d,e,r,s,"interval"))},s=function(e,r,o){var a=i(e,o),s=a.expected,d=a.remainingDelay;t.set(r,setTimeout(n,d,t,r,s,"timeout"))};addEventListener("message",(function(e){var t=e.data;try{if("clear"===t.method){var i=t.id,n=t.params,d=n.timerId,c=n.timerType;if("interval"===c)r(d),postMessage({error:null,id:i});else{if("timeout"!==c)throw new Error('The given type "'.concat(c,'" is not supported'));o(d),postMessage({error:null,id:i})}}else{if("set"!==t.method)throw new Error('The given method "'.concat(t.method,'" is not supported'));var u=t.params,l=u.delay,p=u.now,m=u.timerId,v=u.timerType;if("interval"===v)a(l,m,p);else{if("timeout"!==v)throw new Error('The given type "'.concat(v,'" is not supported'));s(l,m,p)}}}catch(e){postMessage({error:{message:e.message},id:t.id,result:null})}}))})?o.call(t,r,t,e):o)||(e.exports=i)}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();`,s=i(g.load,o),r=function(C){return s().clearInterval(C)},l=function(C){return s().clearTimeout(C)},I=function(){var C;return(C=s()).setInterval.apply(C,arguments)},a=function(){var C;return(C=s()).setTimeout.apply(C,arguments)};n.clearInterval=r,n.clearTimeout=l,n.setInterval=I,n.setTimeout=a})}),XT=Ze(e=>{he(),Ae(),ue();var t=e&&e.__createBinding||(Object.create?function(I,a,C,c){c===void 0&&(c=C);var d=Object.getOwnPropertyDescriptor(a,C);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[C]}}),Object.defineProperty(I,c,d)}:function(I,a,C,c){c===void 0&&(c=C),I[c]=a[C]}),n=e&&e.__setModuleDefault||(Object.create?function(I,a){Object.defineProperty(I,"default",{enumerable:!0,value:a})}:function(I,a){I.default=a}),g=e&&e.__importStar||function(I){if(I&&I.__esModule)return I;var a={};if(I!=null)for(var C in I)C!=="default"&&Object.prototype.hasOwnProperty.call(I,C)&&t(a,I,C);return n(a,I),a};Object.defineProperty(e,"__esModule",{value:!0});var i=g(ec()),o=kT(),s={set:o.setInterval,clear:o.clearInterval},r={set:(I,a)=>setInterval(I,a),clear:I=>clearInterval(I)},l=I=>{switch(I){case"native":return r;case"worker":return s;case"auto":default:return i.default&&!i.isWebWorker&&!i.isReactNativeBrowser?s:r}};e.default=l}),Sv=Ze(e=>{he(),Ae(),ue();var t=e&&e.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(e,"__esModule",{value:!0});var n=t(XT()),g=class{get keepaliveTimeoutTimestamp(){return this._keepaliveTimeoutTimestamp}get intervalEvery(){return this._intervalEvery}get keepalive(){return this._keepalive}constructor(i,o){this.destroyed=!1,this.client=i,this.timer=(0,n.default)(o),this.setKeepalive(i.options.keepalive)}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}setKeepalive(i){if(i*=1e3,isNaN(i)||i<=0||i>2147483647)throw new Error(`Keepalive value must be an integer between 0 and 2147483647. Provided value is ${i}`);this._keepalive=i,this.reschedule(),this.client.log(`KeepaliveManager: set keepalive to ${i}ms`)}destroy(){this.clear(),this.destroyed=!0}reschedule(){if(this.destroyed)return;this.clear(),this.counter=0;let i=Math.ceil(this._keepalive*1.5);this._keepaliveTimeoutTimestamp=Date.now()+i,this._intervalEvery=Math.ceil(this._keepalive/2),this.timerId=this.timer.set(()=>{this.destroyed||(this.counter+=1,this.counter===2?this.client.sendPing():this.counter>2&&this.client.onKeepaliveTimeout())},this._intervalEvery)}};e.default=g}),sh=Ze(e=>{he(),Ae(),ue();var t=e&&e.__createBinding||(Object.create?function(W,S,V,R){R===void 0&&(R=V);var J=Object.getOwnPropertyDescriptor(S,V);(!J||("get"in J?!S.__esModule:J.writable||J.configurable))&&(J={enumerable:!0,get:function(){return S[V]}}),Object.defineProperty(W,R,J)}:function(W,S,V,R){R===void 0&&(R=V),W[R]=S[V]}),n=e&&e.__setModuleDefault||(Object.create?function(W,S){Object.defineProperty(W,"default",{enumerable:!0,value:S})}:function(W,S){W.default=S}),g=e&&e.__importStar||function(W){if(W&&W.__esModule)return W;var S={};if(W!=null)for(var V in W)V!=="default"&&Object.prototype.hasOwnProperty.call(W,V)&&t(S,W,V);return n(S,W),S},i=e&&e.__importDefault||function(W){return W&&W.__esModule?W:{default:W}};Object.defineProperty(e,"__esModule",{value:!0});var o=i(fM()),s=i(nT()),r=i(lv()),l=zo(),I=i(iT()),a=g(oT()),C=i(Qg()),c=i(Iv()),d=i(VT()),u=El(),h=WT(),f=i(Sv()),y=g(ec()),Z=globalThis.setImmediate||((...W)=>{let S=W.shift();(0,u.nextTick)(()=>{S(...W)})}),p={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0,writeCache:!0,timerVariant:"auto"},B=class rh extends h.TypedEventEmitter{static defaultId(){return`mqttjs_${Math.random().toString(16).substr(2,8)}`}constructor(S,V){super(),this.options=V||{};for(let R in p)typeof this.options[R]>"u"?this.options[R]=p[R]:this.options[R]=V[R];this.log=this.options.log||(0,C.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",rh.VERSION),y.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",y.default?"browser":"node"),this.log("MqttClient :: options.protocol",V.protocol),this.log("MqttClient :: options.protocolVersion",V.protocolVersion),this.log("MqttClient :: options.username",V.username),this.log("MqttClient :: options.keepalive",V.keepalive),this.log("MqttClient :: options.reconnectPeriod",V.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",V.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",V.properties?V.properties.topicAliasMaximum:void 0),this.options.clientId=typeof V.clientId=="string"?V.clientId:rh.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=V.protocolVersion===5&&V.customHandleAcks?V.customHandleAcks:(...R)=>{R[3](null,0)},this.options.writeCache||(s.default.writeToStream.cacheNumbers=!1),this.streamBuilder=S,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new r.default:this.options.messageIdProvider,this.outgoingStore=V.outgoingStore||new c.default,this.incomingStore=V.incomingStore||new c.default,this.queueQoSZero=V.queueQoSZero===void 0?!0:V.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.keepaliveManager=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,V.properties&&V.properties.topicAliasMaximum>0&&(V.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new o.default(V.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:R}=this,J=()=>{let M=R.shift();this.log("deliver :: entry %o",M);let P=null;if(!M){this._resubscribe();return}P=M.packet,this.log("deliver :: call _sendPacket for %o",P);let X=!0;P.messageId&&P.messageId!==0&&(this.messageIdProvider.register(P.messageId)||(X=!1)),X?this._sendPacket(P,L=>{M.cb&&M.cb(L),J()}):(this.log("messageId: %d has already used. The message is skipped and removed.",P.messageId),J())};this.log("connect :: sending queued packets"),J()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this._destroyKeepaliveManager(),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}handleAuth(S,V){V()}handleMessage(S,V){V()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){var S;let V=new l.Writable,R=s.default.parser(this.options),J=null,M=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),R.on("packet",D=>{this.log("parser :: on packet push to packets array."),M.push(D)});let P=()=>{this.log("work :: getting next packet in queue");let D=M.shift();if(D)this.log("work :: packet pulled from queue"),(0,d.default)(this,D,X);else{this.log("work :: no packets in queue");let ie=J;J=null,this.log("work :: done flag is %s",!!ie),ie&&ie()}},X=()=>{if(M.length)(0,u.nextTick)(P);else{let D=J;J=null,D()}};V._write=(D,ie,ge)=>{J=ge,this.log("writable stream :: parsing buffer"),R.parse(D),P()};let L=D=>{this.log("streamErrorHandler :: error",D.message),D.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",D)):this.noop(D)};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(V),this.stream.on("error",L),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let ne={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(ne.will=Object.assign(Object.assign({},this.options.will),{payload:(S=this.options.will)===null||S===void 0?void 0:S.payload})),this.topicAliasRecv&&(ne.properties||(ne.properties={}),this.topicAliasRecv&&(ne.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(ne),R.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){let D=Object.assign({cmd:"auth",reasonCode:0},this.options.authPacket);this._writePacket(D)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(S,V,R,J){this.log("publish :: message `%s` to topic `%s`",V,S);let{options:M}=this;typeof R=="function"&&(J=R,R=null),R=R||{},R=Object.assign(Object.assign({},{qos:0,retain:!1,dup:!1}),R);let{qos:P,retain:X,dup:L,properties:ne,cbStorePut:D}=R;if(this._checkDisconnecting(J))return this;let ie=()=>{let ge=0;if((P===1||P===2)&&(ge=this._nextId(),ge===null))return this.log("No messageId left"),!1;let N={cmd:"publish",topic:S,payload:V,qos:P,retain:X,messageId:ge,dup:L};switch(M.protocolVersion===5&&(N.properties=ne),this.log("publish :: qos",P),P){case 1:case 2:this.outgoing[N.messageId]={volatile:!1,cb:J||this.noop},this.log("MqttClient:publish: packet cmd: %s",N.cmd),this._sendPacket(N,void 0,D);break;default:this.log("MqttClient:publish: packet cmd: %s",N.cmd),this._sendPacket(N,J,D);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!ie())&&this._storeProcessingQueue.push({invoke:ie,cbStorePut:R.cbStorePut,callback:J}),this}publishAsync(S,V,R){return new Promise((J,M)=>{this.publish(S,V,R,(P,X)=>{P?M(P):J(X)})})}subscribe(S,V,R){let J=this.options.protocolVersion;typeof V=="function"&&(R=V),R=R||this.noop;let M=!1,P=[];typeof S=="string"?(S=[S],P=S):Array.isArray(S)?P=S:typeof S=="object"&&(M=S.resubscribe,delete S.resubscribe,P=Object.keys(S));let X=a.validateTopics(P);if(X!==null)return Z(R,new Error(`Invalid topic ${X}`)),this;if(this._checkDisconnecting(R))return this.log("subscribe: discconecting true"),this;let L={qos:0};J===5&&(L.nl=!1,L.rap=!1,L.rh=0),V=Object.assign(Object.assign({},L),V);let ne=V.properties,D=[],ie=(N,te)=>{if(te=te||V,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,N)||this._resubscribeTopics[N].qos<te.qos||M){let q={topic:N,qos:te.qos};J===5&&(q.nl=te.nl,q.rap=te.rap,q.rh=te.rh,q.properties=ne),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",q.topic,q.qos),D.push(q)}};if(Array.isArray(S)?S.forEach(N=>{this.log("subscribe: array topic %s",N),ie(N)}):Object.keys(S).forEach(N=>{this.log("subscribe: object topic %s, %o",N,S[N]),ie(N,S[N])}),!D.length)return R(null,[]),this;let ge=()=>{let N=this._nextId();if(N===null)return this.log("No messageId left"),!1;let te={cmd:"subscribe",subscriptions:D,messageId:N};if(ne&&(te.properties=ne),this.options.resubscribe){this.log("subscribe :: resubscribe true");let q=[];D.forEach(me=>{if(this.options.reconnectPeriod>0){let v={qos:me.qos};J===5&&(v.nl=me.nl||!1,v.rap=me.rap||!1,v.rh=me.rh||0,v.properties=me.properties),this._resubscribeTopics[me.topic]=v,q.push(me.topic)}}),this.messageIdToTopic[te.messageId]=q}return this.outgoing[te.messageId]={volatile:!0,cb(q,me){if(!q){let{granted:v}=me;for(let $=0;$<v.length;$+=1)D[$].qos=v[$]}R(q,D)}},this.log("subscribe :: call _sendPacket"),this._sendPacket(te),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!ge())&&this._storeProcessingQueue.push({invoke:ge,callback:R}),this}subscribeAsync(S,V){return new Promise((R,J)=>{this.subscribe(S,V,(M,P)=>{M?J(M):R(P)})})}unsubscribe(S,V,R){typeof S=="string"&&(S=[S]),typeof V=="function"&&(R=V),R=R||this.noop;let J=a.validateTopics(S);if(J!==null)return Z(R,new Error(`Invalid topic ${J}`)),this;if(this._checkDisconnecting(R))return this;let M=()=>{let P=this._nextId();if(P===null)return this.log("No messageId left"),!1;let X={cmd:"unsubscribe",messageId:P,unsubscriptions:[]};return typeof S=="string"?X.unsubscriptions=[S]:Array.isArray(S)&&(X.unsubscriptions=S),this.options.resubscribe&&X.unsubscriptions.forEach(L=>{delete this._resubscribeTopics[L]}),typeof V=="object"&&V.properties&&(X.properties=V.properties),this.outgoing[X.messageId]={volatile:!0,cb:R},this.log("unsubscribe: call _sendPacket"),this._sendPacket(X),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!M())&&this._storeProcessingQueue.push({invoke:M,callback:R}),this}unsubscribeAsync(S,V){return new Promise((R,J)=>{this.unsubscribe(S,V,(M,P)=>{M?J(M):R(P)})})}end(S,V,R){this.log("end :: (%s)",this.options.clientId),(S==null||typeof S!="boolean")&&(R=R||V,V=S,S=!1),typeof V!="object"&&(R=R||V,V=null),this.log("end :: cb? %s",!!R),(!R||typeof R!="function")&&(R=this.noop);let J=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close(P=>{this.outgoingStore.close(X=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),R){let L=P||X;this.log("end :: closeStores: invoking callback with args"),R(L)}})}),this._deferredReconnect&&this._deferredReconnect()},M=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,S),this._cleanUp(S,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,u.nextTick)(J)},V)};return this.disconnecting?(R(),this):(this._clearReconnect(),this.disconnecting=!0,!S&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,M,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),M()),this)}endAsync(S,V){return new Promise((R,J)=>{this.end(S,V,M=>{M?J(M):R()})})}removeOutgoingMessage(S){if(this.outgoing[S]){let{cb:V}=this.outgoing[S];this._removeOutgoingAndStoreMessage(S,()=>{V(new Error("Message removed"))})}return this}reconnect(S){this.log("client reconnect");let V=()=>{S?(this.options.incomingStore=S.incomingStore,this.options.outgoingStore=S.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new c.default,this.outgoingStore=this.options.outgoingStore||new c.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=V:V(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(S=>{this.outgoing[S].volatile&&typeof this.outgoing[S].cb=="function"&&(this.outgoing[S].cb(new Error("Connection closed")),delete this.outgoing[S])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(S=>{typeof this.outgoing[S].cb=="function"&&(this.outgoing[S].cb(new Error("Connection closed")),delete this.outgoing[S])}))}_removeTopicAliasAndRecoverTopicName(S){let V;S.properties&&(V=S.properties.topicAlias);let R=S.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",V,R),R.length===0){if(typeof V>"u")return new Error("Unregistered Topic Alias");if(R=this.topicAliasSend.getTopicByAlias(V),typeof R>"u")return new Error("Unregistered Topic Alias");S.topic=R}V&&delete S.properties.topicAlias}_checkDisconnecting(S){return this.disconnecting&&(S&&S!==this.noop?S(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(S,V,R={}){if(V&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",V)),this.log("_cleanUp :: forced? %s",S),S)this.options.reconnectPeriod===0&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let J=Object.assign({cmd:"disconnect"},R);this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(J,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),Z(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this._destroyKeepaliveManager(),V&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",V),V())}_storeAndSend(S,V,R){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",S.cmd);let J=S,M;if(J.cmd==="publish"&&(J=(0,I.default)(S),M=this._removeTopicAliasAndRecoverTopicName(J),M))return V&&V(M);this.outgoingStore.put(J,P=>{if(P)return V&&V(P);R(),this._writePacket(S,V)})}_applyTopicAlias(S){if(this.options.protocolVersion===5&&S.cmd==="publish"){let V;S.properties&&(V=S.properties.topicAlias);let R=S.topic.toString();if(this.topicAliasSend)if(V){if(R.length!==0&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",R,V),!this.topicAliasSend.put(R,V)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",R,V),new Error("Sending Topic Alias out of range")}else R.length!==0&&(this.options.autoAssignTopicAlias?(V=this.topicAliasSend.getAliasByTopic(R),V?(S.topic="",S.properties=Object.assign(Object.assign({},S.properties),{topicAlias:V}),this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",R,V)):(V=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(R,V),S.properties=Object.assign(Object.assign({},S.properties),{topicAlias:V}),this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",R,V))):this.options.autoUseTopicAlias&&(V=this.topicAliasSend.getAliasByTopic(R),V&&(S.topic="",S.properties=Object.assign(Object.assign({},S.properties),{topicAlias:V}),this.log("applyTopicAlias :: auto use topic: %s - alias: %d",R,V))));else if(V)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",R,V),new Error("Sending Topic Alias out of range")}}_noop(S){this.log("noop ::",S)}_writePacket(S,V){this.log("_writePacket :: packet: %O",S),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",S),this.log("_writePacket :: writing to stream");let R=s.default.writeToStream(S,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",R),!R&&V&&V!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",V)):V&&(this.log("_writePacket :: invoking cb"),V())}_sendPacket(S,V,R,J){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),R=R||this.noop,V=V||this.noop;let M=this._applyTopicAlias(S);if(M){V(M);return}if(!this.connected){if(S.cmd==="auth"){this._writePacket(S,V);return}this.log("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(S,V,R);return}if(J){this._writePacket(S,V);return}switch(S.cmd){case"publish":break;case"pubrel":this._storeAndSend(S,V,R);return;default:this._writePacket(S,V);return}switch(S.qos){case 2:case 1:this._storeAndSend(S,V,R);break;case 0:default:this._writePacket(S,V);break}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}_storePacket(S,V,R){this.log("_storePacket :: packet: %o",S),this.log("_storePacket :: cb? %s",!!V),R=R||this.noop;let J=S;if(J.cmd==="publish"){J=(0,I.default)(S);let P=this._removeTopicAliasAndRecoverTopicName(J);if(P)return V&&V(P)}let M=J.qos||0;M===0&&this.queueQoSZero||J.cmd!=="publish"?this.queue.push({packet:J,cb:V}):M>0?(V=this.outgoing[J.messageId]?this.outgoing[J.messageId].cb:null,this.outgoingStore.put(J,P=>{if(P)return V&&V(P);R()})):V&&V(new Error("No connection to broker"))}_setupKeepaliveManager(){this.log("_setupKeepaliveManager :: keepalive %d (seconds)",this.options.keepalive),!this.keepaliveManager&&this.options.keepalive&&(this.keepaliveManager=new f.default(this,this.options.timerVariant))}_destroyKeepaliveManager(){this.keepaliveManager&&(this.log("_destroyKeepaliveManager :: destroying keepalive manager"),this.keepaliveManager.destroy(),this.keepaliveManager=null)}reschedulePing(){this.keepaliveManager&&this.options.keepalive&&this.options.reschedulePings&&this._reschedulePing()}_reschedulePing(){this.log("_reschedulePing :: rescheduling ping"),this.keepaliveManager.reschedule()}sendPing(){this.log("_sendPing :: sending pingreq"),this._sendPacket({cmd:"pingreq"})}onKeepaliveTimeout(){this.emit("error",new Error("Keepalive timeout")),this.log("onKeepaliveTimeout :: calling _cleanUp with force true"),this._cleanUp(!0)}_resubscribe(){this.log("_resubscribe");let S=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&S.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){this.log("_resubscribe: protocolVersion 5");for(let V=0;V<S.length;V++){let R={};R[S[V]]=this._resubscribeTopics[S[V]],R.resubscribe=!0,this.subscribe(R,{properties:R[S[V]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(S){if(this.disconnected){this.emit("connect",S);return}this.connackPacket=S,this.messageIdProvider.clear(),this._setupKeepaliveManager(),this.connected=!0;let V=()=>{let R=this.outgoingStore.createStream(),J=()=>{R.destroy(),R=null,this._flushStoreProcessingQueue(),M()},M=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",J),R.on("error",X=>{M(),this._flushStoreProcessingQueue(),this.removeListener("close",J),this.emit("error",X)});let P=()=>{if(!R)return;let X=R.read(1),L;if(!X){R.once("readable",P);return}if(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[X.messageId]){P();return}!this.disconnecting&&!this.reconnectTimer?(L=this.outgoing[X.messageId]?this.outgoing[X.messageId].cb:null,this.outgoing[X.messageId]={volatile:!1,cb(ne,D){L&&L(ne,D),P()}},this._packetIdsDuringStoreProcessing[X.messageId]=!0,this.messageIdProvider.register(X.messageId)?this._sendPacket(X,void 0,void 0,!0):this.log("messageId: %d has already used.",X.messageId)):R.destroy&&R.destroy()};R.on("end",()=>{let X=!0;for(let L in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[L]){X=!1;break}this.removeListener("close",J),X?(M(),this._invokeAllStoreProcessingQueue(),this.emit("connect",S)):V()}),P()};V()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let S=this._storeProcessingQueue[0];if(S&&S.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let S of this._storeProcessingQueue)S.cbStorePut&&S.cbStorePut(new Error("Connection closed")),S.callback&&S.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(S,V){delete this.outgoing[S],this.outgoingStore.del({messageId:S},(R,J)=>{V(R,J),this.messageIdProvider.deallocate(S),this._invokeStoreProcessingQueue()})}};B.VERSION=u.MQTTJS_VERSION,e.default=B}),wT=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=Bv(),n=class{constructor(){this.numberAllocator=new t.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(g){return this.numberAllocator.use(g)}deallocate(g){this.numberAllocator.free(g)}clear(){this.numberAllocator.clear()}};e.default=n});function qi(e){throw new RangeError(Wv[e])}function hy(e,t){let n=e.split("@"),g="";n.length>1&&(g=n[0]+"@",e=n[1]);let i=function(o,s){let r=[],l=o.length;for(;l--;)r[l]=s(o[l]);return r}((e=e.replace(Vv,".")).split("."),t).join(".");return g+i}function my(e){let t=[],n=0,g=e.length;for(;n<g;){let i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<g){let o=e.charCodeAt(n++);(64512&o)==56320?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}var by,py,Vv,Wv,Dn,GI,Cd,cd,dd,ud,ri,JT=Tt(()=>{he(),Ae(),ue(),by=/^xn--/,py=/[^\0-\x7E]/,Vv=/[\x2E\u3002\uFF0E\uFF61]/g,Wv={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Dn=Math.floor,GI=String.fromCharCode,Cd=function(e,t){return e+22+75*(e<26)-((t!=0)<<5)},cd=function(e,t,n){let g=0;for(e=n?Dn(e/700):e>>1,e+=Dn(e/t);e>455;g+=36)e=Dn(e/35);return Dn(g+36*e/(e+38))},dd=function(e){let t=[],n=e.length,g=0,i=128,o=72,s=e.lastIndexOf("-");s<0&&(s=0);for(let l=0;l<s;++l)e.charCodeAt(l)>=128&&qi("not-basic"),t.push(e.charCodeAt(l));for(let l=s>0?s+1:0;l<n;){let I=g;for(let C=1,c=36;;c+=36){l>=n&&qi("invalid-input");let d=(r=e.charCodeAt(l++))-48<10?r-22:r-65<26?r-65:r-97<26?r-97:36;(d>=36||d>Dn((2147483647-g)/C))&&qi("overflow"),g+=d*C;let u=c<=o?1:c>=o+26?26:c-o;if(d<u)break;let h=36-u;C>Dn(2147483647/h)&&qi("overflow"),C*=h}let a=t.length+1;o=cd(g-I,a,I==0),Dn(g/a)>2147483647-i&&qi("overflow"),i+=Dn(g/a),g%=a,t.splice(g++,0,i)}var r;return String.fromCodePoint(...t)},ud=function(e){let t=[],n=(e=my(e)).length,g=128,i=0,o=72;for(let l of e)l<128&&t.push(GI(l));let s=t.length,r=s;for(s&&t.push("-");r<n;){let l=2147483647;for(let a of e)a>=g&&a<l&&(l=a);let I=r+1;l-g>Dn((2147483647-i)/I)&&qi("overflow"),i+=(l-g)*I,g=l;for(let a of e)if(a<g&&++i>2147483647&&qi("overflow"),a==g){let C=i;for(let c=36;;c+=36){let d=c<=o?1:c>=o+26?26:c-o;if(C<d)break;let u=C-d,h=36-d;t.push(GI(Cd(d+u%h,0))),C=Dn(u/h)}t.push(GI(Cd(C,0))),o=cd(i,I,r==s),i=0,++r}++i,++g}return t.join("")},ri={version:"2.1.0",ucs2:{decode:my,encode:e=>String.fromCodePoint(...e)},decode:dd,encode:ud,toASCII:function(e){return hy(e,function(t){return py.test(t)?"xn--"+ud(t):t})},toUnicode:function(e){return hy(e,function(t){return by.test(t)?dd(t.slice(4).toLowerCase()):t})}},ri.decode,ri.encode,ri.toASCII,ri.toUnicode,ri.ucs2,ri.version});function YT(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var fy,Oo,Zy,rg,HT=Tt(()=>{he(),Ae(),ue(),fy=function(e,t,n,g){t=t||"&",n=n||"=";var i={};if(typeof e!="string"||e.length===0)return i;var o=/\+/g;e=e.split(t);var s=1e3;g&&typeof g.maxKeys=="number"&&(s=g.maxKeys);var r=e.length;s>0&&r>s&&(r=s);for(var l=0;l<r;++l){var I,a,C,c,d=e[l].replace(o,"%20"),u=d.indexOf(n);u>=0?(I=d.substr(0,u),a=d.substr(u+1)):(I=d,a=""),C=decodeURIComponent(I),c=decodeURIComponent(a),YT(i,C)?Array.isArray(i[C])?i[C].push(c):i[C]=[i[C],c]:i[C]=c}return i},Oo=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},Zy=function(e,t,n,g){return t=t||"&",n=n||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(i){var o=encodeURIComponent(Oo(i))+n;return Array.isArray(e[i])?e[i].map(function(s){return o+encodeURIComponent(Oo(s))}).join(t):o+encodeURIComponent(Oo(e[i]))}).join(t):g?encodeURIComponent(Oo(g))+n+encodeURIComponent(Oo(e)):""},rg={},rg.decode=rg.parse=fy,rg.encode=rg.stringify=Zy,rg.decode,rg.encode,rg.parse,rg.stringify});function lh(){throw new Error("setTimeout has not been defined")}function Ih(){throw new Error("clearTimeout has not been defined")}function Rv(e){if(Vg===setTimeout)return setTimeout(e,0);if((Vg===lh||!Vg)&&setTimeout)return Vg=setTimeout,setTimeout(e,0);try{return Vg(e,0)}catch{try{return Vg.call(null,e,0)}catch{return Vg.call(this||Go,e,0)}}}function NT(){Bo&&uo&&(Bo=!1,uo.length?ug=uo.concat(ug):Lr=-1,ug.length&&vv())}function vv(){if(!Bo){var e=Rv(NT);Bo=!0;for(var t=ug.length;t;){for(uo=ug,ug=[];++Lr<t;)uo&&uo[Lr].run();Lr=-1,t=ug.length}uo=null,Bo=!1,function(n){if(Wg===clearTimeout)return clearTimeout(n);if((Wg===Ih||!Wg)&&clearTimeout)return Wg=clearTimeout,clearTimeout(n);try{Wg(n)}catch{try{return Wg.call(null,n)}catch{return Wg.call(this||Go,n)}}}(e)}}function yy(e,t){(this||Go).fun=e,(this||Go).array=t}function fg(){}var Gy,Vg,Wg,Go,At,uo,ug,Bo,Lr,It,FT=Tt(()=>{he(),Ae(),ue(),Go=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,At=Gy={},function(){try{Vg=typeof setTimeout=="function"?setTimeout:lh}catch{Vg=lh}try{Wg=typeof clearTimeout=="function"?clearTimeout:Ih}catch{Wg=Ih}}(),ug=[],Bo=!1,Lr=-1,At.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ug.push(new yy(e,t)),ug.length!==1||Bo||Rv(vv)},yy.prototype.run=function(){(this||Go).fun.apply(null,(this||Go).array)},At.title="browser",At.browser=!0,At.env={},At.argv=[],At.version="",At.versions={},At.on=fg,At.addListener=fg,At.once=fg,At.off=fg,At.removeListener=fg,At.removeAllListeners=fg,At.emit=fg,At.prependListener=fg,At.prependOnceListener=fg,At.listeners=function(e){return[]},At.binding=function(e){throw new Error("process.binding is not supported")},At.cwd=function(){return"/"},At.chdir=function(e){throw new Error("process.chdir is not supported")},At.umask=function(){return 0},It=Gy,It.addListener,It.argv,It.binding,It.browser,It.chdir,It.cwd,It.emit,It.env,It.listeners,It.nextTick,It.off,It.on,It.once,It.prependListener,It.prependOnceListener,It.removeAllListeners,It.removeListener,It.title,It.umask,It.version,It.versions});function xT(){if(ah)return ta;ah=!0;var e=ta={},t,n;function g(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?t=setTimeout:t=g}catch{t=g}try{typeof clearTimeout=="function"?n=clearTimeout:n=i}catch{n=i}})();function o(h){if(t===setTimeout)return setTimeout(h,0);if((t===g||!t)&&setTimeout)return t=setTimeout,setTimeout(h,0);try{return t(h,0)}catch{try{return t.call(null,h,0)}catch{return t.call(this||oo,h,0)}}}function s(h){if(n===clearTimeout)return clearTimeout(h);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(h);try{return n(h)}catch{try{return n.call(null,h)}catch{return n.call(this||oo,h)}}}var r=[],l=!1,I,a=-1;function C(){!l||!I||(l=!1,I.length?r=I.concat(r):a=-1,r.length&&c())}function c(){if(!l){var h=o(C);l=!0;for(var f=r.length;f;){for(I=r,r=[];++a<f;)I&&I[a].run();a=-1,f=r.length}I=null,l=!1,s(h)}}e.nextTick=function(h){var f=new Array(arguments.length-1);if(arguments.length>1)for(var y=1;y<arguments.length;y++)f[y-1]=arguments[y];r.push(new d(h,f)),r.length===1&&!l&&o(c)};function d(h,f){(this||oo).fun=h,(this||oo).array=f}d.prototype.run=function(){(this||oo).fun.apply(null,(this||oo).array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={};function u(){}return e.on=u,e.addListener=u,e.once=u,e.off=u,e.removeListener=u,e.removeAllListeners=u,e.emit=u,e.prependListener=u,e.prependOnceListener=u,e.listeners=function(h){return[]},e.binding=function(h){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(h){throw new Error("process.chdir is not supported")},e.umask=function(){return 0},ta}var ta,ah,oo,st,kv=Tt(()=>{he(),Ae(),ue(),ta={},ah=!1,oo=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,st=xT(),st.platform="browser",st.addListener,st.argv,st.binding,st.browser,st.chdir,st.cwd,st.emit,st.env,st.listeners,st.nextTick,st.off,st.on,st.once,st.prependListener,st.prependOnceListener,st.removeAllListeners,st.removeListener,st.title,st.umask,st.version,st.versions});function KT(){if(Ch)return na;Ch=!0;var e=st;function t(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function n(o,s){for(var r="",l=0,I=-1,a=0,C,c=0;c<=o.length;++c){if(c<o.length)C=o.charCodeAt(c);else{if(C===47)break;C=47}if(C===47){if(!(I===c-1||a===1))if(I!==c-1&&a===2){if(r.length<2||l!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){var d=r.lastIndexOf("/");if(d!==r.length-1){d===-1?(r="",l=0):(r=r.slice(0,d),l=r.length-1-r.lastIndexOf("/")),I=c,a=0;continue}}else if(r.length===2||r.length===1){r="",l=0,I=c,a=0;continue}}s&&(r.length>0?r+="/..":r="..",l=2)}else r.length>0?r+="/"+o.slice(I+1,c):r=o.slice(I+1,c),l=c-I-1;I=c,a=0}else C===46&&a!==-1?++a:a=-1}return r}function g(o,s){var r=s.dir||s.root,l=s.base||(s.name||"")+(s.ext||"");return r?r===s.root?r+l:r+o+l:l}var i={resolve:function(){for(var o="",s=!1,r,l=arguments.length-1;l>=-1&&!s;l--){var I;l>=0?I=arguments[l]:(r===void 0&&(r=e.cwd()),I=r),t(I),I.length!==0&&(o=I+"/"+o,s=I.charCodeAt(0)===47)}return o=n(o,!s),s?o.length>0?"/"+o:"/":o.length>0?o:"."},normalize:function(o){if(t(o),o.length===0)return".";var s=o.charCodeAt(0)===47,r=o.charCodeAt(o.length-1)===47;return o=n(o,!s),o.length===0&&!s&&(o="."),o.length>0&&r&&(o+="/"),s?"/"+o:o},isAbsolute:function(o){return t(o),o.length>0&&o.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var o,s=0;s<arguments.length;++s){var r=arguments[s];t(r),r.length>0&&(o===void 0?o=r:o+="/"+r)}return o===void 0?".":i.normalize(o)},relative:function(o,s){if(t(o),t(s),o===s||(o=i.resolve(o),s=i.resolve(s),o===s))return"";for(var r=1;r<o.length&&o.charCodeAt(r)===47;++r);for(var l=o.length,I=l-r,a=1;a<s.length&&s.charCodeAt(a)===47;++a);for(var C=s.length,c=C-a,d=I<c?I:c,u=-1,h=0;h<=d;++h){if(h===d){if(c>d){if(s.charCodeAt(a+h)===47)return s.slice(a+h+1);if(h===0)return s.slice(a+h)}else I>d&&(o.charCodeAt(r+h)===47?u=h:h===0&&(u=0));break}var f=o.charCodeAt(r+h),y=s.charCodeAt(a+h);if(f!==y)break;f===47&&(u=h)}var Z="";for(h=r+u+1;h<=l;++h)(h===l||o.charCodeAt(h)===47)&&(Z.length===0?Z+="..":Z+="/..");return Z.length>0?Z+s.slice(a+u):(a+=u,s.charCodeAt(a)===47&&++a,s.slice(a))},_makeLong:function(o){return o},dirname:function(o){if(t(o),o.length===0)return".";for(var s=o.charCodeAt(0),r=s===47,l=-1,I=!0,a=o.length-1;a>=1;--a)if(s=o.charCodeAt(a),s===47){if(!I){l=a;break}}else I=!1;return l===-1?r?"/":".":r&&l===1?"//":o.slice(0,l)},basename:function(o,s){if(s!==void 0&&typeof s!="string")throw new TypeError('"ext" argument must be a string');t(o);var r=0,l=-1,I=!0,a;if(s!==void 0&&s.length>0&&s.length<=o.length){if(s.length===o.length&&s===o)return"";var C=s.length-1,c=-1;for(a=o.length-1;a>=0;--a){var d=o.charCodeAt(a);if(d===47){if(!I){r=a+1;break}}else c===-1&&(I=!1,c=a+1),C>=0&&(d===s.charCodeAt(C)?--C===-1&&(l=a):(C=-1,l=c))}return r===l?l=c:l===-1&&(l=o.length),o.slice(r,l)}else{for(a=o.length-1;a>=0;--a)if(o.charCodeAt(a)===47){if(!I){r=a+1;break}}else l===-1&&(I=!1,l=a+1);return l===-1?"":o.slice(r,l)}},extname:function(o){t(o);for(var s=-1,r=0,l=-1,I=!0,a=0,C=o.length-1;C>=0;--C){var c=o.charCodeAt(C);if(c===47){if(!I){r=C+1;break}continue}l===-1&&(I=!1,l=C+1),c===46?s===-1?s=C:a!==1&&(a=1):s!==-1&&(a=-1)}return s===-1||l===-1||a===0||a===1&&s===l-1&&s===r+1?"":o.slice(s,l)},format:function(o){if(o===null||typeof o!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof o);return g("/",o)},parse:function(o){t(o);var s={root:"",dir:"",base:"",ext:"",name:""};if(o.length===0)return s;var r=o.charCodeAt(0),l=r===47,I;l?(s.root="/",I=1):I=0;for(var a=-1,C=0,c=-1,d=!0,u=o.length-1,h=0;u>=I;--u){if(r=o.charCodeAt(u),r===47){if(!d){C=u+1;break}continue}c===-1&&(d=!1,c=u+1),r===46?a===-1?a=u:h!==1&&(h=1):a!==-1&&(h=-1)}return a===-1||c===-1||h===0||h===1&&a===c-1&&a===C+1?c!==-1&&(C===0&&l?s.base=s.name=o.slice(1,c):s.base=s.name=o.slice(C,c)):(C===0&&l?(s.name=o.slice(1,a),s.base=o.slice(1,c)):(s.name=o.slice(C,a),s.base=o.slice(C,c)),s.ext=o.slice(a,c)),C>0?s.dir=o.slice(0,C-1):l&&(s.dir="/"),s},sep:"/",delimiter:":",win32:null,posix:null};return i.posix=i,na=i,na}var na,Ch,ch,ET=Tt(()=>{he(),Ae(),ue(),kv(),na={},Ch=!1,ch=KT()}),Xv={};To(Xv,{URL:()=>Pv,Url:()=>Uv,default:()=>Pe,fileURLToPath:()=>wv,format:()=>zv,parse:()=>jv,pathToFileURL:()=>Jv,resolve:()=>Dv,resolveObject:()=>Qv});function Nn(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function cr(e,t,n){if(e&&jn.isObject(e)&&e instanceof Nn)return e;var g=new Nn;return g.parse(e,t,n),g}function MT(){if(dh)return ga;dh=!0;var e=It;function t(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function n(o,s){for(var r="",l=0,I=-1,a=0,C,c=0;c<=o.length;++c){if(c<o.length)C=o.charCodeAt(c);else{if(C===47)break;C=47}if(C===47){if(!(I===c-1||a===1))if(I!==c-1&&a===2){if(r.length<2||l!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){var d=r.lastIndexOf("/");if(d!==r.length-1){d===-1?(r="",l=0):(r=r.slice(0,d),l=r.length-1-r.lastIndexOf("/")),I=c,a=0;continue}}else if(r.length===2||r.length===1){r="",l=0,I=c,a=0;continue}}s&&(r.length>0?r+="/..":r="..",l=2)}else r.length>0?r+="/"+o.slice(I+1,c):r=o.slice(I+1,c),l=c-I-1;I=c,a=0}else C===46&&a!==-1?++a:a=-1}return r}function g(o,s){var r=s.dir||s.root,l=s.base||(s.name||"")+(s.ext||"");return r?r===s.root?r+l:r+o+l:l}var i={resolve:function(){for(var o="",s=!1,r,l=arguments.length-1;l>=-1&&!s;l--){var I;l>=0?I=arguments[l]:(r===void 0&&(r=e.cwd()),I=r),t(I),I.length!==0&&(o=I+"/"+o,s=I.charCodeAt(0)===47)}return o=n(o,!s),s?o.length>0?"/"+o:"/":o.length>0?o:"."},normalize:function(o){if(t(o),o.length===0)return".";var s=o.charCodeAt(0)===47,r=o.charCodeAt(o.length-1)===47;return o=n(o,!s),o.length===0&&!s&&(o="."),o.length>0&&r&&(o+="/"),s?"/"+o:o},isAbsolute:function(o){return t(o),o.length>0&&o.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var o,s=0;s<arguments.length;++s){var r=arguments[s];t(r),r.length>0&&(o===void 0?o=r:o+="/"+r)}return o===void 0?".":i.normalize(o)},relative:function(o,s){if(t(o),t(s),o===s||(o=i.resolve(o),s=i.resolve(s),o===s))return"";for(var r=1;r<o.length&&o.charCodeAt(r)===47;++r);for(var l=o.length,I=l-r,a=1;a<s.length&&s.charCodeAt(a)===47;++a);for(var C=s.length,c=C-a,d=I<c?I:c,u=-1,h=0;h<=d;++h){if(h===d){if(c>d){if(s.charCodeAt(a+h)===47)return s.slice(a+h+1);if(h===0)return s.slice(a+h)}else I>d&&(o.charCodeAt(r+h)===47?u=h:h===0&&(u=0));break}var f=o.charCodeAt(r+h),y=s.charCodeAt(a+h);if(f!==y)break;f===47&&(u=h)}var Z="";for(h=r+u+1;h<=l;++h)(h===l||o.charCodeAt(h)===47)&&(Z.length===0?Z+="..":Z+="/..");return Z.length>0?Z+s.slice(a+u):(a+=u,s.charCodeAt(a)===47&&++a,s.slice(a))},_makeLong:function(o){return o},dirname:function(o){if(t(o),o.length===0)return".";for(var s=o.charCodeAt(0),r=s===47,l=-1,I=!0,a=o.length-1;a>=1;--a)if(s=o.charCodeAt(a),s===47){if(!I){l=a;break}}else I=!1;return l===-1?r?"/":".":r&&l===1?"//":o.slice(0,l)},basename:function(o,s){if(s!==void 0&&typeof s!="string")throw new TypeError('"ext" argument must be a string');t(o);var r=0,l=-1,I=!0,a;if(s!==void 0&&s.length>0&&s.length<=o.length){if(s.length===o.length&&s===o)return"";var C=s.length-1,c=-1;for(a=o.length-1;a>=0;--a){var d=o.charCodeAt(a);if(d===47){if(!I){r=a+1;break}}else c===-1&&(I=!1,c=a+1),C>=0&&(d===s.charCodeAt(C)?--C===-1&&(l=a):(C=-1,l=c))}return r===l?l=c:l===-1&&(l=o.length),o.slice(r,l)}else{for(a=o.length-1;a>=0;--a)if(o.charCodeAt(a)===47){if(!I){r=a+1;break}}else l===-1&&(I=!1,l=a+1);return l===-1?"":o.slice(r,l)}},extname:function(o){t(o);for(var s=-1,r=0,l=-1,I=!0,a=0,C=o.length-1;C>=0;--C){var c=o.charCodeAt(C);if(c===47){if(!I){r=C+1;break}continue}l===-1&&(I=!1,l=C+1),c===46?s===-1?s=C:a!==1&&(a=1):s!==-1&&(a=-1)}return s===-1||l===-1||a===0||a===1&&s===l-1&&s===r+1?"":o.slice(s,l)},format:function(o){if(o===null||typeof o!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof o);return g("/",o)},parse:function(o){t(o);var s={root:"",dir:"",base:"",ext:"",name:""};if(o.length===0)return s;var r=o.charCodeAt(0),l=r===47,I;l?(s.root="/",I=1):I=0;for(var a=-1,C=0,c=-1,d=!0,u=o.length-1,h=0;u>=I;--u){if(r=o.charCodeAt(u),r===47){if(!d){C=u+1;break}continue}c===-1&&(d=!1,c=u+1),r===46?a===-1?a=u:h!==1&&(h=1):a!==-1&&(h=-1)}return a===-1||c===-1||h===0||h===1&&a===c-1&&a===C+1?c!==-1&&(C===0&&l?s.base=s.name=o.slice(1,c):s.base=s.name=o.slice(C,c)):(C===0&&l?(s.name=o.slice(1,a),s.base=o.slice(1,c)):(s.name=o.slice(C,a),s.base=o.slice(C,c)),s.ext=o.slice(a,c)),C>0?s.dir=o.slice(0,C-1):l&&(s.dir="/"),s},sep:"/",delimiter:":",win32:null,posix:null};return i.posix=i,ga=i,ga}function TT(e){if(typeof e=="string")e=new URL(e);else if(!(e instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(e.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return tC?LT(e):UT(e)}function LT(e){let t=e.hostname,n=e.pathname;for(let g=0;g<n.length;g++)if(n[g]==="%"){let i=n.codePointAt(g+2)||32;if(n[g+1]==="2"&&i===102||n[g+1]==="5"&&i===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(n=n.replace(xv,"\\"),n=decodeURIComponent(n),t!=="")return`\\\\${t}${n}`;{let g=n.codePointAt(1)|32,i=n[2];if(g<Nv||g>Fv||i!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return n.slice(1)}}function UT(e){if(e.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let t=e.pathname;for(let n=0;n<t.length;n++)if(t[n]==="%"){let g=t.codePointAt(n+2)||32;if(t[n+1]==="2"&&g===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(t)}function zT(e){let t=uh.resolve(e),n=e.charCodeAt(e.length-1);(n===Hv||tC&&n===Yv)&&t[t.length-1]!==uh.sep&&(t+="/");let g=new URL("file://");return t.includes("%")&&(t=t.replace(Kv,"%25")),!tC&&t.includes("\\")&&(t=t.replace(Ev,"%5C")),t.includes(`
`)&&(t=t.replace(Mv,"%0A")),t.includes("\r")&&(t=t.replace(Tv,"%0D")),t.includes("	")&&(t=t.replace(Lv,"%09")),g.pathname=t,g}function wv(e){if(typeof e=="string")e=new URL(e);else if(!(e instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(e.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return nC?DT(e):QT(e)}function DT(e){let t=e.hostname,n=e.pathname;for(let g=0;g<n.length;g++)if(n[g]==="%"){let i=n.codePointAt(g+2)||32;if(n[g+1]==="2"&&i===102||n[g+1]==="5"&&i===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(n=n.replace(ek,"\\"),n=decodeURIComponent(n),t!=="")return`\\\\${t}${n}`;{let g=n.codePointAt(1)|32,i=n[2];if(g<qv||g>$v||i!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return n.slice(1)}}function QT(e){if(e.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let t=e.pathname;for(let n=0;n<t.length;n++)if(t[n]==="%"){let g=t.codePointAt(n+2)||32;if(t[n+1]==="2"&&g===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(t)}function Jv(e){let t=ch.resolve(e),n=e.charCodeAt(e.length-1);(n===_v||nC&&n===Ov)&&t[t.length-1]!==ch.sep&&(t+="/");let g=new URL("file://");return t.includes("%")&&(t=t.replace(tk,"%25")),!nC&&t.includes("\\")&&(t=t.replace(nk,"%5C")),t.includes(`
`)&&(t=t.replace(gk,"%0A")),t.includes("\r")&&(t=t.replace(ik,"%0D")),t.includes("	")&&(t=t.replace(ok,"%09")),g.pathname=t,g}var Pe,By,jn,Sy,Vy,Wy,Ry,BI,Ad,hd,md,vy,ky,SI,$i,VI,ga,dh,uh,Xy,Yv,Hv,Nv,Fv,tC,xv,Kv,Ev,Mv,Tv,Lv,wy,Uv,zv,Dv,Qv,jv,Pv,Ov,_v,qv,$v,nC,ek,tk,nk,gk,ik,ok,jT=Tt(()=>{he(),Ae(),ue(),JT(),HT(),FT(),ET(),kv(),Pe={},By=ri,jn={isString:function(e){return typeof e=="string"},isObject:function(e){return typeof e=="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}},Pe.parse=cr,Pe.resolve=function(e,t){return cr(e,!1,!0).resolve(t)},Pe.resolveObject=function(e,t){return e?cr(e,!1,!0).resolveObject(t):t},Pe.format=function(e){return jn.isString(e)&&(e=cr(e)),e instanceof Nn?e.format():Nn.prototype.format.call(e)},Pe.Url=Nn,Sy=/^([a-z0-9.+-]+:)/i,Vy=/:[0-9]*$/,Wy=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Ry=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),BI=["'"].concat(Ry),Ad=["%","/","?",";","#"].concat(BI),hd=["/","?","#"],md=/^[+a-z0-9A-Z_-]{0,63}$/,vy=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,ky={javascript:!0,"javascript:":!0},SI={javascript:!0,"javascript:":!0},$i={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},VI=rg,Nn.prototype.parse=function(e,t,n){if(!jn.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var g=e.indexOf("?"),i=g!==-1&&g<e.indexOf("#")?"?":"#",o=e.split(i);o[0]=o[0].replace(/\\/g,"/");var s=e=o.join(i);if(s=s.trim(),!n&&e.split("#").length===1){var r=Wy.exec(s);if(r)return this.path=s,this.href=s,this.pathname=r[1],r[2]?(this.search=r[2],this.query=t?VI.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=Sy.exec(s);if(l){var I=(l=l[0]).toLowerCase();this.protocol=I,s=s.substr(l.length)}if(n||l||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var a=s.substr(0,2)==="//";!a||l&&SI[l]||(s=s.substr(2),this.slashes=!0)}if(!SI[l]&&(a||l&&!$i[l])){for(var C,c,d=-1,u=0;u<hd.length;u++)(h=s.indexOf(hd[u]))!==-1&&(d===-1||h<d)&&(d=h);for((c=d===-1?s.lastIndexOf("@"):s.lastIndexOf("@",d))!==-1&&(C=s.slice(0,c),s=s.slice(c+1),this.auth=decodeURIComponent(C)),d=-1,u=0;u<Ad.length;u++){var h;(h=s.indexOf(Ad[u]))!==-1&&(d===-1||h<d)&&(d=h)}d===-1&&(d=s.length),this.host=s.slice(0,d),s=s.slice(d),this.parseHost(),this.hostname=this.hostname||"";var f=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!f)for(var y=this.hostname.split(/\./),Z=(u=0,y.length);u<Z;u++){var p=y[u];if(p&&!p.match(md)){for(var B="",W=0,S=p.length;W<S;W++)p.charCodeAt(W)>127?B+="x":B+=p[W];if(!B.match(md)){var V=y.slice(0,u),R=y.slice(u+1),J=p.match(vy);J&&(V.push(J[1]),R.unshift(J[2])),R.length&&(s="/"+R.join(".")+s),this.hostname=V.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),f||(this.hostname=By.toASCII(this.hostname));var M=this.port?":"+this.port:"",P=this.hostname||"";this.host=P+M,this.href+=this.host,f&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),s[0]!=="/"&&(s="/"+s))}if(!ky[I])for(u=0,Z=BI.length;u<Z;u++){var X=BI[u];if(s.indexOf(X)!==-1){var L=encodeURIComponent(X);L===X&&(L=escape(X)),s=s.split(X).join(L)}}var ne=s.indexOf("#");ne!==-1&&(this.hash=s.substr(ne),s=s.slice(0,ne));var D=s.indexOf("?");if(D!==-1?(this.search=s.substr(D),this.query=s.substr(D+1),t&&(this.query=VI.parse(this.query)),s=s.slice(0,D)):t&&(this.search="",this.query={}),s&&(this.pathname=s),$i[I]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){M=this.pathname||"";var ie=this.search||"";this.path=M+ie}return this.href=this.format(),this},Nn.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",g=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&jn.isObject(this.query)&&Object.keys(this.query).length&&(o=VI.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||$i[t])&&i!==!1?(i="//"+(i||""),n&&n.charAt(0)!=="/"&&(n="/"+n)):i||(i=""),g&&g.charAt(0)!=="#"&&(g="#"+g),s&&s.charAt(0)!=="?"&&(s="?"+s),t+i+(n=n.replace(/[?#]/g,function(r){return encodeURIComponent(r)}))+(s=s.replace("#","%23"))+g},Nn.prototype.resolve=function(e){return this.resolveObject(cr(e,!1,!0)).format()},Nn.prototype.resolveObject=function(e){if(jn.isString(e)){var t=new Nn;t.parse(e,!1,!0),e=t}for(var n=new Nn,g=Object.keys(this),i=0;i<g.length;i++){var o=g[i];n[o]=this[o]}if(n.hash=e.hash,e.href==="")return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),r=0;r<s.length;r++){var l=s[r];l!=="protocol"&&(n[l]=e[l])}return $i[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!$i[e.protocol]){for(var I=Object.keys(e),a=0;a<I.length;a++){var C=I[a];n[C]=e[C]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||SI[e.protocol])n.pathname=e.pathname;else{for(var c=(e.pathname||"").split("/");c.length&&!(e.host=c.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),c[0]!==""&&c.unshift(""),c.length<2&&c.unshift(""),n.pathname=c.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var d=n.pathname||"",u=n.search||"";n.path=d+u}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var h=n.pathname&&n.pathname.charAt(0)==="/",f=e.host||e.pathname&&e.pathname.charAt(0)==="/",y=f||h||n.host&&e.pathname,Z=y,p=n.pathname&&n.pathname.split("/")||[],B=(c=e.pathname&&e.pathname.split("/")||[],n.protocol&&!$i[n.protocol]);if(B&&(n.hostname="",n.port=null,n.host&&(p[0]===""?p[0]=n.host:p.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(c[0]===""?c[0]=e.host:c.unshift(e.host)),e.host=null),y=y&&(c[0]===""||p[0]==="")),f)n.host=e.host||e.host===""?e.host:n.host,n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname,n.search=e.search,n.query=e.query,p=c;else if(c.length)p||(p=[]),p.pop(),p=p.concat(c),n.search=e.search,n.query=e.query;else if(!jn.isNullOrUndefined(e.search))return B&&(n.hostname=n.host=p.shift(),(J=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=J.shift(),n.host=n.hostname=J.shift())),n.search=e.search,n.query=e.query,jn.isNull(n.pathname)&&jn.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!p.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var W=p.slice(-1)[0],S=(n.host||e.host||p.length>1)&&(W==="."||W==="..")||W==="",V=0,R=p.length;R>=0;R--)(W=p[R])==="."?p.splice(R,1):W===".."?(p.splice(R,1),V++):V&&(p.splice(R,1),V--);if(!y&&!Z)for(;V--;V)p.unshift("..");!y||p[0]===""||p[0]&&p[0].charAt(0)==="/"||p.unshift(""),S&&p.join("/").substr(-1)!=="/"&&p.push("");var J,M=p[0]===""||p[0]&&p[0].charAt(0)==="/";return B&&(n.hostname=n.host=M?"":p.length?p.shift():"",(J=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=J.shift(),n.host=n.hostname=J.shift())),(y=y||n.host&&p.length)&&!M&&p.unshift(""),p.length?n.pathname=p.join("/"):(n.pathname=null,n.path=null),jn.isNull(n.pathname)&&jn.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},Nn.prototype.parseHost=function(){var e=this.host,t=Vy.exec(e);t&&((t=t[0])!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},Pe.Url,Pe.format,Pe.resolve,Pe.resolveObject,ga={},dh=!1,uh=MT(),Xy=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,Pe.URL=typeof URL<"u"?URL:null,Pe.pathToFileURL=zT,Pe.fileURLToPath=TT,Pe.Url,Pe.format,Pe.resolve,Pe.resolveObject,Pe.URL,Yv=92,Hv=47,Nv=97,Fv=122,tC=Xy==="win32",xv=/\//g,Kv=/%/g,Ev=/\\/g,Mv=/\n/g,Tv=/\r/g,Lv=/\t/g,wy=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,Pe.URL=typeof URL<"u"?URL:null,Pe.pathToFileURL=Jv,Pe.fileURLToPath=wv,Uv=Pe.Url,zv=Pe.format,Dv=Pe.resolve,Qv=Pe.resolveObject,jv=Pe.parse,Pv=Pe.URL,Ov=92,_v=47,qv=97,$v=122,nC=wy==="win32",ek=/\//g,tk=/%/g,nk=/\\/g,gk=/\n/g,ik=/\r/g,ok=/\t/g}),vb={};To(vb,{Server:()=>rt,Socket:()=>rt,Stream:()=>rt,_createServerHandle:()=>rt,_normalizeArgs:()=>rt,_setSimultaneousAccepts:()=>rt,connect:()=>rt,createConnection:()=>rt,createServer:()=>rt,default:()=>sk,isIP:()=>rt,isIPv4:()=>rt,isIPv6:()=>rt});function rt(){throw new Error("Node.js net module is not supported by JSPM core outside of Node.js")}var sk,rk=Tt(()=>{he(),Ae(),ue(),sk={_createServerHandle:rt,_normalizeArgs:rt,_setSimultaneousAccepts:rt,connect:rt,createConnection:rt,createServer:rt,isIP:rt,isIPv4:rt,isIPv6:rt,Server:rt,Socket:rt,Stream:rt}}),Jy=Ze(e=>{he(),Ae(),ue();var t=e&&e.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0});var n=t((rk(),$e(vb))),g=t(Qg()),i=(0,g.default)("mqttjs:tcp"),o=(s,r)=>{r.port=r.port||1883,r.hostname=r.hostname||r.host||"localhost";let{port:l,path:I}=r,a=r.hostname;return i("port %d and host %s",l,a),n.default.createConnection({port:l,host:a,path:I})};e.default=o}),lk={};To(lk,{default:()=>Ik});var Ik,PT=Tt(()=>{he(),Ae(),ue(),Ik={}}),Yy=Ze(e=>{he(),Ae(),ue();var t=e&&e.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0});var n=t((PT(),$e(lk))),g=t((rk(),$e(vb))),i=t(Qg()),o=(0,i.default)("mqttjs:tls"),s=(r,l)=>{l.port=l.port||8883,l.host=l.hostname||l.host||"localhost",g.default.isIP(l.host)===0&&(l.servername=l.host),l.rejectUnauthorized=l.rejectUnauthorized!==!1,delete l.path,o("port %d host %s rejectUnauthorized %b",l.port,l.host,l.rejectUnauthorized);let I=n.default.connect(l);I.on("secureConnect",()=>{l.rejectUnauthorized&&!I.authorized?I.emit("error",new Error("TLS not authorized")):I.removeListener("error",a)});function a(C){l.rejectUnauthorized&&r.emit("error",C),I.end()}return I.on("error",a),I};e.default=s}),kb=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0}),e.BufferedDuplex=e.writev=void 0;var t=zo(),n=(Ut(),$e(Lt));function g(o,s){let r=new Array(o.length);for(let l=0;l<o.length;l++)typeof o[l].chunk=="string"?r[l]=n.Buffer.from(o[l].chunk,"utf8"):r[l]=o[l].chunk;this._write(n.Buffer.concat(r),"binary",s)}e.writev=g;var i=class extends t.Duplex{constructor(o,s,r){super({objectMode:!0}),this.proxy=s,this.socket=r,this.writeQueue=[],o.objectMode||(this._writev=g.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",l=>{this.push(l)})}_read(o){this.proxy.read(o)}_write(o,s,r){this.isSocketOpen?this.writeToProxy(o,s,r):this.writeQueue.push({chunk:o,encoding:s,cb:r})}_final(o){this.writeQueue=[],this.proxy.end(o)}_destroy(o,s){this.writeQueue=[],this.proxy.destroy(),s(o)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(o,s,r){this.proxy.write(o,s)===!1?this.proxy.once("drain",r):r()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:o,encoding:s,cb:r}=this.writeQueue.shift();this.writeToProxy(o,s,r)}}};e.BufferedDuplex=i}),Hy=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=(Ut(),$e(Lt)),n=zo(),g=kb(),i,o,s;function r(){let c=new n.Transform;return c._write=(d,u,h)=>{i.send({data:d.buffer,success(){h()},fail(f){h(new Error(f))}})},c._flush=d=>{i.close({success(){d()}})},c}function l(c){c.hostname||(c.hostname="localhost"),c.path||(c.path="/"),c.wsOptions||(c.wsOptions={})}function I(c,d){let u=c.protocol==="wxs"?"wss":"ws",h=`${u}://${c.hostname}${c.path}`;return c.port&&c.port!==80&&c.port!==443&&(h=`${u}://${c.hostname}:${c.port}${c.path}`),typeof c.transformWsUrl=="function"&&(h=c.transformWsUrl(h,c,d)),h}function a(){i.onOpen(()=>{s.socketReady()}),i.onMessage(c=>{let{data:d}=c;d instanceof ArrayBuffer?d=t.Buffer.from(d):d=t.Buffer.from(d,"utf8"),o.push(d)}),i.onClose(()=>{s.emit("close"),s.end(),s.destroy()}),i.onError(c=>{let d=new Error(c.errMsg);s.destroy(d)})}var C=(c,d)=>{if(d.hostname=d.hostname||d.host,!d.hostname)throw new Error("Could not determine host. Specify host manually.");let u=d.protocolId==="MQIsdp"&&d.protocolVersion===3?"mqttv3.1":"mqtt";l(d);let h=I(d,c);i=wx.connectSocket({url:h,protocols:[u]}),o=r(),s=new g.BufferedDuplex(d,o,i),s._destroy=(y,Z)=>{i.close({success(){Z&&Z(y)}})};let f=s.destroy;return s.destroy=(y,Z)=>(s.destroy=f,setTimeout(()=>{i.close({fail(){s._destroy(y,Z)}})},0),s),a(),s};e.default=C}),Ny=Ze(e=>{he(),Ae(),ue(),Object.defineProperty(e,"__esModule",{value:!0});var t=(Ut(),$e(Lt)),n=zo(),g=kb(),i,o,s,r=!1;function l(){let d=new n.Transform;return d._write=(u,h,f)=>{i.sendSocketMessage({data:u.buffer,success(){f()},fail(){f(new Error)}})},d._flush=u=>{i.closeSocket({success(){u()}})},d}function I(d){d.hostname||(d.hostname="localhost"),d.path||(d.path="/"),d.wsOptions||(d.wsOptions={})}function a(d,u){let h=d.protocol==="alis"?"wss":"ws",f=`${h}://${d.hostname}${d.path}`;return d.port&&d.port!==80&&d.port!==443&&(f=`${h}://${d.hostname}:${d.port}${d.path}`),typeof d.transformWsUrl=="function"&&(f=d.transformWsUrl(f,d,u)),f}function C(){r||(r=!0,i.onSocketOpen(()=>{s.socketReady()}),i.onSocketMessage(d=>{if(typeof d.data=="string"){let u=t.Buffer.from(d.data,"base64");o.push(u)}else{let u=new FileReader;u.addEventListener("load",()=>{let h=u.result;h instanceof ArrayBuffer?h=t.Buffer.from(h):h=t.Buffer.from(h,"utf8"),o.push(h)}),u.readAsArrayBuffer(d.data)}}),i.onSocketClose(()=>{s.end(),s.destroy()}),i.onSocketError(d=>{s.destroy(d)}))}var c=(d,u)=>{if(u.hostname=u.hostname||u.host,!u.hostname)throw new Error("Could not determine host. Specify host manually.");let h=u.protocolId==="MQIsdp"&&u.protocolVersion===3?"mqttv3.1":"mqtt";I(u);let f=a(u,d);return i=u.my,i.connectSocket({url:f,protocols:h}),o=l(),s=new g.BufferedDuplex(u,o,i),C(),s};e.default=c}),OT=Ze((e,t)=>{he(),Ae(),ue(),t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),Fy=Ze(e=>{he(),Ae(),ue();var t=e&&e.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(e,"__esModule",{value:!0});var n=(Ut(),$e(Lt)),g=t(OT()),i=t(Qg()),o=zo(),s=t(ec()),r=kb(),l=(0,i.default)("mqttjs:ws"),I=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function a(y,Z){let p=`${y.protocol}://${y.hostname}:${y.port}${y.path}`;return typeof y.transformWsUrl=="function"&&(p=y.transformWsUrl(p,y,Z)),p}function C(y){let Z=y;return y.port||(y.protocol==="wss"?Z.port=443:Z.port=80),y.path||(Z.path="/"),y.wsOptions||(Z.wsOptions={}),!s.default&&y.protocol==="wss"&&I.forEach(p=>{Object.prototype.hasOwnProperty.call(y,p)&&!Object.prototype.hasOwnProperty.call(y.wsOptions,p)&&(Z.wsOptions[p]=y[p])}),Z}function c(y){let Z=C(y);if(Z.hostname||(Z.hostname=Z.host),!Z.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let p=new URL(document.URL);Z.hostname=p.hostname,Z.port||(Z.port=Number(p.port))}return Z.objectMode===void 0&&(Z.objectMode=!(Z.binary===!0||Z.binary===void 0)),Z}function d(y,Z,p){l("createWebSocket"),l(`protocol: ${p.protocolId} ${p.protocolVersion}`);let B=p.protocolId==="MQIsdp"&&p.protocolVersion===3?"mqttv3.1":"mqtt";l(`creating new Websocket for url: ${Z} and protocol: ${B}`);let W;return p.createWebsocket?W=p.createWebsocket(Z,[B],p):W=new g.default(Z,[B],p.wsOptions),W}function u(y,Z){let p=Z.protocolId==="MQIsdp"&&Z.protocolVersion===3?"mqttv3.1":"mqtt",B=a(Z,y),W;return Z.createWebsocket?W=Z.createWebsocket(B,[p],Z):W=new WebSocket(B,[p]),W.binaryType="arraybuffer",W}var h=(y,Z)=>{l("streamBuilder");let p=C(Z);p.hostname=p.hostname||p.host||"localhost";let B=a(p,y),W=d(y,B,p),S=g.default.createWebSocketStream(W,p.wsOptions);return S.url=B,W.on("close",()=>{S.destroy()}),S},f=(y,Z)=>{l("browserStreamBuilder");let p,B=c(Z).browserBufferSize||1024*512,W=Z.browserBufferTimeout||1e3,S=!Z.objectMode,V=u(y,Z),R=M(Z,D,ie);Z.objectMode||(R._writev=r.writev.bind(R)),R.on("close",()=>{V.close()});let J=typeof V.addEventListener<"u";V.readyState===V.OPEN?(p=R,p.socket=V):(p=new r.BufferedDuplex(Z,R,V),J?V.addEventListener("open",P):V.onopen=P),J?(V.addEventListener("close",X),V.addEventListener("error",L),V.addEventListener("message",ne)):(V.onclose=X,V.onerror=L,V.onmessage=ne);function M(ge,N,te){let q=new o.Transform({objectMode:ge.objectMode});return q._write=N,q._flush=te,q}function P(){l("WebSocket onOpen"),p instanceof r.BufferedDuplex&&p.socketReady()}function X(ge){l("WebSocket onClose",ge),p.end(),p.destroy()}function L(ge){l("WebSocket onError",ge);let N=new Error("WebSocket error");N.event=ge,p.destroy(N)}function ne(ge){let{data:N}=ge;N instanceof ArrayBuffer?N=n.Buffer.from(N):N=n.Buffer.from(N,"utf8"),R.push(N)}function D(ge,N,te){if(V.bufferedAmount>B){setTimeout(D,W,ge,N,te);return}S&&typeof ge=="string"&&(ge=n.Buffer.from(ge,"utf8"));try{V.send(ge)}catch(q){return te(q)}te()}function ie(ge){V.close(),ge()}return p};e.default=s.default?f:h}),_T=Ze(e=>{he(),Ae(),ue();var t=e&&e.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(e,"__esModule",{value:!0}),e.connectAsync=void 0;var n=t(Qg()),g=t((jT(),$e(Xv))),i=t(sh()),o=t(ec());typeof(ze==null?void 0:ze.nextTick)!="function"&&(ze.nextTick=setImmediate);var s=(0,n.default)("mqttjs"),r={};o.default?(r.wx=Hy().default,r.wxs=Hy().default,r.ali=Ny().default,r.alis=Ny().default):(r.mqtt=Jy().default,r.tcp=Jy().default,r.ssl=Yy().default,r.tls=r.ssl,r.mqtts=Yy().default),r.ws=Fy().default,r.wss=Fy().default;function l(C){let c;C.auth&&(c=C.auth.match(/^(.+):(.+)$/),c?(C.username=c[1],C.password=c[2]):C.username=C.auth)}function I(C,c){var d,u,h,f;if(s("connecting to an MQTT broker..."),typeof C=="object"&&!c&&(c=C,C=""),c=c||{},C&&typeof C=="string"){let p=g.default.parse(C,!0),B={};if(p.port!=null&&(B.port=Number(p.port)),B.host=p.hostname,B.query=p.query,B.auth=p.auth,B.protocol=p.protocol,B.path=p.path,B.protocol=(d=B.protocol)===null||d===void 0?void 0:d.replace(/:$/,""),c=Object.assign(Object.assign({},B),c),!c.protocol)throw new Error("Missing protocol")}if(c.unixSocket=c.unixSocket||((u=c.protocol)===null||u===void 0?void 0:u.includes("+unix")),c.unixSocket?c.protocol=c.protocol.replace("+unix",""):!(!((h=c.protocol)===null||h===void 0)&&h.startsWith("ws"))&&!(!((f=c.protocol)===null||f===void 0)&&f.startsWith("wx"))&&delete c.path,l(c),c.query&&typeof c.query.clientId=="string"&&(c.clientId=c.query.clientId),c.cert&&c.key)if(c.protocol){if(["mqtts","wss","wxs","alis"].indexOf(c.protocol)===-1)switch(c.protocol){case"mqtt":c.protocol="mqtts";break;case"ws":c.protocol="wss";break;case"wx":c.protocol="wxs";break;case"ali":c.protocol="alis";break;default:throw new Error(`Unknown protocol for secure connection: "${c.protocol}"!`)}}else throw new Error("Missing secure protocol key");if(!r[c.protocol]){let p=["mqtts","wss"].indexOf(c.protocol)!==-1;c.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((B,W)=>p&&W%2===0?!1:typeof r[B]=="function")[0]}if(c.clean===!1&&!c.clientId)throw new Error("Missing clientId for unclean clients");c.protocol&&(c.defaultProtocol=c.protocol);function y(p){return c.servers&&((!p._reconnectCount||p._reconnectCount===c.servers.length)&&(p._reconnectCount=0),c.host=c.servers[p._reconnectCount].host,c.port=c.servers[p._reconnectCount].port,c.protocol=c.servers[p._reconnectCount].protocol?c.servers[p._reconnectCount].protocol:c.defaultProtocol,c.hostname=c.host,p._reconnectCount++),s("calling streambuilder for",c.protocol),r[c.protocol](p,c)}let Z=new i.default(y,c);return Z.on("error",()=>{}),Z}function a(C,c,d=!0){return new Promise((u,h)=>{let f=I(C,c),y={connect:p=>{Z(),u(f)},end:()=>{Z(),u(f)},error:p=>{Z(),f.end(),h(p)}};d===!1&&(y.close=()=>{y.error(new Error("Couldn't connect to server"))});function Z(){Object.keys(y).forEach(p=>{f.off(p,y[p])})}Object.keys(y).forEach(p=>{f.on(p,y[p])})})}e.connectAsync=a,e.default=I}),xy=Ze(e=>{he(),Ae(),ue();var t=e&&e.__createBinding||(Object.create?function(d,u,h,f){f===void 0&&(f=h);var y=Object.getOwnPropertyDescriptor(u,h);(!y||("get"in y?!u.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return u[h]}}),Object.defineProperty(d,f,y)}:function(d,u,h,f){f===void 0&&(f=h),d[f]=u[h]}),n=e&&e.__setModuleDefault||(Object.create?function(d,u){Object.defineProperty(d,"default",{enumerable:!0,value:u})}:function(d,u){d.default=u}),g=e&&e.__importStar||function(d){if(d&&d.__esModule)return d;var u={};if(d!=null)for(var h in d)h!=="default"&&Object.prototype.hasOwnProperty.call(d,h)&&t(u,d,h);return n(u,d),u},i=e&&e.__exportStar||function(d,u){for(var h in d)h!=="default"&&!Object.prototype.hasOwnProperty.call(u,h)&&t(u,d,h)},o=e&&e.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(e,"__esModule",{value:!0}),e.ReasonCodes=e.KeepaliveManager=e.UniqueMessageIdProvider=e.DefaultMessageIdProvider=e.Store=e.MqttClient=e.connectAsync=e.connect=e.Client=void 0;var s=o(sh());e.MqttClient=s.default;var r=o(lv());e.DefaultMessageIdProvider=r.default;var l=o(wT());e.UniqueMessageIdProvider=l.default;var I=o(Iv());e.Store=I.default;var a=g(_T());e.connect=a.default,Object.defineProperty(e,"connectAsync",{enumerable:!0,get:function(){return a.connectAsync}});var C=o(Sv());e.KeepaliveManager=C.default,e.Client=s.default,i(sh(),e),i(El(),e);var c=$C();Object.defineProperty(e,"ReasonCodes",{enumerable:!0,get:function(){return c.ReasonCodes}})}),qT=Ze(e=>{he(),Ae(),ue();var t=e&&e.__createBinding||(Object.create?function(s,r,l,I){I===void 0&&(I=l);var a=Object.getOwnPropertyDescriptor(r,l);(!a||("get"in a?!r.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return r[l]}}),Object.defineProperty(s,I,a)}:function(s,r,l,I){I===void 0&&(I=l),s[I]=r[l]}),n=e&&e.__setModuleDefault||(Object.create?function(s,r){Object.defineProperty(s,"default",{enumerable:!0,value:r})}:function(s,r){s.default=r}),g=e&&e.__importStar||function(s){if(s&&s.__esModule)return s;var r={};if(s!=null)for(var l in s)l!=="default"&&Object.prototype.hasOwnProperty.call(s,l)&&t(r,s,l);return n(r,s),r},i=e&&e.__exportStar||function(s,r){for(var l in s)l!=="default"&&!Object.prototype.hasOwnProperty.call(r,l)&&t(r,s,l)};Object.defineProperty(e,"__esModule",{value:!0});var o=g(xy());e.default=o,i(xy(),e)});qT();/*! Bundled license information:

@jspm/core/nodelibs/browser/buffer.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/bd.createRoot(document.getElementById("root")).render(G.jsx(Nk,{clientId:"927856352370-jlatbrbc93vf8so236e2c8u5kqaipttd.apps.googleusercontent.com",children:G.jsx(sn.StrictMode,{children:G.jsx(Nw,{children:G.jsx(Kk,{children:G.jsx(aM,{})})})})}));
