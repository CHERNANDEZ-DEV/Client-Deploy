var nb=Object.defineProperty;var ob=(I,g,C)=>g in I?nb(I,g,{enumerable:!0,configurable:!0,writable:!0,value:C}):I[g]=C;var N=(I,g,C)=>(ob(I,typeof g!="symbol"?g+"":g,C),C);function Ab(I,g){for(var C=0;C<g.length;C++){const e=g[C];if(typeof e!="string"&&!Array.isArray(e)){for(const t in e)if(t!=="default"&&!(t in I)){const l=Object.getOwnPropertyDescriptor(e,t);l&&Object.defineProperty(I,t,l.get?l:{enumerable:!0,get:()=>e[t]})}}}return Object.freeze(Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}))}(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function C(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function e(t){if(t.ep)return;t.ep=!0;const l=C(t);fetch(t.href,l)}})();function ib(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}var or={exports:{}},qn={},Ar={exports:{}},z={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var el=Symbol.for("react.element"),sb=Symbol.for("react.portal"),cb=Symbol.for("react.fragment"),ab=Symbol.for("react.strict_mode"),db=Symbol.for("react.profiler"),rb=Symbol.for("react.provider"),mb=Symbol.for("react.context"),ub=Symbol.for("react.forward_ref"),Zb=Symbol.for("react.suspense"),bb=Symbol.for("react.memo"),hb=Symbol.for("react.lazy"),ic=Symbol.iterator;function Gb(I){return I===null||typeof I!="object"?null:(I=ic&&I[ic]||I["@@iterator"],typeof I=="function"?I:null)}var ir={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sr=Object.assign,cr={};function ze(I,g,C){this.props=I,this.context=g,this.refs=cr,this.updater=C||ir}ze.prototype.isReactComponent={};ze.prototype.setState=function(I,g){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,g,"setState")};ze.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function ar(){}ar.prototype=ze.prototype;function xi(I,g,C){this.props=I,this.context=g,this.refs=cr,this.updater=C||ir}var zi=xi.prototype=new ar;zi.constructor=xi;sr(zi,ze.prototype);zi.isPureReactComponent=!0;var sc=Array.isArray,dr=Object.prototype.hasOwnProperty,Mi={current:null},rr={key:!0,ref:!0,__self:!0,__source:!0};function mr(I,g,C){var e,t={},l=null,n=null;if(g!=null)for(e in g.ref!==void 0&&(n=g.ref),g.key!==void 0&&(l=""+g.key),g)dr.call(g,e)&&!rr.hasOwnProperty(e)&&(t[e]=g[e]);var o=arguments.length-2;if(o===1)t.children=C;else if(1<o){for(var A=Array(o),i=0;i<o;i++)A[i]=arguments[i+2];t.children=A}if(I&&I.defaultProps)for(e in o=I.defaultProps,o)t[e]===void 0&&(t[e]=o[e]);return{$$typeof:el,type:I,key:l,ref:n,props:t,_owner:Mi.current}}function Bb(I,g){return{$$typeof:el,type:I.type,key:g,ref:I.ref,props:I.props,_owner:I._owner}}function Ei(I){return typeof I=="object"&&I!==null&&I.$$typeof===el}function yb(I){var g={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(C){return g[C]})}var cc=/\/+/g;function Ko(I,g){return typeof I=="object"&&I!==null&&I.key!=null?yb(""+I.key):g.toString(36)}function Tl(I,g,C,e,t){var l=typeof I;(l==="undefined"||l==="boolean")&&(I=null);var n=!1;if(I===null)n=!0;else switch(l){case"string":case"number":n=!0;break;case"object":switch(I.$$typeof){case el:case sb:n=!0}}if(n)return n=I,t=t(n),I=e===""?"."+Ko(n,0):e,sc(t)?(C="",I!=null&&(C=I.replace(cc,"$&/")+"/"),Tl(t,g,C,"",function(i){return i})):t!=null&&(Ei(t)&&(t=Bb(t,C+(!t.key||n&&n.key===t.key?"":(""+t.key).replace(cc,"$&/")+"/")+I)),g.push(t)),1;if(n=0,e=e===""?".":e+":",sc(I))for(var o=0;o<I.length;o++){l=I[o];var A=e+Ko(l,o);n+=Tl(l,g,C,A,t)}else if(A=Gb(I),typeof A=="function")for(I=A.call(I),o=0;!(l=I.next()).done;)l=l.value,A=e+Ko(l,o++),n+=Tl(l,g,C,A,t);else if(l==="object")throw g=String(I),Error("Objects are not valid as a React child (found: "+(g==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":g)+"). If you meant to render a collection of children, use an array instead.");return n}function ul(I,g,C){if(I==null)return I;var e=[],t=0;return Tl(I,e,"","",function(l){return g.call(C,l,t++)}),e}function pb(I){if(I._status===-1){var g=I._result;g=g(),g.then(function(C){(I._status===0||I._status===-1)&&(I._status=1,I._result=C)},function(C){(I._status===0||I._status===-1)&&(I._status=2,I._result=C)}),I._status===-1&&(I._status=0,I._result=g)}if(I._status===1)return I._result.default;throw I._result}var xg={current:null},jl={transition:null},Wb={ReactCurrentDispatcher:xg,ReactCurrentBatchConfig:jl,ReactCurrentOwner:Mi};function ur(){throw Error("act(...) is not supported in production builds of React.")}z.Children={map:ul,forEach:function(I,g,C){ul(I,function(){g.apply(this,arguments)},C)},count:function(I){var g=0;return ul(I,function(){g++}),g},toArray:function(I){return ul(I,function(g){return g})||[]},only:function(I){if(!Ei(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};z.Component=ze;z.Fragment=cb;z.Profiler=db;z.PureComponent=xi;z.StrictMode=ab;z.Suspense=Zb;z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wb;z.act=ur;z.cloneElement=function(I,g,C){if(I==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+I+".");var e=sr({},I.props),t=I.key,l=I.ref,n=I._owner;if(g!=null){if(g.ref!==void 0&&(l=g.ref,n=Mi.current),g.key!==void 0&&(t=""+g.key),I.type&&I.type.defaultProps)var o=I.type.defaultProps;for(A in g)dr.call(g,A)&&!rr.hasOwnProperty(A)&&(e[A]=g[A]===void 0&&o!==void 0?o[A]:g[A])}var A=arguments.length-2;if(A===1)e.children=C;else if(1<A){o=Array(A);for(var i=0;i<A;i++)o[i]=arguments[i+2];e.children=o}return{$$typeof:el,type:I.type,key:t,ref:l,props:e,_owner:n}};z.createContext=function(I){return I={$$typeof:mb,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},I.Provider={$$typeof:rb,_context:I},I.Consumer=I};z.createElement=mr;z.createFactory=function(I){var g=mr.bind(null,I);return g.type=I,g};z.createRef=function(){return{current:null}};z.forwardRef=function(I){return{$$typeof:ub,render:I}};z.isValidElement=Ei;z.lazy=function(I){return{$$typeof:hb,_payload:{_status:-1,_result:I},_init:pb}};z.memo=function(I,g){return{$$typeof:bb,type:I,compare:g===void 0?null:g}};z.startTransition=function(I){var g=jl.transition;jl.transition={};try{I()}finally{jl.transition=g}};z.unstable_act=ur;z.useCallback=function(I,g){return xg.current.useCallback(I,g)};z.useContext=function(I){return xg.current.useContext(I)};z.useDebugValue=function(){};z.useDeferredValue=function(I){return xg.current.useDeferredValue(I)};z.useEffect=function(I,g){return xg.current.useEffect(I,g)};z.useId=function(){return xg.current.useId()};z.useImperativeHandle=function(I,g,C){return xg.current.useImperativeHandle(I,g,C)};z.useInsertionEffect=function(I,g){return xg.current.useInsertionEffect(I,g)};z.useLayoutEffect=function(I,g){return xg.current.useLayoutEffect(I,g)};z.useMemo=function(I,g){return xg.current.useMemo(I,g)};z.useReducer=function(I,g,C){return xg.current.useReducer(I,g,C)};z.useRef=function(I){return xg.current.useRef(I)};z.useState=function(I){return xg.current.useState(I)};z.useSyncExternalStore=function(I,g,C){return xg.current.useSyncExternalStore(I,g,C)};z.useTransition=function(){return xg.current.useTransition()};z.version="18.3.1";Ar.exports=z;var p=Ar.exports;const Fg=ib(p),Vb=Ab({__proto__:null,default:Fg},[p]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sb=p,Rb=Symbol.for("react.element"),Xb=Symbol.for("react.fragment"),Jb=Object.prototype.hasOwnProperty,kb=Sb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fb={key:!0,ref:!0,__self:!0,__source:!0};function Zr(I,g,C){var e,t={},l=null,n=null;C!==void 0&&(l=""+C),g.key!==void 0&&(l=""+g.key),g.ref!==void 0&&(n=g.ref);for(e in g)Jb.call(g,e)&&!fb.hasOwnProperty(e)&&(t[e]=g[e]);if(I&&I.defaultProps)for(e in g=I.defaultProps,g)t[e]===void 0&&(t[e]=g[e]);return{$$typeof:Rb,type:I,key:l,ref:n,props:t,_owner:kb.current}}qn.Fragment=Xb;qn.jsx=Zr;qn.jsxs=Zr;or.exports=qn;var d=or.exports;function Yb(I={}){const{nonce:g,onScriptLoadSuccess:C,onScriptLoadError:e}=I,[t,l]=p.useState(!1),n=p.useRef(C);n.current=C;const o=p.useRef(e);return o.current=e,p.useEffect(()=>{const A=document.createElement("script");return A.src="https://accounts.google.com/gsi/client",A.async=!0,A.defer=!0,A.nonce=g,A.onload=()=>{var i;l(!0),(i=n.current)===null||i===void 0||i.call(n)},A.onerror=()=>{var i;l(!1),(i=o.current)===null||i===void 0||i.call(o)},document.body.appendChild(A),()=>{document.body.removeChild(A)}},[g]),t}const br=p.createContext(null);function Hb({clientId:I,nonce:g,onScriptLoadSuccess:C,onScriptLoadError:e,children:t}){const l=Yb({nonce:g,onScriptLoadSuccess:C,onScriptLoadError:e}),n=p.useMemo(()=>({clientId:I,scriptLoadedSuccessfully:l}),[I,l]);return Fg.createElement(br.Provider,{value:n},t)}function vb(){const I=p.useContext(br);if(!I)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return I}function Nb({flow:I="implicit",scope:g="",onSuccess:C,onError:e,onNonOAuthError:t,overrideScope:l,state:n,...o}){const{clientId:A,scriptLoadedSuccessfully:i}=vb(),s=p.useRef(),c=p.useRef(C);c.current=C;const a=p.useRef(e);a.current=e;const r=p.useRef(t);r.current=t,p.useEffect(()=>{var G,u;if(!i)return;const Z=I==="implicit"?"initTokenClient":"initCodeClient",h=(u=(G=window==null?void 0:window.google)===null||G===void 0?void 0:G.accounts)===null||u===void 0?void 0:u.oauth2[Z]({client_id:A,scope:l?g:`openid profile email ${g}`,callback:B=>{var y,V;if(B.error)return(y=a.current)===null||y===void 0?void 0:y.call(a,B);(V=c.current)===null||V===void 0||V.call(c,B)},error_callback:B=>{var y;(y=r.current)===null||y===void 0||y.call(r,B)},state:n,...o});s.current=h},[A,i,I,g,n]);const m=p.useCallback(G=>{var u;return(u=s.current)===null||u===void 0?void 0:u.requestAccessToken(G)},[]),b=p.useCallback(()=>{var G;return(G=s.current)===null||G===void 0?void 0:G.requestCode()},[]);return I==="implicit"?m:b}const Qi=p.createContext(),Fb=({children:I})=>{const[g,C]=p.useState({name:"Carlos Hernández",email:"00002721@uca.edu.sv",id:"06306281-7",address:"Casa N°12"});return d.jsx(Qi.Provider,{value:{user:g,setUser:C},children:I})};var VA={},hr={exports:{}},CI={},Gr={exports:{}},Br={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(I){function g(k,v){var F=k.length;k.push(v);g:for(;0<F;){var _=F-1>>>1,Ig=k[_];if(0<t(Ig,v))k[_]=v,k[F]=Ig,F=_;else break g}}function C(k){return k.length===0?null:k[0]}function e(k){if(k.length===0)return null;var v=k[0],F=k.pop();if(F!==v){k[0]=F;g:for(var _=0,Ig=k.length,yI=Ig>>>1;_<yI;){var Hg=2*(_+1)-1,HI=k[Hg],vg=Hg+1,ml=k[vg];if(0>t(HI,F))vg<Ig&&0>t(ml,HI)?(k[_]=ml,k[vg]=F,_=vg):(k[_]=HI,k[Hg]=F,_=Hg);else if(vg<Ig&&0>t(ml,F))k[_]=ml,k[vg]=F,_=vg;else break g}}return v}function t(k,v){var F=k.sortIndex-v.sortIndex;return F!==0?F:k.id-v.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;I.unstable_now=function(){return l.now()}}else{var n=Date,o=n.now();I.unstable_now=function(){return n.now()-o}}var A=[],i=[],s=1,c=null,a=3,r=!1,m=!1,b=!1,G=typeof setTimeout=="function"?setTimeout:null,u=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function h(k){for(var v=C(i);v!==null;){if(v.callback===null)e(i);else if(v.startTime<=k)e(i),v.sortIndex=v.expirationTime,g(A,v);else break;v=C(i)}}function B(k){if(b=!1,h(k),!m)if(C(A)!==null)m=!0,j(y);else{var v=C(i);v!==null&&gg(B,v.startTime-k)}}function y(k,v){m=!1,b&&(b=!1,u(R),R=-1),r=!0;var F=a;try{for(h(v),c=C(A);c!==null&&(!(c.expirationTime>v)||k&&!H());){var _=c.callback;if(typeof _=="function"){c.callback=null,a=c.priorityLevel;var Ig=_(c.expirationTime<=v);v=I.unstable_now(),typeof Ig=="function"?c.callback=Ig:c===C(A)&&e(A),h(v)}else e(A);c=C(A)}if(c!==null)var yI=!0;else{var Hg=C(i);Hg!==null&&gg(B,Hg.startTime-v),yI=!1}return yI}finally{c=null,a=F,r=!1}}var V=!1,W=null,R=-1,f=5,J=-1;function H(){return!(I.unstable_now()-J<f)}function K(){if(W!==null){var k=I.unstable_now();J=k;var v=!0;try{v=W(!0,k)}finally{v?T():(V=!1,W=null)}}else V=!1}var T;if(typeof Z=="function")T=function(){Z(K)};else if(typeof MessageChannel<"u"){var Ag=new MessageChannel,Q=Ag.port2;Ag.port1.onmessage=K,T=function(){Q.postMessage(null)}}else T=function(){G(K,0)};function j(k){W=k,V||(V=!0,T())}function gg(k,v){R=G(function(){k(I.unstable_now())},v)}I.unstable_IdlePriority=5,I.unstable_ImmediatePriority=1,I.unstable_LowPriority=4,I.unstable_NormalPriority=3,I.unstable_Profiling=null,I.unstable_UserBlockingPriority=2,I.unstable_cancelCallback=function(k){k.callback=null},I.unstable_continueExecution=function(){m||r||(m=!0,j(y))},I.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):f=0<k?Math.floor(1e3/k):5},I.unstable_getCurrentPriorityLevel=function(){return a},I.unstable_getFirstCallbackNode=function(){return C(A)},I.unstable_next=function(k){switch(a){case 1:case 2:case 3:var v=3;break;default:v=a}var F=a;a=v;try{return k()}finally{a=F}},I.unstable_pauseExecution=function(){},I.unstable_requestPaint=function(){},I.unstable_runWithPriority=function(k,v){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var F=a;a=k;try{return v()}finally{a=F}},I.unstable_scheduleCallback=function(k,v,F){var _=I.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?_+F:_):F=_,k){case 1:var Ig=-1;break;case 2:Ig=250;break;case 5:Ig=1073741823;break;case 4:Ig=1e4;break;default:Ig=5e3}return Ig=F+Ig,k={id:s++,callback:v,priorityLevel:k,startTime:F,expirationTime:Ig,sortIndex:-1},F>_?(k.sortIndex=F,g(i,k),C(A)===null&&k===C(i)&&(b?(u(R),R=-1):b=!0,gg(B,F-_))):(k.sortIndex=Ig,g(A,k),m||r||(m=!0,j(y))),k},I.unstable_shouldYield=H,I.unstable_wrapCallback=function(k){var v=a;return function(){var F=a;a=v;try{return k.apply(this,arguments)}finally{a=F}}}})(Br);Gr.exports=Br;var Kb=Gr.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wb=p,II=Kb;function X(I){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+I,C=1;C<arguments.length;C++)g+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+I+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yr=new Set,Jt={};function Ie(I,g){fe(I,g),fe(I+"Capture",g)}function fe(I,g){for(Jt[I]=g,I=0;I<g.length;I++)yr.add(g[I])}var QI=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),SA=Object.prototype.hasOwnProperty,xb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ac={},dc={};function zb(I){return SA.call(dc,I)?!0:SA.call(ac,I)?!1:xb.test(I)?dc[I]=!0:(ac[I]=!0,!1)}function Mb(I,g,C,e){if(C!==null&&C.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return e?!1:C!==null?!C.acceptsBooleans:(I=I.toLowerCase().slice(0,5),I!=="data-"&&I!=="aria-");default:return!1}}function Eb(I,g,C,e){if(g===null||typeof g>"u"||Mb(I,g,C,e))return!0;if(e)return!1;if(C!==null)switch(C.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function zg(I,g,C,e,t,l,n){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=e,this.attributeNamespace=t,this.mustUseProperty=C,this.propertyName=I,this.type=g,this.sanitizeURL=l,this.removeEmptyString=n}var Xg={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(I){Xg[I]=new zg(I,0,!1,I,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(I){var g=I[0];Xg[g]=new zg(g,1,!1,I[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(I){Xg[I]=new zg(I,2,!1,I.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(I){Xg[I]=new zg(I,2,!1,I,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(I){Xg[I]=new zg(I,3,!1,I.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(I){Xg[I]=new zg(I,3,!0,I,null,!1,!1)});["capture","download"].forEach(function(I){Xg[I]=new zg(I,4,!1,I,null,!1,!1)});["cols","rows","size","span"].forEach(function(I){Xg[I]=new zg(I,6,!1,I,null,!1,!1)});["rowSpan","start"].forEach(function(I){Xg[I]=new zg(I,5,!1,I.toLowerCase(),null,!1,!1)});var Ui=/[\-:]([a-z])/g;function Li(I){return I[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(I){var g=I.replace(Ui,Li);Xg[g]=new zg(g,1,!1,I,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(I){var g=I.replace(Ui,Li);Xg[g]=new zg(g,1,!1,I,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(I){var g=I.replace(Ui,Li);Xg[g]=new zg(g,1,!1,I,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(I){Xg[I]=new zg(I,1,!1,I.toLowerCase(),null,!1,!1)});Xg.xlinkHref=new zg("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(I){Xg[I]=new zg(I,1,!1,I.toLowerCase(),null,!0,!0)});function Di(I,g,C,e){var t=Xg.hasOwnProperty(g)?Xg[g]:null;(t!==null?t.type!==0:e||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(Eb(g,C,t,e)&&(C=null),e||t===null?zb(g)&&(C===null?I.removeAttribute(g):I.setAttribute(g,""+C)):t.mustUseProperty?I[t.propertyName]=C===null?t.type===3?!1:"":C:(g=t.attributeName,e=t.attributeNamespace,C===null?I.removeAttribute(g):(t=t.type,C=t===3||t===4&&C===!0?"":""+C,e?I.setAttributeNS(e,g,C):I.setAttribute(g,C))))}var TI=wb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zl=Symbol.for("react.element"),ie=Symbol.for("react.portal"),se=Symbol.for("react.fragment"),Ti=Symbol.for("react.strict_mode"),RA=Symbol.for("react.profiler"),pr=Symbol.for("react.provider"),Wr=Symbol.for("react.context"),ji=Symbol.for("react.forward_ref"),XA=Symbol.for("react.suspense"),JA=Symbol.for("react.suspense_list"),Pi=Symbol.for("react.memo"),qI=Symbol.for("react.lazy"),Vr=Symbol.for("react.offscreen"),rc=Symbol.iterator;function Te(I){return I===null||typeof I!="object"?null:(I=rc&&I[rc]||I["@@iterator"],typeof I=="function"?I:null)}var og=Object.assign,wo;function At(I){if(wo===void 0)try{throw Error()}catch(C){var g=C.stack.trim().match(/\n( *(at )?)/);wo=g&&g[1]||""}return`
`+wo+I}var xo=!1;function zo(I,g){if(!I||xo)return"";xo=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(i){var e=i}Reflect.construct(I,[],g)}else{try{g.call()}catch(i){e=i}I.call(g.prototype)}else{try{throw Error()}catch(i){e=i}I()}}catch(i){if(i&&e&&typeof i.stack=="string"){for(var t=i.stack.split(`
`),l=e.stack.split(`
`),n=t.length-1,o=l.length-1;1<=n&&0<=o&&t[n]!==l[o];)o--;for(;1<=n&&0<=o;n--,o--)if(t[n]!==l[o]){if(n!==1||o!==1)do if(n--,o--,0>o||t[n]!==l[o]){var A=`
`+t[n].replace(" at new "," at ");return I.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",I.displayName)),A}while(1<=n&&0<=o);break}}}finally{xo=!1,Error.prepareStackTrace=C}return(I=I?I.displayName||I.name:"")?At(I):""}function Qb(I){switch(I.tag){case 5:return At(I.type);case 16:return At("Lazy");case 13:return At("Suspense");case 19:return At("SuspenseList");case 0:case 2:case 15:return I=zo(I.type,!1),I;case 11:return I=zo(I.type.render,!1),I;case 1:return I=zo(I.type,!0),I;default:return""}}function kA(I){if(I==null)return null;if(typeof I=="function")return I.displayName||I.name||null;if(typeof I=="string")return I;switch(I){case se:return"Fragment";case ie:return"Portal";case RA:return"Profiler";case Ti:return"StrictMode";case XA:return"Suspense";case JA:return"SuspenseList"}if(typeof I=="object")switch(I.$$typeof){case Wr:return(I.displayName||"Context")+".Consumer";case pr:return(I._context.displayName||"Context")+".Provider";case ji:var g=I.render;return I=I.displayName,I||(I=g.displayName||g.name||"",I=I!==""?"ForwardRef("+I+")":"ForwardRef"),I;case Pi:return g=I.displayName||null,g!==null?g:kA(I.type)||"Memo";case qI:g=I._payload,I=I._init;try{return kA(I(g))}catch{}}return null}function Ub(I){var g=I.type;switch(I.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return I=g.render,I=I.displayName||I.name||"",g.displayName||(I!==""?"ForwardRef("+I+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kA(g);case 8:return g===Ti?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function hC(I){switch(typeof I){case"boolean":case"number":case"string":case"undefined":return I;case"object":return I;default:return""}}function Sr(I){var g=I.type;return(I=I.nodeName)&&I.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Lb(I){var g=Sr(I)?"checked":"value",C=Object.getOwnPropertyDescriptor(I.constructor.prototype,g),e=""+I[g];if(!I.hasOwnProperty(g)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var t=C.get,l=C.set;return Object.defineProperty(I,g,{configurable:!0,get:function(){return t.call(this)},set:function(n){e=""+n,l.call(this,n)}}),Object.defineProperty(I,g,{enumerable:C.enumerable}),{getValue:function(){return e},setValue:function(n){e=""+n},stopTracking:function(){I._valueTracker=null,delete I[g]}}}}function bl(I){I._valueTracker||(I._valueTracker=Lb(I))}function Rr(I){if(!I)return!1;var g=I._valueTracker;if(!g)return!0;var C=g.getValue(),e="";return I&&(e=Sr(I)?I.checked?"true":"false":I.value),I=e,I!==C?(g.setValue(I),!0):!1}function dn(I){if(I=I||(typeof document<"u"?document:void 0),typeof I>"u")return null;try{return I.activeElement||I.body}catch{return I.body}}function fA(I,g){var C=g.checked;return og({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:C??I._wrapperState.initialChecked})}function mc(I,g){var C=g.defaultValue==null?"":g.defaultValue,e=g.checked!=null?g.checked:g.defaultChecked;C=hC(g.value!=null?g.value:C),I._wrapperState={initialChecked:e,initialValue:C,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Xr(I,g){g=g.checked,g!=null&&Di(I,"checked",g,!1)}function YA(I,g){Xr(I,g);var C=hC(g.value),e=g.type;if(C!=null)e==="number"?(C===0&&I.value===""||I.value!=C)&&(I.value=""+C):I.value!==""+C&&(I.value=""+C);else if(e==="submit"||e==="reset"){I.removeAttribute("value");return}g.hasOwnProperty("value")?HA(I,g.type,C):g.hasOwnProperty("defaultValue")&&HA(I,g.type,hC(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(I.defaultChecked=!!g.defaultChecked)}function uc(I,g,C){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var e=g.type;if(!(e!=="submit"&&e!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+I._wrapperState.initialValue,C||g===I.value||(I.value=g),I.defaultValue=g}C=I.name,C!==""&&(I.name=""),I.defaultChecked=!!I._wrapperState.initialChecked,C!==""&&(I.name=C)}function HA(I,g,C){(g!=="number"||dn(I.ownerDocument)!==I)&&(C==null?I.defaultValue=""+I._wrapperState.initialValue:I.defaultValue!==""+C&&(I.defaultValue=""+C))}var it=Array.isArray;function pe(I,g,C,e){if(I=I.options,g){g={};for(var t=0;t<C.length;t++)g["$"+C[t]]=!0;for(C=0;C<I.length;C++)t=g.hasOwnProperty("$"+I[C].value),I[C].selected!==t&&(I[C].selected=t),t&&e&&(I[C].defaultSelected=!0)}else{for(C=""+hC(C),g=null,t=0;t<I.length;t++){if(I[t].value===C){I[t].selected=!0,e&&(I[t].defaultSelected=!0);return}g!==null||I[t].disabled||(g=I[t])}g!==null&&(g.selected=!0)}}function vA(I,g){if(g.dangerouslySetInnerHTML!=null)throw Error(X(91));return og({},g,{value:void 0,defaultValue:void 0,children:""+I._wrapperState.initialValue})}function Zc(I,g){var C=g.value;if(C==null){if(C=g.children,g=g.defaultValue,C!=null){if(g!=null)throw Error(X(92));if(it(C)){if(1<C.length)throw Error(X(93));C=C[0]}g=C}g==null&&(g=""),C=g}I._wrapperState={initialValue:hC(C)}}function Jr(I,g){var C=hC(g.value),e=hC(g.defaultValue);C!=null&&(C=""+C,C!==I.value&&(I.value=C),g.defaultValue==null&&I.defaultValue!==C&&(I.defaultValue=C)),e!=null&&(I.defaultValue=""+e)}function bc(I){var g=I.textContent;g===I._wrapperState.initialValue&&g!==""&&g!==null&&(I.value=g)}function kr(I){switch(I){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function NA(I,g){return I==null||I==="http://www.w3.org/1999/xhtml"?kr(g):I==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":I}var hl,fr=function(I){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,C,e,t){MSApp.execUnsafeLocalFunction(function(){return I(g,C,e,t)})}:I}(function(I,g){if(I.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in I)I.innerHTML=g;else{for(hl=hl||document.createElement("div"),hl.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=hl.firstChild;I.firstChild;)I.removeChild(I.firstChild);for(;g.firstChild;)I.appendChild(g.firstChild)}});function kt(I,g){if(g){var C=I.firstChild;if(C&&C===I.lastChild&&C.nodeType===3){C.nodeValue=g;return}}I.textContent=g}var Zt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Db=["Webkit","ms","Moz","O"];Object.keys(Zt).forEach(function(I){Db.forEach(function(g){g=g+I.charAt(0).toUpperCase()+I.substring(1),Zt[g]=Zt[I]})});function Yr(I,g,C){return g==null||typeof g=="boolean"||g===""?"":C||typeof g!="number"||g===0||Zt.hasOwnProperty(I)&&Zt[I]?(""+g).trim():g+"px"}function Hr(I,g){I=I.style;for(var C in g)if(g.hasOwnProperty(C)){var e=C.indexOf("--")===0,t=Yr(C,g[C],e);C==="float"&&(C="cssFloat"),e?I.setProperty(C,t):I[C]=t}}var Tb=og({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function FA(I,g){if(g){if(Tb[I]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(X(137,I));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(X(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(X(61))}if(g.style!=null&&typeof g.style!="object")throw Error(X(62))}}function KA(I,g){if(I.indexOf("-")===-1)return typeof g.is=="string";switch(I){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wA=null;function Oi(I){return I=I.target||I.srcElement||window,I.correspondingUseElement&&(I=I.correspondingUseElement),I.nodeType===3?I.parentNode:I}var xA=null,We=null,Ve=null;function hc(I){if(I=nl(I)){if(typeof xA!="function")throw Error(X(280));var g=I.stateNode;g&&(g=eo(g),xA(I.stateNode,I.type,g))}}function vr(I){We?Ve?Ve.push(I):Ve=[I]:We=I}function Nr(){if(We){var I=We,g=Ve;if(Ve=We=null,hc(I),g)for(I=0;I<g.length;I++)hc(g[I])}}function Fr(I,g){return I(g)}function Kr(){}var Mo=!1;function wr(I,g,C){if(Mo)return I(g,C);Mo=!0;try{return Fr(I,g,C)}finally{Mo=!1,(We!==null||Ve!==null)&&(Kr(),Nr())}}function ft(I,g){var C=I.stateNode;if(C===null)return null;var e=eo(C);if(e===null)return null;C=e[g];g:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(e=!e.disabled)||(I=I.type,e=!(I==="button"||I==="input"||I==="select"||I==="textarea")),I=!e;break g;default:I=!1}if(I)return null;if(C&&typeof C!="function")throw Error(X(231,g,typeof C));return C}var zA=!1;if(QI)try{var je={};Object.defineProperty(je,"passive",{get:function(){zA=!0}}),window.addEventListener("test",je,je),window.removeEventListener("test",je,je)}catch{zA=!1}function jb(I,g,C,e,t,l,n,o,A){var i=Array.prototype.slice.call(arguments,3);try{g.apply(C,i)}catch(s){this.onError(s)}}var bt=!1,rn=null,mn=!1,MA=null,Pb={onError:function(I){bt=!0,rn=I}};function Ob(I,g,C,e,t,l,n,o,A){bt=!1,rn=null,jb.apply(Pb,arguments)}function _b(I,g,C,e,t,l,n,o,A){if(Ob.apply(this,arguments),bt){if(bt){var i=rn;bt=!1,rn=null}else throw Error(X(198));mn||(mn=!0,MA=i)}}function Ce(I){var g=I,C=I;if(I.alternate)for(;g.return;)g=g.return;else{I=g;do g=I,g.flags&4098&&(C=g.return),I=g.return;while(I)}return g.tag===3?C:null}function xr(I){if(I.tag===13){var g=I.memoizedState;if(g===null&&(I=I.alternate,I!==null&&(g=I.memoizedState)),g!==null)return g.dehydrated}return null}function Gc(I){if(Ce(I)!==I)throw Error(X(188))}function qb(I){var g=I.alternate;if(!g){if(g=Ce(I),g===null)throw Error(X(188));return g!==I?null:I}for(var C=I,e=g;;){var t=C.return;if(t===null)break;var l=t.alternate;if(l===null){if(e=t.return,e!==null){C=e;continue}break}if(t.child===l.child){for(l=t.child;l;){if(l===C)return Gc(t),I;if(l===e)return Gc(t),g;l=l.sibling}throw Error(X(188))}if(C.return!==e.return)C=t,e=l;else{for(var n=!1,o=t.child;o;){if(o===C){n=!0,C=t,e=l;break}if(o===e){n=!0,e=t,C=l;break}o=o.sibling}if(!n){for(o=l.child;o;){if(o===C){n=!0,C=l,e=t;break}if(o===e){n=!0,e=l,C=t;break}o=o.sibling}if(!n)throw Error(X(189))}}if(C.alternate!==e)throw Error(X(190))}if(C.tag!==3)throw Error(X(188));return C.stateNode.current===C?I:g}function zr(I){return I=qb(I),I!==null?Mr(I):null}function Mr(I){if(I.tag===5||I.tag===6)return I;for(I=I.child;I!==null;){var g=Mr(I);if(g!==null)return g;I=I.sibling}return null}var Er=II.unstable_scheduleCallback,Bc=II.unstable_cancelCallback,$b=II.unstable_shouldYield,gh=II.unstable_requestPaint,dg=II.unstable_now,Ih=II.unstable_getCurrentPriorityLevel,_i=II.unstable_ImmediatePriority,Qr=II.unstable_UserBlockingPriority,un=II.unstable_NormalPriority,Ch=II.unstable_LowPriority,Ur=II.unstable_IdlePriority,$n=null,fI=null;function eh(I){if(fI&&typeof fI.onCommitFiberRoot=="function")try{fI.onCommitFiberRoot($n,I,void 0,(I.current.flags&128)===128)}catch{}}var ZI=Math.clz32?Math.clz32:nh,th=Math.log,lh=Math.LN2;function nh(I){return I>>>=0,I===0?32:31-(th(I)/lh|0)|0}var Gl=64,Bl=4194304;function st(I){switch(I&-I){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return I&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return I&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return I}}function Zn(I,g){var C=I.pendingLanes;if(C===0)return 0;var e=0,t=I.suspendedLanes,l=I.pingedLanes,n=C&268435455;if(n!==0){var o=n&~t;o!==0?e=st(o):(l&=n,l!==0&&(e=st(l)))}else n=C&~t,n!==0?e=st(n):l!==0&&(e=st(l));if(e===0)return 0;if(g!==0&&g!==e&&!(g&t)&&(t=e&-e,l=g&-g,t>=l||t===16&&(l&4194240)!==0))return g;if(e&4&&(e|=C&16),g=I.entangledLanes,g!==0)for(I=I.entanglements,g&=e;0<g;)C=31-ZI(g),t=1<<C,e|=I[C],g&=~t;return e}function oh(I,g){switch(I){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ah(I,g){for(var C=I.suspendedLanes,e=I.pingedLanes,t=I.expirationTimes,l=I.pendingLanes;0<l;){var n=31-ZI(l),o=1<<n,A=t[n];A===-1?(!(o&C)||o&e)&&(t[n]=oh(o,g)):A<=g&&(I.expiredLanes|=o),l&=~o}}function EA(I){return I=I.pendingLanes&-1073741825,I!==0?I:I&1073741824?1073741824:0}function Lr(){var I=Gl;return Gl<<=1,!(Gl&4194240)&&(Gl=64),I}function Eo(I){for(var g=[],C=0;31>C;C++)g.push(I);return g}function tl(I,g,C){I.pendingLanes|=g,g!==536870912&&(I.suspendedLanes=0,I.pingedLanes=0),I=I.eventTimes,g=31-ZI(g),I[g]=C}function ih(I,g){var C=I.pendingLanes&~g;I.pendingLanes=g,I.suspendedLanes=0,I.pingedLanes=0,I.expiredLanes&=g,I.mutableReadLanes&=g,I.entangledLanes&=g,g=I.entanglements;var e=I.eventTimes;for(I=I.expirationTimes;0<C;){var t=31-ZI(C),l=1<<t;g[t]=0,e[t]=-1,I[t]=-1,C&=~l}}function qi(I,g){var C=I.entangledLanes|=g;for(I=I.entanglements;C;){var e=31-ZI(C),t=1<<e;t&g|I[e]&g&&(I[e]|=g),C&=~t}}var D=0;function Dr(I){return I&=-I,1<I?4<I?I&268435455?16:536870912:4:1}var Tr,$i,jr,Pr,Or,QA=!1,yl=[],iC=null,sC=null,cC=null,Yt=new Map,Ht=new Map,gC=[],sh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yc(I,g){switch(I){case"focusin":case"focusout":iC=null;break;case"dragenter":case"dragleave":sC=null;break;case"mouseover":case"mouseout":cC=null;break;case"pointerover":case"pointerout":Yt.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ht.delete(g.pointerId)}}function Pe(I,g,C,e,t,l){return I===null||I.nativeEvent!==l?(I={blockedOn:g,domEventName:C,eventSystemFlags:e,nativeEvent:l,targetContainers:[t]},g!==null&&(g=nl(g),g!==null&&$i(g)),I):(I.eventSystemFlags|=e,g=I.targetContainers,t!==null&&g.indexOf(t)===-1&&g.push(t),I)}function ch(I,g,C,e,t){switch(g){case"focusin":return iC=Pe(iC,I,g,C,e,t),!0;case"dragenter":return sC=Pe(sC,I,g,C,e,t),!0;case"mouseover":return cC=Pe(cC,I,g,C,e,t),!0;case"pointerover":var l=t.pointerId;return Yt.set(l,Pe(Yt.get(l)||null,I,g,C,e,t)),!0;case"gotpointercapture":return l=t.pointerId,Ht.set(l,Pe(Ht.get(l)||null,I,g,C,e,t)),!0}return!1}function _r(I){var g=NC(I.target);if(g!==null){var C=Ce(g);if(C!==null){if(g=C.tag,g===13){if(g=xr(C),g!==null){I.blockedOn=g,Or(I.priority,function(){jr(C)});return}}else if(g===3&&C.stateNode.current.memoizedState.isDehydrated){I.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}I.blockedOn=null}function Pl(I){if(I.blockedOn!==null)return!1;for(var g=I.targetContainers;0<g.length;){var C=UA(I.domEventName,I.eventSystemFlags,g[0],I.nativeEvent);if(C===null){C=I.nativeEvent;var e=new C.constructor(C.type,C);wA=e,C.target.dispatchEvent(e),wA=null}else return g=nl(C),g!==null&&$i(g),I.blockedOn=C,!1;g.shift()}return!0}function pc(I,g,C){Pl(I)&&C.delete(g)}function ah(){QA=!1,iC!==null&&Pl(iC)&&(iC=null),sC!==null&&Pl(sC)&&(sC=null),cC!==null&&Pl(cC)&&(cC=null),Yt.forEach(pc),Ht.forEach(pc)}function Oe(I,g){I.blockedOn===g&&(I.blockedOn=null,QA||(QA=!0,II.unstable_scheduleCallback(II.unstable_NormalPriority,ah)))}function vt(I){function g(t){return Oe(t,I)}if(0<yl.length){Oe(yl[0],I);for(var C=1;C<yl.length;C++){var e=yl[C];e.blockedOn===I&&(e.blockedOn=null)}}for(iC!==null&&Oe(iC,I),sC!==null&&Oe(sC,I),cC!==null&&Oe(cC,I),Yt.forEach(g),Ht.forEach(g),C=0;C<gC.length;C++)e=gC[C],e.blockedOn===I&&(e.blockedOn=null);for(;0<gC.length&&(C=gC[0],C.blockedOn===null);)_r(C),C.blockedOn===null&&gC.shift()}var Se=TI.ReactCurrentBatchConfig,bn=!0;function dh(I,g,C,e){var t=D,l=Se.transition;Se.transition=null;try{D=1,gs(I,g,C,e)}finally{D=t,Se.transition=l}}function rh(I,g,C,e){var t=D,l=Se.transition;Se.transition=null;try{D=4,gs(I,g,C,e)}finally{D=t,Se.transition=l}}function gs(I,g,C,e){if(bn){var t=UA(I,g,C,e);if(t===null)qo(I,g,e,hn,C),yc(I,e);else if(ch(t,I,g,C,e))e.stopPropagation();else if(yc(I,e),g&4&&-1<sh.indexOf(I)){for(;t!==null;){var l=nl(t);if(l!==null&&Tr(l),l=UA(I,g,C,e),l===null&&qo(I,g,e,hn,C),l===t)break;t=l}t!==null&&e.stopPropagation()}else qo(I,g,e,null,C)}}var hn=null;function UA(I,g,C,e){if(hn=null,I=Oi(e),I=NC(I),I!==null)if(g=Ce(I),g===null)I=null;else if(C=g.tag,C===13){if(I=xr(g),I!==null)return I;I=null}else if(C===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;I=null}else g!==I&&(I=null);return hn=I,null}function qr(I){switch(I){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ih()){case _i:return 1;case Qr:return 4;case un:case Ch:return 16;case Ur:return 536870912;default:return 16}default:return 16}}var CC=null,Is=null,Ol=null;function $r(){if(Ol)return Ol;var I,g=Is,C=g.length,e,t="value"in CC?CC.value:CC.textContent,l=t.length;for(I=0;I<C&&g[I]===t[I];I++);var n=C-I;for(e=1;e<=n&&g[C-e]===t[l-e];e++);return Ol=t.slice(I,1<e?1-e:void 0)}function _l(I){var g=I.keyCode;return"charCode"in I?(I=I.charCode,I===0&&g===13&&(I=13)):I=g,I===10&&(I=13),32<=I||I===13?I:0}function pl(){return!0}function Wc(){return!1}function eI(I){function g(C,e,t,l,n){this._reactName=C,this._targetInst=t,this.type=e,this.nativeEvent=l,this.target=n,this.currentTarget=null;for(var o in I)I.hasOwnProperty(o)&&(C=I[o],this[o]=C?C(l):l[o]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?pl:Wc,this.isPropagationStopped=Wc,this}return og(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=pl)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=pl)},persist:function(){},isPersistent:pl}),g}var Me={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(I){return I.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cs=eI(Me),ll=og({},Me,{view:0,detail:0}),mh=eI(ll),Qo,Uo,_e,go=og({},ll,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:es,button:0,buttons:0,relatedTarget:function(I){return I.relatedTarget===void 0?I.fromElement===I.srcElement?I.toElement:I.fromElement:I.relatedTarget},movementX:function(I){return"movementX"in I?I.movementX:(I!==_e&&(_e&&I.type==="mousemove"?(Qo=I.screenX-_e.screenX,Uo=I.screenY-_e.screenY):Uo=Qo=0,_e=I),Qo)},movementY:function(I){return"movementY"in I?I.movementY:Uo}}),Vc=eI(go),uh=og({},go,{dataTransfer:0}),Zh=eI(uh),bh=og({},ll,{relatedTarget:0}),Lo=eI(bh),hh=og({},Me,{animationName:0,elapsedTime:0,pseudoElement:0}),Gh=eI(hh),Bh=og({},Me,{clipboardData:function(I){return"clipboardData"in I?I.clipboardData:window.clipboardData}}),yh=eI(Bh),ph=og({},Me,{data:0}),Sc=eI(ph),Wh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rh(I){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(I):(I=Sh[I])?!!g[I]:!1}function es(){return Rh}var Xh=og({},ll,{key:function(I){if(I.key){var g=Wh[I.key]||I.key;if(g!=="Unidentified")return g}return I.type==="keypress"?(I=_l(I),I===13?"Enter":String.fromCharCode(I)):I.type==="keydown"||I.type==="keyup"?Vh[I.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:es,charCode:function(I){return I.type==="keypress"?_l(I):0},keyCode:function(I){return I.type==="keydown"||I.type==="keyup"?I.keyCode:0},which:function(I){return I.type==="keypress"?_l(I):I.type==="keydown"||I.type==="keyup"?I.keyCode:0}}),Jh=eI(Xh),kh=og({},go,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rc=eI(kh),fh=og({},ll,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:es}),Yh=eI(fh),Hh=og({},Me,{propertyName:0,elapsedTime:0,pseudoElement:0}),vh=eI(Hh),Nh=og({},go,{deltaX:function(I){return"deltaX"in I?I.deltaX:"wheelDeltaX"in I?-I.wheelDeltaX:0},deltaY:function(I){return"deltaY"in I?I.deltaY:"wheelDeltaY"in I?-I.wheelDeltaY:"wheelDelta"in I?-I.wheelDelta:0},deltaZ:0,deltaMode:0}),Fh=eI(Nh),Kh=[9,13,27,32],ts=QI&&"CompositionEvent"in window,ht=null;QI&&"documentMode"in document&&(ht=document.documentMode);var wh=QI&&"TextEvent"in window&&!ht,gm=QI&&(!ts||ht&&8<ht&&11>=ht),Xc=" ",Jc=!1;function Im(I,g){switch(I){case"keyup":return Kh.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cm(I){return I=I.detail,typeof I=="object"&&"data"in I?I.data:null}var ce=!1;function xh(I,g){switch(I){case"compositionend":return Cm(g);case"keypress":return g.which!==32?null:(Jc=!0,Xc);case"textInput":return I=g.data,I===Xc&&Jc?null:I;default:return null}}function zh(I,g){if(ce)return I==="compositionend"||!ts&&Im(I,g)?(I=$r(),Ol=Is=CC=null,ce=!1,I):null;switch(I){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return gm&&g.locale!=="ko"?null:g.data;default:return null}}var Mh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kc(I){var g=I&&I.nodeName&&I.nodeName.toLowerCase();return g==="input"?!!Mh[I.type]:g==="textarea"}function em(I,g,C,e){vr(e),g=Gn(g,"onChange"),0<g.length&&(C=new Cs("onChange","change",null,C,e),I.push({event:C,listeners:g}))}var Gt=null,Nt=null;function Eh(I){rm(I,0)}function Io(I){var g=re(I);if(Rr(g))return I}function Qh(I,g){if(I==="change")return g}var tm=!1;if(QI){var Do;if(QI){var To="oninput"in document;if(!To){var fc=document.createElement("div");fc.setAttribute("oninput","return;"),To=typeof fc.oninput=="function"}Do=To}else Do=!1;tm=Do&&(!document.documentMode||9<document.documentMode)}function Yc(){Gt&&(Gt.detachEvent("onpropertychange",lm),Nt=Gt=null)}function lm(I){if(I.propertyName==="value"&&Io(Nt)){var g=[];em(g,Nt,I,Oi(I)),wr(Eh,g)}}function Uh(I,g,C){I==="focusin"?(Yc(),Gt=g,Nt=C,Gt.attachEvent("onpropertychange",lm)):I==="focusout"&&Yc()}function Lh(I){if(I==="selectionchange"||I==="keyup"||I==="keydown")return Io(Nt)}function Dh(I,g){if(I==="click")return Io(g)}function Th(I,g){if(I==="input"||I==="change")return Io(g)}function jh(I,g){return I===g&&(I!==0||1/I===1/g)||I!==I&&g!==g}var GI=typeof Object.is=="function"?Object.is:jh;function Ft(I,g){if(GI(I,g))return!0;if(typeof I!="object"||I===null||typeof g!="object"||g===null)return!1;var C=Object.keys(I),e=Object.keys(g);if(C.length!==e.length)return!1;for(e=0;e<C.length;e++){var t=C[e];if(!SA.call(g,t)||!GI(I[t],g[t]))return!1}return!0}function Hc(I){for(;I&&I.firstChild;)I=I.firstChild;return I}function vc(I,g){var C=Hc(I);I=0;for(var e;C;){if(C.nodeType===3){if(e=I+C.textContent.length,I<=g&&e>=g)return{node:C,offset:g-I};I=e}g:{for(;C;){if(C.nextSibling){C=C.nextSibling;break g}C=C.parentNode}C=void 0}C=Hc(C)}}function nm(I,g){return I&&g?I===g?!0:I&&I.nodeType===3?!1:g&&g.nodeType===3?nm(I,g.parentNode):"contains"in I?I.contains(g):I.compareDocumentPosition?!!(I.compareDocumentPosition(g)&16):!1:!1}function om(){for(var I=window,g=dn();g instanceof I.HTMLIFrameElement;){try{var C=typeof g.contentWindow.location.href=="string"}catch{C=!1}if(C)I=g.contentWindow;else break;g=dn(I.document)}return g}function ls(I){var g=I&&I.nodeName&&I.nodeName.toLowerCase();return g&&(g==="input"&&(I.type==="text"||I.type==="search"||I.type==="tel"||I.type==="url"||I.type==="password")||g==="textarea"||I.contentEditable==="true")}function Ph(I){var g=om(),C=I.focusedElem,e=I.selectionRange;if(g!==C&&C&&C.ownerDocument&&nm(C.ownerDocument.documentElement,C)){if(e!==null&&ls(C)){if(g=e.start,I=e.end,I===void 0&&(I=g),"selectionStart"in C)C.selectionStart=g,C.selectionEnd=Math.min(I,C.value.length);else if(I=(g=C.ownerDocument||document)&&g.defaultView||window,I.getSelection){I=I.getSelection();var t=C.textContent.length,l=Math.min(e.start,t);e=e.end===void 0?l:Math.min(e.end,t),!I.extend&&l>e&&(t=e,e=l,l=t),t=vc(C,l);var n=vc(C,e);t&&n&&(I.rangeCount!==1||I.anchorNode!==t.node||I.anchorOffset!==t.offset||I.focusNode!==n.node||I.focusOffset!==n.offset)&&(g=g.createRange(),g.setStart(t.node,t.offset),I.removeAllRanges(),l>e?(I.addRange(g),I.extend(n.node,n.offset)):(g.setEnd(n.node,n.offset),I.addRange(g)))}}for(g=[],I=C;I=I.parentNode;)I.nodeType===1&&g.push({element:I,left:I.scrollLeft,top:I.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<g.length;C++)I=g[C],I.element.scrollLeft=I.left,I.element.scrollTop=I.top}}var Oh=QI&&"documentMode"in document&&11>=document.documentMode,ae=null,LA=null,Bt=null,DA=!1;function Nc(I,g,C){var e=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;DA||ae==null||ae!==dn(e)||(e=ae,"selectionStart"in e&&ls(e)?e={start:e.selectionStart,end:e.selectionEnd}:(e=(e.ownerDocument&&e.ownerDocument.defaultView||window).getSelection(),e={anchorNode:e.anchorNode,anchorOffset:e.anchorOffset,focusNode:e.focusNode,focusOffset:e.focusOffset}),Bt&&Ft(Bt,e)||(Bt=e,e=Gn(LA,"onSelect"),0<e.length&&(g=new Cs("onSelect","select",null,g,C),I.push({event:g,listeners:e}),g.target=ae)))}function Wl(I,g){var C={};return C[I.toLowerCase()]=g.toLowerCase(),C["Webkit"+I]="webkit"+g,C["Moz"+I]="moz"+g,C}var de={animationend:Wl("Animation","AnimationEnd"),animationiteration:Wl("Animation","AnimationIteration"),animationstart:Wl("Animation","AnimationStart"),transitionend:Wl("Transition","TransitionEnd")},jo={},Am={};QI&&(Am=document.createElement("div").style,"AnimationEvent"in window||(delete de.animationend.animation,delete de.animationiteration.animation,delete de.animationstart.animation),"TransitionEvent"in window||delete de.transitionend.transition);function Co(I){if(jo[I])return jo[I];if(!de[I])return I;var g=de[I],C;for(C in g)if(g.hasOwnProperty(C)&&C in Am)return jo[I]=g[C];return I}var im=Co("animationend"),sm=Co("animationiteration"),cm=Co("animationstart"),am=Co("transitionend"),dm=new Map,Fc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function pC(I,g){dm.set(I,g),Ie(g,[I])}for(var Po=0;Po<Fc.length;Po++){var Oo=Fc[Po],_h=Oo.toLowerCase(),qh=Oo[0].toUpperCase()+Oo.slice(1);pC(_h,"on"+qh)}pC(im,"onAnimationEnd");pC(sm,"onAnimationIteration");pC(cm,"onAnimationStart");pC("dblclick","onDoubleClick");pC("focusin","onFocus");pC("focusout","onBlur");pC(am,"onTransitionEnd");fe("onMouseEnter",["mouseout","mouseover"]);fe("onMouseLeave",["mouseout","mouseover"]);fe("onPointerEnter",["pointerout","pointerover"]);fe("onPointerLeave",["pointerout","pointerover"]);Ie("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ie("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ie("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ie("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ie("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ie("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ct="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$h=new Set("cancel close invalid load scroll toggle".split(" ").concat(ct));function Kc(I,g,C){var e=I.type||"unknown-event";I.currentTarget=C,_b(e,g,void 0,I),I.currentTarget=null}function rm(I,g){g=(g&4)!==0;for(var C=0;C<I.length;C++){var e=I[C],t=e.event;e=e.listeners;g:{var l=void 0;if(g)for(var n=e.length-1;0<=n;n--){var o=e[n],A=o.instance,i=o.currentTarget;if(o=o.listener,A!==l&&t.isPropagationStopped())break g;Kc(t,o,i),l=A}else for(n=0;n<e.length;n++){if(o=e[n],A=o.instance,i=o.currentTarget,o=o.listener,A!==l&&t.isPropagationStopped())break g;Kc(t,o,i),l=A}}}if(mn)throw I=MA,mn=!1,MA=null,I}function Cg(I,g){var C=g[_A];C===void 0&&(C=g[_A]=new Set);var e=I+"__bubble";C.has(e)||(mm(g,I,2,!1),C.add(e))}function _o(I,g,C){var e=0;g&&(e|=4),mm(C,I,e,g)}var Vl="_reactListening"+Math.random().toString(36).slice(2);function Kt(I){if(!I[Vl]){I[Vl]=!0,yr.forEach(function(C){C!=="selectionchange"&&($h.has(C)||_o(C,!1,I),_o(C,!0,I))});var g=I.nodeType===9?I:I.ownerDocument;g===null||g[Vl]||(g[Vl]=!0,_o("selectionchange",!1,g))}}function mm(I,g,C,e){switch(qr(g)){case 1:var t=dh;break;case 4:t=rh;break;default:t=gs}C=t.bind(null,g,C,I),t=void 0,!zA||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(t=!0),e?t!==void 0?I.addEventListener(g,C,{capture:!0,passive:t}):I.addEventListener(g,C,!0):t!==void 0?I.addEventListener(g,C,{passive:t}):I.addEventListener(g,C,!1)}function qo(I,g,C,e,t){var l=e;if(!(g&1)&&!(g&2)&&e!==null)g:for(;;){if(e===null)return;var n=e.tag;if(n===3||n===4){var o=e.stateNode.containerInfo;if(o===t||o.nodeType===8&&o.parentNode===t)break;if(n===4)for(n=e.return;n!==null;){var A=n.tag;if((A===3||A===4)&&(A=n.stateNode.containerInfo,A===t||A.nodeType===8&&A.parentNode===t))return;n=n.return}for(;o!==null;){if(n=NC(o),n===null)return;if(A=n.tag,A===5||A===6){e=l=n;continue g}o=o.parentNode}}e=e.return}wr(function(){var i=l,s=Oi(C),c=[];g:{var a=dm.get(I);if(a!==void 0){var r=Cs,m=I;switch(I){case"keypress":if(_l(C)===0)break g;case"keydown":case"keyup":r=Jh;break;case"focusin":m="focus",r=Lo;break;case"focusout":m="blur",r=Lo;break;case"beforeblur":case"afterblur":r=Lo;break;case"click":if(C.button===2)break g;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":r=Vc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":r=Zh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":r=Yh;break;case im:case sm:case cm:r=Gh;break;case am:r=vh;break;case"scroll":r=mh;break;case"wheel":r=Fh;break;case"copy":case"cut":case"paste":r=yh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":r=Rc}var b=(g&4)!==0,G=!b&&I==="scroll",u=b?a!==null?a+"Capture":null:a;b=[];for(var Z=i,h;Z!==null;){h=Z;var B=h.stateNode;if(h.tag===5&&B!==null&&(h=B,u!==null&&(B=ft(Z,u),B!=null&&b.push(wt(Z,B,h)))),G)break;Z=Z.return}0<b.length&&(a=new r(a,m,null,C,s),c.push({event:a,listeners:b}))}}if(!(g&7)){g:{if(a=I==="mouseover"||I==="pointerover",r=I==="mouseout"||I==="pointerout",a&&C!==wA&&(m=C.relatedTarget||C.fromElement)&&(NC(m)||m[UI]))break g;if((r||a)&&(a=s.window===s?s:(a=s.ownerDocument)?a.defaultView||a.parentWindow:window,r?(m=C.relatedTarget||C.toElement,r=i,m=m?NC(m):null,m!==null&&(G=Ce(m),m!==G||m.tag!==5&&m.tag!==6)&&(m=null)):(r=null,m=i),r!==m)){if(b=Vc,B="onMouseLeave",u="onMouseEnter",Z="mouse",(I==="pointerout"||I==="pointerover")&&(b=Rc,B="onPointerLeave",u="onPointerEnter",Z="pointer"),G=r==null?a:re(r),h=m==null?a:re(m),a=new b(B,Z+"leave",r,C,s),a.target=G,a.relatedTarget=h,B=null,NC(s)===i&&(b=new b(u,Z+"enter",m,C,s),b.target=h,b.relatedTarget=G,B=b),G=B,r&&m)I:{for(b=r,u=m,Z=0,h=b;h;h=le(h))Z++;for(h=0,B=u;B;B=le(B))h++;for(;0<Z-h;)b=le(b),Z--;for(;0<h-Z;)u=le(u),h--;for(;Z--;){if(b===u||u!==null&&b===u.alternate)break I;b=le(b),u=le(u)}b=null}else b=null;r!==null&&wc(c,a,r,b,!1),m!==null&&G!==null&&wc(c,G,m,b,!0)}}g:{if(a=i?re(i):window,r=a.nodeName&&a.nodeName.toLowerCase(),r==="select"||r==="input"&&a.type==="file")var y=Qh;else if(kc(a))if(tm)y=Th;else{y=Lh;var V=Uh}else(r=a.nodeName)&&r.toLowerCase()==="input"&&(a.type==="checkbox"||a.type==="radio")&&(y=Dh);if(y&&(y=y(I,i))){em(c,y,C,s);break g}V&&V(I,a,i),I==="focusout"&&(V=a._wrapperState)&&V.controlled&&a.type==="number"&&HA(a,"number",a.value)}switch(V=i?re(i):window,I){case"focusin":(kc(V)||V.contentEditable==="true")&&(ae=V,LA=i,Bt=null);break;case"focusout":Bt=LA=ae=null;break;case"mousedown":DA=!0;break;case"contextmenu":case"mouseup":case"dragend":DA=!1,Nc(c,C,s);break;case"selectionchange":if(Oh)break;case"keydown":case"keyup":Nc(c,C,s)}var W;if(ts)g:{switch(I){case"compositionstart":var R="onCompositionStart";break g;case"compositionend":R="onCompositionEnd";break g;case"compositionupdate":R="onCompositionUpdate";break g}R=void 0}else ce?Im(I,C)&&(R="onCompositionEnd"):I==="keydown"&&C.keyCode===229&&(R="onCompositionStart");R&&(gm&&C.locale!=="ko"&&(ce||R!=="onCompositionStart"?R==="onCompositionEnd"&&ce&&(W=$r()):(CC=s,Is="value"in CC?CC.value:CC.textContent,ce=!0)),V=Gn(i,R),0<V.length&&(R=new Sc(R,I,null,C,s),c.push({event:R,listeners:V}),W?R.data=W:(W=Cm(C),W!==null&&(R.data=W)))),(W=wh?xh(I,C):zh(I,C))&&(i=Gn(i,"onBeforeInput"),0<i.length&&(s=new Sc("onBeforeInput","beforeinput",null,C,s),c.push({event:s,listeners:i}),s.data=W))}rm(c,g)})}function wt(I,g,C){return{instance:I,listener:g,currentTarget:C}}function Gn(I,g){for(var C=g+"Capture",e=[];I!==null;){var t=I,l=t.stateNode;t.tag===5&&l!==null&&(t=l,l=ft(I,C),l!=null&&e.unshift(wt(I,l,t)),l=ft(I,g),l!=null&&e.push(wt(I,l,t))),I=I.return}return e}function le(I){if(I===null)return null;do I=I.return;while(I&&I.tag!==5);return I||null}function wc(I,g,C,e,t){for(var l=g._reactName,n=[];C!==null&&C!==e;){var o=C,A=o.alternate,i=o.stateNode;if(A!==null&&A===e)break;o.tag===5&&i!==null&&(o=i,t?(A=ft(C,l),A!=null&&n.unshift(wt(C,A,o))):t||(A=ft(C,l),A!=null&&n.push(wt(C,A,o)))),C=C.return}n.length!==0&&I.push({event:g,listeners:n})}var gG=/\r\n?/g,IG=/\u0000|\uFFFD/g;function xc(I){return(typeof I=="string"?I:""+I).replace(gG,`
`).replace(IG,"")}function Sl(I,g,C){if(g=xc(g),xc(I)!==g&&C)throw Error(X(425))}function Bn(){}var TA=null,jA=null;function PA(I,g){return I==="textarea"||I==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var OA=typeof setTimeout=="function"?setTimeout:void 0,CG=typeof clearTimeout=="function"?clearTimeout:void 0,zc=typeof Promise=="function"?Promise:void 0,eG=typeof queueMicrotask=="function"?queueMicrotask:typeof zc<"u"?function(I){return zc.resolve(null).then(I).catch(tG)}:OA;function tG(I){setTimeout(function(){throw I})}function $o(I,g){var C=g,e=0;do{var t=C.nextSibling;if(I.removeChild(C),t&&t.nodeType===8)if(C=t.data,C==="/$"){if(e===0){I.removeChild(t),vt(g);return}e--}else C!=="$"&&C!=="$?"&&C!=="$!"||e++;C=t}while(C);vt(g)}function aC(I){for(;I!=null;I=I.nextSibling){var g=I.nodeType;if(g===1||g===3)break;if(g===8){if(g=I.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return I}function Mc(I){I=I.previousSibling;for(var g=0;I;){if(I.nodeType===8){var C=I.data;if(C==="$"||C==="$!"||C==="$?"){if(g===0)return I;g--}else C==="/$"&&g++}I=I.previousSibling}return null}var Ee=Math.random().toString(36).slice(2),JI="__reactFiber$"+Ee,xt="__reactProps$"+Ee,UI="__reactContainer$"+Ee,_A="__reactEvents$"+Ee,lG="__reactListeners$"+Ee,nG="__reactHandles$"+Ee;function NC(I){var g=I[JI];if(g)return g;for(var C=I.parentNode;C;){if(g=C[UI]||C[JI]){if(C=g.alternate,g.child!==null||C!==null&&C.child!==null)for(I=Mc(I);I!==null;){if(C=I[JI])return C;I=Mc(I)}return g}I=C,C=I.parentNode}return null}function nl(I){return I=I[JI]||I[UI],!I||I.tag!==5&&I.tag!==6&&I.tag!==13&&I.tag!==3?null:I}function re(I){if(I.tag===5||I.tag===6)return I.stateNode;throw Error(X(33))}function eo(I){return I[xt]||null}var qA=[],me=-1;function WC(I){return{current:I}}function eg(I){0>me||(I.current=qA[me],qA[me]=null,me--)}function $(I,g){me++,qA[me]=I.current,I.current=g}var GC={},Yg=WC(GC),Dg=WC(!1),LC=GC;function Ye(I,g){var C=I.type.contextTypes;if(!C)return GC;var e=I.stateNode;if(e&&e.__reactInternalMemoizedUnmaskedChildContext===g)return e.__reactInternalMemoizedMaskedChildContext;var t={},l;for(l in C)t[l]=g[l];return e&&(I=I.stateNode,I.__reactInternalMemoizedUnmaskedChildContext=g,I.__reactInternalMemoizedMaskedChildContext=t),t}function Tg(I){return I=I.childContextTypes,I!=null}function yn(){eg(Dg),eg(Yg)}function Ec(I,g,C){if(Yg.current!==GC)throw Error(X(168));$(Yg,g),$(Dg,C)}function um(I,g,C){var e=I.stateNode;if(g=g.childContextTypes,typeof e.getChildContext!="function")return C;e=e.getChildContext();for(var t in e)if(!(t in g))throw Error(X(108,Ub(I)||"Unknown",t));return og({},C,e)}function pn(I){return I=(I=I.stateNode)&&I.__reactInternalMemoizedMergedChildContext||GC,LC=Yg.current,$(Yg,I),$(Dg,Dg.current),!0}function Qc(I,g,C){var e=I.stateNode;if(!e)throw Error(X(169));C?(I=um(I,g,LC),e.__reactInternalMemoizedMergedChildContext=I,eg(Dg),eg(Yg),$(Yg,I)):eg(Dg),$(Dg,C)}var wI=null,to=!1,gA=!1;function Zm(I){wI===null?wI=[I]:wI.push(I)}function oG(I){to=!0,Zm(I)}function VC(){if(!gA&&wI!==null){gA=!0;var I=0,g=D;try{var C=wI;for(D=1;I<C.length;I++){var e=C[I];do e=e(!0);while(e!==null)}wI=null,to=!1}catch(t){throw wI!==null&&(wI=wI.slice(I+1)),Er(_i,VC),t}finally{D=g,gA=!1}}return null}var ue=[],Ze=0,Wn=null,Vn=0,nI=[],oI=0,DC=null,zI=1,MI="";function YC(I,g){ue[Ze++]=Vn,ue[Ze++]=Wn,Wn=I,Vn=g}function bm(I,g,C){nI[oI++]=zI,nI[oI++]=MI,nI[oI++]=DC,DC=I;var e=zI;I=MI;var t=32-ZI(e)-1;e&=~(1<<t),C+=1;var l=32-ZI(g)+t;if(30<l){var n=t-t%5;l=(e&(1<<n)-1).toString(32),e>>=n,t-=n,zI=1<<32-ZI(g)+t|C<<t|e,MI=l+I}else zI=1<<l|C<<t|e,MI=I}function ns(I){I.return!==null&&(YC(I,1),bm(I,1,0))}function os(I){for(;I===Wn;)Wn=ue[--Ze],ue[Ze]=null,Vn=ue[--Ze],ue[Ze]=null;for(;I===DC;)DC=nI[--oI],nI[oI]=null,MI=nI[--oI],nI[oI]=null,zI=nI[--oI],nI[oI]=null}var gI=null,$g=null,tg=!1,uI=null;function hm(I,g){var C=AI(5,null,null,0);C.elementType="DELETED",C.stateNode=g,C.return=I,g=I.deletions,g===null?(I.deletions=[C],I.flags|=16):g.push(C)}function Uc(I,g){switch(I.tag){case 5:var C=I.type;return g=g.nodeType!==1||C.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(I.stateNode=g,gI=I,$g=aC(g.firstChild),!0):!1;case 6:return g=I.pendingProps===""||g.nodeType!==3?null:g,g!==null?(I.stateNode=g,gI=I,$g=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(C=DC!==null?{id:zI,overflow:MI}:null,I.memoizedState={dehydrated:g,treeContext:C,retryLane:1073741824},C=AI(18,null,null,0),C.stateNode=g,C.return=I,I.child=C,gI=I,$g=null,!0):!1;default:return!1}}function $A(I){return(I.mode&1)!==0&&(I.flags&128)===0}function gi(I){if(tg){var g=$g;if(g){var C=g;if(!Uc(I,g)){if($A(I))throw Error(X(418));g=aC(C.nextSibling);var e=gI;g&&Uc(I,g)?hm(e,C):(I.flags=I.flags&-4097|2,tg=!1,gI=I)}}else{if($A(I))throw Error(X(418));I.flags=I.flags&-4097|2,tg=!1,gI=I}}}function Lc(I){for(I=I.return;I!==null&&I.tag!==5&&I.tag!==3&&I.tag!==13;)I=I.return;gI=I}function Rl(I){if(I!==gI)return!1;if(!tg)return Lc(I),tg=!0,!1;var g;if((g=I.tag!==3)&&!(g=I.tag!==5)&&(g=I.type,g=g!=="head"&&g!=="body"&&!PA(I.type,I.memoizedProps)),g&&(g=$g)){if($A(I))throw Gm(),Error(X(418));for(;g;)hm(I,g),g=aC(g.nextSibling)}if(Lc(I),I.tag===13){if(I=I.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(X(317));g:{for(I=I.nextSibling,g=0;I;){if(I.nodeType===8){var C=I.data;if(C==="/$"){if(g===0){$g=aC(I.nextSibling);break g}g--}else C!=="$"&&C!=="$!"&&C!=="$?"||g++}I=I.nextSibling}$g=null}}else $g=gI?aC(I.stateNode.nextSibling):null;return!0}function Gm(){for(var I=$g;I;)I=aC(I.nextSibling)}function He(){$g=gI=null,tg=!1}function As(I){uI===null?uI=[I]:uI.push(I)}var AG=TI.ReactCurrentBatchConfig;function qe(I,g,C){if(I=C.ref,I!==null&&typeof I!="function"&&typeof I!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(X(309));var e=C.stateNode}if(!e)throw Error(X(147,I));var t=e,l=""+I;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===l?g.ref:(g=function(n){var o=t.refs;n===null?delete o[l]:o[l]=n},g._stringRef=l,g)}if(typeof I!="string")throw Error(X(284));if(!C._owner)throw Error(X(290,I))}return I}function Xl(I,g){throw I=Object.prototype.toString.call(g),Error(X(31,I==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":I))}function Dc(I){var g=I._init;return g(I._payload)}function Bm(I){function g(u,Z){if(I){var h=u.deletions;h===null?(u.deletions=[Z],u.flags|=16):h.push(Z)}}function C(u,Z){if(!I)return null;for(;Z!==null;)g(u,Z),Z=Z.sibling;return null}function e(u,Z){for(u=new Map;Z!==null;)Z.key!==null?u.set(Z.key,Z):u.set(Z.index,Z),Z=Z.sibling;return u}function t(u,Z){return u=uC(u,Z),u.index=0,u.sibling=null,u}function l(u,Z,h){return u.index=h,I?(h=u.alternate,h!==null?(h=h.index,h<Z?(u.flags|=2,Z):h):(u.flags|=2,Z)):(u.flags|=1048576,Z)}function n(u){return I&&u.alternate===null&&(u.flags|=2),u}function o(u,Z,h,B){return Z===null||Z.tag!==6?(Z=oA(h,u.mode,B),Z.return=u,Z):(Z=t(Z,h),Z.return=u,Z)}function A(u,Z,h,B){var y=h.type;return y===se?s(u,Z,h.props.children,B,h.key):Z!==null&&(Z.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===qI&&Dc(y)===Z.type)?(B=t(Z,h.props),B.ref=qe(u,Z,h),B.return=u,B):(B=tn(h.type,h.key,h.props,null,u.mode,B),B.ref=qe(u,Z,h),B.return=u,B)}function i(u,Z,h,B){return Z===null||Z.tag!==4||Z.stateNode.containerInfo!==h.containerInfo||Z.stateNode.implementation!==h.implementation?(Z=AA(h,u.mode,B),Z.return=u,Z):(Z=t(Z,h.children||[]),Z.return=u,Z)}function s(u,Z,h,B,y){return Z===null||Z.tag!==7?(Z=zC(h,u.mode,B,y),Z.return=u,Z):(Z=t(Z,h),Z.return=u,Z)}function c(u,Z,h){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return Z=oA(""+Z,u.mode,h),Z.return=u,Z;if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case Zl:return h=tn(Z.type,Z.key,Z.props,null,u.mode,h),h.ref=qe(u,null,Z),h.return=u,h;case ie:return Z=AA(Z,u.mode,h),Z.return=u,Z;case qI:var B=Z._init;return c(u,B(Z._payload),h)}if(it(Z)||Te(Z))return Z=zC(Z,u.mode,h,null),Z.return=u,Z;Xl(u,Z)}return null}function a(u,Z,h,B){var y=Z!==null?Z.key:null;if(typeof h=="string"&&h!==""||typeof h=="number")return y!==null?null:o(u,Z,""+h,B);if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Zl:return h.key===y?A(u,Z,h,B):null;case ie:return h.key===y?i(u,Z,h,B):null;case qI:return y=h._init,a(u,Z,y(h._payload),B)}if(it(h)||Te(h))return y!==null?null:s(u,Z,h,B,null);Xl(u,h)}return null}function r(u,Z,h,B,y){if(typeof B=="string"&&B!==""||typeof B=="number")return u=u.get(h)||null,o(Z,u,""+B,y);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case Zl:return u=u.get(B.key===null?h:B.key)||null,A(Z,u,B,y);case ie:return u=u.get(B.key===null?h:B.key)||null,i(Z,u,B,y);case qI:var V=B._init;return r(u,Z,h,V(B._payload),y)}if(it(B)||Te(B))return u=u.get(h)||null,s(Z,u,B,y,null);Xl(Z,B)}return null}function m(u,Z,h,B){for(var y=null,V=null,W=Z,R=Z=0,f=null;W!==null&&R<h.length;R++){W.index>R?(f=W,W=null):f=W.sibling;var J=a(u,W,h[R],B);if(J===null){W===null&&(W=f);break}I&&W&&J.alternate===null&&g(u,W),Z=l(J,Z,R),V===null?y=J:V.sibling=J,V=J,W=f}if(R===h.length)return C(u,W),tg&&YC(u,R),y;if(W===null){for(;R<h.length;R++)W=c(u,h[R],B),W!==null&&(Z=l(W,Z,R),V===null?y=W:V.sibling=W,V=W);return tg&&YC(u,R),y}for(W=e(u,W);R<h.length;R++)f=r(W,u,R,h[R],B),f!==null&&(I&&f.alternate!==null&&W.delete(f.key===null?R:f.key),Z=l(f,Z,R),V===null?y=f:V.sibling=f,V=f);return I&&W.forEach(function(H){return g(u,H)}),tg&&YC(u,R),y}function b(u,Z,h,B){var y=Te(h);if(typeof y!="function")throw Error(X(150));if(h=y.call(h),h==null)throw Error(X(151));for(var V=y=null,W=Z,R=Z=0,f=null,J=h.next();W!==null&&!J.done;R++,J=h.next()){W.index>R?(f=W,W=null):f=W.sibling;var H=a(u,W,J.value,B);if(H===null){W===null&&(W=f);break}I&&W&&H.alternate===null&&g(u,W),Z=l(H,Z,R),V===null?y=H:V.sibling=H,V=H,W=f}if(J.done)return C(u,W),tg&&YC(u,R),y;if(W===null){for(;!J.done;R++,J=h.next())J=c(u,J.value,B),J!==null&&(Z=l(J,Z,R),V===null?y=J:V.sibling=J,V=J);return tg&&YC(u,R),y}for(W=e(u,W);!J.done;R++,J=h.next())J=r(W,u,R,J.value,B),J!==null&&(I&&J.alternate!==null&&W.delete(J.key===null?R:J.key),Z=l(J,Z,R),V===null?y=J:V.sibling=J,V=J);return I&&W.forEach(function(K){return g(u,K)}),tg&&YC(u,R),y}function G(u,Z,h,B){if(typeof h=="object"&&h!==null&&h.type===se&&h.key===null&&(h=h.props.children),typeof h=="object"&&h!==null){switch(h.$$typeof){case Zl:g:{for(var y=h.key,V=Z;V!==null;){if(V.key===y){if(y=h.type,y===se){if(V.tag===7){C(u,V.sibling),Z=t(V,h.props.children),Z.return=u,u=Z;break g}}else if(V.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===qI&&Dc(y)===V.type){C(u,V.sibling),Z=t(V,h.props),Z.ref=qe(u,V,h),Z.return=u,u=Z;break g}C(u,V);break}else g(u,V);V=V.sibling}h.type===se?(Z=zC(h.props.children,u.mode,B,h.key),Z.return=u,u=Z):(B=tn(h.type,h.key,h.props,null,u.mode,B),B.ref=qe(u,Z,h),B.return=u,u=B)}return n(u);case ie:g:{for(V=h.key;Z!==null;){if(Z.key===V)if(Z.tag===4&&Z.stateNode.containerInfo===h.containerInfo&&Z.stateNode.implementation===h.implementation){C(u,Z.sibling),Z=t(Z,h.children||[]),Z.return=u,u=Z;break g}else{C(u,Z);break}else g(u,Z);Z=Z.sibling}Z=AA(h,u.mode,B),Z.return=u,u=Z}return n(u);case qI:return V=h._init,G(u,Z,V(h._payload),B)}if(it(h))return m(u,Z,h,B);if(Te(h))return b(u,Z,h,B);Xl(u,h)}return typeof h=="string"&&h!==""||typeof h=="number"?(h=""+h,Z!==null&&Z.tag===6?(C(u,Z.sibling),Z=t(Z,h),Z.return=u,u=Z):(C(u,Z),Z=oA(h,u.mode,B),Z.return=u,u=Z),n(u)):C(u,Z)}return G}var ve=Bm(!0),ym=Bm(!1),Sn=WC(null),Rn=null,be=null,is=null;function ss(){is=be=Rn=null}function cs(I){var g=Sn.current;eg(Sn),I._currentValue=g}function Ii(I,g,C){for(;I!==null;){var e=I.alternate;if((I.childLanes&g)!==g?(I.childLanes|=g,e!==null&&(e.childLanes|=g)):e!==null&&(e.childLanes&g)!==g&&(e.childLanes|=g),I===C)break;I=I.return}}function Re(I,g){Rn=I,is=be=null,I=I.dependencies,I!==null&&I.firstContext!==null&&(I.lanes&g&&(Ug=!0),I.firstContext=null)}function cI(I){var g=I._currentValue;if(is!==I)if(I={context:I,memoizedValue:g,next:null},be===null){if(Rn===null)throw Error(X(308));be=I,Rn.dependencies={lanes:0,firstContext:I}}else be=be.next=I;return g}var FC=null;function as(I){FC===null?FC=[I]:FC.push(I)}function pm(I,g,C,e){var t=g.interleaved;return t===null?(C.next=C,as(g)):(C.next=t.next,t.next=C),g.interleaved=C,LI(I,e)}function LI(I,g){I.lanes|=g;var C=I.alternate;for(C!==null&&(C.lanes|=g),C=I,I=I.return;I!==null;)I.childLanes|=g,C=I.alternate,C!==null&&(C.childLanes|=g),C=I,I=I.return;return C.tag===3?C.stateNode:null}var $I=!1;function ds(I){I.updateQueue={baseState:I.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Wm(I,g){I=I.updateQueue,g.updateQueue===I&&(g.updateQueue={baseState:I.baseState,firstBaseUpdate:I.firstBaseUpdate,lastBaseUpdate:I.lastBaseUpdate,shared:I.shared,effects:I.effects})}function EI(I,g){return{eventTime:I,lane:g,tag:0,payload:null,callback:null,next:null}}function dC(I,g,C){var e=I.updateQueue;if(e===null)return null;if(e=e.shared,M&2){var t=e.pending;return t===null?g.next=g:(g.next=t.next,t.next=g),e.pending=g,LI(I,C)}return t=e.interleaved,t===null?(g.next=g,as(e)):(g.next=t.next,t.next=g),e.interleaved=g,LI(I,C)}function ql(I,g,C){if(g=g.updateQueue,g!==null&&(g=g.shared,(C&4194240)!==0)){var e=g.lanes;e&=I.pendingLanes,C|=e,g.lanes=C,qi(I,C)}}function Tc(I,g){var C=I.updateQueue,e=I.alternate;if(e!==null&&(e=e.updateQueue,C===e)){var t=null,l=null;if(C=C.firstBaseUpdate,C!==null){do{var n={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};l===null?t=l=n:l=l.next=n,C=C.next}while(C!==null);l===null?t=l=g:l=l.next=g}else t=l=g;C={baseState:e.baseState,firstBaseUpdate:t,lastBaseUpdate:l,shared:e.shared,effects:e.effects},I.updateQueue=C;return}I=C.lastBaseUpdate,I===null?C.firstBaseUpdate=g:I.next=g,C.lastBaseUpdate=g}function Xn(I,g,C,e){var t=I.updateQueue;$I=!1;var l=t.firstBaseUpdate,n=t.lastBaseUpdate,o=t.shared.pending;if(o!==null){t.shared.pending=null;var A=o,i=A.next;A.next=null,n===null?l=i:n.next=i,n=A;var s=I.alternate;s!==null&&(s=s.updateQueue,o=s.lastBaseUpdate,o!==n&&(o===null?s.firstBaseUpdate=i:o.next=i,s.lastBaseUpdate=A))}if(l!==null){var c=t.baseState;n=0,s=i=A=null,o=l;do{var a=o.lane,r=o.eventTime;if((e&a)===a){s!==null&&(s=s.next={eventTime:r,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});g:{var m=I,b=o;switch(a=g,r=C,b.tag){case 1:if(m=b.payload,typeof m=="function"){c=m.call(r,c,a);break g}c=m;break g;case 3:m.flags=m.flags&-65537|128;case 0:if(m=b.payload,a=typeof m=="function"?m.call(r,c,a):m,a==null)break g;c=og({},c,a);break g;case 2:$I=!0}}o.callback!==null&&o.lane!==0&&(I.flags|=64,a=t.effects,a===null?t.effects=[o]:a.push(o))}else r={eventTime:r,lane:a,tag:o.tag,payload:o.payload,callback:o.callback,next:null},s===null?(i=s=r,A=c):s=s.next=r,n|=a;if(o=o.next,o===null){if(o=t.shared.pending,o===null)break;a=o,o=a.next,a.next=null,t.lastBaseUpdate=a,t.shared.pending=null}}while(!0);if(s===null&&(A=c),t.baseState=A,t.firstBaseUpdate=i,t.lastBaseUpdate=s,g=t.shared.interleaved,g!==null){t=g;do n|=t.lane,t=t.next;while(t!==g)}else l===null&&(t.shared.lanes=0);jC|=n,I.lanes=n,I.memoizedState=c}}function jc(I,g,C){if(I=g.effects,g.effects=null,I!==null)for(g=0;g<I.length;g++){var e=I[g],t=e.callback;if(t!==null){if(e.callback=null,e=C,typeof t!="function")throw Error(X(191,t));t.call(e)}}}var ol={},YI=WC(ol),zt=WC(ol),Mt=WC(ol);function KC(I){if(I===ol)throw Error(X(174));return I}function rs(I,g){switch($(Mt,g),$(zt,I),$(YI,ol),I=g.nodeType,I){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:NA(null,"");break;default:I=I===8?g.parentNode:g,g=I.namespaceURI||null,I=I.tagName,g=NA(g,I)}eg(YI),$(YI,g)}function Ne(){eg(YI),eg(zt),eg(Mt)}function Vm(I){KC(Mt.current);var g=KC(YI.current),C=NA(g,I.type);g!==C&&($(zt,I),$(YI,C))}function ms(I){zt.current===I&&(eg(YI),eg(zt))}var lg=WC(0);function Jn(I){for(var g=I;g!==null;){if(g.tag===13){var C=g.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||C.data==="$?"||C.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if(g.flags&128)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===I)break;for(;g.sibling===null;){if(g.return===null||g.return===I)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var IA=[];function us(){for(var I=0;I<IA.length;I++)IA[I]._workInProgressVersionPrimary=null;IA.length=0}var $l=TI.ReactCurrentDispatcher,CA=TI.ReactCurrentBatchConfig,TC=0,ng=null,hg=null,Bg=null,kn=!1,yt=!1,Et=0,iG=0;function Jg(){throw Error(X(321))}function Zs(I,g){if(g===null)return!1;for(var C=0;C<g.length&&C<I.length;C++)if(!GI(I[C],g[C]))return!1;return!0}function bs(I,g,C,e,t,l){if(TC=l,ng=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,$l.current=I===null||I.memoizedState===null?dG:rG,I=C(e,t),yt){l=0;do{if(yt=!1,Et=0,25<=l)throw Error(X(301));l+=1,Bg=hg=null,g.updateQueue=null,$l.current=mG,I=C(e,t)}while(yt)}if($l.current=fn,g=hg!==null&&hg.next!==null,TC=0,Bg=hg=ng=null,kn=!1,g)throw Error(X(300));return I}function hs(){var I=Et!==0;return Et=0,I}function SI(){var I={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bg===null?ng.memoizedState=Bg=I:Bg=Bg.next=I,Bg}function aI(){if(hg===null){var I=ng.alternate;I=I!==null?I.memoizedState:null}else I=hg.next;var g=Bg===null?ng.memoizedState:Bg.next;if(g!==null)Bg=g,hg=I;else{if(I===null)throw Error(X(310));hg=I,I={memoizedState:hg.memoizedState,baseState:hg.baseState,baseQueue:hg.baseQueue,queue:hg.queue,next:null},Bg===null?ng.memoizedState=Bg=I:Bg=Bg.next=I}return Bg}function Qt(I,g){return typeof g=="function"?g(I):g}function eA(I){var g=aI(),C=g.queue;if(C===null)throw Error(X(311));C.lastRenderedReducer=I;var e=hg,t=e.baseQueue,l=C.pending;if(l!==null){if(t!==null){var n=t.next;t.next=l.next,l.next=n}e.baseQueue=t=l,C.pending=null}if(t!==null){l=t.next,e=e.baseState;var o=n=null,A=null,i=l;do{var s=i.lane;if((TC&s)===s)A!==null&&(A=A.next={lane:0,action:i.action,hasEagerState:i.hasEagerState,eagerState:i.eagerState,next:null}),e=i.hasEagerState?i.eagerState:I(e,i.action);else{var c={lane:s,action:i.action,hasEagerState:i.hasEagerState,eagerState:i.eagerState,next:null};A===null?(o=A=c,n=e):A=A.next=c,ng.lanes|=s,jC|=s}i=i.next}while(i!==null&&i!==l);A===null?n=e:A.next=o,GI(e,g.memoizedState)||(Ug=!0),g.memoizedState=e,g.baseState=n,g.baseQueue=A,C.lastRenderedState=e}if(I=C.interleaved,I!==null){t=I;do l=t.lane,ng.lanes|=l,jC|=l,t=t.next;while(t!==I)}else t===null&&(C.lanes=0);return[g.memoizedState,C.dispatch]}function tA(I){var g=aI(),C=g.queue;if(C===null)throw Error(X(311));C.lastRenderedReducer=I;var e=C.dispatch,t=C.pending,l=g.memoizedState;if(t!==null){C.pending=null;var n=t=t.next;do l=I(l,n.action),n=n.next;while(n!==t);GI(l,g.memoizedState)||(Ug=!0),g.memoizedState=l,g.baseQueue===null&&(g.baseState=l),C.lastRenderedState=l}return[l,e]}function Sm(){}function Rm(I,g){var C=ng,e=aI(),t=g(),l=!GI(e.memoizedState,t);if(l&&(e.memoizedState=t,Ug=!0),e=e.queue,Gs(km.bind(null,C,e,I),[I]),e.getSnapshot!==g||l||Bg!==null&&Bg.memoizedState.tag&1){if(C.flags|=2048,Ut(9,Jm.bind(null,C,e,t,g),void 0,null),pg===null)throw Error(X(349));TC&30||Xm(C,g,t)}return t}function Xm(I,g,C){I.flags|=16384,I={getSnapshot:g,value:C},g=ng.updateQueue,g===null?(g={lastEffect:null,stores:null},ng.updateQueue=g,g.stores=[I]):(C=g.stores,C===null?g.stores=[I]:C.push(I))}function Jm(I,g,C,e){g.value=C,g.getSnapshot=e,fm(g)&&Ym(I)}function km(I,g,C){return C(function(){fm(g)&&Ym(I)})}function fm(I){var g=I.getSnapshot;I=I.value;try{var C=g();return!GI(I,C)}catch{return!0}}function Ym(I){var g=LI(I,1);g!==null&&bI(g,I,1,-1)}function Pc(I){var g=SI();return typeof I=="function"&&(I=I()),g.memoizedState=g.baseState=I,I={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qt,lastRenderedState:I},g.queue=I,I=I.dispatch=aG.bind(null,ng,I),[g.memoizedState,I]}function Ut(I,g,C,e){return I={tag:I,create:g,destroy:C,deps:e,next:null},g=ng.updateQueue,g===null?(g={lastEffect:null,stores:null},ng.updateQueue=g,g.lastEffect=I.next=I):(C=g.lastEffect,C===null?g.lastEffect=I.next=I:(e=C.next,C.next=I,I.next=e,g.lastEffect=I)),I}function Hm(){return aI().memoizedState}function gn(I,g,C,e){var t=SI();ng.flags|=I,t.memoizedState=Ut(1|g,C,void 0,e===void 0?null:e)}function lo(I,g,C,e){var t=aI();e=e===void 0?null:e;var l=void 0;if(hg!==null){var n=hg.memoizedState;if(l=n.destroy,e!==null&&Zs(e,n.deps)){t.memoizedState=Ut(g,C,l,e);return}}ng.flags|=I,t.memoizedState=Ut(1|g,C,l,e)}function Oc(I,g){return gn(8390656,8,I,g)}function Gs(I,g){return lo(2048,8,I,g)}function vm(I,g){return lo(4,2,I,g)}function Nm(I,g){return lo(4,4,I,g)}function Fm(I,g){if(typeof g=="function")return I=I(),g(I),function(){g(null)};if(g!=null)return I=I(),g.current=I,function(){g.current=null}}function Km(I,g,C){return C=C!=null?C.concat([I]):null,lo(4,4,Fm.bind(null,g,I),C)}function Bs(){}function wm(I,g){var C=aI();g=g===void 0?null:g;var e=C.memoizedState;return e!==null&&g!==null&&Zs(g,e[1])?e[0]:(C.memoizedState=[I,g],I)}function xm(I,g){var C=aI();g=g===void 0?null:g;var e=C.memoizedState;return e!==null&&g!==null&&Zs(g,e[1])?e[0]:(I=I(),C.memoizedState=[I,g],I)}function zm(I,g,C){return TC&21?(GI(C,g)||(C=Lr(),ng.lanes|=C,jC|=C,I.baseState=!0),g):(I.baseState&&(I.baseState=!1,Ug=!0),I.memoizedState=C)}function sG(I,g){var C=D;D=C!==0&&4>C?C:4,I(!0);var e=CA.transition;CA.transition={};try{I(!1),g()}finally{D=C,CA.transition=e}}function Mm(){return aI().memoizedState}function cG(I,g,C){var e=mC(I);if(C={lane:e,action:C,hasEagerState:!1,eagerState:null,next:null},Em(I))Qm(g,C);else if(C=pm(I,g,C,e),C!==null){var t=Kg();bI(C,I,e,t),Um(C,g,e)}}function aG(I,g,C){var e=mC(I),t={lane:e,action:C,hasEagerState:!1,eagerState:null,next:null};if(Em(I))Qm(g,t);else{var l=I.alternate;if(I.lanes===0&&(l===null||l.lanes===0)&&(l=g.lastRenderedReducer,l!==null))try{var n=g.lastRenderedState,o=l(n,C);if(t.hasEagerState=!0,t.eagerState=o,GI(o,n)){var A=g.interleaved;A===null?(t.next=t,as(g)):(t.next=A.next,A.next=t),g.interleaved=t;return}}catch{}finally{}C=pm(I,g,t,e),C!==null&&(t=Kg(),bI(C,I,e,t),Um(C,g,e))}}function Em(I){var g=I.alternate;return I===ng||g!==null&&g===ng}function Qm(I,g){yt=kn=!0;var C=I.pending;C===null?g.next=g:(g.next=C.next,C.next=g),I.pending=g}function Um(I,g,C){if(C&4194240){var e=g.lanes;e&=I.pendingLanes,C|=e,g.lanes=C,qi(I,C)}}var fn={readContext:cI,useCallback:Jg,useContext:Jg,useEffect:Jg,useImperativeHandle:Jg,useInsertionEffect:Jg,useLayoutEffect:Jg,useMemo:Jg,useReducer:Jg,useRef:Jg,useState:Jg,useDebugValue:Jg,useDeferredValue:Jg,useTransition:Jg,useMutableSource:Jg,useSyncExternalStore:Jg,useId:Jg,unstable_isNewReconciler:!1},dG={readContext:cI,useCallback:function(I,g){return SI().memoizedState=[I,g===void 0?null:g],I},useContext:cI,useEffect:Oc,useImperativeHandle:function(I,g,C){return C=C!=null?C.concat([I]):null,gn(4194308,4,Fm.bind(null,g,I),C)},useLayoutEffect:function(I,g){return gn(4194308,4,I,g)},useInsertionEffect:function(I,g){return gn(4,2,I,g)},useMemo:function(I,g){var C=SI();return g=g===void 0?null:g,I=I(),C.memoizedState=[I,g],I},useReducer:function(I,g,C){var e=SI();return g=C!==void 0?C(g):g,e.memoizedState=e.baseState=g,I={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:I,lastRenderedState:g},e.queue=I,I=I.dispatch=cG.bind(null,ng,I),[e.memoizedState,I]},useRef:function(I){var g=SI();return I={current:I},g.memoizedState=I},useState:Pc,useDebugValue:Bs,useDeferredValue:function(I){return SI().memoizedState=I},useTransition:function(){var I=Pc(!1),g=I[0];return I=sG.bind(null,I[1]),SI().memoizedState=I,[g,I]},useMutableSource:function(){},useSyncExternalStore:function(I,g,C){var e=ng,t=SI();if(tg){if(C===void 0)throw Error(X(407));C=C()}else{if(C=g(),pg===null)throw Error(X(349));TC&30||Xm(e,g,C)}t.memoizedState=C;var l={value:C,getSnapshot:g};return t.queue=l,Oc(km.bind(null,e,l,I),[I]),e.flags|=2048,Ut(9,Jm.bind(null,e,l,C,g),void 0,null),C},useId:function(){var I=SI(),g=pg.identifierPrefix;if(tg){var C=MI,e=zI;C=(e&~(1<<32-ZI(e)-1)).toString(32)+C,g=":"+g+"R"+C,C=Et++,0<C&&(g+="H"+C.toString(32)),g+=":"}else C=iG++,g=":"+g+"r"+C.toString(32)+":";return I.memoizedState=g},unstable_isNewReconciler:!1},rG={readContext:cI,useCallback:wm,useContext:cI,useEffect:Gs,useImperativeHandle:Km,useInsertionEffect:vm,useLayoutEffect:Nm,useMemo:xm,useReducer:eA,useRef:Hm,useState:function(){return eA(Qt)},useDebugValue:Bs,useDeferredValue:function(I){var g=aI();return zm(g,hg.memoizedState,I)},useTransition:function(){var I=eA(Qt)[0],g=aI().memoizedState;return[I,g]},useMutableSource:Sm,useSyncExternalStore:Rm,useId:Mm,unstable_isNewReconciler:!1},mG={readContext:cI,useCallback:wm,useContext:cI,useEffect:Gs,useImperativeHandle:Km,useInsertionEffect:vm,useLayoutEffect:Nm,useMemo:xm,useReducer:tA,useRef:Hm,useState:function(){return tA(Qt)},useDebugValue:Bs,useDeferredValue:function(I){var g=aI();return hg===null?g.memoizedState=I:zm(g,hg.memoizedState,I)},useTransition:function(){var I=tA(Qt)[0],g=aI().memoizedState;return[I,g]},useMutableSource:Sm,useSyncExternalStore:Rm,useId:Mm,unstable_isNewReconciler:!1};function rI(I,g){if(I&&I.defaultProps){g=og({},g),I=I.defaultProps;for(var C in I)g[C]===void 0&&(g[C]=I[C]);return g}return g}function Ci(I,g,C,e){g=I.memoizedState,C=C(e,g),C=C==null?g:og({},g,C),I.memoizedState=C,I.lanes===0&&(I.updateQueue.baseState=C)}var no={isMounted:function(I){return(I=I._reactInternals)?Ce(I)===I:!1},enqueueSetState:function(I,g,C){I=I._reactInternals;var e=Kg(),t=mC(I),l=EI(e,t);l.payload=g,C!=null&&(l.callback=C),g=dC(I,l,t),g!==null&&(bI(g,I,t,e),ql(g,I,t))},enqueueReplaceState:function(I,g,C){I=I._reactInternals;var e=Kg(),t=mC(I),l=EI(e,t);l.tag=1,l.payload=g,C!=null&&(l.callback=C),g=dC(I,l,t),g!==null&&(bI(g,I,t,e),ql(g,I,t))},enqueueForceUpdate:function(I,g){I=I._reactInternals;var C=Kg(),e=mC(I),t=EI(C,e);t.tag=2,g!=null&&(t.callback=g),g=dC(I,t,e),g!==null&&(bI(g,I,e,C),ql(g,I,e))}};function _c(I,g,C,e,t,l,n){return I=I.stateNode,typeof I.shouldComponentUpdate=="function"?I.shouldComponentUpdate(e,l,n):g.prototype&&g.prototype.isPureReactComponent?!Ft(C,e)||!Ft(t,l):!0}function Lm(I,g,C){var e=!1,t=GC,l=g.contextType;return typeof l=="object"&&l!==null?l=cI(l):(t=Tg(g)?LC:Yg.current,e=g.contextTypes,l=(e=e!=null)?Ye(I,t):GC),g=new g(C,l),I.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=no,I.stateNode=g,g._reactInternals=I,e&&(I=I.stateNode,I.__reactInternalMemoizedUnmaskedChildContext=t,I.__reactInternalMemoizedMaskedChildContext=l),g}function qc(I,g,C,e){I=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(C,e),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(C,e),g.state!==I&&no.enqueueReplaceState(g,g.state,null)}function ei(I,g,C,e){var t=I.stateNode;t.props=C,t.state=I.memoizedState,t.refs={},ds(I);var l=g.contextType;typeof l=="object"&&l!==null?t.context=cI(l):(l=Tg(g)?LC:Yg.current,t.context=Ye(I,l)),t.state=I.memoizedState,l=g.getDerivedStateFromProps,typeof l=="function"&&(Ci(I,g,l,C),t.state=I.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof t.getSnapshotBeforeUpdate=="function"||typeof t.UNSAFE_componentWillMount!="function"&&typeof t.componentWillMount!="function"||(g=t.state,typeof t.componentWillMount=="function"&&t.componentWillMount(),typeof t.UNSAFE_componentWillMount=="function"&&t.UNSAFE_componentWillMount(),g!==t.state&&no.enqueueReplaceState(t,t.state,null),Xn(I,C,t,e),t.state=I.memoizedState),typeof t.componentDidMount=="function"&&(I.flags|=4194308)}function Fe(I,g){try{var C="",e=g;do C+=Qb(e),e=e.return;while(e);var t=C}catch(l){t=`
Error generating stack: `+l.message+`
`+l.stack}return{value:I,source:g,stack:t,digest:null}}function lA(I,g,C){return{value:I,source:null,stack:C??null,digest:g??null}}function ti(I,g){try{console.error(g.value)}catch(C){setTimeout(function(){throw C})}}var uG=typeof WeakMap=="function"?WeakMap:Map;function Dm(I,g,C){C=EI(-1,C),C.tag=3,C.payload={element:null};var e=g.value;return C.callback=function(){Hn||(Hn=!0,ri=e),ti(I,g)},C}function Tm(I,g,C){C=EI(-1,C),C.tag=3;var e=I.type.getDerivedStateFromError;if(typeof e=="function"){var t=g.value;C.payload=function(){return e(t)},C.callback=function(){ti(I,g)}}var l=I.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(C.callback=function(){ti(I,g),typeof e!="function"&&(rC===null?rC=new Set([this]):rC.add(this));var n=g.stack;this.componentDidCatch(g.value,{componentStack:n!==null?n:""})}),C}function $c(I,g,C){var e=I.pingCache;if(e===null){e=I.pingCache=new uG;var t=new Set;e.set(g,t)}else t=e.get(g),t===void 0&&(t=new Set,e.set(g,t));t.has(C)||(t.add(C),I=kG.bind(null,I,g,C),g.then(I,I))}function ga(I){do{var g;if((g=I.tag===13)&&(g=I.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return I;I=I.return}while(I!==null);return null}function Ia(I,g,C,e,t){return I.mode&1?(I.flags|=65536,I.lanes=t,I):(I===g?I.flags|=65536:(I.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(g=EI(-1,1),g.tag=2,dC(C,g,1))),C.lanes|=1),I)}var ZG=TI.ReactCurrentOwner,Ug=!1;function Ng(I,g,C,e){g.child=I===null?ym(g,null,C,e):ve(g,I.child,C,e)}function Ca(I,g,C,e,t){C=C.render;var l=g.ref;return Re(g,t),e=bs(I,g,C,e,l,t),C=hs(),I!==null&&!Ug?(g.updateQueue=I.updateQueue,g.flags&=-2053,I.lanes&=~t,DI(I,g,t)):(tg&&C&&ns(g),g.flags|=1,Ng(I,g,e,t),g.child)}function ea(I,g,C,e,t){if(I===null){var l=C.type;return typeof l=="function"&&!Js(l)&&l.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(g.tag=15,g.type=l,jm(I,g,l,e,t)):(I=tn(C.type,null,e,g,g.mode,t),I.ref=g.ref,I.return=g,g.child=I)}if(l=I.child,!(I.lanes&t)){var n=l.memoizedProps;if(C=C.compare,C=C!==null?C:Ft,C(n,e)&&I.ref===g.ref)return DI(I,g,t)}return g.flags|=1,I=uC(l,e),I.ref=g.ref,I.return=g,g.child=I}function jm(I,g,C,e,t){if(I!==null){var l=I.memoizedProps;if(Ft(l,e)&&I.ref===g.ref)if(Ug=!1,g.pendingProps=e=l,(I.lanes&t)!==0)I.flags&131072&&(Ug=!0);else return g.lanes=I.lanes,DI(I,g,t)}return li(I,g,C,e,t)}function Pm(I,g,C){var e=g.pendingProps,t=e.children,l=I!==null?I.memoizedState:null;if(e.mode==="hidden")if(!(g.mode&1))g.memoizedState={baseLanes:0,cachePool:null,transitions:null},$(Ge,qg),qg|=C;else{if(!(C&1073741824))return I=l!==null?l.baseLanes|C:C,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:I,cachePool:null,transitions:null},g.updateQueue=null,$(Ge,qg),qg|=I,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},e=l!==null?l.baseLanes:C,$(Ge,qg),qg|=e}else l!==null?(e=l.baseLanes|C,g.memoizedState=null):e=C,$(Ge,qg),qg|=e;return Ng(I,g,t,C),g.child}function Om(I,g){var C=g.ref;(I===null&&C!==null||I!==null&&I.ref!==C)&&(g.flags|=512,g.flags|=2097152)}function li(I,g,C,e,t){var l=Tg(C)?LC:Yg.current;return l=Ye(g,l),Re(g,t),C=bs(I,g,C,e,l,t),e=hs(),I!==null&&!Ug?(g.updateQueue=I.updateQueue,g.flags&=-2053,I.lanes&=~t,DI(I,g,t)):(tg&&e&&ns(g),g.flags|=1,Ng(I,g,C,t),g.child)}function ta(I,g,C,e,t){if(Tg(C)){var l=!0;pn(g)}else l=!1;if(Re(g,t),g.stateNode===null)In(I,g),Lm(g,C,e),ei(g,C,e,t),e=!0;else if(I===null){var n=g.stateNode,o=g.memoizedProps;n.props=o;var A=n.context,i=C.contextType;typeof i=="object"&&i!==null?i=cI(i):(i=Tg(C)?LC:Yg.current,i=Ye(g,i));var s=C.getDerivedStateFromProps,c=typeof s=="function"||typeof n.getSnapshotBeforeUpdate=="function";c||typeof n.UNSAFE_componentWillReceiveProps!="function"&&typeof n.componentWillReceiveProps!="function"||(o!==e||A!==i)&&qc(g,n,e,i),$I=!1;var a=g.memoizedState;n.state=a,Xn(g,e,n,t),A=g.memoizedState,o!==e||a!==A||Dg.current||$I?(typeof s=="function"&&(Ci(g,C,s,e),A=g.memoizedState),(o=$I||_c(g,C,o,e,a,A,i))?(c||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount()),typeof n.componentDidMount=="function"&&(g.flags|=4194308)):(typeof n.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=e,g.memoizedState=A),n.props=e,n.state=A,n.context=i,e=o):(typeof n.componentDidMount=="function"&&(g.flags|=4194308),e=!1)}else{n=g.stateNode,Wm(I,g),o=g.memoizedProps,i=g.type===g.elementType?o:rI(g.type,o),n.props=i,c=g.pendingProps,a=n.context,A=C.contextType,typeof A=="object"&&A!==null?A=cI(A):(A=Tg(C)?LC:Yg.current,A=Ye(g,A));var r=C.getDerivedStateFromProps;(s=typeof r=="function"||typeof n.getSnapshotBeforeUpdate=="function")||typeof n.UNSAFE_componentWillReceiveProps!="function"&&typeof n.componentWillReceiveProps!="function"||(o!==c||a!==A)&&qc(g,n,e,A),$I=!1,a=g.memoizedState,n.state=a,Xn(g,e,n,t);var m=g.memoizedState;o!==c||a!==m||Dg.current||$I?(typeof r=="function"&&(Ci(g,C,r,e),m=g.memoizedState),(i=$I||_c(g,C,i,e,a,m,A)||!1)?(s||typeof n.UNSAFE_componentWillUpdate!="function"&&typeof n.componentWillUpdate!="function"||(typeof n.componentWillUpdate=="function"&&n.componentWillUpdate(e,m,A),typeof n.UNSAFE_componentWillUpdate=="function"&&n.UNSAFE_componentWillUpdate(e,m,A)),typeof n.componentDidUpdate=="function"&&(g.flags|=4),typeof n.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof n.componentDidUpdate!="function"||o===I.memoizedProps&&a===I.memoizedState||(g.flags|=4),typeof n.getSnapshotBeforeUpdate!="function"||o===I.memoizedProps&&a===I.memoizedState||(g.flags|=1024),g.memoizedProps=e,g.memoizedState=m),n.props=e,n.state=m,n.context=A,e=i):(typeof n.componentDidUpdate!="function"||o===I.memoizedProps&&a===I.memoizedState||(g.flags|=4),typeof n.getSnapshotBeforeUpdate!="function"||o===I.memoizedProps&&a===I.memoizedState||(g.flags|=1024),e=!1)}return ni(I,g,C,e,l,t)}function ni(I,g,C,e,t,l){Om(I,g);var n=(g.flags&128)!==0;if(!e&&!n)return t&&Qc(g,C,!1),DI(I,g,l);e=g.stateNode,ZG.current=g;var o=n&&typeof C.getDerivedStateFromError!="function"?null:e.render();return g.flags|=1,I!==null&&n?(g.child=ve(g,I.child,null,l),g.child=ve(g,null,o,l)):Ng(I,g,o,l),g.memoizedState=e.state,t&&Qc(g,C,!0),g.child}function _m(I){var g=I.stateNode;g.pendingContext?Ec(I,g.pendingContext,g.pendingContext!==g.context):g.context&&Ec(I,g.context,!1),rs(I,g.containerInfo)}function la(I,g,C,e,t){return He(),As(t),g.flags|=256,Ng(I,g,C,e),g.child}var oi={dehydrated:null,treeContext:null,retryLane:0};function Ai(I){return{baseLanes:I,cachePool:null,transitions:null}}function qm(I,g,C){var e=g.pendingProps,t=lg.current,l=!1,n=(g.flags&128)!==0,o;if((o=n)||(o=I!==null&&I.memoizedState===null?!1:(t&2)!==0),o?(l=!0,g.flags&=-129):(I===null||I.memoizedState!==null)&&(t|=1),$(lg,t&1),I===null)return gi(g),I=g.memoizedState,I!==null&&(I=I.dehydrated,I!==null)?(g.mode&1?I.data==="$!"?g.lanes=8:g.lanes=1073741824:g.lanes=1,null):(n=e.children,I=e.fallback,l?(e=g.mode,l=g.child,n={mode:"hidden",children:n},!(e&1)&&l!==null?(l.childLanes=0,l.pendingProps=n):l=io(n,e,0,null),I=zC(I,e,C,null),l.return=g,I.return=g,l.sibling=I,g.child=l,g.child.memoizedState=Ai(C),g.memoizedState=oi,I):ys(g,n));if(t=I.memoizedState,t!==null&&(o=t.dehydrated,o!==null))return bG(I,g,n,e,o,t,C);if(l){l=e.fallback,n=g.mode,t=I.child,o=t.sibling;var A={mode:"hidden",children:e.children};return!(n&1)&&g.child!==t?(e=g.child,e.childLanes=0,e.pendingProps=A,g.deletions=null):(e=uC(t,A),e.subtreeFlags=t.subtreeFlags&14680064),o!==null?l=uC(o,l):(l=zC(l,n,C,null),l.flags|=2),l.return=g,e.return=g,e.sibling=l,g.child=e,e=l,l=g.child,n=I.child.memoizedState,n=n===null?Ai(C):{baseLanes:n.baseLanes|C,cachePool:null,transitions:n.transitions},l.memoizedState=n,l.childLanes=I.childLanes&~C,g.memoizedState=oi,e}return l=I.child,I=l.sibling,e=uC(l,{mode:"visible",children:e.children}),!(g.mode&1)&&(e.lanes=C),e.return=g,e.sibling=null,I!==null&&(C=g.deletions,C===null?(g.deletions=[I],g.flags|=16):C.push(I)),g.child=e,g.memoizedState=null,e}function ys(I,g){return g=io({mode:"visible",children:g},I.mode,0,null),g.return=I,I.child=g}function Jl(I,g,C,e){return e!==null&&As(e),ve(g,I.child,null,C),I=ys(g,g.pendingProps.children),I.flags|=2,g.memoizedState=null,I}function bG(I,g,C,e,t,l,n){if(C)return g.flags&256?(g.flags&=-257,e=lA(Error(X(422))),Jl(I,g,n,e)):g.memoizedState!==null?(g.child=I.child,g.flags|=128,null):(l=e.fallback,t=g.mode,e=io({mode:"visible",children:e.children},t,0,null),l=zC(l,t,n,null),l.flags|=2,e.return=g,l.return=g,e.sibling=l,g.child=e,g.mode&1&&ve(g,I.child,null,n),g.child.memoizedState=Ai(n),g.memoizedState=oi,l);if(!(g.mode&1))return Jl(I,g,n,null);if(t.data==="$!"){if(e=t.nextSibling&&t.nextSibling.dataset,e)var o=e.dgst;return e=o,l=Error(X(419)),e=lA(l,e,void 0),Jl(I,g,n,e)}if(o=(n&I.childLanes)!==0,Ug||o){if(e=pg,e!==null){switch(n&-n){case 4:t=2;break;case 16:t=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:t=32;break;case 536870912:t=268435456;break;default:t=0}t=t&(e.suspendedLanes|n)?0:t,t!==0&&t!==l.retryLane&&(l.retryLane=t,LI(I,t),bI(e,I,t,-1))}return Xs(),e=lA(Error(X(421))),Jl(I,g,n,e)}return t.data==="$?"?(g.flags|=128,g.child=I.child,g=fG.bind(null,I),t._reactRetry=g,null):(I=l.treeContext,$g=aC(t.nextSibling),gI=g,tg=!0,uI=null,I!==null&&(nI[oI++]=zI,nI[oI++]=MI,nI[oI++]=DC,zI=I.id,MI=I.overflow,DC=g),g=ys(g,e.children),g.flags|=4096,g)}function na(I,g,C){I.lanes|=g;var e=I.alternate;e!==null&&(e.lanes|=g),Ii(I.return,g,C)}function nA(I,g,C,e,t){var l=I.memoizedState;l===null?I.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:e,tail:C,tailMode:t}:(l.isBackwards=g,l.rendering=null,l.renderingStartTime=0,l.last=e,l.tail=C,l.tailMode=t)}function $m(I,g,C){var e=g.pendingProps,t=e.revealOrder,l=e.tail;if(Ng(I,g,e.children,C),e=lg.current,e&2)e=e&1|2,g.flags|=128;else{if(I!==null&&I.flags&128)g:for(I=g.child;I!==null;){if(I.tag===13)I.memoizedState!==null&&na(I,C,g);else if(I.tag===19)na(I,C,g);else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===g)break g;for(;I.sibling===null;){if(I.return===null||I.return===g)break g;I=I.return}I.sibling.return=I.return,I=I.sibling}e&=1}if($(lg,e),!(g.mode&1))g.memoizedState=null;else switch(t){case"forwards":for(C=g.child,t=null;C!==null;)I=C.alternate,I!==null&&Jn(I)===null&&(t=C),C=C.sibling;C=t,C===null?(t=g.child,g.child=null):(t=C.sibling,C.sibling=null),nA(g,!1,t,C,l);break;case"backwards":for(C=null,t=g.child,g.child=null;t!==null;){if(I=t.alternate,I!==null&&Jn(I)===null){g.child=t;break}I=t.sibling,t.sibling=C,C=t,t=I}nA(g,!0,C,null,l);break;case"together":nA(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function In(I,g){!(g.mode&1)&&I!==null&&(I.alternate=null,g.alternate=null,g.flags|=2)}function DI(I,g,C){if(I!==null&&(g.dependencies=I.dependencies),jC|=g.lanes,!(C&g.childLanes))return null;if(I!==null&&g.child!==I.child)throw Error(X(153));if(g.child!==null){for(I=g.child,C=uC(I,I.pendingProps),g.child=C,C.return=g;I.sibling!==null;)I=I.sibling,C=C.sibling=uC(I,I.pendingProps),C.return=g;C.sibling=null}return g.child}function hG(I,g,C){switch(g.tag){case 3:_m(g),He();break;case 5:Vm(g);break;case 1:Tg(g.type)&&pn(g);break;case 4:rs(g,g.stateNode.containerInfo);break;case 10:var e=g.type._context,t=g.memoizedProps.value;$(Sn,e._currentValue),e._currentValue=t;break;case 13:if(e=g.memoizedState,e!==null)return e.dehydrated!==null?($(lg,lg.current&1),g.flags|=128,null):C&g.child.childLanes?qm(I,g,C):($(lg,lg.current&1),I=DI(I,g,C),I!==null?I.sibling:null);$(lg,lg.current&1);break;case 19:if(e=(C&g.childLanes)!==0,I.flags&128){if(e)return $m(I,g,C);g.flags|=128}if(t=g.memoizedState,t!==null&&(t.rendering=null,t.tail=null,t.lastEffect=null),$(lg,lg.current),e)break;return null;case 22:case 23:return g.lanes=0,Pm(I,g,C)}return DI(I,g,C)}var gu,ii,Iu,Cu;gu=function(I,g){for(var C=g.child;C!==null;){if(C.tag===5||C.tag===6)I.appendChild(C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===g)break;for(;C.sibling===null;){if(C.return===null||C.return===g)return;C=C.return}C.sibling.return=C.return,C=C.sibling}};ii=function(){};Iu=function(I,g,C,e){var t=I.memoizedProps;if(t!==e){I=g.stateNode,KC(YI.current);var l=null;switch(C){case"input":t=fA(I,t),e=fA(I,e),l=[];break;case"select":t=og({},t,{value:void 0}),e=og({},e,{value:void 0}),l=[];break;case"textarea":t=vA(I,t),e=vA(I,e),l=[];break;default:typeof t.onClick!="function"&&typeof e.onClick=="function"&&(I.onclick=Bn)}FA(C,e);var n;C=null;for(i in t)if(!e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&t[i]!=null)if(i==="style"){var o=t[i];for(n in o)o.hasOwnProperty(n)&&(C||(C={}),C[n]="")}else i!=="dangerouslySetInnerHTML"&&i!=="children"&&i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Jt.hasOwnProperty(i)?l||(l=[]):(l=l||[]).push(i,null));for(i in e){var A=e[i];if(o=t!=null?t[i]:void 0,e.hasOwnProperty(i)&&A!==o&&(A!=null||o!=null))if(i==="style")if(o){for(n in o)!o.hasOwnProperty(n)||A&&A.hasOwnProperty(n)||(C||(C={}),C[n]="");for(n in A)A.hasOwnProperty(n)&&o[n]!==A[n]&&(C||(C={}),C[n]=A[n])}else C||(l||(l=[]),l.push(i,C)),C=A;else i==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,o=o?o.__html:void 0,A!=null&&o!==A&&(l=l||[]).push(i,A)):i==="children"?typeof A!="string"&&typeof A!="number"||(l=l||[]).push(i,""+A):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&(Jt.hasOwnProperty(i)?(A!=null&&i==="onScroll"&&Cg("scroll",I),l||o===A||(l=[])):(l=l||[]).push(i,A))}C&&(l=l||[]).push("style",C);var i=l;(g.updateQueue=i)&&(g.flags|=4)}};Cu=function(I,g,C,e){C!==e&&(g.flags|=4)};function $e(I,g){if(!tg)switch(I.tailMode){case"hidden":g=I.tail;for(var C=null;g!==null;)g.alternate!==null&&(C=g),g=g.sibling;C===null?I.tail=null:C.sibling=null;break;case"collapsed":C=I.tail;for(var e=null;C!==null;)C.alternate!==null&&(e=C),C=C.sibling;e===null?g||I.tail===null?I.tail=null:I.tail.sibling=null:e.sibling=null}}function kg(I){var g=I.alternate!==null&&I.alternate.child===I.child,C=0,e=0;if(g)for(var t=I.child;t!==null;)C|=t.lanes|t.childLanes,e|=t.subtreeFlags&14680064,e|=t.flags&14680064,t.return=I,t=t.sibling;else for(t=I.child;t!==null;)C|=t.lanes|t.childLanes,e|=t.subtreeFlags,e|=t.flags,t.return=I,t=t.sibling;return I.subtreeFlags|=e,I.childLanes=C,g}function GG(I,g,C){var e=g.pendingProps;switch(os(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kg(g),null;case 1:return Tg(g.type)&&yn(),kg(g),null;case 3:return e=g.stateNode,Ne(),eg(Dg),eg(Yg),us(),e.pendingContext&&(e.context=e.pendingContext,e.pendingContext=null),(I===null||I.child===null)&&(Rl(g)?g.flags|=4:I===null||I.memoizedState.isDehydrated&&!(g.flags&256)||(g.flags|=1024,uI!==null&&(Zi(uI),uI=null))),ii(I,g),kg(g),null;case 5:ms(g);var t=KC(Mt.current);if(C=g.type,I!==null&&g.stateNode!=null)Iu(I,g,C,e,t),I.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!e){if(g.stateNode===null)throw Error(X(166));return kg(g),null}if(I=KC(YI.current),Rl(g)){e=g.stateNode,C=g.type;var l=g.memoizedProps;switch(e[JI]=g,e[xt]=l,I=(g.mode&1)!==0,C){case"dialog":Cg("cancel",e),Cg("close",e);break;case"iframe":case"object":case"embed":Cg("load",e);break;case"video":case"audio":for(t=0;t<ct.length;t++)Cg(ct[t],e);break;case"source":Cg("error",e);break;case"img":case"image":case"link":Cg("error",e),Cg("load",e);break;case"details":Cg("toggle",e);break;case"input":mc(e,l),Cg("invalid",e);break;case"select":e._wrapperState={wasMultiple:!!l.multiple},Cg("invalid",e);break;case"textarea":Zc(e,l),Cg("invalid",e)}FA(C,l),t=null;for(var n in l)if(l.hasOwnProperty(n)){var o=l[n];n==="children"?typeof o=="string"?e.textContent!==o&&(l.suppressHydrationWarning!==!0&&Sl(e.textContent,o,I),t=["children",o]):typeof o=="number"&&e.textContent!==""+o&&(l.suppressHydrationWarning!==!0&&Sl(e.textContent,o,I),t=["children",""+o]):Jt.hasOwnProperty(n)&&o!=null&&n==="onScroll"&&Cg("scroll",e)}switch(C){case"input":bl(e),uc(e,l,!0);break;case"textarea":bl(e),bc(e);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(e.onclick=Bn)}e=t,g.updateQueue=e,e!==null&&(g.flags|=4)}else{n=t.nodeType===9?t:t.ownerDocument,I==="http://www.w3.org/1999/xhtml"&&(I=kr(C)),I==="http://www.w3.org/1999/xhtml"?C==="script"?(I=n.createElement("div"),I.innerHTML="<script><\/script>",I=I.removeChild(I.firstChild)):typeof e.is=="string"?I=n.createElement(C,{is:e.is}):(I=n.createElement(C),C==="select"&&(n=I,e.multiple?n.multiple=!0:e.size&&(n.size=e.size))):I=n.createElementNS(I,C),I[JI]=g,I[xt]=e,gu(I,g,!1,!1),g.stateNode=I;g:{switch(n=KA(C,e),C){case"dialog":Cg("cancel",I),Cg("close",I),t=e;break;case"iframe":case"object":case"embed":Cg("load",I),t=e;break;case"video":case"audio":for(t=0;t<ct.length;t++)Cg(ct[t],I);t=e;break;case"source":Cg("error",I),t=e;break;case"img":case"image":case"link":Cg("error",I),Cg("load",I),t=e;break;case"details":Cg("toggle",I),t=e;break;case"input":mc(I,e),t=fA(I,e),Cg("invalid",I);break;case"option":t=e;break;case"select":I._wrapperState={wasMultiple:!!e.multiple},t=og({},e,{value:void 0}),Cg("invalid",I);break;case"textarea":Zc(I,e),t=vA(I,e),Cg("invalid",I);break;default:t=e}FA(C,t),o=t;for(l in o)if(o.hasOwnProperty(l)){var A=o[l];l==="style"?Hr(I,A):l==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&fr(I,A)):l==="children"?typeof A=="string"?(C!=="textarea"||A!=="")&&kt(I,A):typeof A=="number"&&kt(I,""+A):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Jt.hasOwnProperty(l)?A!=null&&l==="onScroll"&&Cg("scroll",I):A!=null&&Di(I,l,A,n))}switch(C){case"input":bl(I),uc(I,e,!1);break;case"textarea":bl(I),bc(I);break;case"option":e.value!=null&&I.setAttribute("value",""+hC(e.value));break;case"select":I.multiple=!!e.multiple,l=e.value,l!=null?pe(I,!!e.multiple,l,!1):e.defaultValue!=null&&pe(I,!!e.multiple,e.defaultValue,!0);break;default:typeof t.onClick=="function"&&(I.onclick=Bn)}switch(C){case"button":case"input":case"select":case"textarea":e=!!e.autoFocus;break g;case"img":e=!0;break g;default:e=!1}}e&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return kg(g),null;case 6:if(I&&g.stateNode!=null)Cu(I,g,I.memoizedProps,e);else{if(typeof e!="string"&&g.stateNode===null)throw Error(X(166));if(C=KC(Mt.current),KC(YI.current),Rl(g)){if(e=g.stateNode,C=g.memoizedProps,e[JI]=g,(l=e.nodeValue!==C)&&(I=gI,I!==null))switch(I.tag){case 3:Sl(e.nodeValue,C,(I.mode&1)!==0);break;case 5:I.memoizedProps.suppressHydrationWarning!==!0&&Sl(e.nodeValue,C,(I.mode&1)!==0)}l&&(g.flags|=4)}else e=(C.nodeType===9?C:C.ownerDocument).createTextNode(e),e[JI]=g,g.stateNode=e}return kg(g),null;case 13:if(eg(lg),e=g.memoizedState,I===null||I.memoizedState!==null&&I.memoizedState.dehydrated!==null){if(tg&&$g!==null&&g.mode&1&&!(g.flags&128))Gm(),He(),g.flags|=98560,l=!1;else if(l=Rl(g),e!==null&&e.dehydrated!==null){if(I===null){if(!l)throw Error(X(318));if(l=g.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(X(317));l[JI]=g}else He(),!(g.flags&128)&&(g.memoizedState=null),g.flags|=4;kg(g),l=!1}else uI!==null&&(Zi(uI),uI=null),l=!0;if(!l)return g.flags&65536?g:null}return g.flags&128?(g.lanes=C,g):(e=e!==null,e!==(I!==null&&I.memoizedState!==null)&&e&&(g.child.flags|=8192,g.mode&1&&(I===null||lg.current&1?Gg===0&&(Gg=3):Xs())),g.updateQueue!==null&&(g.flags|=4),kg(g),null);case 4:return Ne(),ii(I,g),I===null&&Kt(g.stateNode.containerInfo),kg(g),null;case 10:return cs(g.type._context),kg(g),null;case 17:return Tg(g.type)&&yn(),kg(g),null;case 19:if(eg(lg),l=g.memoizedState,l===null)return kg(g),null;if(e=(g.flags&128)!==0,n=l.rendering,n===null)if(e)$e(l,!1);else{if(Gg!==0||I!==null&&I.flags&128)for(I=g.child;I!==null;){if(n=Jn(I),n!==null){for(g.flags|=128,$e(l,!1),e=n.updateQueue,e!==null&&(g.updateQueue=e,g.flags|=4),g.subtreeFlags=0,e=C,C=g.child;C!==null;)l=C,I=e,l.flags&=14680066,n=l.alternate,n===null?(l.childLanes=0,l.lanes=I,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=n.childLanes,l.lanes=n.lanes,l.child=n.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=n.memoizedProps,l.memoizedState=n.memoizedState,l.updateQueue=n.updateQueue,l.type=n.type,I=n.dependencies,l.dependencies=I===null?null:{lanes:I.lanes,firstContext:I.firstContext}),C=C.sibling;return $(lg,lg.current&1|2),g.child}I=I.sibling}l.tail!==null&&dg()>Ke&&(g.flags|=128,e=!0,$e(l,!1),g.lanes=4194304)}else{if(!e)if(I=Jn(n),I!==null){if(g.flags|=128,e=!0,C=I.updateQueue,C!==null&&(g.updateQueue=C,g.flags|=4),$e(l,!0),l.tail===null&&l.tailMode==="hidden"&&!n.alternate&&!tg)return kg(g),null}else 2*dg()-l.renderingStartTime>Ke&&C!==1073741824&&(g.flags|=128,e=!0,$e(l,!1),g.lanes=4194304);l.isBackwards?(n.sibling=g.child,g.child=n):(C=l.last,C!==null?C.sibling=n:g.child=n,l.last=n)}return l.tail!==null?(g=l.tail,l.rendering=g,l.tail=g.sibling,l.renderingStartTime=dg(),g.sibling=null,C=lg.current,$(lg,e?C&1|2:C&1),g):(kg(g),null);case 22:case 23:return Rs(),e=g.memoizedState!==null,I!==null&&I.memoizedState!==null!==e&&(g.flags|=8192),e&&g.mode&1?qg&1073741824&&(kg(g),g.subtreeFlags&6&&(g.flags|=8192)):kg(g),null;case 24:return null;case 25:return null}throw Error(X(156,g.tag))}function BG(I,g){switch(os(g),g.tag){case 1:return Tg(g.type)&&yn(),I=g.flags,I&65536?(g.flags=I&-65537|128,g):null;case 3:return Ne(),eg(Dg),eg(Yg),us(),I=g.flags,I&65536&&!(I&128)?(g.flags=I&-65537|128,g):null;case 5:return ms(g),null;case 13:if(eg(lg),I=g.memoizedState,I!==null&&I.dehydrated!==null){if(g.alternate===null)throw Error(X(340));He()}return I=g.flags,I&65536?(g.flags=I&-65537|128,g):null;case 19:return eg(lg),null;case 4:return Ne(),null;case 10:return cs(g.type._context),null;case 22:case 23:return Rs(),null;case 24:return null;default:return null}}var kl=!1,fg=!1,yG=typeof WeakSet=="function"?WeakSet:Set,Y=null;function he(I,g){var C=I.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(e){ig(I,g,e)}else C.current=null}function si(I,g,C){try{C()}catch(e){ig(I,g,e)}}var oa=!1;function pG(I,g){if(TA=bn,I=om(),ls(I)){if("selectionStart"in I)var C={start:I.selectionStart,end:I.selectionEnd};else g:{C=(C=I.ownerDocument)&&C.defaultView||window;var e=C.getSelection&&C.getSelection();if(e&&e.rangeCount!==0){C=e.anchorNode;var t=e.anchorOffset,l=e.focusNode;e=e.focusOffset;try{C.nodeType,l.nodeType}catch{C=null;break g}var n=0,o=-1,A=-1,i=0,s=0,c=I,a=null;I:for(;;){for(var r;c!==C||t!==0&&c.nodeType!==3||(o=n+t),c!==l||e!==0&&c.nodeType!==3||(A=n+e),c.nodeType===3&&(n+=c.nodeValue.length),(r=c.firstChild)!==null;)a=c,c=r;for(;;){if(c===I)break I;if(a===C&&++i===t&&(o=n),a===l&&++s===e&&(A=n),(r=c.nextSibling)!==null)break;c=a,a=c.parentNode}c=r}C=o===-1||A===-1?null:{start:o,end:A}}else C=null}C=C||{start:0,end:0}}else C=null;for(jA={focusedElem:I,selectionRange:C},bn=!1,Y=g;Y!==null;)if(g=Y,I=g.child,(g.subtreeFlags&1028)!==0&&I!==null)I.return=g,Y=I;else for(;Y!==null;){g=Y;try{var m=g.alternate;if(g.flags&1024)switch(g.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var b=m.memoizedProps,G=m.memoizedState,u=g.stateNode,Z=u.getSnapshotBeforeUpdate(g.elementType===g.type?b:rI(g.type,b),G);u.__reactInternalSnapshotBeforeUpdate=Z}break;case 3:var h=g.stateNode.containerInfo;h.nodeType===1?h.textContent="":h.nodeType===9&&h.documentElement&&h.removeChild(h.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(X(163))}}catch(B){ig(g,g.return,B)}if(I=g.sibling,I!==null){I.return=g.return,Y=I;break}Y=g.return}return m=oa,oa=!1,m}function pt(I,g,C){var e=g.updateQueue;if(e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&I)===I){var l=t.destroy;t.destroy=void 0,l!==void 0&&si(g,C,l)}t=t.next}while(t!==e)}}function oo(I,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var C=g=g.next;do{if((C.tag&I)===I){var e=C.create;C.destroy=e()}C=C.next}while(C!==g)}}function ci(I){var g=I.ref;if(g!==null){var C=I.stateNode;switch(I.tag){case 5:I=C;break;default:I=C}typeof g=="function"?g(I):g.current=I}}function eu(I){var g=I.alternate;g!==null&&(I.alternate=null,eu(g)),I.child=null,I.deletions=null,I.sibling=null,I.tag===5&&(g=I.stateNode,g!==null&&(delete g[JI],delete g[xt],delete g[_A],delete g[lG],delete g[nG])),I.stateNode=null,I.return=null,I.dependencies=null,I.memoizedProps=null,I.memoizedState=null,I.pendingProps=null,I.stateNode=null,I.updateQueue=null}function tu(I){return I.tag===5||I.tag===3||I.tag===4}function Aa(I){g:for(;;){for(;I.sibling===null;){if(I.return===null||tu(I.return))return null;I=I.return}for(I.sibling.return=I.return,I=I.sibling;I.tag!==5&&I.tag!==6&&I.tag!==18;){if(I.flags&2||I.child===null||I.tag===4)continue g;I.child.return=I,I=I.child}if(!(I.flags&2))return I.stateNode}}function ai(I,g,C){var e=I.tag;if(e===5||e===6)I=I.stateNode,g?C.nodeType===8?C.parentNode.insertBefore(I,g):C.insertBefore(I,g):(C.nodeType===8?(g=C.parentNode,g.insertBefore(I,C)):(g=C,g.appendChild(I)),C=C._reactRootContainer,C!=null||g.onclick!==null||(g.onclick=Bn));else if(e!==4&&(I=I.child,I!==null))for(ai(I,g,C),I=I.sibling;I!==null;)ai(I,g,C),I=I.sibling}function di(I,g,C){var e=I.tag;if(e===5||e===6)I=I.stateNode,g?C.insertBefore(I,g):C.appendChild(I);else if(e!==4&&(I=I.child,I!==null))for(di(I,g,C),I=I.sibling;I!==null;)di(I,g,C),I=I.sibling}var Vg=null,mI=!1;function PI(I,g,C){for(C=C.child;C!==null;)lu(I,g,C),C=C.sibling}function lu(I,g,C){if(fI&&typeof fI.onCommitFiberUnmount=="function")try{fI.onCommitFiberUnmount($n,C)}catch{}switch(C.tag){case 5:fg||he(C,g);case 6:var e=Vg,t=mI;Vg=null,PI(I,g,C),Vg=e,mI=t,Vg!==null&&(mI?(I=Vg,C=C.stateNode,I.nodeType===8?I.parentNode.removeChild(C):I.removeChild(C)):Vg.removeChild(C.stateNode));break;case 18:Vg!==null&&(mI?(I=Vg,C=C.stateNode,I.nodeType===8?$o(I.parentNode,C):I.nodeType===1&&$o(I,C),vt(I)):$o(Vg,C.stateNode));break;case 4:e=Vg,t=mI,Vg=C.stateNode.containerInfo,mI=!0,PI(I,g,C),Vg=e,mI=t;break;case 0:case 11:case 14:case 15:if(!fg&&(e=C.updateQueue,e!==null&&(e=e.lastEffect,e!==null))){t=e=e.next;do{var l=t,n=l.destroy;l=l.tag,n!==void 0&&(l&2||l&4)&&si(C,g,n),t=t.next}while(t!==e)}PI(I,g,C);break;case 1:if(!fg&&(he(C,g),e=C.stateNode,typeof e.componentWillUnmount=="function"))try{e.props=C.memoizedProps,e.state=C.memoizedState,e.componentWillUnmount()}catch(o){ig(C,g,o)}PI(I,g,C);break;case 21:PI(I,g,C);break;case 22:C.mode&1?(fg=(e=fg)||C.memoizedState!==null,PI(I,g,C),fg=e):PI(I,g,C);break;default:PI(I,g,C)}}function ia(I){var g=I.updateQueue;if(g!==null){I.updateQueue=null;var C=I.stateNode;C===null&&(C=I.stateNode=new yG),g.forEach(function(e){var t=YG.bind(null,I,e);C.has(e)||(C.add(e),e.then(t,t))})}}function dI(I,g){var C=g.deletions;if(C!==null)for(var e=0;e<C.length;e++){var t=C[e];try{var l=I,n=g,o=n;g:for(;o!==null;){switch(o.tag){case 5:Vg=o.stateNode,mI=!1;break g;case 3:Vg=o.stateNode.containerInfo,mI=!0;break g;case 4:Vg=o.stateNode.containerInfo,mI=!0;break g}o=o.return}if(Vg===null)throw Error(X(160));lu(l,n,t),Vg=null,mI=!1;var A=t.alternate;A!==null&&(A.return=null),t.return=null}catch(i){ig(t,g,i)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)nu(g,I),g=g.sibling}function nu(I,g){var C=I.alternate,e=I.flags;switch(I.tag){case 0:case 11:case 14:case 15:if(dI(g,I),pI(I),e&4){try{pt(3,I,I.return),oo(3,I)}catch(b){ig(I,I.return,b)}try{pt(5,I,I.return)}catch(b){ig(I,I.return,b)}}break;case 1:dI(g,I),pI(I),e&512&&C!==null&&he(C,C.return);break;case 5:if(dI(g,I),pI(I),e&512&&C!==null&&he(C,C.return),I.flags&32){var t=I.stateNode;try{kt(t,"")}catch(b){ig(I,I.return,b)}}if(e&4&&(t=I.stateNode,t!=null)){var l=I.memoizedProps,n=C!==null?C.memoizedProps:l,o=I.type,A=I.updateQueue;if(I.updateQueue=null,A!==null)try{o==="input"&&l.type==="radio"&&l.name!=null&&Xr(t,l),KA(o,n);var i=KA(o,l);for(n=0;n<A.length;n+=2){var s=A[n],c=A[n+1];s==="style"?Hr(t,c):s==="dangerouslySetInnerHTML"?fr(t,c):s==="children"?kt(t,c):Di(t,s,c,i)}switch(o){case"input":YA(t,l);break;case"textarea":Jr(t,l);break;case"select":var a=t._wrapperState.wasMultiple;t._wrapperState.wasMultiple=!!l.multiple;var r=l.value;r!=null?pe(t,!!l.multiple,r,!1):a!==!!l.multiple&&(l.defaultValue!=null?pe(t,!!l.multiple,l.defaultValue,!0):pe(t,!!l.multiple,l.multiple?[]:"",!1))}t[xt]=l}catch(b){ig(I,I.return,b)}}break;case 6:if(dI(g,I),pI(I),e&4){if(I.stateNode===null)throw Error(X(162));t=I.stateNode,l=I.memoizedProps;try{t.nodeValue=l}catch(b){ig(I,I.return,b)}}break;case 3:if(dI(g,I),pI(I),e&4&&C!==null&&C.memoizedState.isDehydrated)try{vt(g.containerInfo)}catch(b){ig(I,I.return,b)}break;case 4:dI(g,I),pI(I);break;case 13:dI(g,I),pI(I),t=I.child,t.flags&8192&&(l=t.memoizedState!==null,t.stateNode.isHidden=l,!l||t.alternate!==null&&t.alternate.memoizedState!==null||(Vs=dg())),e&4&&ia(I);break;case 22:if(s=C!==null&&C.memoizedState!==null,I.mode&1?(fg=(i=fg)||s,dI(g,I),fg=i):dI(g,I),pI(I),e&8192){if(i=I.memoizedState!==null,(I.stateNode.isHidden=i)&&!s&&I.mode&1)for(Y=I,s=I.child;s!==null;){for(c=Y=s;Y!==null;){switch(a=Y,r=a.child,a.tag){case 0:case 11:case 14:case 15:pt(4,a,a.return);break;case 1:he(a,a.return);var m=a.stateNode;if(typeof m.componentWillUnmount=="function"){e=a,C=a.return;try{g=e,m.props=g.memoizedProps,m.state=g.memoizedState,m.componentWillUnmount()}catch(b){ig(e,C,b)}}break;case 5:he(a,a.return);break;case 22:if(a.memoizedState!==null){ca(c);continue}}r!==null?(r.return=a,Y=r):ca(c)}s=s.sibling}g:for(s=null,c=I;;){if(c.tag===5){if(s===null){s=c;try{t=c.stateNode,i?(l=t.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(o=c.stateNode,A=c.memoizedProps.style,n=A!=null&&A.hasOwnProperty("display")?A.display:null,o.style.display=Yr("display",n))}catch(b){ig(I,I.return,b)}}}else if(c.tag===6){if(s===null)try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(b){ig(I,I.return,b)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===I)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===I)break g;for(;c.sibling===null;){if(c.return===null||c.return===I)break g;s===c&&(s=null),c=c.return}s===c&&(s=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:dI(g,I),pI(I),e&4&&ia(I);break;case 21:break;default:dI(g,I),pI(I)}}function pI(I){var g=I.flags;if(g&2){try{g:{for(var C=I.return;C!==null;){if(tu(C)){var e=C;break g}C=C.return}throw Error(X(160))}switch(e.tag){case 5:var t=e.stateNode;e.flags&32&&(kt(t,""),e.flags&=-33);var l=Aa(I);di(I,l,t);break;case 3:case 4:var n=e.stateNode.containerInfo,o=Aa(I);ai(I,o,n);break;default:throw Error(X(161))}}catch(A){ig(I,I.return,A)}I.flags&=-3}g&4096&&(I.flags&=-4097)}function WG(I,g,C){Y=I,ou(I)}function ou(I,g,C){for(var e=(I.mode&1)!==0;Y!==null;){var t=Y,l=t.child;if(t.tag===22&&e){var n=t.memoizedState!==null||kl;if(!n){var o=t.alternate,A=o!==null&&o.memoizedState!==null||fg;o=kl;var i=fg;if(kl=n,(fg=A)&&!i)for(Y=t;Y!==null;)n=Y,A=n.child,n.tag===22&&n.memoizedState!==null?aa(t):A!==null?(A.return=n,Y=A):aa(t);for(;l!==null;)Y=l,ou(l),l=l.sibling;Y=t,kl=o,fg=i}sa(I)}else t.subtreeFlags&8772&&l!==null?(l.return=t,Y=l):sa(I)}}function sa(I){for(;Y!==null;){var g=Y;if(g.flags&8772){var C=g.alternate;try{if(g.flags&8772)switch(g.tag){case 0:case 11:case 15:fg||oo(5,g);break;case 1:var e=g.stateNode;if(g.flags&4&&!fg)if(C===null)e.componentDidMount();else{var t=g.elementType===g.type?C.memoizedProps:rI(g.type,C.memoizedProps);e.componentDidUpdate(t,C.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}var l=g.updateQueue;l!==null&&jc(g,l,e);break;case 3:var n=g.updateQueue;if(n!==null){if(C=null,g.child!==null)switch(g.child.tag){case 5:C=g.child.stateNode;break;case 1:C=g.child.stateNode}jc(g,n,C)}break;case 5:var o=g.stateNode;if(C===null&&g.flags&4){C=o;var A=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&C.focus();break;case"img":A.src&&(C.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var i=g.alternate;if(i!==null){var s=i.memoizedState;if(s!==null){var c=s.dehydrated;c!==null&&vt(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(X(163))}fg||g.flags&512&&ci(g)}catch(a){ig(g,g.return,a)}}if(g===I){Y=null;break}if(C=g.sibling,C!==null){C.return=g.return,Y=C;break}Y=g.return}}function ca(I){for(;Y!==null;){var g=Y;if(g===I){Y=null;break}var C=g.sibling;if(C!==null){C.return=g.return,Y=C;break}Y=g.return}}function aa(I){for(;Y!==null;){var g=Y;try{switch(g.tag){case 0:case 11:case 15:var C=g.return;try{oo(4,g)}catch(A){ig(g,C,A)}break;case 1:var e=g.stateNode;if(typeof e.componentDidMount=="function"){var t=g.return;try{e.componentDidMount()}catch(A){ig(g,t,A)}}var l=g.return;try{ci(g)}catch(A){ig(g,l,A)}break;case 5:var n=g.return;try{ci(g)}catch(A){ig(g,n,A)}}}catch(A){ig(g,g.return,A)}if(g===I){Y=null;break}var o=g.sibling;if(o!==null){o.return=g.return,Y=o;break}Y=g.return}}var VG=Math.ceil,Yn=TI.ReactCurrentDispatcher,ps=TI.ReactCurrentOwner,iI=TI.ReactCurrentBatchConfig,M=0,pg=null,ug=null,Rg=0,qg=0,Ge=WC(0),Gg=0,Lt=null,jC=0,Ao=0,Ws=0,Wt=null,Eg=null,Vs=0,Ke=1/0,KI=null,Hn=!1,ri=null,rC=null,fl=!1,eC=null,vn=0,Vt=0,mi=null,Cn=-1,en=0;function Kg(){return M&6?dg():Cn!==-1?Cn:Cn=dg()}function mC(I){return I.mode&1?M&2&&Rg!==0?Rg&-Rg:AG.transition!==null?(en===0&&(en=Lr()),en):(I=D,I!==0||(I=window.event,I=I===void 0?16:qr(I.type)),I):1}function bI(I,g,C,e){if(50<Vt)throw Vt=0,mi=null,Error(X(185));tl(I,C,e),(!(M&2)||I!==pg)&&(I===pg&&(!(M&2)&&(Ao|=C),Gg===4&&IC(I,Rg)),jg(I,e),C===1&&M===0&&!(g.mode&1)&&(Ke=dg()+500,to&&VC()))}function jg(I,g){var C=I.callbackNode;Ah(I,g);var e=Zn(I,I===pg?Rg:0);if(e===0)C!==null&&Bc(C),I.callbackNode=null,I.callbackPriority=0;else if(g=e&-e,I.callbackPriority!==g){if(C!=null&&Bc(C),g===1)I.tag===0?oG(da.bind(null,I)):Zm(da.bind(null,I)),eG(function(){!(M&6)&&VC()}),C=null;else{switch(Dr(e)){case 1:C=_i;break;case 4:C=Qr;break;case 16:C=un;break;case 536870912:C=Ur;break;default:C=un}C=mu(C,Au.bind(null,I))}I.callbackPriority=g,I.callbackNode=C}}function Au(I,g){if(Cn=-1,en=0,M&6)throw Error(X(327));var C=I.callbackNode;if(Xe()&&I.callbackNode!==C)return null;var e=Zn(I,I===pg?Rg:0);if(e===0)return null;if(e&30||e&I.expiredLanes||g)g=Nn(I,e);else{g=e;var t=M;M|=2;var l=su();(pg!==I||Rg!==g)&&(KI=null,Ke=dg()+500,xC(I,g));do try{XG();break}catch(o){iu(I,o)}while(!0);ss(),Yn.current=l,M=t,ug!==null?g=0:(pg=null,Rg=0,g=Gg)}if(g!==0){if(g===2&&(t=EA(I),t!==0&&(e=t,g=ui(I,t))),g===1)throw C=Lt,xC(I,0),IC(I,e),jg(I,dg()),C;if(g===6)IC(I,e);else{if(t=I.current.alternate,!(e&30)&&!SG(t)&&(g=Nn(I,e),g===2&&(l=EA(I),l!==0&&(e=l,g=ui(I,l))),g===1))throw C=Lt,xC(I,0),IC(I,e),jg(I,dg()),C;switch(I.finishedWork=t,I.finishedLanes=e,g){case 0:case 1:throw Error(X(345));case 2:HC(I,Eg,KI);break;case 3:if(IC(I,e),(e&130023424)===e&&(g=Vs+500-dg(),10<g)){if(Zn(I,0)!==0)break;if(t=I.suspendedLanes,(t&e)!==e){Kg(),I.pingedLanes|=I.suspendedLanes&t;break}I.timeoutHandle=OA(HC.bind(null,I,Eg,KI),g);break}HC(I,Eg,KI);break;case 4:if(IC(I,e),(e&4194240)===e)break;for(g=I.eventTimes,t=-1;0<e;){var n=31-ZI(e);l=1<<n,n=g[n],n>t&&(t=n),e&=~l}if(e=t,e=dg()-e,e=(120>e?120:480>e?480:1080>e?1080:1920>e?1920:3e3>e?3e3:4320>e?4320:1960*VG(e/1960))-e,10<e){I.timeoutHandle=OA(HC.bind(null,I,Eg,KI),e);break}HC(I,Eg,KI);break;case 5:HC(I,Eg,KI);break;default:throw Error(X(329))}}}return jg(I,dg()),I.callbackNode===C?Au.bind(null,I):null}function ui(I,g){var C=Wt;return I.current.memoizedState.isDehydrated&&(xC(I,g).flags|=256),I=Nn(I,g),I!==2&&(g=Eg,Eg=C,g!==null&&Zi(g)),I}function Zi(I){Eg===null?Eg=I:Eg.push.apply(Eg,I)}function SG(I){for(var g=I;;){if(g.flags&16384){var C=g.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var e=0;e<C.length;e++){var t=C[e],l=t.getSnapshot;t=t.value;try{if(!GI(l(),t))return!1}catch{return!1}}}if(C=g.child,g.subtreeFlags&16384&&C!==null)C.return=g,g=C;else{if(g===I)break;for(;g.sibling===null;){if(g.return===null||g.return===I)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function IC(I,g){for(g&=~Ws,g&=~Ao,I.suspendedLanes|=g,I.pingedLanes&=~g,I=I.expirationTimes;0<g;){var C=31-ZI(g),e=1<<C;I[C]=-1,g&=~e}}function da(I){if(M&6)throw Error(X(327));Xe();var g=Zn(I,0);if(!(g&1))return jg(I,dg()),null;var C=Nn(I,g);if(I.tag!==0&&C===2){var e=EA(I);e!==0&&(g=e,C=ui(I,e))}if(C===1)throw C=Lt,xC(I,0),IC(I,g),jg(I,dg()),C;if(C===6)throw Error(X(345));return I.finishedWork=I.current.alternate,I.finishedLanes=g,HC(I,Eg,KI),jg(I,dg()),null}function Ss(I,g){var C=M;M|=1;try{return I(g)}finally{M=C,M===0&&(Ke=dg()+500,to&&VC())}}function PC(I){eC!==null&&eC.tag===0&&!(M&6)&&Xe();var g=M;M|=1;var C=iI.transition,e=D;try{if(iI.transition=null,D=1,I)return I()}finally{D=e,iI.transition=C,M=g,!(M&6)&&VC()}}function Rs(){qg=Ge.current,eg(Ge)}function xC(I,g){I.finishedWork=null,I.finishedLanes=0;var C=I.timeoutHandle;if(C!==-1&&(I.timeoutHandle=-1,CG(C)),ug!==null)for(C=ug.return;C!==null;){var e=C;switch(os(e),e.tag){case 1:e=e.type.childContextTypes,e!=null&&yn();break;case 3:Ne(),eg(Dg),eg(Yg),us();break;case 5:ms(e);break;case 4:Ne();break;case 13:eg(lg);break;case 19:eg(lg);break;case 10:cs(e.type._context);break;case 22:case 23:Rs()}C=C.return}if(pg=I,ug=I=uC(I.current,null),Rg=qg=g,Gg=0,Lt=null,Ws=Ao=jC=0,Eg=Wt=null,FC!==null){for(g=0;g<FC.length;g++)if(C=FC[g],e=C.interleaved,e!==null){C.interleaved=null;var t=e.next,l=C.pending;if(l!==null){var n=l.next;l.next=t,e.next=n}C.pending=e}FC=null}return I}function iu(I,g){do{var C=ug;try{if(ss(),$l.current=fn,kn){for(var e=ng.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}kn=!1}if(TC=0,Bg=hg=ng=null,yt=!1,Et=0,ps.current=null,C===null||C.return===null){Gg=1,Lt=g,ug=null;break}g:{var l=I,n=C.return,o=C,A=g;if(g=Rg,o.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var i=A,s=o,c=s.tag;if(!(s.mode&1)&&(c===0||c===11||c===15)){var a=s.alternate;a?(s.updateQueue=a.updateQueue,s.memoizedState=a.memoizedState,s.lanes=a.lanes):(s.updateQueue=null,s.memoizedState=null)}var r=ga(n);if(r!==null){r.flags&=-257,Ia(r,n,o,l,g),r.mode&1&&$c(l,i,g),g=r,A=i;var m=g.updateQueue;if(m===null){var b=new Set;b.add(A),g.updateQueue=b}else m.add(A);break g}else{if(!(g&1)){$c(l,i,g),Xs();break g}A=Error(X(426))}}else if(tg&&o.mode&1){var G=ga(n);if(G!==null){!(G.flags&65536)&&(G.flags|=256),Ia(G,n,o,l,g),As(Fe(A,o));break g}}l=A=Fe(A,o),Gg!==4&&(Gg=2),Wt===null?Wt=[l]:Wt.push(l),l=n;do{switch(l.tag){case 3:l.flags|=65536,g&=-g,l.lanes|=g;var u=Dm(l,A,g);Tc(l,u);break g;case 1:o=A;var Z=l.type,h=l.stateNode;if(!(l.flags&128)&&(typeof Z.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(rC===null||!rC.has(h)))){l.flags|=65536,g&=-g,l.lanes|=g;var B=Tm(l,o,g);Tc(l,B);break g}}l=l.return}while(l!==null)}au(C)}catch(y){g=y,ug===C&&C!==null&&(ug=C=C.return);continue}break}while(!0)}function su(){var I=Yn.current;return Yn.current=fn,I===null?fn:I}function Xs(){(Gg===0||Gg===3||Gg===2)&&(Gg=4),pg===null||!(jC&268435455)&&!(Ao&268435455)||IC(pg,Rg)}function Nn(I,g){var C=M;M|=2;var e=su();(pg!==I||Rg!==g)&&(KI=null,xC(I,g));do try{RG();break}catch(t){iu(I,t)}while(!0);if(ss(),M=C,Yn.current=e,ug!==null)throw Error(X(261));return pg=null,Rg=0,Gg}function RG(){for(;ug!==null;)cu(ug)}function XG(){for(;ug!==null&&!$b();)cu(ug)}function cu(I){var g=ru(I.alternate,I,qg);I.memoizedProps=I.pendingProps,g===null?au(I):ug=g,ps.current=null}function au(I){var g=I;do{var C=g.alternate;if(I=g.return,g.flags&32768){if(C=BG(C,g),C!==null){C.flags&=32767,ug=C;return}if(I!==null)I.flags|=32768,I.subtreeFlags=0,I.deletions=null;else{Gg=6,ug=null;return}}else if(C=GG(C,g,qg),C!==null){ug=C;return}if(g=g.sibling,g!==null){ug=g;return}ug=g=I}while(g!==null);Gg===0&&(Gg=5)}function HC(I,g,C){var e=D,t=iI.transition;try{iI.transition=null,D=1,JG(I,g,C,e)}finally{iI.transition=t,D=e}return null}function JG(I,g,C,e){do Xe();while(eC!==null);if(M&6)throw Error(X(327));C=I.finishedWork;var t=I.finishedLanes;if(C===null)return null;if(I.finishedWork=null,I.finishedLanes=0,C===I.current)throw Error(X(177));I.callbackNode=null,I.callbackPriority=0;var l=C.lanes|C.childLanes;if(ih(I,l),I===pg&&(ug=pg=null,Rg=0),!(C.subtreeFlags&2064)&&!(C.flags&2064)||fl||(fl=!0,mu(un,function(){return Xe(),null})),l=(C.flags&15990)!==0,C.subtreeFlags&15990||l){l=iI.transition,iI.transition=null;var n=D;D=1;var o=M;M|=4,ps.current=null,pG(I,C),nu(C,I),Ph(jA),bn=!!TA,jA=TA=null,I.current=C,WG(C),gh(),M=o,D=n,iI.transition=l}else I.current=C;if(fl&&(fl=!1,eC=I,vn=t),l=I.pendingLanes,l===0&&(rC=null),eh(C.stateNode),jg(I,dg()),g!==null)for(e=I.onRecoverableError,C=0;C<g.length;C++)t=g[C],e(t.value,{componentStack:t.stack,digest:t.digest});if(Hn)throw Hn=!1,I=ri,ri=null,I;return vn&1&&I.tag!==0&&Xe(),l=I.pendingLanes,l&1?I===mi?Vt++:(Vt=0,mi=I):Vt=0,VC(),null}function Xe(){if(eC!==null){var I=Dr(vn),g=iI.transition,C=D;try{if(iI.transition=null,D=16>I?16:I,eC===null)var e=!1;else{if(I=eC,eC=null,vn=0,M&6)throw Error(X(331));var t=M;for(M|=4,Y=I.current;Y!==null;){var l=Y,n=l.child;if(Y.flags&16){var o=l.deletions;if(o!==null){for(var A=0;A<o.length;A++){var i=o[A];for(Y=i;Y!==null;){var s=Y;switch(s.tag){case 0:case 11:case 15:pt(8,s,l)}var c=s.child;if(c!==null)c.return=s,Y=c;else for(;Y!==null;){s=Y;var a=s.sibling,r=s.return;if(eu(s),s===i){Y=null;break}if(a!==null){a.return=r,Y=a;break}Y=r}}}var m=l.alternate;if(m!==null){var b=m.child;if(b!==null){m.child=null;do{var G=b.sibling;b.sibling=null,b=G}while(b!==null)}}Y=l}}if(l.subtreeFlags&2064&&n!==null)n.return=l,Y=n;else g:for(;Y!==null;){if(l=Y,l.flags&2048)switch(l.tag){case 0:case 11:case 15:pt(9,l,l.return)}var u=l.sibling;if(u!==null){u.return=l.return,Y=u;break g}Y=l.return}}var Z=I.current;for(Y=Z;Y!==null;){n=Y;var h=n.child;if(n.subtreeFlags&2064&&h!==null)h.return=n,Y=h;else g:for(n=Z;Y!==null;){if(o=Y,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:oo(9,o)}}catch(y){ig(o,o.return,y)}if(o===n){Y=null;break g}var B=o.sibling;if(B!==null){B.return=o.return,Y=B;break g}Y=o.return}}if(M=t,VC(),fI&&typeof fI.onPostCommitFiberRoot=="function")try{fI.onPostCommitFiberRoot($n,I)}catch{}e=!0}return e}finally{D=C,iI.transition=g}}return!1}function ra(I,g,C){g=Fe(C,g),g=Dm(I,g,1),I=dC(I,g,1),g=Kg(),I!==null&&(tl(I,1,g),jg(I,g))}function ig(I,g,C){if(I.tag===3)ra(I,I,C);else for(;g!==null;){if(g.tag===3){ra(g,I,C);break}else if(g.tag===1){var e=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof e.componentDidCatch=="function"&&(rC===null||!rC.has(e))){I=Fe(C,I),I=Tm(g,I,1),g=dC(g,I,1),I=Kg(),g!==null&&(tl(g,1,I),jg(g,I));break}}g=g.return}}function kG(I,g,C){var e=I.pingCache;e!==null&&e.delete(g),g=Kg(),I.pingedLanes|=I.suspendedLanes&C,pg===I&&(Rg&C)===C&&(Gg===4||Gg===3&&(Rg&130023424)===Rg&&500>dg()-Vs?xC(I,0):Ws|=C),jg(I,g)}function du(I,g){g===0&&(I.mode&1?(g=Bl,Bl<<=1,!(Bl&130023424)&&(Bl=4194304)):g=1);var C=Kg();I=LI(I,g),I!==null&&(tl(I,g,C),jg(I,C))}function fG(I){var g=I.memoizedState,C=0;g!==null&&(C=g.retryLane),du(I,C)}function YG(I,g){var C=0;switch(I.tag){case 13:var e=I.stateNode,t=I.memoizedState;t!==null&&(C=t.retryLane);break;case 19:e=I.stateNode;break;default:throw Error(X(314))}e!==null&&e.delete(g),du(I,C)}var ru;ru=function(I,g,C){if(I!==null)if(I.memoizedProps!==g.pendingProps||Dg.current)Ug=!0;else{if(!(I.lanes&C)&&!(g.flags&128))return Ug=!1,hG(I,g,C);Ug=!!(I.flags&131072)}else Ug=!1,tg&&g.flags&1048576&&bm(g,Vn,g.index);switch(g.lanes=0,g.tag){case 2:var e=g.type;In(I,g),I=g.pendingProps;var t=Ye(g,Yg.current);Re(g,C),t=bs(null,g,e,I,t,C);var l=hs();return g.flags|=1,typeof t=="object"&&t!==null&&typeof t.render=="function"&&t.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Tg(e)?(l=!0,pn(g)):l=!1,g.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,ds(g),t.updater=no,g.stateNode=t,t._reactInternals=g,ei(g,e,I,C),g=ni(null,g,e,!0,l,C)):(g.tag=0,tg&&l&&ns(g),Ng(null,g,t,C),g=g.child),g;case 16:e=g.elementType;g:{switch(In(I,g),I=g.pendingProps,t=e._init,e=t(e._payload),g.type=e,t=g.tag=vG(e),I=rI(e,I),t){case 0:g=li(null,g,e,I,C);break g;case 1:g=ta(null,g,e,I,C);break g;case 11:g=Ca(null,g,e,I,C);break g;case 14:g=ea(null,g,e,rI(e.type,I),C);break g}throw Error(X(306,e,""))}return g;case 0:return e=g.type,t=g.pendingProps,t=g.elementType===e?t:rI(e,t),li(I,g,e,t,C);case 1:return e=g.type,t=g.pendingProps,t=g.elementType===e?t:rI(e,t),ta(I,g,e,t,C);case 3:g:{if(_m(g),I===null)throw Error(X(387));e=g.pendingProps,l=g.memoizedState,t=l.element,Wm(I,g),Xn(g,e,null,C);var n=g.memoizedState;if(e=n.element,l.isDehydrated)if(l={element:e,isDehydrated:!1,cache:n.cache,pendingSuspenseBoundaries:n.pendingSuspenseBoundaries,transitions:n.transitions},g.updateQueue.baseState=l,g.memoizedState=l,g.flags&256){t=Fe(Error(X(423)),g),g=la(I,g,e,C,t);break g}else if(e!==t){t=Fe(Error(X(424)),g),g=la(I,g,e,C,t);break g}else for($g=aC(g.stateNode.containerInfo.firstChild),gI=g,tg=!0,uI=null,C=ym(g,null,e,C),g.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(He(),e===t){g=DI(I,g,C);break g}Ng(I,g,e,C)}g=g.child}return g;case 5:return Vm(g),I===null&&gi(g),e=g.type,t=g.pendingProps,l=I!==null?I.memoizedProps:null,n=t.children,PA(e,t)?n=null:l!==null&&PA(e,l)&&(g.flags|=32),Om(I,g),Ng(I,g,n,C),g.child;case 6:return I===null&&gi(g),null;case 13:return qm(I,g,C);case 4:return rs(g,g.stateNode.containerInfo),e=g.pendingProps,I===null?g.child=ve(g,null,e,C):Ng(I,g,e,C),g.child;case 11:return e=g.type,t=g.pendingProps,t=g.elementType===e?t:rI(e,t),Ca(I,g,e,t,C);case 7:return Ng(I,g,g.pendingProps,C),g.child;case 8:return Ng(I,g,g.pendingProps.children,C),g.child;case 12:return Ng(I,g,g.pendingProps.children,C),g.child;case 10:g:{if(e=g.type._context,t=g.pendingProps,l=g.memoizedProps,n=t.value,$(Sn,e._currentValue),e._currentValue=n,l!==null)if(GI(l.value,n)){if(l.children===t.children&&!Dg.current){g=DI(I,g,C);break g}}else for(l=g.child,l!==null&&(l.return=g);l!==null;){var o=l.dependencies;if(o!==null){n=l.child;for(var A=o.firstContext;A!==null;){if(A.context===e){if(l.tag===1){A=EI(-1,C&-C),A.tag=2;var i=l.updateQueue;if(i!==null){i=i.shared;var s=i.pending;s===null?A.next=A:(A.next=s.next,s.next=A),i.pending=A}}l.lanes|=C,A=l.alternate,A!==null&&(A.lanes|=C),Ii(l.return,C,g),o.lanes|=C;break}A=A.next}}else if(l.tag===10)n=l.type===g.type?null:l.child;else if(l.tag===18){if(n=l.return,n===null)throw Error(X(341));n.lanes|=C,o=n.alternate,o!==null&&(o.lanes|=C),Ii(n,C,g),n=l.sibling}else n=l.child;if(n!==null)n.return=l;else for(n=l;n!==null;){if(n===g){n=null;break}if(l=n.sibling,l!==null){l.return=n.return,n=l;break}n=n.return}l=n}Ng(I,g,t.children,C),g=g.child}return g;case 9:return t=g.type,e=g.pendingProps.children,Re(g,C),t=cI(t),e=e(t),g.flags|=1,Ng(I,g,e,C),g.child;case 14:return e=g.type,t=rI(e,g.pendingProps),t=rI(e.type,t),ea(I,g,e,t,C);case 15:return jm(I,g,g.type,g.pendingProps,C);case 17:return e=g.type,t=g.pendingProps,t=g.elementType===e?t:rI(e,t),In(I,g),g.tag=1,Tg(e)?(I=!0,pn(g)):I=!1,Re(g,C),Lm(g,e,t),ei(g,e,t,C),ni(null,g,e,!0,I,C);case 19:return $m(I,g,C);case 22:return Pm(I,g,C)}throw Error(X(156,g.tag))};function mu(I,g){return Er(I,g)}function HG(I,g,C,e){this.tag=I,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=e,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function AI(I,g,C,e){return new HG(I,g,C,e)}function Js(I){return I=I.prototype,!(!I||!I.isReactComponent)}function vG(I){if(typeof I=="function")return Js(I)?1:0;if(I!=null){if(I=I.$$typeof,I===ji)return 11;if(I===Pi)return 14}return 2}function uC(I,g){var C=I.alternate;return C===null?(C=AI(I.tag,g,I.key,I.mode),C.elementType=I.elementType,C.type=I.type,C.stateNode=I.stateNode,C.alternate=I,I.alternate=C):(C.pendingProps=g,C.type=I.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=I.flags&14680064,C.childLanes=I.childLanes,C.lanes=I.lanes,C.child=I.child,C.memoizedProps=I.memoizedProps,C.memoizedState=I.memoizedState,C.updateQueue=I.updateQueue,g=I.dependencies,C.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},C.sibling=I.sibling,C.index=I.index,C.ref=I.ref,C}function tn(I,g,C,e,t,l){var n=2;if(e=I,typeof I=="function")Js(I)&&(n=1);else if(typeof I=="string")n=5;else g:switch(I){case se:return zC(C.children,t,l,g);case Ti:n=8,t|=8;break;case RA:return I=AI(12,C,g,t|2),I.elementType=RA,I.lanes=l,I;case XA:return I=AI(13,C,g,t),I.elementType=XA,I.lanes=l,I;case JA:return I=AI(19,C,g,t),I.elementType=JA,I.lanes=l,I;case Vr:return io(C,t,l,g);default:if(typeof I=="object"&&I!==null)switch(I.$$typeof){case pr:n=10;break g;case Wr:n=9;break g;case ji:n=11;break g;case Pi:n=14;break g;case qI:n=16,e=null;break g}throw Error(X(130,I==null?I:typeof I,""))}return g=AI(n,C,g,t),g.elementType=I,g.type=e,g.lanes=l,g}function zC(I,g,C,e){return I=AI(7,I,e,g),I.lanes=C,I}function io(I,g,C,e){return I=AI(22,I,e,g),I.elementType=Vr,I.lanes=C,I.stateNode={isHidden:!1},I}function oA(I,g,C){return I=AI(6,I,null,g),I.lanes=C,I}function AA(I,g,C){return g=AI(4,I.children!==null?I.children:[],I.key,g),g.lanes=C,g.stateNode={containerInfo:I.containerInfo,pendingChildren:null,implementation:I.implementation},g}function NG(I,g,C,e,t){this.tag=g,this.containerInfo=I,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Eo(0),this.expirationTimes=Eo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Eo(0),this.identifierPrefix=e,this.onRecoverableError=t,this.mutableSourceEagerHydrationData=null}function ks(I,g,C,e,t,l,n,o,A){return I=new NG(I,g,C,o,A),g===1?(g=1,l===!0&&(g|=8)):g=0,l=AI(3,null,null,g),I.current=l,l.stateNode=I,l.memoizedState={element:e,isDehydrated:C,cache:null,transitions:null,pendingSuspenseBoundaries:null},ds(l),I}function FG(I,g,C){var e=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ie,key:e==null?null:""+e,children:I,containerInfo:g,implementation:C}}function uu(I){if(!I)return GC;I=I._reactInternals;g:{if(Ce(I)!==I||I.tag!==1)throw Error(X(170));var g=I;do{switch(g.tag){case 3:g=g.stateNode.context;break g;case 1:if(Tg(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break g}}g=g.return}while(g!==null);throw Error(X(171))}if(I.tag===1){var C=I.type;if(Tg(C))return um(I,C,g)}return g}function Zu(I,g,C,e,t,l,n,o,A){return I=ks(C,e,!0,I,t,l,n,o,A),I.context=uu(null),C=I.current,e=Kg(),t=mC(C),l=EI(e,t),l.callback=g??null,dC(C,l,t),I.current.lanes=t,tl(I,t,e),jg(I,e),I}function so(I,g,C,e){var t=g.current,l=Kg(),n=mC(t);return C=uu(C),g.context===null?g.context=C:g.pendingContext=C,g=EI(l,n),g.payload={element:I},e=e===void 0?null:e,e!==null&&(g.callback=e),I=dC(t,g,n),I!==null&&(bI(I,t,n,l),ql(I,t,n)),n}function Fn(I){if(I=I.current,!I.child)return null;switch(I.child.tag){case 5:return I.child.stateNode;default:return I.child.stateNode}}function ma(I,g){if(I=I.memoizedState,I!==null&&I.dehydrated!==null){var C=I.retryLane;I.retryLane=C!==0&&C<g?C:g}}function fs(I,g){ma(I,g),(I=I.alternate)&&ma(I,g)}function KG(){return null}var bu=typeof reportError=="function"?reportError:function(I){console.error(I)};function Ys(I){this._internalRoot=I}co.prototype.render=Ys.prototype.render=function(I){var g=this._internalRoot;if(g===null)throw Error(X(409));so(I,g,null,null)};co.prototype.unmount=Ys.prototype.unmount=function(){var I=this._internalRoot;if(I!==null){this._internalRoot=null;var g=I.containerInfo;PC(function(){so(null,I,null,null)}),g[UI]=null}};function co(I){this._internalRoot=I}co.prototype.unstable_scheduleHydration=function(I){if(I){var g=Pr();I={blockedOn:null,target:I,priority:g};for(var C=0;C<gC.length&&g!==0&&g<gC[C].priority;C++);gC.splice(C,0,I),C===0&&_r(I)}};function Hs(I){return!(!I||I.nodeType!==1&&I.nodeType!==9&&I.nodeType!==11)}function ao(I){return!(!I||I.nodeType!==1&&I.nodeType!==9&&I.nodeType!==11&&(I.nodeType!==8||I.nodeValue!==" react-mount-point-unstable "))}function ua(){}function wG(I,g,C,e,t){if(t){if(typeof e=="function"){var l=e;e=function(){var i=Fn(n);l.call(i)}}var n=Zu(g,e,I,0,null,!1,!1,"",ua);return I._reactRootContainer=n,I[UI]=n.current,Kt(I.nodeType===8?I.parentNode:I),PC(),n}for(;t=I.lastChild;)I.removeChild(t);if(typeof e=="function"){var o=e;e=function(){var i=Fn(A);o.call(i)}}var A=ks(I,0,!1,null,null,!1,!1,"",ua);return I._reactRootContainer=A,I[UI]=A.current,Kt(I.nodeType===8?I.parentNode:I),PC(function(){so(g,A,C,e)}),A}function ro(I,g,C,e,t){var l=C._reactRootContainer;if(l){var n=l;if(typeof t=="function"){var o=t;t=function(){var A=Fn(n);o.call(A)}}so(g,n,I,t)}else n=wG(C,g,I,t,e);return Fn(n)}Tr=function(I){switch(I.tag){case 3:var g=I.stateNode;if(g.current.memoizedState.isDehydrated){var C=st(g.pendingLanes);C!==0&&(qi(g,C|1),jg(g,dg()),!(M&6)&&(Ke=dg()+500,VC()))}break;case 13:PC(function(){var e=LI(I,1);if(e!==null){var t=Kg();bI(e,I,1,t)}}),fs(I,1)}};$i=function(I){if(I.tag===13){var g=LI(I,134217728);if(g!==null){var C=Kg();bI(g,I,134217728,C)}fs(I,134217728)}};jr=function(I){if(I.tag===13){var g=mC(I),C=LI(I,g);if(C!==null){var e=Kg();bI(C,I,g,e)}fs(I,g)}};Pr=function(){return D};Or=function(I,g){var C=D;try{return D=I,g()}finally{D=C}};xA=function(I,g,C){switch(g){case"input":if(YA(I,C),g=C.name,C.type==="radio"&&g!=null){for(C=I;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<C.length;g++){var e=C[g];if(e!==I&&e.form===I.form){var t=eo(e);if(!t)throw Error(X(90));Rr(e),YA(e,t)}}}break;case"textarea":Jr(I,C);break;case"select":g=C.value,g!=null&&pe(I,!!C.multiple,g,!1)}};Fr=Ss;Kr=PC;var xG={usingClientEntryPoint:!1,Events:[nl,re,eo,vr,Nr,Ss]},gt={findFiberByHostInstance:NC,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},zG={bundleType:gt.bundleType,version:gt.version,rendererPackageName:gt.rendererPackageName,rendererConfig:gt.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:TI.ReactCurrentDispatcher,findHostInstanceByFiber:function(I){return I=zr(I),I===null?null:I.stateNode},findFiberByHostInstance:gt.findFiberByHostInstance||KG,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yl.isDisabled&&Yl.supportsFiber)try{$n=Yl.inject(zG),fI=Yl}catch{}}CI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xG;CI.createPortal=function(I,g){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hs(g))throw Error(X(200));return FG(I,g,null,C)};CI.createRoot=function(I,g){if(!Hs(I))throw Error(X(299));var C=!1,e="",t=bu;return g!=null&&(g.unstable_strictMode===!0&&(C=!0),g.identifierPrefix!==void 0&&(e=g.identifierPrefix),g.onRecoverableError!==void 0&&(t=g.onRecoverableError)),g=ks(I,1,!1,null,null,C,!1,e,t),I[UI]=g.current,Kt(I.nodeType===8?I.parentNode:I),new Ys(g)};CI.findDOMNode=function(I){if(I==null)return null;if(I.nodeType===1)return I;var g=I._reactInternals;if(g===void 0)throw typeof I.render=="function"?Error(X(188)):(I=Object.keys(I).join(","),Error(X(268,I)));return I=zr(g),I=I===null?null:I.stateNode,I};CI.flushSync=function(I){return PC(I)};CI.hydrate=function(I,g,C){if(!ao(g))throw Error(X(200));return ro(null,I,g,!0,C)};CI.hydrateRoot=function(I,g,C){if(!Hs(I))throw Error(X(405));var e=C!=null&&C.hydratedSources||null,t=!1,l="",n=bu;if(C!=null&&(C.unstable_strictMode===!0&&(t=!0),C.identifierPrefix!==void 0&&(l=C.identifierPrefix),C.onRecoverableError!==void 0&&(n=C.onRecoverableError)),g=Zu(g,null,I,1,C??null,t,!1,l,n),I[UI]=g.current,Kt(I),e)for(I=0;I<e.length;I++)C=e[I],t=C._getVersion,t=t(C._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[C,t]:g.mutableSourceEagerHydrationData.push(C,t);return new co(g)};CI.render=function(I,g,C){if(!ao(g))throw Error(X(200));return ro(null,I,g,!1,C)};CI.unmountComponentAtNode=function(I){if(!ao(I))throw Error(X(40));return I._reactRootContainer?(PC(function(){ro(null,null,I,!1,function(){I._reactRootContainer=null,I[UI]=null})}),!0):!1};CI.unstable_batchedUpdates=Ss;CI.unstable_renderSubtreeIntoContainer=function(I,g,C,e){if(!ao(C))throw Error(X(200));if(I==null||I._reactInternals===void 0)throw Error(X(38));return ro(I,g,C,!1,e)};CI.version="18.3.1-next-f1338f8080-20240426";function hu(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(hu)}catch(I){console.error(I)}}hu(),hr.exports=CI;var MG=hr.exports,Za=MG;VA.createRoot=Za.createRoot,VA.hydrateRoot=Za.hydrateRoot;/**
 * @remix-run/router v1.16.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dt(){return Dt=Object.assign?Object.assign.bind():function(I){for(var g=1;g<arguments.length;g++){var C=arguments[g];for(var e in C)Object.prototype.hasOwnProperty.call(C,e)&&(I[e]=C[e])}return I},Dt.apply(this,arguments)}var tC;(function(I){I.Pop="POP",I.Push="PUSH",I.Replace="REPLACE"})(tC||(tC={}));const ba="popstate";function EG(I){I===void 0&&(I={});function g(e,t){let{pathname:l,search:n,hash:o}=e.location;return bi("",{pathname:l,search:n,hash:o},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}function C(e,t){return typeof t=="string"?t:Bu(t)}return UG(g,C,null,I)}function Zg(I,g){if(I===!1||I===null||typeof I>"u")throw new Error(g)}function Gu(I,g){if(!I){typeof console<"u"&&console.warn(g);try{throw new Error(g)}catch{}}}function QG(){return Math.random().toString(36).substr(2,8)}function ha(I,g){return{usr:I.state,key:I.key,idx:g}}function bi(I,g,C,e){return C===void 0&&(C=null),Dt({pathname:typeof I=="string"?I:I.pathname,search:"",hash:""},typeof g=="string"?Qe(g):g,{state:C,key:g&&g.key||e||QG()})}function Bu(I){let{pathname:g="/",search:C="",hash:e=""}=I;return C&&C!=="?"&&(g+=C.charAt(0)==="?"?C:"?"+C),e&&e!=="#"&&(g+=e.charAt(0)==="#"?e:"#"+e),g}function Qe(I){let g={};if(I){let C=I.indexOf("#");C>=0&&(g.hash=I.substr(C),I=I.substr(0,C));let e=I.indexOf("?");e>=0&&(g.search=I.substr(e),I=I.substr(0,e)),I&&(g.pathname=I)}return g}function UG(I,g,C,e){e===void 0&&(e={});let{window:t=document.defaultView,v5Compat:l=!1}=e,n=t.history,o=tC.Pop,A=null,i=s();i==null&&(i=0,n.replaceState(Dt({},n.state,{idx:i}),""));function s(){return(n.state||{idx:null}).idx}function c(){o=tC.Pop;let G=s(),u=G==null?null:G-i;i=G,A&&A({action:o,location:b.location,delta:u})}function a(G,u){o=tC.Push;let Z=bi(b.location,G,u);i=s()+1;let h=ha(Z,i),B=b.createHref(Z);try{n.pushState(h,"",B)}catch(y){if(y instanceof DOMException&&y.name==="DataCloneError")throw y;t.location.assign(B)}l&&A&&A({action:o,location:b.location,delta:1})}function r(G,u){o=tC.Replace;let Z=bi(b.location,G,u);i=s();let h=ha(Z,i),B=b.createHref(Z);n.replaceState(h,"",B),l&&A&&A({action:o,location:b.location,delta:0})}function m(G){let u=t.location.origin!=="null"?t.location.origin:t.location.href,Z=typeof G=="string"?G:Bu(G);return Z=Z.replace(/ $/,"%20"),Zg(u,"No window.location.(origin|href) available to create URL for href: "+Z),new URL(Z,u)}let b={get action(){return o},get location(){return I(t,n)},listen(G){if(A)throw new Error("A history only accepts one active listener");return t.addEventListener(ba,c),A=G,()=>{t.removeEventListener(ba,c),A=null}},createHref(G){return g(t,G)},createURL:m,encodeLocation(G){let u=m(G);return{pathname:u.pathname,search:u.search,hash:u.hash}},push:a,replace:r,go(G){return n.go(G)}};return b}var Ga;(function(I){I.data="data",I.deferred="deferred",I.redirect="redirect",I.error="error"})(Ga||(Ga={}));function LG(I,g,C){C===void 0&&(C="/");let e=typeof g=="string"?Qe(g):g,t=Wu(e.pathname||"/",C);if(t==null)return null;let l=yu(I);DG(l);let n=null;for(let o=0;n==null&&o<l.length;++o){let A=t0(t);n=I0(l[o],A)}return n}function yu(I,g,C,e){g===void 0&&(g=[]),C===void 0&&(C=[]),e===void 0&&(e="");let t=(l,n,o)=>{let A={relativePath:o===void 0?l.path||"":o,caseSensitive:l.caseSensitive===!0,childrenIndex:n,route:l};A.relativePath.startsWith("/")&&(Zg(A.relativePath.startsWith(e),'Absolute route path "'+A.relativePath+'" nested under path '+('"'+e+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),A.relativePath=A.relativePath.slice(e.length));let i=MC([e,A.relativePath]),s=C.concat(A);l.children&&l.children.length>0&&(Zg(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+i+'".')),yu(l.children,g,s,i)),!(l.path==null&&!l.index)&&g.push({path:i,score:$G(i,l.index),routesMeta:s})};return I.forEach((l,n)=>{var o;if(l.path===""||!((o=l.path)!=null&&o.includes("?")))t(l,n);else for(let A of pu(l.path))t(l,n,A)}),g}function pu(I){let g=I.split("/");if(g.length===0)return[];let[C,...e]=g,t=C.endsWith("?"),l=C.replace(/\?$/,"");if(e.length===0)return t?[l,""]:[l];let n=pu(e.join("/")),o=[];return o.push(...n.map(A=>A===""?l:[l,A].join("/"))),t&&o.push(...n),o.map(A=>I.startsWith("/")&&A===""?"/":A)}function DG(I){I.sort((g,C)=>g.score!==C.score?C.score-g.score:g0(g.routesMeta.map(e=>e.childrenIndex),C.routesMeta.map(e=>e.childrenIndex)))}const TG=/^:[\w-]+$/,jG=3,PG=2,OG=1,_G=10,qG=-2,Ba=I=>I==="*";function $G(I,g){let C=I.split("/"),e=C.length;return C.some(Ba)&&(e+=qG),g&&(e+=PG),C.filter(t=>!Ba(t)).reduce((t,l)=>t+(TG.test(l)?jG:l===""?OG:_G),e)}function g0(I,g){return I.length===g.length&&I.slice(0,-1).every((e,t)=>e===g[t])?I[I.length-1]-g[g.length-1]:0}function I0(I,g){let{routesMeta:C}=I,e={},t="/",l=[];for(let n=0;n<C.length;++n){let o=C[n],A=n===C.length-1,i=t==="/"?g:g.slice(t.length)||"/",s=C0({path:o.relativePath,caseSensitive:o.caseSensitive,end:A},i);if(!s)return null;Object.assign(e,s.params);let c=o.route;l.push({params:e,pathname:MC([t,s.pathname]),pathnameBase:A0(MC([t,s.pathnameBase])),route:c}),s.pathnameBase!=="/"&&(t=MC([t,s.pathnameBase]))}return l}function C0(I,g){typeof I=="string"&&(I={path:I,caseSensitive:!1,end:!0});let[C,e]=e0(I.path,I.caseSensitive,I.end),t=g.match(C);if(!t)return null;let l=t[0],n=l.replace(/(.)\/+$/,"$1"),o=t.slice(1);return{params:e.reduce((i,s,c)=>{let{paramName:a,isOptional:r}=s;if(a==="*"){let b=o[c]||"";n=l.slice(0,l.length-b.length).replace(/(.)\/+$/,"$1")}const m=o[c];return r&&!m?i[a]=void 0:i[a]=(m||"").replace(/%2F/g,"/"),i},{}),pathname:l,pathnameBase:n,pattern:I}}function e0(I,g,C){g===void 0&&(g=!1),C===void 0&&(C=!0),Gu(I==="*"||!I.endsWith("*")||I.endsWith("/*"),'Route path "'+I+'" will be treated as if it were '+('"'+I.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+I.replace(/\*$/,"/*")+'".'));let e=[],t="^"+I.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(n,o,A)=>(e.push({paramName:o,isOptional:A!=null}),A?"/?([^\\/]+)?":"/([^\\/]+)"));return I.endsWith("*")?(e.push({paramName:"*"}),t+=I==="*"||I==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):C?t+="\\/*$":I!==""&&I!=="/"&&(t+="(?:(?=\\/|$))"),[new RegExp(t,g?void 0:"i"),e]}function t0(I){try{return I.split("/").map(g=>decodeURIComponent(g).replace(/\//g,"%2F")).join("/")}catch(g){return Gu(!1,'The URL path "'+I+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+g+").")),I}}function Wu(I,g){if(g==="/")return I;if(!I.toLowerCase().startsWith(g.toLowerCase()))return null;let C=g.endsWith("/")?g.length-1:g.length,e=I.charAt(C);return e&&e!=="/"?null:I.slice(C)||"/"}function l0(I,g){g===void 0&&(g="/");let{pathname:C,search:e="",hash:t=""}=typeof I=="string"?Qe(I):I;return{pathname:C?C.startsWith("/")?C:n0(C,g):g,search:i0(e),hash:s0(t)}}function n0(I,g){let C=g.replace(/\/+$/,"").split("/");return I.split("/").forEach(t=>{t===".."?C.length>1&&C.pop():t!=="."&&C.push(t)}),C.length>1?C.join("/"):"/"}function iA(I,g,C,e){return"Cannot include a '"+I+"' character in a manually specified "+("`to."+g+"` field ["+JSON.stringify(e)+"].  Please separate it out to the ")+("`to."+C+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function o0(I){return I.filter((g,C)=>C===0||g.route.path&&g.route.path.length>0)}function Vu(I,g){let C=o0(I);return g?C.map((e,t)=>t===I.length-1?e.pathname:e.pathnameBase):C.map(e=>e.pathnameBase)}function Su(I,g,C,e){e===void 0&&(e=!1);let t;typeof I=="string"?t=Qe(I):(t=Dt({},I),Zg(!t.pathname||!t.pathname.includes("?"),iA("?","pathname","search",t)),Zg(!t.pathname||!t.pathname.includes("#"),iA("#","pathname","hash",t)),Zg(!t.search||!t.search.includes("#"),iA("#","search","hash",t)));let l=I===""||t.pathname==="",n=l?"/":t.pathname,o;if(n==null)o=C;else{let c=g.length-1;if(!e&&n.startsWith("..")){let a=n.split("/");for(;a[0]==="..";)a.shift(),c-=1;t.pathname=a.join("/")}o=c>=0?g[c]:"/"}let A=l0(t,o),i=n&&n!=="/"&&n.endsWith("/"),s=(l||n===".")&&C.endsWith("/");return!A.pathname.endsWith("/")&&(i||s)&&(A.pathname+="/"),A}const MC=I=>I.join("/").replace(/\/\/+/g,"/"),A0=I=>I.replace(/\/+$/,"").replace(/^\/*/,"/"),i0=I=>!I||I==="?"?"":I.startsWith("?")?I:"?"+I,s0=I=>!I||I==="#"?"":I.startsWith("#")?I:"#"+I;function c0(I){return I!=null&&typeof I.status=="number"&&typeof I.statusText=="string"&&typeof I.internal=="boolean"&&"data"in I}const Ru=["post","put","patch","delete"];new Set(Ru);const a0=["get",...Ru];new Set(a0);/**
 * React Router v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Tt(){return Tt=Object.assign?Object.assign.bind():function(I){for(var g=1;g<arguments.length;g++){var C=arguments[g];for(var e in C)Object.prototype.hasOwnProperty.call(C,e)&&(I[e]=C[e])}return I},Tt.apply(this,arguments)}const vs=p.createContext(null),d0=p.createContext(null),Al=p.createContext(null),mo=p.createContext(null),jI=p.createContext({outlet:null,matches:[],isDataRoute:!1}),Xu=p.createContext(null);function il(){return p.useContext(mo)!=null}function Ns(){return il()||Zg(!1),p.useContext(mo).location}function Ju(I){p.useContext(Al).static||p.useLayoutEffect(I)}function SC(){let{isDataRoute:I}=p.useContext(jI);return I?J0():r0()}function r0(){il()||Zg(!1);let I=p.useContext(vs),{basename:g,future:C,navigator:e}=p.useContext(Al),{matches:t}=p.useContext(jI),{pathname:l}=Ns(),n=JSON.stringify(Vu(t,C.v7_relativeSplatPath)),o=p.useRef(!1);return Ju(()=>{o.current=!0}),p.useCallback(function(i,s){if(s===void 0&&(s={}),!o.current)return;if(typeof i=="number"){e.go(i);return}let c=Su(i,JSON.parse(n),l,s.relative==="path");I==null&&g!=="/"&&(c.pathname=c.pathname==="/"?g:MC([g,c.pathname])),(s.replace?e.replace:e.push)(c,s.state,s)},[g,e,n,l,I])}const m0=p.createContext(null);function u0(I){let g=p.useContext(jI).outlet;return g&&p.createElement(m0.Provider,{value:I},g)}function Z0(){let{matches:I}=p.useContext(jI),g=I[I.length-1];return g?g.params:{}}function b0(I,g){return h0(I,g)}function h0(I,g,C,e){il()||Zg(!1);let{navigator:t}=p.useContext(Al),{matches:l}=p.useContext(jI),n=l[l.length-1],o=n?n.params:{};n&&n.pathname;let A=n?n.pathnameBase:"/";n&&n.route;let i=Ns(),s;if(g){var c;let G=typeof g=="string"?Qe(g):g;A==="/"||(c=G.pathname)!=null&&c.startsWith(A)||Zg(!1),s=G}else s=i;let a=s.pathname||"/",r=a;if(A!=="/"){let G=A.replace(/^\//,"").split("/");r="/"+a.replace(/^\//,"").split("/").slice(G.length).join("/")}let m=LG(I,{pathname:r}),b=W0(m&&m.map(G=>Object.assign({},G,{params:Object.assign({},o,G.params),pathname:MC([A,t.encodeLocation?t.encodeLocation(G.pathname).pathname:G.pathname]),pathnameBase:G.pathnameBase==="/"?A:MC([A,t.encodeLocation?t.encodeLocation(G.pathnameBase).pathname:G.pathnameBase])})),l,C,e);return g&&b?p.createElement(mo.Provider,{value:{location:Tt({pathname:"/",search:"",hash:"",state:null,key:"default"},s),navigationType:tC.Pop}},b):b}function G0(){let I=X0(),g=c0(I)?I.status+" "+I.statusText:I instanceof Error?I.message:JSON.stringify(I),C=I instanceof Error?I.stack:null,t={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return p.createElement(p.Fragment,null,p.createElement("h2",null,"Unexpected Application Error!"),p.createElement("h3",{style:{fontStyle:"italic"}},g),C?p.createElement("pre",{style:t},C):null,null)}const B0=p.createElement(G0,null);class y0 extends p.Component{constructor(g){super(g),this.state={location:g.location,revalidation:g.revalidation,error:g.error}}static getDerivedStateFromError(g){return{error:g}}static getDerivedStateFromProps(g,C){return C.location!==g.location||C.revalidation!=="idle"&&g.revalidation==="idle"?{error:g.error,location:g.location,revalidation:g.revalidation}:{error:g.error!==void 0?g.error:C.error,location:C.location,revalidation:g.revalidation||C.revalidation}}componentDidCatch(g,C){console.error("React Router caught the following error during render",g,C)}render(){return this.state.error!==void 0?p.createElement(jI.Provider,{value:this.props.routeContext},p.createElement(Xu.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function p0(I){let{routeContext:g,match:C,children:e}=I,t=p.useContext(vs);return t&&t.static&&t.staticContext&&(C.route.errorElement||C.route.ErrorBoundary)&&(t.staticContext._deepestRenderedBoundaryId=C.route.id),p.createElement(jI.Provider,{value:g},e)}function W0(I,g,C,e){var t;if(g===void 0&&(g=[]),C===void 0&&(C=null),e===void 0&&(e=null),I==null){var l;if((l=C)!=null&&l.errors)I=C.matches;else return null}let n=I,o=(t=C)==null?void 0:t.errors;if(o!=null){let s=n.findIndex(c=>c.route.id&&(o==null?void 0:o[c.route.id])!==void 0);s>=0||Zg(!1),n=n.slice(0,Math.min(n.length,s+1))}let A=!1,i=-1;if(C&&e&&e.v7_partialHydration)for(let s=0;s<n.length;s++){let c=n[s];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(i=s),c.route.id){let{loaderData:a,errors:r}=C,m=c.route.loader&&a[c.route.id]===void 0&&(!r||r[c.route.id]===void 0);if(c.route.lazy||m){A=!0,i>=0?n=n.slice(0,i+1):n=[n[0]];break}}}return n.reduceRight((s,c,a)=>{let r,m=!1,b=null,G=null;C&&(r=o&&c.route.id?o[c.route.id]:void 0,b=c.route.errorElement||B0,A&&(i<0&&a===0?(m=!0,G=null):i===a&&(m=!0,G=c.route.hydrateFallbackElement||null)));let u=g.concat(n.slice(0,a+1)),Z=()=>{let h;return r?h=b:m?h=G:c.route.Component?h=p.createElement(c.route.Component,null):c.route.element?h=c.route.element:h=s,p.createElement(p0,{match:c,routeContext:{outlet:s,matches:u,isDataRoute:C!=null},children:h})};return C&&(c.route.ErrorBoundary||c.route.errorElement||a===0)?p.createElement(y0,{location:C.location,revalidation:C.revalidation,component:b,error:r,children:Z(),routeContext:{outlet:null,matches:u,isDataRoute:!0}}):Z()},null)}var ku=function(I){return I.UseBlocker="useBlocker",I.UseRevalidator="useRevalidator",I.UseNavigateStable="useNavigate",I}(ku||{}),Kn=function(I){return I.UseBlocker="useBlocker",I.UseLoaderData="useLoaderData",I.UseActionData="useActionData",I.UseRouteError="useRouteError",I.UseNavigation="useNavigation",I.UseRouteLoaderData="useRouteLoaderData",I.UseMatches="useMatches",I.UseRevalidator="useRevalidator",I.UseNavigateStable="useNavigate",I.UseRouteId="useRouteId",I}(Kn||{});function V0(I){let g=p.useContext(vs);return g||Zg(!1),g}function S0(I){let g=p.useContext(d0);return g||Zg(!1),g}function R0(I){let g=p.useContext(jI);return g||Zg(!1),g}function fu(I){let g=R0(),C=g.matches[g.matches.length-1];return C.route.id||Zg(!1),C.route.id}function X0(){var I;let g=p.useContext(Xu),C=S0(Kn.UseRouteError),e=fu(Kn.UseRouteError);return g!==void 0?g:(I=C.errors)==null?void 0:I[e]}function J0(){let{router:I}=V0(ku.UseNavigateStable),g=fu(Kn.UseNavigateStable),C=p.useRef(!1);return Ju(()=>{C.current=!0}),p.useCallback(function(t,l){l===void 0&&(l={}),C.current&&(typeof t=="number"?I.navigate(t):I.navigate(t,Tt({fromRouteId:g},l)))},[I,g])}function OC(I){let{to:g,replace:C,state:e,relative:t}=I;il()||Zg(!1);let{future:l,static:n}=p.useContext(Al),{matches:o}=p.useContext(jI),{pathname:A}=Ns(),i=SC(),s=Su(g,Vu(o,l.v7_relativeSplatPath),A,t==="path"),c=JSON.stringify(s);return p.useEffect(()=>i(JSON.parse(c),{replace:C,state:e,relative:t}),[i,c,t,C,e]),null}function k0(I){return u0(I.context)}function x(I){Zg(!1)}function f0(I){let{basename:g="/",children:C=null,location:e,navigationType:t=tC.Pop,navigator:l,static:n=!1,future:o}=I;il()&&Zg(!1);let A=g.replace(/^\/*/,"/"),i=p.useMemo(()=>({basename:A,navigator:l,static:n,future:Tt({v7_relativeSplatPath:!1},o)}),[A,o,l,n]);typeof e=="string"&&(e=Qe(e));let{pathname:s="/",search:c="",hash:a="",state:r=null,key:m="default"}=e,b=p.useMemo(()=>{let G=Wu(s,A);return G==null?null:{location:{pathname:G,search:c,hash:a,state:r,key:m},navigationType:t}},[A,s,c,a,r,m,t]);return b==null?null:p.createElement(Al.Provider,{value:i},p.createElement(mo.Provider,{children:C,value:b}))}function Ue(I){let{children:g,location:C}=I;return b0(hi(g),C)}new Promise(()=>{});function hi(I,g){g===void 0&&(g=[]);let C=[];return p.Children.forEach(I,(e,t)=>{if(!p.isValidElement(e))return;let l=[...g,t];if(e.type===p.Fragment){C.push.apply(C,hi(e.props.children,l));return}e.type!==x&&Zg(!1),!e.props.index||!e.props.children||Zg(!1);let n={id:e.props.id||l.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:e.props.ErrorBoundary!=null||e.props.errorElement!=null,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(n.children=hi(e.props.children,l)),C.push(n)}),C}/**
 * React Router DOM v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Y0="6";try{window.__reactRouterVersion=Y0}catch{}const H0="startTransition",ya=Vb[H0];function v0(I){let{basename:g,children:C,future:e,window:t}=I,l=p.useRef();l.current==null&&(l.current=EG({window:t,v5Compat:!0}));let n=l.current,[o,A]=p.useState({action:n.action,location:n.location}),{v7_startTransition:i}=e||{},s=p.useCallback(c=>{i&&ya?ya(()=>A(c)):A(c)},[A,i]);return p.useLayoutEffect(()=>n.listen(s),[n,s]),p.createElement(f0,{basename:g,children:C,location:o.location,navigationType:o.action,navigator:n,future:e})}var pa;(function(I){I.UseScrollRestoration="useScrollRestoration",I.UseSubmit="useSubmit",I.UseSubmitFetcher="useSubmitFetcher",I.UseFetcher="useFetcher",I.useViewTransitionState="useViewTransitionState"})(pa||(pa={}));var Wa;(function(I){I.UseFetcher="useFetcher",I.UseFetchers="useFetchers",I.UseScrollRestoration="useScrollRestoration"})(Wa||(Wa={}));const It=({canActivate:I,requiredRole:g})=>{const C=I,e=localStorage.getItem("role");return C?e!=g?d.jsx(OC,{to:"/"}):d.jsx(k0,{}):d.jsx(OC,{to:"/"})},N0="/assets/google-KGMh1rWy.svg",F0="/assets/Logo-DN3Dznic.png",K0=()=>{const I=SC(),{setUser:g}=p.useContext(Qi),C=o=>{localStorage.setItem("access_token",o)},e=o=>{switch(o){case 1:return"/admon";case 2:return"/resident";case 3:return"/normal";case 4:return"/visits";case 5:return"/security";default:return"/"}},t=Nb({onSuccess:async o=>{C(o.access_token);const A=await l(o.access_token);g(A);const i=await n(),s=e(i);I(s)},onError:o=>console.log("Fallo al iniciar sesion",o)}),l=async o=>{const i=await(await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${o}`}})).json();return{name:i.name,email:i.email,id:i.sub,address:"Casa N°12"}},n=async o=>(localStorage.setItem("role",3),3);return d.jsxs("div",{className:"flex items-center justify-center h-screen flex-col lg:flex-row",children:[d.jsxs("div",{className:"flex flex-col items-center justify-center w-1/2 mx-auto text-center",children:[d.jsx("h1",{className:"font-bold text-5xl m-4",children:"Bienvenido"}),d.jsx("img",{src:F0,className:"w-auto h-auto",alt:"Logo de la compañia"}),d.jsx("h2",{className:"lg:text-2xl text-base m-4",children:"Acceso protegido: tu seguridad, nuestra prioridad"})]}),d.jsxs("div",{className:"flex flex-col items-center justify-center w-1/2 lg:h-screen px-4 bg-blue-900 rounded-lg relative p-6",children:[d.jsx("p",{className:"text-white m-4 text-center",children:"Ingresar al sistema"}),d.jsxs("button",{className:"bg-white text-blue rounded-md py-2 px-4 flex items-center space-x-2",onClick:()=>t(),children:[d.jsx("img",{src:N0,alt:"Google icon",className:"h-6 w-6"}),d.jsx("span",{children:"Sign in with Google"})]})]})]})},w0=({columnas:I,datos:g,handleEliminar:C})=>d.jsxs("div",{className:"w-full h-full mt-6 mr-6 ml-auto pl-5 pr-5",children:[d.jsx("div",{className:"m-6 flex justify-center"}),d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"min-w-full divide-y border-separate border-spacing-0.5 border border-gray-500",children:[d.jsx("thead",{children:d.jsxs("tr",{className:"bg-[#F8BD0D] bg-opacity-70 font-semibold font-roboto_mono",children:[I.map(e=>d.jsx("th",{className:"px-4 py-2 text-center border border-gray-500",children:e.Header},e.accessor)),d.jsx("th",{className:"px-4 py-2 text-center border border-gray-500",children:"Acciones"})]})}),d.jsx("tbody",{className:"text-center  bg-gray-100 border-stone-500 font-roboto_mono",children:g.map((e,t)=>d.jsxs("tr",{className:"hover:bg-gray-100 border-black",children:[I.map(l=>d.jsx("td",{className:"border px-4 py-2 border-gray-500",children:e[l.accessor]},l.accessor)),d.jsx("td",{className:"border px-4 py-2 border-gray-500",children:d.jsx("button",{onClick:()=>C(e.id),className:"bg-red-300 py-1 px-3 rounded-md font-roboto_mono",children:"Eliminar"})})]},t))})]})})]}),x0=()=>{const[I,g]=p.useState([{id:1,nombre:"Ilcia",apellido:"Huezo",correo:"hola@gamil.com",documento:"00295333-2"},{id:2,nombre:"Ilcia",apellido:"Huezo",correo:"hola@gamil.com",documento:"00295333-2"}]),[C,e]=p.useState(""),t=()=>{C?(g([...I,{id:I.length+1,nombre:"Nuevo",apellido:"Vigilante",correo:C,documento:"--------"}]),e("")):alert("Por favor, ingrese un correo electrónico.")},l=o=>{g(I.filter(A=>A.id!==o))},n=[{Header:"Nombre",accessor:"nombre"},{Header:"Apellido",accessor:"apellido"},{Header:"Correo electrónico",accessor:"correo"},{Header:"Documento",accessor:"documento"}];return d.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4",children:[d.jsx("h1",{className:"text-2xl font-bold text-center text-azul-principal m-3 font-roboto_mono",children:"Agregar Vigilante"}),d.jsxs("div",{className:"flex flex-col mt-2 w-[150px] sm:w-[332px]",children:[d.jsx("label",{htmlFor:"email",className:"text-base m-2 font-roboto_mono",children:"Correo electrónico:"}),d.jsx("input",{type:"text",id:"email",placeholder:"Ingrese el correo electrónico",className:"border border-gray-300 p-2 rounded-md",value:C,onChange:o=>e(o.target.value)}),d.jsx("button",{className:"bg-amarillo-principal text-black m-2 w-20 py-2 rounded-md font-roboto_mono",onClick:t,children:"Agregar"})]}),d.jsx("h1",{className:"text-2xl font-bold text-center text-azul-principal m-3 font-roboto_mono mt-5 mb-1",children:"Lista de vigilantes"}),d.jsx(w0,{columnas:n,datos:I,handleEliminar:l})]})},z0=({data:I})=>{const g=["Casa","Correo_electronico","Documento","Motivo","Fecha","Hora"];return d.jsx("div",{className:"overflow-x-auto w-full max-w-4xl",children:d.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[d.jsx("thead",{children:d.jsx("tr",{className:"bg-amarillo-principal",children:g.map(C=>d.jsx("th",{className:"px-4 py-2 text-left text-xs font-roboto_mono font-medium text-gray-900 uppercase tracking-wider",children:C},C))})}),d.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:I.map((C,e)=>d.jsxs("tr",{children:[d.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-roboto_mono",children:C.Casa}),d.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-roboto_mono",children:C.Correo_electronico}),d.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-roboto_mono",children:C.Documento}),d.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-roboto_mono",children:C.Motivo}),d.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-roboto_mono",children:C.Fecha}),d.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-roboto_mono",children:C.Hora})]},e))})]})})},M0=({filterResults:I})=>{const[g,C]=p.useState(!1),[e,t]=p.useState(""),l=()=>{C(!g)},n=A=>{I(A,e),C(!1)},o=[{id:"all",label:"Mostrar todas las entradas"},{id:"casa",label:"Filtrar por casa"},{id:"motivo",label:"Filtrar por motivo"},{id:"fecha",label:"Filtrar por fecha"}];return d.jsxs("div",{className:"relative",children:[d.jsx("button",{type:"button",className:"bg-amarillo-principal text-black py-1 px-4 rounded-md text-sm font-roboto_mono",onClick:l,children:"Filtrar resultados"}),g&&d.jsx("div",{className:"absolute right-0 mt-2 w-56 origin-top-right bg-white divide-y divide-gray-100 rounded-md shadow-lg",children:d.jsxs("div",{className:"py-1",children:[o.map(A=>d.jsx("button",{onClick:()=>n(A.id),className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:A.label},A.id)),d.jsxs("div",{className:"block px-4 py-2 text-sm text-gray-700",children:[d.jsx("label",{htmlFor:"filter-date",className:"block text-sm font-medium text-gray-700",children:"Selecciona fecha:"}),d.jsx("input",{type:"date",id:"filter-date",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:e,onChange:A=>t(A.target.value)})]})]})})]})};/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function sl(I){return I+.5|0}const lC=(I,g,C)=>Math.max(Math.min(I,C),g);function at(I){return lC(sl(I*2.55),0,255)}function ZC(I){return lC(sl(I*255),0,255)}function xI(I){return lC(sl(I/2.55)/100,0,1)}function Va(I){return lC(sl(I*100),0,100)}const lI={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Gi=[..."0123456789ABCDEF"],E0=I=>Gi[I&15],Q0=I=>Gi[(I&240)>>4]+Gi[I&15],Hl=I=>(I&240)>>4===(I&15),U0=I=>Hl(I.r)&&Hl(I.g)&&Hl(I.b)&&Hl(I.a);function L0(I){var g=I.length,C;return I[0]==="#"&&(g===4||g===5?C={r:255&lI[I[1]]*17,g:255&lI[I[2]]*17,b:255&lI[I[3]]*17,a:g===5?lI[I[4]]*17:255}:(g===7||g===9)&&(C={r:lI[I[1]]<<4|lI[I[2]],g:lI[I[3]]<<4|lI[I[4]],b:lI[I[5]]<<4|lI[I[6]],a:g===9?lI[I[7]]<<4|lI[I[8]]:255})),C}const D0=(I,g)=>I<255?g(I):"";function T0(I){var g=U0(I)?E0:Q0;return I?"#"+g(I.r)+g(I.g)+g(I.b)+D0(I.a,g):void 0}const j0=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Yu(I,g,C){const e=g*Math.min(C,1-C),t=(l,n=(l+I/30)%12)=>C-e*Math.max(Math.min(n-3,9-n,1),-1);return[t(0),t(8),t(4)]}function P0(I,g,C){const e=(t,l=(t+I/60)%6)=>C-C*g*Math.max(Math.min(l,4-l,1),0);return[e(5),e(3),e(1)]}function O0(I,g,C){const e=Yu(I,1,.5);let t;for(g+C>1&&(t=1/(g+C),g*=t,C*=t),t=0;t<3;t++)e[t]*=1-g-C,e[t]+=g;return e}function _0(I,g,C,e,t){return I===t?(g-C)/e+(g<C?6:0):g===t?(C-I)/e+2:(I-g)/e+4}function Fs(I){const C=I.r/255,e=I.g/255,t=I.b/255,l=Math.max(C,e,t),n=Math.min(C,e,t),o=(l+n)/2;let A,i,s;return l!==n&&(s=l-n,i=o>.5?s/(2-l-n):s/(l+n),A=_0(C,e,t,s,l),A=A*60+.5),[A|0,i||0,o]}function Ks(I,g,C,e){return(Array.isArray(g)?I(g[0],g[1],g[2]):I(g,C,e)).map(ZC)}function ws(I,g,C){return Ks(Yu,I,g,C)}function q0(I,g,C){return Ks(O0,I,g,C)}function $0(I,g,C){return Ks(P0,I,g,C)}function Hu(I){return(I%360+360)%360}function gB(I){const g=j0.exec(I);let C=255,e;if(!g)return;g[5]!==e&&(C=g[6]?at(+g[5]):ZC(+g[5]));const t=Hu(+g[2]),l=+g[3]/100,n=+g[4]/100;return g[1]==="hwb"?e=q0(t,l,n):g[1]==="hsv"?e=$0(t,l,n):e=ws(t,l,n),{r:e[0],g:e[1],b:e[2],a:C}}function IB(I,g){var C=Fs(I);C[0]=Hu(C[0]+g),C=ws(C),I.r=C[0],I.g=C[1],I.b=C[2]}function CB(I){if(!I)return;const g=Fs(I),C=g[0],e=Va(g[1]),t=Va(g[2]);return I.a<255?`hsla(${C}, ${e}%, ${t}%, ${xI(I.a)})`:`hsl(${C}, ${e}%, ${t}%)`}const Sa={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ra={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function eB(){const I={},g=Object.keys(Ra),C=Object.keys(Sa);let e,t,l,n,o;for(e=0;e<g.length;e++){for(n=o=g[e],t=0;t<C.length;t++)l=C[t],o=o.replace(l,Sa[l]);l=parseInt(Ra[n],16),I[o]=[l>>16&255,l>>8&255,l&255]}return I}let vl;function tB(I){vl||(vl=eB(),vl.transparent=[0,0,0,0]);const g=vl[I.toLowerCase()];return g&&{r:g[0],g:g[1],b:g[2],a:g.length===4?g[3]:255}}const lB=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function nB(I){const g=lB.exec(I);let C=255,e,t,l;if(g){if(g[7]!==e){const n=+g[7];C=g[8]?at(n):lC(n*255,0,255)}return e=+g[1],t=+g[3],l=+g[5],e=255&(g[2]?at(e):lC(e,0,255)),t=255&(g[4]?at(t):lC(t,0,255)),l=255&(g[6]?at(l):lC(l,0,255)),{r:e,g:t,b:l,a:C}}}function oB(I){return I&&(I.a<255?`rgba(${I.r}, ${I.g}, ${I.b}, ${xI(I.a)})`:`rgb(${I.r}, ${I.g}, ${I.b})`)}const sA=I=>I<=.0031308?I*12.92:Math.pow(I,1/2.4)*1.055-.055,ne=I=>I<=.04045?I/12.92:Math.pow((I+.055)/1.055,2.4);function AB(I,g,C){const e=ne(xI(I.r)),t=ne(xI(I.g)),l=ne(xI(I.b));return{r:ZC(sA(e+C*(ne(xI(g.r))-e))),g:ZC(sA(t+C*(ne(xI(g.g))-t))),b:ZC(sA(l+C*(ne(xI(g.b))-l))),a:I.a+C*(g.a-I.a)}}function Nl(I,g,C){if(I){let e=Fs(I);e[g]=Math.max(0,Math.min(e[g]+e[g]*C,g===0?360:1)),e=ws(e),I.r=e[0],I.g=e[1],I.b=e[2]}}function vu(I,g){return I&&Object.assign(g||{},I)}function Xa(I){var g={r:0,g:0,b:0,a:255};return Array.isArray(I)?I.length>=3&&(g={r:I[0],g:I[1],b:I[2],a:255},I.length>3&&(g.a=ZC(I[3]))):(g=vu(I,{r:0,g:0,b:0,a:1}),g.a=ZC(g.a)),g}function iB(I){return I.charAt(0)==="r"?nB(I):gB(I)}class jt{constructor(g){if(g instanceof jt)return g;const C=typeof g;let e;C==="object"?e=Xa(g):C==="string"&&(e=L0(g)||tB(g)||iB(g)),this._rgb=e,this._valid=!!e}get valid(){return this._valid}get rgb(){var g=vu(this._rgb);return g&&(g.a=xI(g.a)),g}set rgb(g){this._rgb=Xa(g)}rgbString(){return this._valid?oB(this._rgb):void 0}hexString(){return this._valid?T0(this._rgb):void 0}hslString(){return this._valid?CB(this._rgb):void 0}mix(g,C){if(g){const e=this.rgb,t=g.rgb;let l;const n=C===l?.5:C,o=2*n-1,A=e.a-t.a,i=((o*A===-1?o:(o+A)/(1+o*A))+1)/2;l=1-i,e.r=255&i*e.r+l*t.r+.5,e.g=255&i*e.g+l*t.g+.5,e.b=255&i*e.b+l*t.b+.5,e.a=n*e.a+(1-n)*t.a,this.rgb=e}return this}interpolate(g,C){return g&&(this._rgb=AB(this._rgb,g._rgb,C)),this}clone(){return new jt(this.rgb)}alpha(g){return this._rgb.a=ZC(g),this}clearer(g){const C=this._rgb;return C.a*=1-g,this}greyscale(){const g=this._rgb,C=sl(g.r*.3+g.g*.59+g.b*.11);return g.r=g.g=g.b=C,this}opaquer(g){const C=this._rgb;return C.a*=1+g,this}negate(){const g=this._rgb;return g.r=255-g.r,g.g=255-g.g,g.b=255-g.b,this}lighten(g){return Nl(this._rgb,2,g),this}darken(g){return Nl(this._rgb,2,-g),this}saturate(g){return Nl(this._rgb,1,g),this}desaturate(g){return Nl(this._rgb,1,-g),this}rotate(g){return IB(this._rgb,g),this}}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function vI(){}const sB=(()=>{let I=0;return()=>I++})();function P(I){return I===null||typeof I>"u"}function sg(I){if(Array.isArray&&Array.isArray(I))return!0;const g=Object.prototype.toString.call(I);return g.slice(0,7)==="[object"&&g.slice(-6)==="Array]"}function E(I){return I!==null&&Object.prototype.toString.call(I)==="[object Object]"}function yg(I){return(typeof I=="number"||I instanceof Number)&&isFinite(+I)}function _g(I,g){return yg(I)?I:g}function U(I,g){return typeof I>"u"?g:I}const cB=(I,g)=>typeof I=="string"&&I.endsWith("%")?parseFloat(I)/100:+I/g,Nu=(I,g)=>typeof I=="string"&&I.endsWith("%")?parseFloat(I)/100*g:+I;function q(I,g,C){if(I&&typeof I.call=="function")return I.apply(C,g)}function L(I,g,C,e){let t,l,n;if(sg(I))for(l=I.length,t=0;t<l;t++)g.call(C,I[t],t);else if(E(I))for(n=Object.keys(I),l=n.length,t=0;t<l;t++)g.call(C,I[n[t]],n[t])}function wn(I,g){let C,e,t,l;if(!I||!g||I.length!==g.length)return!1;for(C=0,e=I.length;C<e;++C)if(t=I[C],l=g[C],t.datasetIndex!==l.datasetIndex||t.index!==l.index)return!1;return!0}function xn(I){if(sg(I))return I.map(xn);if(E(I)){const g=Object.create(null),C=Object.keys(I),e=C.length;let t=0;for(;t<e;++t)g[C[t]]=xn(I[C[t]]);return g}return I}function Fu(I){return["__proto__","prototype","constructor"].indexOf(I)===-1}function aB(I,g,C,e){if(!Fu(I))return;const t=g[I],l=C[I];E(t)&&E(l)?Pt(t,l,e):g[I]=xn(l)}function Pt(I,g,C){const e=sg(g)?g:[g],t=e.length;if(!E(I))return I;C=C||{};const l=C.merger||aB;let n;for(let o=0;o<t;++o){if(n=e[o],!E(n))continue;const A=Object.keys(n);for(let i=0,s=A.length;i<s;++i)l(A[i],I,n,C)}return I}function St(I,g){return Pt(I,g,{merger:dB})}function dB(I,g,C){if(!Fu(I))return;const e=g[I],t=C[I];E(e)&&E(t)?St(e,t):Object.prototype.hasOwnProperty.call(g,I)||(g[I]=xn(t))}const Ja={"":I=>I,x:I=>I.x,y:I=>I.y};function rB(I){const g=I.split("."),C=[];let e="";for(const t of g)e+=t,e.endsWith("\\")?e=e.slice(0,-1)+".":(C.push(e),e="");return C}function mB(I){const g=rB(I);return C=>{for(const e of g){if(e==="")break;C=C&&C[e]}return C}}function _C(I,g){return(Ja[g]||(Ja[g]=mB(g)))(I)}function xs(I){return I.charAt(0).toUpperCase()+I.slice(1)}const Ot=I=>typeof I<"u",BC=I=>typeof I=="function",ka=(I,g)=>{if(I.size!==g.size)return!1;for(const C of I)if(!g.has(C))return!1;return!0};function uB(I){return I.type==="mouseup"||I.type==="click"||I.type==="contextmenu"}const bg=Math.PI,cg=2*bg,zn=Number.POSITIVE_INFINITY,ZB=bg/180,rg=bg/2,XC=bg/4,fa=bg*2/3,nC=Math.log10,bC=Math.sign;function ln(I,g,C){return Math.abs(I-g)<C}function Ya(I){const g=Math.round(I);I=ln(I,g,I/1e3)?g:I;const C=Math.pow(10,Math.floor(nC(I))),e=I/C;return(e<=1?1:e<=2?2:e<=5?5:10)*C}function bB(I){const g=[],C=Math.sqrt(I);let e;for(e=1;e<C;e++)I%e===0&&(g.push(e),g.push(I/e));return C===(C|0)&&g.push(C),g.sort((t,l)=>t-l).pop(),g}function Mn(I){return!isNaN(parseFloat(I))&&isFinite(I)}function hB(I,g){const C=Math.round(I);return C-g<=I&&C+g>=I}function Ku(I,g,C){let e,t,l;for(e=0,t=I.length;e<t;e++)l=I[e][C],isNaN(l)||(g.min=Math.min(g.min,l),g.max=Math.max(g.max,l))}function kI(I){return I*(bg/180)}function zs(I){return I*(180/bg)}function Ha(I){if(!yg(I))return;let g=1,C=0;for(;Math.round(I*g)/g!==I;)g*=10,C++;return C}function wu(I,g){const C=g.x-I.x,e=g.y-I.y,t=Math.sqrt(C*C+e*e);let l=Math.atan2(e,C);return l<-.5*bg&&(l+=cg),{angle:l,distance:t}}function GB(I,g){return Math.sqrt(Math.pow(g.x-I.x,2)+Math.pow(g.y-I.y,2))}function XI(I){return(I%cg+cg)%cg}function En(I,g,C,e){const t=XI(I),l=XI(g),n=XI(C),o=XI(l-t),A=XI(n-t),i=XI(t-l),s=XI(t-n);return t===l||t===n||e&&l===n||o>A&&i<s}function Lg(I,g,C){return Math.max(g,Math.min(C,I))}function BB(I){return Lg(I,-32768,32767)}function wC(I,g,C,e=1e-6){return I>=Math.min(g,C)-e&&I<=Math.max(g,C)+e}function Ms(I,g,C){C=C||(n=>I[n]<g);let e=I.length-1,t=0,l;for(;e-t>1;)l=t+e>>1,C(l)?t=l:e=l;return{lo:t,hi:e}}const Bi=(I,g,C,e)=>Ms(I,C,e?t=>{const l=I[t][g];return l<C||l===C&&I[t+1][g]===C}:t=>I[t][g]<C),yB=(I,g,C)=>Ms(I,C,e=>I[e][g]>=C);function pB(I,g,C){let e=0,t=I.length;for(;e<t&&I[e]<g;)e++;for(;t>e&&I[t-1]>C;)t--;return e>0||t<I.length?I.slice(e,t):I}const xu=["push","pop","shift","splice","unshift"];function WB(I,g){if(I._chartjs){I._chartjs.listeners.push(g);return}Object.defineProperty(I,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[g]}}),xu.forEach(C=>{const e="_onData"+xs(C),t=I[C];Object.defineProperty(I,C,{configurable:!0,enumerable:!1,value(...l){const n=t.apply(this,l);return I._chartjs.listeners.forEach(o=>{typeof o[e]=="function"&&o[e](...l)}),n}})})}function va(I,g){const C=I._chartjs;if(!C)return;const e=C.listeners,t=e.indexOf(g);t!==-1&&e.splice(t,1),!(e.length>0)&&(xu.forEach(l=>{delete I[l]}),delete I._chartjs)}function zu(I){const g=new Set(I);return g.size===I.length?I:Array.from(g)}const Mu=function(){return typeof window>"u"?function(I){return I()}:window.requestAnimationFrame}();function Eu(I,g){let C=[],e=!1;return function(...t){C=t,e||(e=!0,Mu.call(window,()=>{e=!1,I.apply(g,C)}))}}function VB(I,g){let C;return function(...e){return g?(clearTimeout(C),C=setTimeout(I,g,e)):I.apply(this,e),g}}const Qu=I=>I==="start"?"left":I==="end"?"right":"center",Og=(I,g,C)=>I==="start"?g:I==="end"?C:(g+C)/2,SB=(I,g,C,e)=>I===(e?"left":"right")?C:I==="center"?(g+C)/2:g,Fl=I=>I===0||I===1,Na=(I,g,C)=>-(Math.pow(2,10*(I-=1))*Math.sin((I-g)*cg/C)),Fa=(I,g,C)=>Math.pow(2,-10*I)*Math.sin((I-g)*cg/C)+1,Rt={linear:I=>I,easeInQuad:I=>I*I,easeOutQuad:I=>-I*(I-2),easeInOutQuad:I=>(I/=.5)<1?.5*I*I:-.5*(--I*(I-2)-1),easeInCubic:I=>I*I*I,easeOutCubic:I=>(I-=1)*I*I+1,easeInOutCubic:I=>(I/=.5)<1?.5*I*I*I:.5*((I-=2)*I*I+2),easeInQuart:I=>I*I*I*I,easeOutQuart:I=>-((I-=1)*I*I*I-1),easeInOutQuart:I=>(I/=.5)<1?.5*I*I*I*I:-.5*((I-=2)*I*I*I-2),easeInQuint:I=>I*I*I*I*I,easeOutQuint:I=>(I-=1)*I*I*I*I+1,easeInOutQuint:I=>(I/=.5)<1?.5*I*I*I*I*I:.5*((I-=2)*I*I*I*I+2),easeInSine:I=>-Math.cos(I*rg)+1,easeOutSine:I=>Math.sin(I*rg),easeInOutSine:I=>-.5*(Math.cos(bg*I)-1),easeInExpo:I=>I===0?0:Math.pow(2,10*(I-1)),easeOutExpo:I=>I===1?1:-Math.pow(2,-10*I)+1,easeInOutExpo:I=>Fl(I)?I:I<.5?.5*Math.pow(2,10*(I*2-1)):.5*(-Math.pow(2,-10*(I*2-1))+2),easeInCirc:I=>I>=1?I:-(Math.sqrt(1-I*I)-1),easeOutCirc:I=>Math.sqrt(1-(I-=1)*I),easeInOutCirc:I=>(I/=.5)<1?-.5*(Math.sqrt(1-I*I)-1):.5*(Math.sqrt(1-(I-=2)*I)+1),easeInElastic:I=>Fl(I)?I:Na(I,.075,.3),easeOutElastic:I=>Fl(I)?I:Fa(I,.075,.3),easeInOutElastic(I){return Fl(I)?I:I<.5?.5*Na(I*2,.1125,.45):.5+.5*Fa(I*2-1,.1125,.45)},easeInBack(I){return I*I*((1.70158+1)*I-1.70158)},easeOutBack(I){return(I-=1)*I*((1.70158+1)*I+1.70158)+1},easeInOutBack(I){let g=1.70158;return(I/=.5)<1?.5*(I*I*(((g*=1.525)+1)*I-g)):.5*((I-=2)*I*(((g*=1.525)+1)*I+g)+2)},easeInBounce:I=>1-Rt.easeOutBounce(1-I),easeOutBounce(I){return I<1/2.75?7.5625*I*I:I<2/2.75?7.5625*(I-=1.5/2.75)*I+.75:I<2.5/2.75?7.5625*(I-=2.25/2.75)*I+.9375:7.5625*(I-=2.625/2.75)*I+.984375},easeInOutBounce:I=>I<.5?Rt.easeInBounce(I*2)*.5:Rt.easeOutBounce(I*2-1)*.5+.5};function Uu(I){if(I&&typeof I=="object"){const g=I.toString();return g==="[object CanvasPattern]"||g==="[object CanvasGradient]"}return!1}function Ka(I){return Uu(I)?I:new jt(I)}function cA(I){return Uu(I)?I:new jt(I).saturate(.5).darken(.1).hexString()}const RB=["x","y","borderWidth","radius","tension"],XB=["color","borderColor","backgroundColor"];function JB(I){I.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),I.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:g=>g!=="onProgress"&&g!=="onComplete"&&g!=="fn"}),I.set("animations",{colors:{type:"color",properties:XB},numbers:{type:"number",properties:RB}}),I.describe("animations",{_fallback:"animation"}),I.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:g=>g|0}}}})}function kB(I){I.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const wa=new Map;function fB(I,g){g=g||{};const C=I+JSON.stringify(g);let e=wa.get(C);return e||(e=new Intl.NumberFormat(I,g),wa.set(C,e)),e}function uo(I,g,C){return fB(g,C).format(I)}const Lu={values(I){return sg(I)?I:""+I},numeric(I,g,C){if(I===0)return"0";const e=this.chart.options.locale;let t,l=I;if(C.length>1){const i=Math.max(Math.abs(C[0].value),Math.abs(C[C.length-1].value));(i<1e-4||i>1e15)&&(t="scientific"),l=YB(I,C)}const n=nC(Math.abs(l)),o=isNaN(n)?1:Math.max(Math.min(-1*Math.floor(n),20),0),A={notation:t,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(A,this.options.ticks.format),uo(I,e,A)},logarithmic(I,g,C){if(I===0)return"0";const e=C[g].significand||I/Math.pow(10,Math.floor(nC(I)));return[1,2,3,5,10,15].includes(e)||g>.8*C.length?Lu.numeric.call(this,I,g,C):""}};function YB(I,g){let C=g.length>3?g[2].value-g[1].value:g[1].value-g[0].value;return Math.abs(C)>=1&&I!==Math.floor(I)&&(C=I-Math.floor(I)),C}var Zo={formatters:Lu};function HB(I){I.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(g,C)=>C.lineWidth,tickColor:(g,C)=>C.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Zo.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),I.route("scale.ticks","color","","color"),I.route("scale.grid","color","","borderColor"),I.route("scale.border","color","","borderColor"),I.route("scale.title","color","","color"),I.describe("scale",{_fallback:!1,_scriptable:g=>!g.startsWith("before")&&!g.startsWith("after")&&g!=="callback"&&g!=="parser",_indexable:g=>g!=="borderDash"&&g!=="tickBorderDash"&&g!=="dash"}),I.describe("scales",{_fallback:"scale"}),I.describe("scale.ticks",{_scriptable:g=>g!=="backdropPadding"&&g!=="callback",_indexable:g=>g!=="backdropPadding"})}const qC=Object.create(null),yi=Object.create(null);function Xt(I,g){if(!g)return I;const C=g.split(".");for(let e=0,t=C.length;e<t;++e){const l=C[e];I=I[l]||(I[l]=Object.create(null))}return I}function aA(I,g,C){return typeof g=="string"?Pt(Xt(I,g),C):Pt(Xt(I,""),g)}class vB{constructor(g,C){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>cA(t.backgroundColor),this.hoverBorderColor=(e,t)=>cA(t.borderColor),this.hoverColor=(e,t)=>cA(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(g),this.apply(C)}set(g,C){return aA(this,g,C)}get(g){return Xt(this,g)}describe(g,C){return aA(yi,g,C)}override(g,C){return aA(qC,g,C)}route(g,C,e,t){const l=Xt(this,g),n=Xt(this,e),o="_"+C;Object.defineProperties(l,{[o]:{value:l[C],writable:!0},[C]:{enumerable:!0,get(){const A=this[o],i=n[t];return E(A)?Object.assign({},i,A):U(A,i)},set(A){this[o]=A}}})}apply(g){g.forEach(C=>C(this))}}var ag=new vB({_scriptable:I=>!I.startsWith("on"),_indexable:I=>I!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[JB,kB,HB]);function NB(I){return!I||P(I.size)||P(I.family)?null:(I.style?I.style+" ":"")+(I.weight?I.weight+" ":"")+I.size+"px "+I.family}function Qn(I,g,C,e,t){let l=g[t];return l||(l=g[t]=I.measureText(t).width,C.push(t)),l>e&&(e=l),e}function FB(I,g,C,e){e=e||{};let t=e.data=e.data||{},l=e.garbageCollect=e.garbageCollect||[];e.font!==g&&(t=e.data={},l=e.garbageCollect=[],e.font=g),I.save(),I.font=g;let n=0;const o=C.length;let A,i,s,c,a;for(A=0;A<o;A++)if(c=C[A],c!=null&&!sg(c))n=Qn(I,t,l,n,c);else if(sg(c))for(i=0,s=c.length;i<s;i++)a=c[i],a!=null&&!sg(a)&&(n=Qn(I,t,l,n,a));I.restore();const r=l.length/2;if(r>C.length){for(A=0;A<r;A++)delete t[l[A]];l.splice(0,r)}return n}function JC(I,g,C){const e=I.currentDevicePixelRatio,t=C!==0?Math.max(C/2,.5):0;return Math.round((g-t)*e)/e+t}function xa(I,g){!g&&!I||(g=g||I.getContext("2d"),g.save(),g.resetTransform(),g.clearRect(0,0,I.width,I.height),g.restore())}function za(I,g,C,e){Du(I,g,C,e,null)}function Du(I,g,C,e,t){let l,n,o,A,i,s,c,a;const r=g.pointStyle,m=g.rotation,b=g.radius;let G=(m||0)*ZB;if(r&&typeof r=="object"&&(l=r.toString(),l==="[object HTMLImageElement]"||l==="[object HTMLCanvasElement]")){I.save(),I.translate(C,e),I.rotate(G),I.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),I.restore();return}if(!(isNaN(b)||b<=0)){switch(I.beginPath(),r){default:t?I.ellipse(C,e,t/2,b,0,0,cg):I.arc(C,e,b,0,cg),I.closePath();break;case"triangle":s=t?t/2:b,I.moveTo(C+Math.sin(G)*s,e-Math.cos(G)*b),G+=fa,I.lineTo(C+Math.sin(G)*s,e-Math.cos(G)*b),G+=fa,I.lineTo(C+Math.sin(G)*s,e-Math.cos(G)*b),I.closePath();break;case"rectRounded":i=b*.516,A=b-i,n=Math.cos(G+XC)*A,c=Math.cos(G+XC)*(t?t/2-i:A),o=Math.sin(G+XC)*A,a=Math.sin(G+XC)*(t?t/2-i:A),I.arc(C-c,e-o,i,G-bg,G-rg),I.arc(C+a,e-n,i,G-rg,G),I.arc(C+c,e+o,i,G,G+rg),I.arc(C-a,e+n,i,G+rg,G+bg),I.closePath();break;case"rect":if(!m){A=Math.SQRT1_2*b,s=t?t/2:A,I.rect(C-s,e-A,2*s,2*A);break}G+=XC;case"rectRot":c=Math.cos(G)*(t?t/2:b),n=Math.cos(G)*b,o=Math.sin(G)*b,a=Math.sin(G)*(t?t/2:b),I.moveTo(C-c,e-o),I.lineTo(C+a,e-n),I.lineTo(C+c,e+o),I.lineTo(C-a,e+n),I.closePath();break;case"crossRot":G+=XC;case"cross":c=Math.cos(G)*(t?t/2:b),n=Math.cos(G)*b,o=Math.sin(G)*b,a=Math.sin(G)*(t?t/2:b),I.moveTo(C-c,e-o),I.lineTo(C+c,e+o),I.moveTo(C+a,e-n),I.lineTo(C-a,e+n);break;case"star":c=Math.cos(G)*(t?t/2:b),n=Math.cos(G)*b,o=Math.sin(G)*b,a=Math.sin(G)*(t?t/2:b),I.moveTo(C-c,e-o),I.lineTo(C+c,e+o),I.moveTo(C+a,e-n),I.lineTo(C-a,e+n),G+=XC,c=Math.cos(G)*(t?t/2:b),n=Math.cos(G)*b,o=Math.sin(G)*b,a=Math.sin(G)*(t?t/2:b),I.moveTo(C-c,e-o),I.lineTo(C+c,e+o),I.moveTo(C+a,e-n),I.lineTo(C-a,e+n);break;case"line":n=t?t/2:Math.cos(G)*b,o=Math.sin(G)*b,I.moveTo(C-n,e-o),I.lineTo(C+n,e+o);break;case"dash":I.moveTo(C,e),I.lineTo(C+Math.cos(G)*(t?t/2:b),e+Math.sin(G)*b);break;case!1:I.closePath();break}I.fill(),g.borderWidth>0&&I.stroke()}}function Be(I,g,C){return C=C||.5,!g||I&&I.x>g.left-C&&I.x<g.right+C&&I.y>g.top-C&&I.y<g.bottom+C}function Es(I,g){I.save(),I.beginPath(),I.rect(g.left,g.top,g.right-g.left,g.bottom-g.top),I.clip()}function Qs(I){I.restore()}function KB(I,g){g.translation&&I.translate(g.translation[0],g.translation[1]),P(g.rotation)||I.rotate(g.rotation),g.color&&(I.fillStyle=g.color),g.textAlign&&(I.textAlign=g.textAlign),g.textBaseline&&(I.textBaseline=g.textBaseline)}function wB(I,g,C,e,t){if(t.strikethrough||t.underline){const l=I.measureText(e),n=g-l.actualBoundingBoxLeft,o=g+l.actualBoundingBoxRight,A=C-l.actualBoundingBoxAscent,i=C+l.actualBoundingBoxDescent,s=t.strikethrough?(A+i)/2:i;I.strokeStyle=I.fillStyle,I.beginPath(),I.lineWidth=t.decorationWidth||2,I.moveTo(n,s),I.lineTo(o,s),I.stroke()}}function xB(I,g){const C=I.fillStyle;I.fillStyle=g.color,I.fillRect(g.left,g.top,g.width,g.height),I.fillStyle=C}function we(I,g,C,e,t,l={}){const n=sg(g)?g:[g],o=l.strokeWidth>0&&l.strokeColor!=="";let A,i;for(I.save(),I.font=t.string,KB(I,l),A=0;A<n.length;++A)i=n[A],l.backdrop&&xB(I,l.backdrop),o&&(l.strokeColor&&(I.strokeStyle=l.strokeColor),P(l.strokeWidth)||(I.lineWidth=l.strokeWidth),I.strokeText(i,C,e,l.maxWidth)),I.fillText(i,C,e,l.maxWidth),wB(I,C,e,i,l),e+=Number(t.lineHeight);I.restore()}function _t(I,g){const{x:C,y:e,w:t,h:l,radius:n}=g;I.arc(C+n.topLeft,e+n.topLeft,n.topLeft,1.5*bg,bg,!0),I.lineTo(C,e+l-n.bottomLeft),I.arc(C+n.bottomLeft,e+l-n.bottomLeft,n.bottomLeft,bg,rg,!0),I.lineTo(C+t-n.bottomRight,e+l),I.arc(C+t-n.bottomRight,e+l-n.bottomRight,n.bottomRight,rg,0,!0),I.lineTo(C+t,e+n.topRight),I.arc(C+t-n.topRight,e+n.topRight,n.topRight,0,-rg,!0),I.lineTo(C+n.topLeft,e)}const zB=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,MB=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function EB(I,g){const C=(""+I).match(zB);if(!C||C[1]==="normal")return g*1.2;switch(I=+C[2],C[3]){case"px":return I;case"%":I/=100;break}return g*I}const QB=I=>+I||0;function Us(I,g){const C={},e=E(g),t=e?Object.keys(g):g,l=E(I)?e?n=>U(I[n],I[g[n]]):n=>I[n]:()=>I;for(const n of t)C[n]=QB(l(n));return C}function Tu(I){return Us(I,{top:"y",right:"x",bottom:"y",left:"x"})}function EC(I){return Us(I,["topLeft","topRight","bottomLeft","bottomRight"])}function wg(I){const g=Tu(I);return g.width=g.left+g.right,g.height=g.top+g.bottom,g}function Sg(I,g){I=I||{},g=g||ag.font;let C=U(I.size,g.size);typeof C=="string"&&(C=parseInt(C,10));let e=U(I.style,g.style);e&&!(""+e).match(MB)&&(console.warn('Invalid font style specified: "'+e+'"'),e=void 0);const t={family:U(I.family,g.family),lineHeight:EB(U(I.lineHeight,g.lineHeight),C),size:C,style:e,weight:U(I.weight,g.weight),string:""};return t.string=NB(t),t}function Kl(I,g,C,e){let t,l,n;for(t=0,l=I.length;t<l;++t)if(n=I[t],n!==void 0&&n!==void 0)return n}function UB(I,g,C){const{min:e,max:t}=I,l=Nu(g,(t-e)/2),n=(o,A)=>C&&o===0?0:o+A;return{min:n(e,-Math.abs(l)),max:n(t,l)}}function ee(I,g){return Object.assign(Object.create(I),g)}function Ls(I,g=[""],C,e,t=()=>I[0]){const l=C||I;typeof e>"u"&&(e=_u("_fallback",I));const n={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:I,_rootScopes:l,_fallback:e,_getTarget:t,override:o=>Ls([o,...I],g,l,e)};return new Proxy(n,{deleteProperty(o,A){return delete o[A],delete o._keys,delete I[0][A],!0},get(o,A){return Pu(o,A,()=>qB(A,g,I,o))},getOwnPropertyDescriptor(o,A){return Reflect.getOwnPropertyDescriptor(o._scopes[0],A)},getPrototypeOf(){return Reflect.getPrototypeOf(I[0])},has(o,A){return Ea(o).includes(A)},ownKeys(o){return Ea(o)},set(o,A,i){const s=o._storage||(o._storage=t());return o[A]=s[A]=i,delete o._keys,!0}})}function xe(I,g,C,e){const t={_cacheable:!1,_proxy:I,_context:g,_subProxy:C,_stack:new Set,_descriptors:ju(I,e),setContext:l=>xe(I,l,C,e),override:l=>xe(I.override(l),g,C,e)};return new Proxy(t,{deleteProperty(l,n){return delete l[n],delete I[n],!0},get(l,n,o){return Pu(l,n,()=>DB(l,n,o))},getOwnPropertyDescriptor(l,n){return l._descriptors.allKeys?Reflect.has(I,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(I,n)},getPrototypeOf(){return Reflect.getPrototypeOf(I)},has(l,n){return Reflect.has(I,n)},ownKeys(){return Reflect.ownKeys(I)},set(l,n,o){return I[n]=o,delete l[n],!0}})}function ju(I,g={scriptable:!0,indexable:!0}){const{_scriptable:C=g.scriptable,_indexable:e=g.indexable,_allKeys:t=g.allKeys}=I;return{allKeys:t,scriptable:C,indexable:e,isScriptable:BC(C)?C:()=>C,isIndexable:BC(e)?e:()=>e}}const LB=(I,g)=>I?I+xs(g):g,Ds=(I,g)=>E(g)&&I!=="adapters"&&(Object.getPrototypeOf(g)===null||g.constructor===Object);function Pu(I,g,C){if(Object.prototype.hasOwnProperty.call(I,g)||g==="constructor")return I[g];const e=C();return I[g]=e,e}function DB(I,g,C){const{_proxy:e,_context:t,_subProxy:l,_descriptors:n}=I;let o=e[g];return BC(o)&&n.isScriptable(g)&&(o=TB(g,o,I,C)),sg(o)&&o.length&&(o=jB(g,o,I,n.isIndexable)),Ds(g,o)&&(o=xe(o,t,l&&l[g],n)),o}function TB(I,g,C,e){const{_proxy:t,_context:l,_subProxy:n,_stack:o}=C;if(o.has(I))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+I);o.add(I);let A=g(l,n||e);return o.delete(I),Ds(I,A)&&(A=Ts(t._scopes,t,I,A)),A}function jB(I,g,C,e){const{_proxy:t,_context:l,_subProxy:n,_descriptors:o}=C;if(typeof l.index<"u"&&e(I))return g[l.index%g.length];if(E(g[0])){const A=g,i=t._scopes.filter(s=>s!==A);g=[];for(const s of A){const c=Ts(i,t,I,s);g.push(xe(c,l,n&&n[I],o))}}return g}function Ou(I,g,C){return BC(I)?I(g,C):I}const PB=(I,g)=>I===!0?g:typeof I=="string"?_C(g,I):void 0;function OB(I,g,C,e,t){for(const l of g){const n=PB(C,l);if(n){I.add(n);const o=Ou(n._fallback,C,t);if(typeof o<"u"&&o!==C&&o!==e)return o}else if(n===!1&&typeof e<"u"&&C!==e)return null}return!1}function Ts(I,g,C,e){const t=g._rootScopes,l=Ou(g._fallback,C,e),n=[...I,...t],o=new Set;o.add(e);let A=Ma(o,n,C,l||C,e);return A===null||typeof l<"u"&&l!==C&&(A=Ma(o,n,l,A,e),A===null)?!1:Ls(Array.from(o),[""],t,l,()=>_B(g,C,e))}function Ma(I,g,C,e,t){for(;C;)C=OB(I,g,C,e,t);return C}function _B(I,g,C){const e=I._getTarget();g in e||(e[g]={});const t=e[g];return sg(t)&&E(C)?C:t||{}}function qB(I,g,C,e){let t;for(const l of g)if(t=_u(LB(l,I),C),typeof t<"u")return Ds(I,t)?Ts(C,e,I,t):t}function _u(I,g){for(const C of g){if(!C)continue;const e=C[I];if(typeof e<"u")return e}}function Ea(I){let g=I._keys;return g||(g=I._keys=$B(I._scopes)),g}function $B(I){const g=new Set;for(const C of I)for(const e of Object.keys(C).filter(t=>!t.startsWith("_")))g.add(e);return Array.from(g)}function js(){return typeof window<"u"&&typeof document<"u"}function Ps(I){let g=I.parentNode;return g&&g.toString()==="[object ShadowRoot]"&&(g=g.host),g}function Un(I,g,C){let e;return typeof I=="string"?(e=parseInt(I,10),I.indexOf("%")!==-1&&(e=e/100*g.parentNode[C])):e=I,e}const bo=I=>I.ownerDocument.defaultView.getComputedStyle(I,null);function gy(I,g){return bo(I).getPropertyValue(g)}const Iy=["top","right","bottom","left"];function QC(I,g,C){const e={};C=C?"-"+C:"";for(let t=0;t<4;t++){const l=Iy[t];e[l]=parseFloat(I[g+"-"+l+C])||0}return e.width=e.left+e.right,e.height=e.top+e.bottom,e}const Cy=(I,g,C)=>(I>0||g>0)&&(!C||!C.shadowRoot);function ey(I,g){const C=I.touches,e=C&&C.length?C[0]:I,{offsetX:t,offsetY:l}=e;let n=!1,o,A;if(Cy(t,l,I.target))o=t,A=l;else{const i=g.getBoundingClientRect();o=e.clientX-i.left,A=e.clientY-i.top,n=!0}return{x:o,y:A,box:n}}function vC(I,g){if("native"in I)return I;const{canvas:C,currentDevicePixelRatio:e}=g,t=bo(C),l=t.boxSizing==="border-box",n=QC(t,"padding"),o=QC(t,"border","width"),{x:A,y:i,box:s}=ey(I,C),c=n.left+(s&&o.left),a=n.top+(s&&o.top);let{width:r,height:m}=g;return l&&(r-=n.width+o.width,m-=n.height+o.height),{x:Math.round((A-c)/r*C.width/e),y:Math.round((i-a)/m*C.height/e)}}function ty(I,g,C){let e,t;if(g===void 0||C===void 0){const l=I&&Ps(I);if(!l)g=I.clientWidth,C=I.clientHeight;else{const n=l.getBoundingClientRect(),o=bo(l),A=QC(o,"border","width"),i=QC(o,"padding");g=n.width-i.width-A.width,C=n.height-i.height-A.height,e=Un(o.maxWidth,l,"clientWidth"),t=Un(o.maxHeight,l,"clientHeight")}}return{width:g,height:C,maxWidth:e||zn,maxHeight:t||zn}}const wl=I=>Math.round(I*10)/10;function ly(I,g,C,e){const t=bo(I),l=QC(t,"margin"),n=Un(t.maxWidth,I,"clientWidth")||zn,o=Un(t.maxHeight,I,"clientHeight")||zn,A=ty(I,g,C);let{width:i,height:s}=A;if(t.boxSizing==="content-box"){const a=QC(t,"border","width"),r=QC(t,"padding");i-=r.width+a.width,s-=r.height+a.height}return i=Math.max(0,i-l.width),s=Math.max(0,e?i/e:s-l.height),i=wl(Math.min(i,n,A.maxWidth)),s=wl(Math.min(s,o,A.maxHeight)),i&&!s&&(s=wl(i/2)),(g!==void 0||C!==void 0)&&e&&A.height&&s>A.height&&(s=A.height,i=wl(Math.floor(s*e))),{width:i,height:s}}function Qa(I,g,C){const e=g||1,t=Math.floor(I.height*e),l=Math.floor(I.width*e);I.height=Math.floor(I.height),I.width=Math.floor(I.width);const n=I.canvas;return n.style&&(C||!n.style.height&&!n.style.width)&&(n.style.height=`${I.height}px`,n.style.width=`${I.width}px`),I.currentDevicePixelRatio!==e||n.height!==t||n.width!==l?(I.currentDevicePixelRatio=e,n.height=t,n.width=l,I.ctx.setTransform(e,0,0,e,0,0),!0):!1}const ny=function(){let I=!1;try{const g={get passive(){return I=!0,!1}};js()&&(window.addEventListener("test",null,g),window.removeEventListener("test",null,g))}catch{}return I}();function Ua(I,g){const C=gy(I,g),e=C&&C.match(/^(\d+)(\.\d+)?px$/);return e?+e[1]:void 0}const oy=function(I,g){return{x(C){return I+I+g-C},setWidth(C){g=C},textAlign(C){return C==="center"?C:C==="right"?"left":"right"},xPlus(C,e){return C-e},leftForLtr(C,e){return C-e}}},Ay=function(){return{x(I){return I},setWidth(I){},textAlign(I){return I},xPlus(I,g){return I+g},leftForLtr(I,g){return I}}};function Je(I,g,C){return I?oy(g,C):Ay()}function qu(I,g){let C,e;(g==="ltr"||g==="rtl")&&(C=I.canvas.style,e=[C.getPropertyValue("direction"),C.getPropertyPriority("direction")],C.setProperty("direction",g,"important"),I.prevTextDirection=e)}function $u(I,g){g!==void 0&&(delete I.prevTextDirection,I.canvas.style.setProperty("direction",g[0],g[1]))}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class iy{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(g,C,e,t){const l=C.listeners[t],n=C.duration;l.forEach(o=>o({chart:g,initial:C.initial,numSteps:n,currentStep:Math.min(e-C.start,n)}))}_refresh(){this._request||(this._running=!0,this._request=Mu.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(g=Date.now()){let C=0;this._charts.forEach((e,t)=>{if(!e.running||!e.items.length)return;const l=e.items;let n=l.length-1,o=!1,A;for(;n>=0;--n)A=l[n],A._active?(A._total>e.duration&&(e.duration=A._total),A.tick(g),o=!0):(l[n]=l[l.length-1],l.pop());o&&(t.draw(),this._notify(t,e,g,"progress")),l.length||(e.running=!1,this._notify(t,e,g,"complete"),e.initial=!1),C+=l.length}),this._lastDate=g,C===0&&(this._running=!1)}_getAnims(g){const C=this._charts;let e=C.get(g);return e||(e={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},C.set(g,e)),e}listen(g,C,e){this._getAnims(g).listeners[C].push(e)}add(g,C){!C||!C.length||this._getAnims(g).items.push(...C)}has(g){return this._getAnims(g).items.length>0}start(g){const C=this._charts.get(g);C&&(C.running=!0,C.start=Date.now(),C.duration=C.items.reduce((e,t)=>Math.max(e,t._duration),0),this._refresh())}running(g){if(!this._running)return!1;const C=this._charts.get(g);return!(!C||!C.running||!C.items.length)}stop(g){const C=this._charts.get(g);if(!C||!C.items.length)return;const e=C.items;let t=e.length-1;for(;t>=0;--t)e[t].cancel();C.items=[],this._notify(g,C,Date.now(),"complete")}remove(g){return this._charts.delete(g)}}var NI=new iy;const La="transparent",sy={boolean(I,g,C){return C>.5?g:I},color(I,g,C){const e=Ka(I||La),t=e.valid&&Ka(g||La);return t&&t.valid?t.mix(e,C).hexString():g},number(I,g,C){return I+(g-I)*C}};class cy{constructor(g,C,e,t){const l=C[e];t=Kl([g.to,t,l,g.from]);const n=Kl([g.from,l,t]);this._active=!0,this._fn=g.fn||sy[g.type||typeof n],this._easing=Rt[g.easing]||Rt.linear,this._start=Math.floor(Date.now()+(g.delay||0)),this._duration=this._total=Math.floor(g.duration),this._loop=!!g.loop,this._target=C,this._prop=e,this._from=n,this._to=t,this._promises=void 0}active(){return this._active}update(g,C,e){if(this._active){this._notify(!1);const t=this._target[this._prop],l=e-this._start,n=this._duration-l;this._start=e,this._duration=Math.floor(Math.max(n,g.duration)),this._total+=l,this._loop=!!g.loop,this._to=Kl([g.to,C,t,g.from]),this._from=Kl([g.from,t,C])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(g){const C=g-this._start,e=this._duration,t=this._prop,l=this._from,n=this._loop,o=this._to;let A;if(this._active=l!==o&&(n||C<e),!this._active){this._target[t]=o,this._notify(!0);return}if(C<0){this._target[t]=l;return}A=C/e%2,A=n&&A>1?2-A:A,A=this._easing(Math.min(1,Math.max(0,A))),this._target[t]=this._fn(l,o,A)}wait(){const g=this._promises||(this._promises=[]);return new Promise((C,e)=>{g.push({res:C,rej:e})})}_notify(g){const C=g?"res":"rej",e=this._promises||[];for(let t=0;t<e.length;t++)e[t][C]()}}class gZ{constructor(g,C){this._chart=g,this._properties=new Map,this.configure(C)}configure(g){if(!E(g))return;const C=Object.keys(ag.animation),e=this._properties;Object.getOwnPropertyNames(g).forEach(t=>{const l=g[t];if(!E(l))return;const n={};for(const o of C)n[o]=l[o];(sg(l.properties)&&l.properties||[t]).forEach(o=>{(o===t||!e.has(o))&&e.set(o,n)})})}_animateOptions(g,C){const e=C.options,t=dy(g,e);if(!t)return[];const l=this._createAnimations(t,e);return e.$shared&&ay(g.options.$animations,e).then(()=>{g.options=e},()=>{}),l}_createAnimations(g,C){const e=this._properties,t=[],l=g.$animations||(g.$animations={}),n=Object.keys(C),o=Date.now();let A;for(A=n.length-1;A>=0;--A){const i=n[A];if(i.charAt(0)==="$")continue;if(i==="options"){t.push(...this._animateOptions(g,C));continue}const s=C[i];let c=l[i];const a=e.get(i);if(c)if(a&&c.active()){c.update(a,s,o);continue}else c.cancel();if(!a||!a.duration){g[i]=s;continue}l[i]=c=new cy(a,g,i,s),t.push(c)}return t}update(g,C){if(this._properties.size===0){Object.assign(g,C);return}const e=this._createAnimations(g,C);if(e.length)return NI.add(this._chart,e),!0}}function ay(I,g){const C=[],e=Object.keys(g);for(let t=0;t<e.length;t++){const l=I[e[t]];l&&l.active()&&C.push(l.wait())}return Promise.all(C)}function dy(I,g){if(!g)return;let C=I.options;if(!C){I.options=g;return}return C.$shared&&(I.options=C=Object.assign({},C,{$shared:!1,$animations:{}})),C}function Da(I,g){const C=I&&I.options||{},e=C.reverse,t=C.min===void 0?g:0,l=C.max===void 0?g:0;return{start:e?l:t,end:e?t:l}}function ry(I,g,C){if(C===!1)return!1;const e=Da(I,C),t=Da(g,C);return{top:t.end,right:e.end,bottom:t.start,left:e.start}}function my(I){let g,C,e,t;return E(I)?(g=I.top,C=I.right,e=I.bottom,t=I.left):g=C=e=t=I,{top:g,right:C,bottom:e,left:t,disabled:I===!1}}function IZ(I,g){const C=[],e=I._getSortedDatasetMetas(g);let t,l;for(t=0,l=e.length;t<l;++t)C.push(e[t].index);return C}function Ta(I,g,C,e={}){const t=I.keys,l=e.mode==="single";let n,o,A,i;if(g!==null){for(n=0,o=t.length;n<o;++n){if(A=+t[n],A===C){if(e.all)continue;break}i=I.values[A],yg(i)&&(l||g===0||bC(g)===bC(i))&&(g+=i)}return g}}function uy(I,g){const{iScale:C,vScale:e}=g,t=C.axis==="x"?"x":"y",l=e.axis==="x"?"x":"y",n=Object.keys(I),o=new Array(n.length);let A,i,s;for(A=0,i=n.length;A<i;++A)s=n[A],o[A]={[t]:s,[l]:I[s]};return o}function ja(I,g){const C=I&&I.options.stacked;return C||C===void 0&&g.stack!==void 0}function Zy(I,g,C){return`${I.id}.${g.id}.${C.stack||C.type}`}function by(I){const{min:g,max:C,minDefined:e,maxDefined:t}=I.getUserBounds();return{min:e?g:Number.NEGATIVE_INFINITY,max:t?C:Number.POSITIVE_INFINITY}}function hy(I,g,C){const e=I[g]||(I[g]={});return e[C]||(e[C]={})}function Pa(I,g,C,e){for(const t of g.getMatchingVisibleMetas(e).reverse()){const l=I[t.index];if(C&&l>0||!C&&l<0)return t.index}return null}function Oa(I,g){const{chart:C,_cachedMeta:e}=I,t=C._stacks||(C._stacks={}),{iScale:l,vScale:n,index:o}=e,A=l.axis,i=n.axis,s=Zy(l,n,e),c=g.length;let a;for(let r=0;r<c;++r){const m=g[r],{[A]:b,[i]:G}=m,u=m._stacks||(m._stacks={});a=u[i]=hy(t,s,b),a[o]=G,a._top=Pa(a,n,!0,e.type),a._bottom=Pa(a,n,!1,e.type);const Z=a._visualValues||(a._visualValues={});Z[o]=G}}function dA(I,g){const C=I.scales;return Object.keys(C).filter(e=>C[e].axis===g).shift()}function Gy(I,g){return ee(I,{active:!1,dataset:void 0,datasetIndex:g,index:g,mode:"default",type:"dataset"})}function By(I,g,C){return ee(I,{active:!1,dataIndex:g,parsed:void 0,raw:void 0,element:C,index:g,mode:"default",type:"data"})}function Ct(I,g){const C=I.controller.index,e=I.vScale&&I.vScale.axis;if(e){g=g||I._parsed;for(const t of g){const l=t._stacks;if(!l||l[e]===void 0||l[e][C]===void 0)return;delete l[e][C],l[e]._visualValues!==void 0&&l[e]._visualValues[C]!==void 0&&delete l[e]._visualValues[C]}}}const rA=I=>I==="reset"||I==="none",_a=(I,g)=>g?I:Object.assign({},I),yy=(I,g,C)=>I&&!g.hidden&&g._stacked&&{keys:IZ(C,!0),values:null};class ke{constructor(g,C){this.chart=g,this._ctx=g.ctx,this.index=C,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const g=this._cachedMeta;this.configure(),this.linkScales(),g._stacked=ja(g.vScale,g),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(g){this.index!==g&&Ct(this._cachedMeta),this.index=g}linkScales(){const g=this.chart,C=this._cachedMeta,e=this.getDataset(),t=(c,a,r,m)=>c==="x"?a:c==="r"?m:r,l=C.xAxisID=U(e.xAxisID,dA(g,"x")),n=C.yAxisID=U(e.yAxisID,dA(g,"y")),o=C.rAxisID=U(e.rAxisID,dA(g,"r")),A=C.indexAxis,i=C.iAxisID=t(A,l,n,o),s=C.vAxisID=t(A,n,l,o);C.xScale=this.getScaleForId(l),C.yScale=this.getScaleForId(n),C.rScale=this.getScaleForId(o),C.iScale=this.getScaleForId(i),C.vScale=this.getScaleForId(s)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(g){return this.chart.scales[g]}_getOtherScale(g){const C=this._cachedMeta;return g===C.iScale?C.vScale:C.iScale}reset(){this._update("reset")}_destroy(){const g=this._cachedMeta;this._data&&va(this._data,this),g._stacked&&Ct(g)}_dataCheck(){const g=this.getDataset(),C=g.data||(g.data=[]),e=this._data;if(E(C)){const t=this._cachedMeta;this._data=uy(C,t)}else if(e!==C){if(e){va(e,this);const t=this._cachedMeta;Ct(t),t._parsed=[]}C&&Object.isExtensible(C)&&WB(C,this),this._syncList=[],this._data=C}}addElements(){const g=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(g.dataset=new this.datasetElementType)}buildOrUpdateElements(g){const C=this._cachedMeta,e=this.getDataset();let t=!1;this._dataCheck();const l=C._stacked;C._stacked=ja(C.vScale,C),C.stack!==e.stack&&(t=!0,Ct(C),C.stack=e.stack),this._resyncElements(g),(t||l!==C._stacked)&&Oa(this,C._parsed)}configure(){const g=this.chart.config,C=g.datasetScopeKeys(this._type),e=g.getOptionScopes(this.getDataset(),C,!0);this.options=g.createResolver(e,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(g,C){const{_cachedMeta:e,_data:t}=this,{iScale:l,_stacked:n}=e,o=l.axis;let A=g===0&&C===t.length?!0:e._sorted,i=g>0&&e._parsed[g-1],s,c,a;if(this._parsing===!1)e._parsed=t,e._sorted=!0,a=t;else{sg(t[g])?a=this.parseArrayData(e,t,g,C):E(t[g])?a=this.parseObjectData(e,t,g,C):a=this.parsePrimitiveData(e,t,g,C);const r=()=>c[o]===null||i&&c[o]<i[o];for(s=0;s<C;++s)e._parsed[s+g]=c=a[s],A&&(r()&&(A=!1),i=c);e._sorted=A}n&&Oa(this,a)}parsePrimitiveData(g,C,e,t){const{iScale:l,vScale:n}=g,o=l.axis,A=n.axis,i=l.getLabels(),s=l===n,c=new Array(t);let a,r,m;for(a=0,r=t;a<r;++a)m=a+e,c[a]={[o]:s||l.parse(i[m],m),[A]:n.parse(C[m],m)};return c}parseArrayData(g,C,e,t){const{xScale:l,yScale:n}=g,o=new Array(t);let A,i,s,c;for(A=0,i=t;A<i;++A)s=A+e,c=C[s],o[A]={x:l.parse(c[0],s),y:n.parse(c[1],s)};return o}parseObjectData(g,C,e,t){const{xScale:l,yScale:n}=g,{xAxisKey:o="x",yAxisKey:A="y"}=this._parsing,i=new Array(t);let s,c,a,r;for(s=0,c=t;s<c;++s)a=s+e,r=C[a],i[s]={x:l.parse(_C(r,o),a),y:n.parse(_C(r,A),a)};return i}getParsed(g){return this._cachedMeta._parsed[g]}getDataElement(g){return this._cachedMeta.data[g]}applyStack(g,C,e){const t=this.chart,l=this._cachedMeta,n=C[g.axis],o={keys:IZ(t,!0),values:C._stacks[g.axis]._visualValues};return Ta(o,n,l.index,{mode:e})}updateRangeFromParsed(g,C,e,t){const l=e[C.axis];let n=l===null?NaN:l;const o=t&&e._stacks[C.axis];t&&o&&(t.values=o,n=Ta(t,l,this._cachedMeta.index)),g.min=Math.min(g.min,n),g.max=Math.max(g.max,n)}getMinMax(g,C){const e=this._cachedMeta,t=e._parsed,l=e._sorted&&g===e.iScale,n=t.length,o=this._getOtherScale(g),A=yy(C,e,this.chart),i={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:s,max:c}=by(o);let a,r;function m(){r=t[a];const b=r[o.axis];return!yg(r[g.axis])||s>b||c<b}for(a=0;a<n&&!(!m()&&(this.updateRangeFromParsed(i,g,r,A),l));++a);if(l){for(a=n-1;a>=0;--a)if(!m()){this.updateRangeFromParsed(i,g,r,A);break}}return i}getAllParsedValues(g){const C=this._cachedMeta._parsed,e=[];let t,l,n;for(t=0,l=C.length;t<l;++t)n=C[t][g.axis],yg(n)&&e.push(n);return e}getMaxOverflow(){return!1}getLabelAndValue(g){const C=this._cachedMeta,e=C.iScale,t=C.vScale,l=this.getParsed(g);return{label:e?""+e.getLabelForValue(l[e.axis]):"",value:t?""+t.getLabelForValue(l[t.axis]):""}}_update(g){const C=this._cachedMeta;this.update(g||"default"),C._clip=my(U(this.options.clip,ry(C.xScale,C.yScale,this.getMaxOverflow())))}update(g){}draw(){const g=this._ctx,C=this.chart,e=this._cachedMeta,t=e.data||[],l=C.chartArea,n=[],o=this._drawStart||0,A=this._drawCount||t.length-o,i=this.options.drawActiveElementsOnTop;let s;for(e.dataset&&e.dataset.draw(g,l,o,A),s=o;s<o+A;++s){const c=t[s];c.hidden||(c.active&&i?n.push(c):c.draw(g,l))}for(s=0;s<n.length;++s)n[s].draw(g,l)}getStyle(g,C){const e=C?"active":"default";return g===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(e):this.resolveDataElementOptions(g||0,e)}getContext(g,C,e){const t=this.getDataset();let l;if(g>=0&&g<this._cachedMeta.data.length){const n=this._cachedMeta.data[g];l=n.$context||(n.$context=By(this.getContext(),g,n)),l.parsed=this.getParsed(g),l.raw=t.data[g],l.index=l.dataIndex=g}else l=this.$context||(this.$context=Gy(this.chart.getContext(),this.index)),l.dataset=t,l.index=l.datasetIndex=this.index;return l.active=!!C,l.mode=e,l}resolveDatasetElementOptions(g){return this._resolveElementOptions(this.datasetElementType.id,g)}resolveDataElementOptions(g,C){return this._resolveElementOptions(this.dataElementType.id,C,g)}_resolveElementOptions(g,C="default",e){const t=C==="active",l=this._cachedDataOpts,n=g+"-"+C,o=l[n],A=this.enableOptionSharing&&Ot(e);if(o)return _a(o,A);const i=this.chart.config,s=i.datasetElementScopeKeys(this._type,g),c=t?[`${g}Hover`,"hover",g,""]:[g,""],a=i.getOptionScopes(this.getDataset(),s),r=Object.keys(ag.elements[g]),m=()=>this.getContext(e,t,C),b=i.resolveNamedOptions(a,r,m,c);return b.$shared&&(b.$shared=A,l[n]=Object.freeze(_a(b,A))),b}_resolveAnimations(g,C,e){const t=this.chart,l=this._cachedDataOpts,n=`animation-${C}`,o=l[n];if(o)return o;let A;if(t.options.animation!==!1){const s=this.chart.config,c=s.datasetAnimationScopeKeys(this._type,C),a=s.getOptionScopes(this.getDataset(),c);A=s.createResolver(a,this.getContext(g,e,C))}const i=new gZ(t,A&&A.animations);return A&&A._cacheable&&(l[n]=Object.freeze(i)),i}getSharedOptions(g){if(g.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},g))}includeOptions(g,C){return!C||rA(g)||this.chart._animationsDisabled}_getSharedOptions(g,C){const e=this.resolveDataElementOptions(g,C),t=this._sharedOptions,l=this.getSharedOptions(e),n=this.includeOptions(C,l)||l!==t;return this.updateSharedOptions(l,C,e),{sharedOptions:l,includeOptions:n}}updateElement(g,C,e,t){rA(t)?Object.assign(g,e):this._resolveAnimations(C,t).update(g,e)}updateSharedOptions(g,C,e){g&&!rA(C)&&this._resolveAnimations(void 0,C).update(g,e)}_setStyle(g,C,e,t){g.active=t;const l=this.getStyle(C,t);this._resolveAnimations(C,e,t).update(g,{options:!t&&this.getSharedOptions(l)||l})}removeHoverStyle(g,C,e){this._setStyle(g,e,"active",!1)}setHoverStyle(g,C,e){this._setStyle(g,e,"active",!0)}_removeDatasetHoverStyle(){const g=this._cachedMeta.dataset;g&&this._setStyle(g,void 0,"active",!1)}_setDatasetHoverStyle(){const g=this._cachedMeta.dataset;g&&this._setStyle(g,void 0,"active",!0)}_resyncElements(g){const C=this._data,e=this._cachedMeta.data;for(const[o,A,i]of this._syncList)this[o](A,i);this._syncList=[];const t=e.length,l=C.length,n=Math.min(l,t);n&&this.parse(0,n),l>t?this._insertElements(t,l-t,g):l<t&&this._removeElements(l,t-l)}_insertElements(g,C,e=!0){const t=this._cachedMeta,l=t.data,n=g+C;let o;const A=i=>{for(i.length+=C,o=i.length-1;o>=n;o--)i[o]=i[o-C]};for(A(l),o=g;o<n;++o)l[o]=new this.dataElementType;this._parsing&&A(t._parsed),this.parse(g,C),e&&this.updateElements(l,g,C,"reset")}updateElements(g,C,e,t){}_removeElements(g,C){const e=this._cachedMeta;if(this._parsing){const t=e._parsed.splice(g,C);e._stacked&&Ct(e,t)}e.data.splice(g,C)}_sync(g){if(this._parsing)this._syncList.push(g);else{const[C,e,t]=g;this[C](e,t)}this.chart._dataChanges.push([this.index,...g])}_onDataPush(){const g=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-g,g])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(g,C){C&&this._sync(["_removeElements",g,C]);const e=arguments.length-2;e&&this._sync(["_insertElements",g,e])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}N(ke,"defaults",{}),N(ke,"datasetElementType",null),N(ke,"dataElementType",null);function py(I,g){if(!I._cache.$bar){const C=I.getMatchingVisibleMetas(g);let e=[];for(let t=0,l=C.length;t<l;t++)e=e.concat(C[t].controller.getAllParsedValues(I));I._cache.$bar=zu(e.sort((t,l)=>t-l))}return I._cache.$bar}function Wy(I){const g=I.iScale,C=py(g,I.type);let e=g._length,t,l,n,o;const A=()=>{n===32767||n===-32768||(Ot(o)&&(e=Math.min(e,Math.abs(n-o)||e)),o=n)};for(t=0,l=C.length;t<l;++t)n=g.getPixelForValue(C[t]),A();for(o=void 0,t=0,l=g.ticks.length;t<l;++t)n=g.getPixelForTick(t),A();return e}function Vy(I,g,C,e){const t=C.barThickness;let l,n;return P(t)?(l=g.min*C.categoryPercentage,n=C.barPercentage):(l=t*e,n=1),{chunk:l/e,ratio:n,start:g.pixels[I]-l/2}}function Sy(I,g,C,e){const t=g.pixels,l=t[I];let n=I>0?t[I-1]:null,o=I<t.length-1?t[I+1]:null;const A=C.categoryPercentage;n===null&&(n=l-(o===null?g.end-g.start:o-l)),o===null&&(o=l+l-n);const i=l-(l-Math.min(n,o))/2*A;return{chunk:Math.abs(o-n)/2*A/e,ratio:C.barPercentage,start:i}}function Ry(I,g,C,e){const t=C.parse(I[0],e),l=C.parse(I[1],e),n=Math.min(t,l),o=Math.max(t,l);let A=n,i=o;Math.abs(n)>Math.abs(o)&&(A=o,i=n),g[C.axis]=i,g._custom={barStart:A,barEnd:i,start:t,end:l,min:n,max:o}}function CZ(I,g,C,e){return sg(I)?Ry(I,g,C,e):g[C.axis]=C.parse(I,e),g}function qa(I,g,C,e){const t=I.iScale,l=I.vScale,n=t.getLabels(),o=t===l,A=[];let i,s,c,a;for(i=C,s=C+e;i<s;++i)a=g[i],c={},c[t.axis]=o||t.parse(n[i],i),A.push(CZ(a,c,l,i));return A}function mA(I){return I&&I.barStart!==void 0&&I.barEnd!==void 0}function Xy(I,g,C){return I!==0?bC(I):(g.isHorizontal()?1:-1)*(g.min>=C?1:-1)}function Jy(I){let g,C,e,t,l;return I.horizontal?(g=I.base>I.x,C="left",e="right"):(g=I.base<I.y,C="bottom",e="top"),g?(t="end",l="start"):(t="start",l="end"),{start:C,end:e,reverse:g,top:t,bottom:l}}function ky(I,g,C,e){let t=g.borderSkipped;const l={};if(!t){I.borderSkipped=l;return}if(t===!0){I.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:n,end:o,reverse:A,top:i,bottom:s}=Jy(I);t==="middle"&&C&&(I.enableBorderRadius=!0,(C._top||0)===e?t=i:(C._bottom||0)===e?t=s:(l[$a(s,n,o,A)]=!0,t=i)),l[$a(t,n,o,A)]=!0,I.borderSkipped=l}function $a(I,g,C,e){return e?(I=fy(I,g,C),I=gd(I,C,g)):I=gd(I,g,C),I}function fy(I,g,C){return I===g?C:I===C?g:I}function gd(I,g,C){return I==="start"?g:I==="end"?C:I}function Yy(I,{inflateAmount:g},C){I.inflateAmount=g==="auto"?C===1?.33:0:g}class nn extends ke{parsePrimitiveData(g,C,e,t){return qa(g,C,e,t)}parseArrayData(g,C,e,t){return qa(g,C,e,t)}parseObjectData(g,C,e,t){const{iScale:l,vScale:n}=g,{xAxisKey:o="x",yAxisKey:A="y"}=this._parsing,i=l.axis==="x"?o:A,s=n.axis==="x"?o:A,c=[];let a,r,m,b;for(a=e,r=e+t;a<r;++a)b=C[a],m={},m[l.axis]=l.parse(_C(b,i),a),c.push(CZ(_C(b,s),m,n,a));return c}updateRangeFromParsed(g,C,e,t){super.updateRangeFromParsed(g,C,e,t);const l=e._custom;l&&C===this._cachedMeta.vScale&&(g.min=Math.min(g.min,l.min),g.max=Math.max(g.max,l.max))}getMaxOverflow(){return 0}getLabelAndValue(g){const C=this._cachedMeta,{iScale:e,vScale:t}=C,l=this.getParsed(g),n=l._custom,o=mA(n)?"["+n.start+", "+n.end+"]":""+t.getLabelForValue(l[t.axis]);return{label:""+e.getLabelForValue(l[e.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();const g=this._cachedMeta;g.stack=this.getDataset().stack}update(g){const C=this._cachedMeta;this.updateElements(C.data,0,C.data.length,g)}updateElements(g,C,e,t){const l=t==="reset",{index:n,_cachedMeta:{vScale:o}}=this,A=o.getBasePixel(),i=o.isHorizontal(),s=this._getRuler(),{sharedOptions:c,includeOptions:a}=this._getSharedOptions(C,t);for(let r=C;r<C+e;r++){const m=this.getParsed(r),b=l||P(m[o.axis])?{base:A,head:A}:this._calculateBarValuePixels(r),G=this._calculateBarIndexPixels(r,s),u=(m._stacks||{})[o.axis],Z={horizontal:i,base:b.base,enableBorderRadius:!u||mA(m._custom)||n===u._top||n===u._bottom,x:i?b.head:G.center,y:i?G.center:b.head,height:i?G.size:Math.abs(b.size),width:i?Math.abs(b.size):G.size};a&&(Z.options=c||this.resolveDataElementOptions(r,g[r].active?"active":t));const h=Z.options||g[r].options;ky(Z,h,u,n),Yy(Z,h,s.ratio),this.updateElement(g[r],r,Z,t)}}_getStacks(g,C){const{iScale:e}=this._cachedMeta,t=e.getMatchingVisibleMetas(this._type).filter(A=>A.controller.options.grouped),l=e.options.stacked,n=[],o=A=>{const i=A.controller.getParsed(C),s=i&&i[A.vScale.axis];if(P(s)||isNaN(s))return!0};for(const A of t)if(!(C!==void 0&&o(A))&&((l===!1||n.indexOf(A.stack)===-1||l===void 0&&A.stack===void 0)&&n.push(A.stack),A.index===g))break;return n.length||n.push(void 0),n}_getStackCount(g){return this._getStacks(void 0,g).length}_getStackIndex(g,C,e){const t=this._getStacks(g,e),l=C!==void 0?t.indexOf(C):-1;return l===-1?t.length-1:l}_getRuler(){const g=this.options,C=this._cachedMeta,e=C.iScale,t=[];let l,n;for(l=0,n=C.data.length;l<n;++l)t.push(e.getPixelForValue(this.getParsed(l)[e.axis],l));const o=g.barThickness;return{min:o||Wy(C),pixels:t,start:e._startPixel,end:e._endPixel,stackCount:this._getStackCount(),scale:e,grouped:g.grouped,ratio:o?1:g.categoryPercentage*g.barPercentage}}_calculateBarValuePixels(g){const{_cachedMeta:{vScale:C,_stacked:e,index:t},options:{base:l,minBarLength:n}}=this,o=l||0,A=this.getParsed(g),i=A._custom,s=mA(i);let c=A[C.axis],a=0,r=e?this.applyStack(C,A,e):c,m,b;r!==c&&(a=r-c,r=c),s&&(c=i.barStart,r=i.barEnd-i.barStart,c!==0&&bC(c)!==bC(i.barEnd)&&(a=0),a+=c);const G=!P(l)&&!s?l:a;let u=C.getPixelForValue(G);if(this.chart.getDataVisibility(g)?m=C.getPixelForValue(a+r):m=u,b=m-u,Math.abs(b)<n){b=Xy(b,C,o)*n,c===o&&(u-=b/2);const Z=C.getPixelForDecimal(0),h=C.getPixelForDecimal(1),B=Math.min(Z,h),y=Math.max(Z,h);u=Math.max(Math.min(u,y),B),m=u+b,e&&!s&&(A._stacks[C.axis]._visualValues[t]=C.getValueForPixel(m)-C.getValueForPixel(u))}if(u===C.getPixelForValue(o)){const Z=bC(b)*C.getLineWidthForValue(o)/2;u+=Z,b-=Z}return{size:b,base:u,head:m,center:m+b/2}}_calculateBarIndexPixels(g,C){const e=C.scale,t=this.options,l=t.skipNull,n=U(t.maxBarThickness,1/0);let o,A;if(C.grouped){const i=l?this._getStackCount(g):C.stackCount,s=t.barThickness==="flex"?Sy(g,C,t,i):Vy(g,C,t,i),c=this._getStackIndex(this.index,this._cachedMeta.stack,l?g:void 0);o=s.start+s.chunk*c+s.chunk/2,A=Math.min(n,s.chunk*s.ratio)}else o=e.getPixelForValue(this.getParsed(g)[e.axis],g),A=Math.min(n,C.min*C.ratio);return{base:o-A/2,head:o+A/2,center:o,size:A}}draw(){const g=this._cachedMeta,C=g.vScale,e=g.data,t=e.length;let l=0;for(;l<t;++l)this.getParsed(l)[C.axis]!==null&&!e[l].hidden&&e[l].draw(this._ctx)}}N(nn,"id","bar"),N(nn,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),N(nn,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});function Hy(I,g,C){let e=1,t=1,l=0,n=0;if(g<cg){const o=I,A=o+g,i=Math.cos(o),s=Math.sin(o),c=Math.cos(A),a=Math.sin(A),r=(h,B,y)=>En(h,o,A,!0)?1:Math.max(B,B*C,y,y*C),m=(h,B,y)=>En(h,o,A,!0)?-1:Math.min(B,B*C,y,y*C),b=r(0,i,c),G=r(rg,s,a),u=m(bg,i,c),Z=m(bg+rg,s,a);e=(b-u)/2,t=(G-Z)/2,l=-(b+u)/2,n=-(G+Z)/2}return{ratioX:e,ratioY:t,offsetX:l,offsetY:n}}class dt extends ke{constructor(g,C){super(g,C),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(g,C){const e=this.getDataset().data,t=this._cachedMeta;if(this._parsing===!1)t._parsed=e;else{let l=A=>+e[A];if(E(e[g])){const{key:A="value"}=this._parsing;l=i=>+_C(e[i],A)}let n,o;for(n=g,o=g+C;n<o;++n)t._parsed[n]=l(n)}}_getRotation(){return kI(this.options.rotation-90)}_getCircumference(){return kI(this.options.circumference)}_getRotationExtents(){let g=cg,C=-cg;for(let e=0;e<this.chart.data.datasets.length;++e)if(this.chart.isDatasetVisible(e)&&this.chart.getDatasetMeta(e).type===this._type){const t=this.chart.getDatasetMeta(e).controller,l=t._getRotation(),n=t._getCircumference();g=Math.min(g,l),C=Math.max(C,l+n)}return{rotation:g,circumference:C-g}}update(g){const C=this.chart,{chartArea:e}=C,t=this._cachedMeta,l=t.data,n=this.getMaxBorderWidth()+this.getMaxOffset(l)+this.options.spacing,o=Math.max((Math.min(e.width,e.height)-n)/2,0),A=Math.min(cB(this.options.cutout,o),1),i=this._getRingWeight(this.index),{circumference:s,rotation:c}=this._getRotationExtents(),{ratioX:a,ratioY:r,offsetX:m,offsetY:b}=Hy(c,s,A),G=(e.width-n)/a,u=(e.height-n)/r,Z=Math.max(Math.min(G,u)/2,0),h=Nu(this.options.radius,Z),B=Math.max(h*A,0),y=(h-B)/this._getVisibleDatasetWeightTotal();this.offsetX=m*h,this.offsetY=b*h,t.total=this.calculateTotal(),this.outerRadius=h-y*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-y*i,0),this.updateElements(l,0,l.length,g)}_circumference(g,C){const e=this.options,t=this._cachedMeta,l=this._getCircumference();return C&&e.animation.animateRotate||!this.chart.getDataVisibility(g)||t._parsed[g]===null||t.data[g].hidden?0:this.calculateCircumference(t._parsed[g]*l/cg)}updateElements(g,C,e,t){const l=t==="reset",n=this.chart,o=n.chartArea,i=n.options.animation,s=(o.left+o.right)/2,c=(o.top+o.bottom)/2,a=l&&i.animateScale,r=a?0:this.innerRadius,m=a?0:this.outerRadius,{sharedOptions:b,includeOptions:G}=this._getSharedOptions(C,t);let u=this._getRotation(),Z;for(Z=0;Z<C;++Z)u+=this._circumference(Z,l);for(Z=C;Z<C+e;++Z){const h=this._circumference(Z,l),B=g[Z],y={x:s+this.offsetX,y:c+this.offsetY,startAngle:u,endAngle:u+h,circumference:h,outerRadius:m,innerRadius:r};G&&(y.options=b||this.resolveDataElementOptions(Z,B.active?"active":t)),u+=h,this.updateElement(B,Z,y,t)}}calculateTotal(){const g=this._cachedMeta,C=g.data;let e=0,t;for(t=0;t<C.length;t++){const l=g._parsed[t];l!==null&&!isNaN(l)&&this.chart.getDataVisibility(t)&&!C[t].hidden&&(e+=Math.abs(l))}return e}calculateCircumference(g){const C=this._cachedMeta.total;return C>0&&!isNaN(g)?cg*(Math.abs(g)/C):0}getLabelAndValue(g){const C=this._cachedMeta,e=this.chart,t=e.data.labels||[],l=uo(C._parsed[g],e.options.locale);return{label:t[g]||"",value:l}}getMaxBorderWidth(g){let C=0;const e=this.chart;let t,l,n,o,A;if(!g){for(t=0,l=e.data.datasets.length;t<l;++t)if(e.isDatasetVisible(t)){n=e.getDatasetMeta(t),g=n.data,o=n.controller;break}}if(!g)return 0;for(t=0,l=g.length;t<l;++t)A=o.resolveDataElementOptions(t),A.borderAlign!=="inner"&&(C=Math.max(C,A.borderWidth||0,A.hoverBorderWidth||0));return C}getMaxOffset(g){let C=0;for(let e=0,t=g.length;e<t;++e){const l=this.resolveDataElementOptions(e);C=Math.max(C,l.offset||0,l.hoverOffset||0)}return C}_getRingWeightOffset(g){let C=0;for(let e=0;e<g;++e)this.chart.isDatasetVisible(e)&&(C+=this._getRingWeight(e));return C}_getRingWeight(g){return Math.max(U(this.chart.data.datasets[g].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}N(dt,"id","doughnut"),N(dt,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),N(dt,"descriptors",{_scriptable:g=>g!=="spacing",_indexable:g=>g!=="spacing"&&!g.startsWith("borderDash")&&!g.startsWith("hoverBorderDash")}),N(dt,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(g){const C=g.data;if(C.labels.length&&C.datasets.length){const{labels:{pointStyle:e,color:t}}=g.legend.options;return C.labels.map((l,n)=>{const A=g.getDatasetMeta(0).controller.getStyle(n);return{text:l,fillStyle:A.backgroundColor,strokeStyle:A.borderColor,fontColor:t,lineWidth:A.borderWidth,pointStyle:e,hidden:!g.getDataVisibility(n),index:n}})}return[]}},onClick(g,C,e){e.chart.toggleDataVisibility(C.index),e.chart.update()}}}});class pi extends dt{}N(pi,"id","pie"),N(pi,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});function kC(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Os{constructor(g){N(this,"options");this.options=g||{}}static override(g){Object.assign(Os.prototype,g)}init(){}formats(){return kC()}parse(){return kC()}format(){return kC()}add(){return kC()}diff(){return kC()}startOf(){return kC()}endOf(){return kC()}}var vy={_date:Os};function Ny(I,g,C,e){const{controller:t,data:l,_sorted:n}=I,o=t._cachedMeta.iScale;if(o&&g===o.axis&&g!=="r"&&n&&l.length){const A=o._reversePixels?yB:Bi;if(e){if(t._sharedOptions){const i=l[0],s=typeof i.getRange=="function"&&i.getRange(g);if(s){const c=A(l,g,C-s),a=A(l,g,C+s);return{lo:c.lo,hi:a.hi}}}}else return A(l,g,C)}return{lo:0,hi:l.length-1}}function cl(I,g,C,e,t){const l=I.getSortedVisibleDatasetMetas(),n=C[g];for(let o=0,A=l.length;o<A;++o){const{index:i,data:s}=l[o],{lo:c,hi:a}=Ny(l[o],g,n,t);for(let r=c;r<=a;++r){const m=s[r];m.skip||e(m,i,r)}}}function Fy(I){const g=I.indexOf("x")!==-1,C=I.indexOf("y")!==-1;return function(e,t){const l=g?Math.abs(e.x-t.x):0,n=C?Math.abs(e.y-t.y):0;return Math.sqrt(Math.pow(l,2)+Math.pow(n,2))}}function uA(I,g,C,e,t){const l=[];return!t&&!I.isPointInArea(g)||cl(I,C,g,function(o,A,i){!t&&!Be(o,I.chartArea,0)||o.inRange(g.x,g.y,e)&&l.push({element:o,datasetIndex:A,index:i})},!0),l}function Ky(I,g,C,e){let t=[];function l(n,o,A){const{startAngle:i,endAngle:s}=n.getProps(["startAngle","endAngle"],e),{angle:c}=wu(n,{x:g.x,y:g.y});En(c,i,s)&&t.push({element:n,datasetIndex:o,index:A})}return cl(I,C,g,l),t}function wy(I,g,C,e,t,l){let n=[];const o=Fy(C);let A=Number.POSITIVE_INFINITY;function i(s,c,a){const r=s.inRange(g.x,g.y,t);if(e&&!r)return;const m=s.getCenterPoint(t);if(!(!!l||I.isPointInArea(m))&&!r)return;const G=o(g,m);G<A?(n=[{element:s,datasetIndex:c,index:a}],A=G):G===A&&n.push({element:s,datasetIndex:c,index:a})}return cl(I,C,g,i),n}function ZA(I,g,C,e,t,l){return!l&&!I.isPointInArea(g)?[]:C==="r"&&!e?Ky(I,g,C,t):wy(I,g,C,e,t,l)}function Id(I,g,C,e,t){const l=[],n=C==="x"?"inXRange":"inYRange";let o=!1;return cl(I,C,g,(A,i,s)=>{A[n](g[C],t)&&(l.push({element:A,datasetIndex:i,index:s}),o=o||A.inRange(g.x,g.y,t))}),e&&!o?[]:l}var xy={evaluateInteractionItems:cl,modes:{index(I,g,C,e){const t=vC(g,I),l=C.axis||"x",n=C.includeInvisible||!1,o=C.intersect?uA(I,t,l,e,n):ZA(I,t,l,!1,e,n),A=[];return o.length?(I.getSortedVisibleDatasetMetas().forEach(i=>{const s=o[0].index,c=i.data[s];c&&!c.skip&&A.push({element:c,datasetIndex:i.index,index:s})}),A):[]},dataset(I,g,C,e){const t=vC(g,I),l=C.axis||"xy",n=C.includeInvisible||!1;let o=C.intersect?uA(I,t,l,e,n):ZA(I,t,l,!1,e,n);if(o.length>0){const A=o[0].datasetIndex,i=I.getDatasetMeta(A).data;o=[];for(let s=0;s<i.length;++s)o.push({element:i[s],datasetIndex:A,index:s})}return o},point(I,g,C,e){const t=vC(g,I),l=C.axis||"xy",n=C.includeInvisible||!1;return uA(I,t,l,e,n)},nearest(I,g,C,e){const t=vC(g,I),l=C.axis||"xy",n=C.includeInvisible||!1;return ZA(I,t,l,C.intersect,e,n)},x(I,g,C,e){const t=vC(g,I);return Id(I,t,"x",C.intersect,e)},y(I,g,C,e){const t=vC(g,I);return Id(I,t,"y",C.intersect,e)}}};const eZ=["left","top","right","bottom"];function et(I,g){return I.filter(C=>C.pos===g)}function Cd(I,g){return I.filter(C=>eZ.indexOf(C.pos)===-1&&C.box.axis===g)}function tt(I,g){return I.sort((C,e)=>{const t=g?e:C,l=g?C:e;return t.weight===l.weight?t.index-l.index:t.weight-l.weight})}function zy(I){const g=[];let C,e,t,l,n,o;for(C=0,e=(I||[]).length;C<e;++C)t=I[C],{position:l,options:{stack:n,stackWeight:o=1}}=t,g.push({index:C,box:t,pos:l,horizontal:t.isHorizontal(),weight:t.weight,stack:n&&l+n,stackWeight:o});return g}function My(I){const g={};for(const C of I){const{stack:e,pos:t,stackWeight:l}=C;if(!e||!eZ.includes(t))continue;const n=g[e]||(g[e]={count:0,placed:0,weight:0,size:0});n.count++,n.weight+=l}return g}function Ey(I,g){const C=My(I),{vBoxMaxWidth:e,hBoxMaxHeight:t}=g;let l,n,o;for(l=0,n=I.length;l<n;++l){o=I[l];const{fullSize:A}=o.box,i=C[o.stack],s=i&&o.stackWeight/i.weight;o.horizontal?(o.width=s?s*e:A&&g.availableWidth,o.height=t):(o.width=e,o.height=s?s*t:A&&g.availableHeight)}return C}function Qy(I){const g=zy(I),C=tt(g.filter(i=>i.box.fullSize),!0),e=tt(et(g,"left"),!0),t=tt(et(g,"right")),l=tt(et(g,"top"),!0),n=tt(et(g,"bottom")),o=Cd(g,"x"),A=Cd(g,"y");return{fullSize:C,leftAndTop:e.concat(l),rightAndBottom:t.concat(A).concat(n).concat(o),chartArea:et(g,"chartArea"),vertical:e.concat(t).concat(A),horizontal:l.concat(n).concat(o)}}function ed(I,g,C,e){return Math.max(I[C],g[C])+Math.max(I[e],g[e])}function tZ(I,g){I.top=Math.max(I.top,g.top),I.left=Math.max(I.left,g.left),I.bottom=Math.max(I.bottom,g.bottom),I.right=Math.max(I.right,g.right)}function Uy(I,g,C,e){const{pos:t,box:l}=C,n=I.maxPadding;if(!E(t)){C.size&&(I[t]-=C.size);const c=e[C.stack]||{size:0,count:1};c.size=Math.max(c.size,C.horizontal?l.height:l.width),C.size=c.size/c.count,I[t]+=C.size}l.getPadding&&tZ(n,l.getPadding());const o=Math.max(0,g.outerWidth-ed(n,I,"left","right")),A=Math.max(0,g.outerHeight-ed(n,I,"top","bottom")),i=o!==I.w,s=A!==I.h;return I.w=o,I.h=A,C.horizontal?{same:i,other:s}:{same:s,other:i}}function Ly(I){const g=I.maxPadding;function C(e){const t=Math.max(g[e]-I[e],0);return I[e]+=t,t}I.y+=C("top"),I.x+=C("left"),C("right"),C("bottom")}function Dy(I,g){const C=g.maxPadding;function e(t){const l={left:0,top:0,right:0,bottom:0};return t.forEach(n=>{l[n]=Math.max(g[n],C[n])}),l}return e(I?["left","right"]:["top","bottom"])}function rt(I,g,C,e){const t=[];let l,n,o,A,i,s;for(l=0,n=I.length,i=0;l<n;++l){o=I[l],A=o.box,A.update(o.width||g.w,o.height||g.h,Dy(o.horizontal,g));const{same:c,other:a}=Uy(g,C,o,e);i|=c&&t.length,s=s||a,A.fullSize||t.push(o)}return i&&rt(t,g,C,e)||s}function xl(I,g,C,e,t){I.top=C,I.left=g,I.right=g+e,I.bottom=C+t,I.width=e,I.height=t}function td(I,g,C,e){const t=C.padding;let{x:l,y:n}=g;for(const o of I){const A=o.box,i=e[o.stack]||{count:1,placed:0,weight:1},s=o.stackWeight/i.weight||1;if(o.horizontal){const c=g.w*s,a=i.size||A.height;Ot(i.start)&&(n=i.start),A.fullSize?xl(A,t.left,n,C.outerWidth-t.right-t.left,a):xl(A,g.left+i.placed,n,c,a),i.start=n,i.placed+=c,n=A.bottom}else{const c=g.h*s,a=i.size||A.width;Ot(i.start)&&(l=i.start),A.fullSize?xl(A,l,t.top,a,C.outerHeight-t.bottom-t.top):xl(A,l,g.top+i.placed,a,c),i.start=l,i.placed+=c,l=A.right}}g.x=l,g.y=n}var oC={addBox(I,g){I.boxes||(I.boxes=[]),g.fullSize=g.fullSize||!1,g.position=g.position||"top",g.weight=g.weight||0,g._layers=g._layers||function(){return[{z:0,draw(C){g.draw(C)}}]},I.boxes.push(g)},removeBox(I,g){const C=I.boxes?I.boxes.indexOf(g):-1;C!==-1&&I.boxes.splice(C,1)},configure(I,g,C){g.fullSize=C.fullSize,g.position=C.position,g.weight=C.weight},update(I,g,C,e){if(!I)return;const t=wg(I.options.layout.padding),l=Math.max(g-t.width,0),n=Math.max(C-t.height,0),o=Qy(I.boxes),A=o.vertical,i=o.horizontal;L(I.boxes,b=>{typeof b.beforeLayout=="function"&&b.beforeLayout()});const s=A.reduce((b,G)=>G.box.options&&G.box.options.display===!1?b:b+1,0)||1,c=Object.freeze({outerWidth:g,outerHeight:C,padding:t,availableWidth:l,availableHeight:n,vBoxMaxWidth:l/2/s,hBoxMaxHeight:n/2}),a=Object.assign({},t);tZ(a,wg(e));const r=Object.assign({maxPadding:a,w:l,h:n,x:t.left,y:t.top},t),m=Ey(A.concat(i),c);rt(o.fullSize,r,c,m),rt(A,r,c,m),rt(i,r,c,m)&&rt(A,r,c,m),Ly(r),td(o.leftAndTop,r,c,m),r.x+=r.w,r.y+=r.h,td(o.rightAndBottom,r,c,m),I.chartArea={left:r.left,top:r.top,right:r.left+r.w,bottom:r.top+r.h,height:r.h,width:r.w},L(o.chartArea,b=>{const G=b.box;Object.assign(G,I.chartArea),G.update(r.w,r.h,{left:0,top:0,right:0,bottom:0})})}};class lZ{acquireContext(g,C){}releaseContext(g){return!1}addEventListener(g,C,e){}removeEventListener(g,C,e){}getDevicePixelRatio(){return 1}getMaximumSize(g,C,e,t){return C=Math.max(0,C||g.width),e=e||g.height,{width:C,height:Math.max(0,t?Math.floor(C/t):e)}}isAttached(g){return!0}updateConfig(g){}}class Ty extends lZ{acquireContext(g){return g&&g.getContext&&g.getContext("2d")||null}updateConfig(g){g.options.animation=!1}}const on="$chartjs",jy={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},ld=I=>I===null||I==="";function Py(I,g){const C=I.style,e=I.getAttribute("height"),t=I.getAttribute("width");if(I[on]={initial:{height:e,width:t,style:{display:C.display,height:C.height,width:C.width}}},C.display=C.display||"block",C.boxSizing=C.boxSizing||"border-box",ld(t)){const l=Ua(I,"width");l!==void 0&&(I.width=l)}if(ld(e))if(I.style.height==="")I.height=I.width/(g||2);else{const l=Ua(I,"height");l!==void 0&&(I.height=l)}return I}const nZ=ny?{passive:!0}:!1;function Oy(I,g,C){I&&I.addEventListener(g,C,nZ)}function _y(I,g,C){I&&I.canvas&&I.canvas.removeEventListener(g,C,nZ)}function qy(I,g){const C=jy[I.type]||I.type,{x:e,y:t}=vC(I,g);return{type:C,chart:g,native:I,x:e!==void 0?e:null,y:t!==void 0?t:null}}function Ln(I,g){for(const C of I)if(C===g||C.contains(g))return!0}function $y(I,g,C){const e=I.canvas,t=new MutationObserver(l=>{let n=!1;for(const o of l)n=n||Ln(o.addedNodes,e),n=n&&!Ln(o.removedNodes,e);n&&C()});return t.observe(document,{childList:!0,subtree:!0}),t}function gp(I,g,C){const e=I.canvas,t=new MutationObserver(l=>{let n=!1;for(const o of l)n=n||Ln(o.removedNodes,e),n=n&&!Ln(o.addedNodes,e);n&&C()});return t.observe(document,{childList:!0,subtree:!0}),t}const qt=new Map;let nd=0;function oZ(){const I=window.devicePixelRatio;I!==nd&&(nd=I,qt.forEach((g,C)=>{C.currentDevicePixelRatio!==I&&g()}))}function Ip(I,g){qt.size||window.addEventListener("resize",oZ),qt.set(I,g)}function Cp(I){qt.delete(I),qt.size||window.removeEventListener("resize",oZ)}function ep(I,g,C){const e=I.canvas,t=e&&Ps(e);if(!t)return;const l=Eu((o,A)=>{const i=t.clientWidth;C(o,A),i<t.clientWidth&&C()},window),n=new ResizeObserver(o=>{const A=o[0],i=A.contentRect.width,s=A.contentRect.height;i===0&&s===0||l(i,s)});return n.observe(t),Ip(I,l),n}function bA(I,g,C){C&&C.disconnect(),g==="resize"&&Cp(I)}function tp(I,g,C){const e=I.canvas,t=Eu(l=>{I.ctx!==null&&C(qy(l,I))},I);return Oy(e,g,t),t}class lp extends lZ{acquireContext(g,C){const e=g&&g.getContext&&g.getContext("2d");return e&&e.canvas===g?(Py(g,C),e):null}releaseContext(g){const C=g.canvas;if(!C[on])return!1;const e=C[on].initial;["height","width"].forEach(l=>{const n=e[l];P(n)?C.removeAttribute(l):C.setAttribute(l,n)});const t=e.style||{};return Object.keys(t).forEach(l=>{C.style[l]=t[l]}),C.width=C.width,delete C[on],!0}addEventListener(g,C,e){this.removeEventListener(g,C);const t=g.$proxies||(g.$proxies={}),n={attach:$y,detach:gp,resize:ep}[C]||tp;t[C]=n(g,C,e)}removeEventListener(g,C){const e=g.$proxies||(g.$proxies={}),t=e[C];if(!t)return;({attach:bA,detach:bA,resize:bA}[C]||_y)(g,C,t),e[C]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(g,C,e,t){return ly(g,C,e,t)}isAttached(g){const C=g&&Ps(g);return!!(C&&C.isConnected)}}function np(I){return!js()||typeof OffscreenCanvas<"u"&&I instanceof OffscreenCanvas?Ty:lp}class yC{constructor(){N(this,"x");N(this,"y");N(this,"active",!1);N(this,"options");N(this,"$animations")}tooltipPosition(g){const{x:C,y:e}=this.getProps(["x","y"],g);return{x:C,y:e}}hasValue(){return Mn(this.x)&&Mn(this.y)}getProps(g,C){const e=this.$animations;if(!C||!e)return this;const t={};return g.forEach(l=>{t[l]=e[l]&&e[l].active()?e[l]._to:this[l]}),t}}N(yC,"defaults",{}),N(yC,"defaultRoutes");function op(I,g){const C=I.options.ticks,e=Ap(I),t=Math.min(C.maxTicksLimit||e,e),l=C.major.enabled?sp(g):[],n=l.length,o=l[0],A=l[n-1],i=[];if(n>t)return cp(g,i,l,n/t),i;const s=ip(l,g,t);if(n>0){let c,a;const r=n>1?Math.round((A-o)/(n-1)):null;for(zl(g,i,s,P(r)?0:o-r,o),c=0,a=n-1;c<a;c++)zl(g,i,s,l[c],l[c+1]);return zl(g,i,s,A,P(r)?g.length:A+r),i}return zl(g,i,s),i}function Ap(I){const g=I.options.offset,C=I._tickSize(),e=I._length/C+(g?0:1),t=I._maxLength/C;return Math.floor(Math.min(e,t))}function ip(I,g,C){const e=ap(I),t=g.length/C;if(!e)return Math.max(t,1);const l=bB(e);for(let n=0,o=l.length-1;n<o;n++){const A=l[n];if(A>t)return A}return Math.max(t,1)}function sp(I){const g=[];let C,e;for(C=0,e=I.length;C<e;C++)I[C].major&&g.push(C);return g}function cp(I,g,C,e){let t=0,l=C[0],n;for(e=Math.ceil(e),n=0;n<I.length;n++)n===l&&(g.push(I[n]),t++,l=C[t*e])}function zl(I,g,C,e,t){const l=U(e,0),n=Math.min(U(t,I.length),I.length);let o=0,A,i,s;for(C=Math.ceil(C),t&&(A=t-e,C=A/Math.floor(A/C)),s=l;s<0;)o++,s=Math.round(l+o*C);for(i=Math.max(l,0);i<n;i++)i===s&&(g.push(I[i]),o++,s=Math.round(l+o*C))}function ap(I){const g=I.length;let C,e;if(g<2)return!1;for(e=I[0],C=1;C<g;++C)if(I[C]-I[C-1]!==e)return!1;return e}const dp=I=>I==="left"?"right":I==="right"?"left":I,od=(I,g,C)=>g==="top"||g==="left"?I[g]+C:I[g]-C,Ad=(I,g)=>Math.min(g||I,I);function id(I,g){const C=[],e=I.length/g,t=I.length;let l=0;for(;l<t;l+=e)C.push(I[Math.floor(l)]);return C}function rp(I,g,C){const e=I.ticks.length,t=Math.min(g,e-1),l=I._startPixel,n=I._endPixel,o=1e-6;let A=I.getPixelForTick(t),i;if(!(C&&(e===1?i=Math.max(A-l,n-A):g===0?i=(I.getPixelForTick(1)-A)/2:i=(A-I.getPixelForTick(t-1))/2,A+=t<g?i:-i,A<l-o||A>n+o)))return A}function mp(I,g){L(I,C=>{const e=C.gc,t=e.length/2;let l;if(t>g){for(l=0;l<t;++l)delete C.data[e[l]];e.splice(0,t)}})}function lt(I){return I.drawTicks?I.tickLength:0}function sd(I,g){if(!I.display)return 0;const C=Sg(I.font,g),e=wg(I.padding);return(sg(I.text)?I.text.length:1)*C.lineHeight+e.height}function up(I,g){return ee(I,{scale:g,type:"scale"})}function Zp(I,g,C){return ee(I,{tick:C,index:g,type:"tick"})}function bp(I,g,C){let e=Qu(I);return(C&&g!=="right"||!C&&g==="right")&&(e=dp(e)),e}function hp(I,g,C,e){const{top:t,left:l,bottom:n,right:o,chart:A}=I,{chartArea:i,scales:s}=A;let c=0,a,r,m;const b=n-t,G=o-l;if(I.isHorizontal()){if(r=Og(e,l,o),E(C)){const u=Object.keys(C)[0],Z=C[u];m=s[u].getPixelForValue(Z)+b-g}else C==="center"?m=(i.bottom+i.top)/2+b-g:m=od(I,C,g);a=o-l}else{if(E(C)){const u=Object.keys(C)[0],Z=C[u];r=s[u].getPixelForValue(Z)-G+g}else C==="center"?r=(i.left+i.right)/2-G+g:r=od(I,C,g);m=Og(e,n,t),c=C==="left"?-rg:rg}return{titleX:r,titleY:m,maxWidth:a,rotation:c}}class te extends yC{constructor(g){super(),this.id=g.id,this.type=g.type,this.options=void 0,this.ctx=g.ctx,this.chart=g.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(g){this.options=g.setContext(this.getContext()),this.axis=g.axis,this._userMin=this.parse(g.min),this._userMax=this.parse(g.max),this._suggestedMin=this.parse(g.suggestedMin),this._suggestedMax=this.parse(g.suggestedMax)}parse(g,C){return g}getUserBounds(){let{_userMin:g,_userMax:C,_suggestedMin:e,_suggestedMax:t}=this;return g=_g(g,Number.POSITIVE_INFINITY),C=_g(C,Number.NEGATIVE_INFINITY),e=_g(e,Number.POSITIVE_INFINITY),t=_g(t,Number.NEGATIVE_INFINITY),{min:_g(g,e),max:_g(C,t),minDefined:yg(g),maxDefined:yg(C)}}getMinMax(g){let{min:C,max:e,minDefined:t,maxDefined:l}=this.getUserBounds(),n;if(t&&l)return{min:C,max:e};const o=this.getMatchingVisibleMetas();for(let A=0,i=o.length;A<i;++A)n=o[A].controller.getMinMax(this,g),t||(C=Math.min(C,n.min)),l||(e=Math.max(e,n.max));return C=l&&C>e?e:C,e=t&&C>e?C:e,{min:_g(C,_g(e,C)),max:_g(e,_g(C,e))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const g=this.chart.data;return this.options.labels||(this.isHorizontal()?g.xLabels:g.yLabels)||g.labels||[]}getLabelItems(g=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(g))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){q(this.options.beforeUpdate,[this])}update(g,C,e){const{beginAtZero:t,grace:l,ticks:n}=this.options,o=n.sampleSize;this.beforeUpdate(),this.maxWidth=g,this.maxHeight=C,this._margins=e=Object.assign({left:0,right:0,top:0,bottom:0},e),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+e.left+e.right:this.height+e.top+e.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=UB(this,l,t),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const A=o<this.ticks.length;this._convertTicksToLabels(A?id(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),n.display&&(n.autoSkip||n.source==="auto")&&(this.ticks=op(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),A&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let g=this.options.reverse,C,e;this.isHorizontal()?(C=this.left,e=this.right):(C=this.top,e=this.bottom,g=!g),this._startPixel=C,this._endPixel=e,this._reversePixels=g,this._length=e-C,this._alignToPixels=this.options.alignToPixels}afterUpdate(){q(this.options.afterUpdate,[this])}beforeSetDimensions(){q(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){q(this.options.afterSetDimensions,[this])}_callHooks(g){this.chart.notifyPlugins(g,this.getContext()),q(this.options[g],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){q(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(g){const C=this.options.ticks;let e,t,l;for(e=0,t=g.length;e<t;e++)l=g[e],l.label=q(C.callback,[l.value,e,g],this)}afterTickToLabelConversion(){q(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){q(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const g=this.options,C=g.ticks,e=Ad(this.ticks.length,g.ticks.maxTicksLimit),t=C.minRotation||0,l=C.maxRotation;let n=t,o,A,i;if(!this._isVisible()||!C.display||t>=l||e<=1||!this.isHorizontal()){this.labelRotation=t;return}const s=this._getLabelSizes(),c=s.widest.width,a=s.highest.height,r=Lg(this.chart.width-c,0,this.maxWidth);o=g.offset?this.maxWidth/e:r/(e-1),c+6>o&&(o=r/(e-(g.offset?.5:1)),A=this.maxHeight-lt(g.grid)-C.padding-sd(g.title,this.chart.options.font),i=Math.sqrt(c*c+a*a),n=zs(Math.min(Math.asin(Lg((s.highest.height+6)/o,-1,1)),Math.asin(Lg(A/i,-1,1))-Math.asin(Lg(a/i,-1,1)))),n=Math.max(t,Math.min(l,n))),this.labelRotation=n}afterCalculateLabelRotation(){q(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){q(this.options.beforeFit,[this])}fit(){const g={width:0,height:0},{chart:C,options:{ticks:e,title:t,grid:l}}=this,n=this._isVisible(),o=this.isHorizontal();if(n){const A=sd(t,C.options.font);if(o?(g.width=this.maxWidth,g.height=lt(l)+A):(g.height=this.maxHeight,g.width=lt(l)+A),e.display&&this.ticks.length){const{first:i,last:s,widest:c,highest:a}=this._getLabelSizes(),r=e.padding*2,m=kI(this.labelRotation),b=Math.cos(m),G=Math.sin(m);if(o){const u=e.mirror?0:G*c.width+b*a.height;g.height=Math.min(this.maxHeight,g.height+u+r)}else{const u=e.mirror?0:b*c.width+G*a.height;g.width=Math.min(this.maxWidth,g.width+u+r)}this._calculatePadding(i,s,G,b)}}this._handleMargins(),o?(this.width=this._length=C.width-this._margins.left-this._margins.right,this.height=g.height):(this.width=g.width,this.height=this._length=C.height-this._margins.top-this._margins.bottom)}_calculatePadding(g,C,e,t){const{ticks:{align:l,padding:n},position:o}=this.options,A=this.labelRotation!==0,i=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const s=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let a=0,r=0;A?i?(a=t*g.width,r=e*C.height):(a=e*g.height,r=t*C.width):l==="start"?r=C.width:l==="end"?a=g.width:l!=="inner"&&(a=g.width/2,r=C.width/2),this.paddingLeft=Math.max((a-s+n)*this.width/(this.width-s),0),this.paddingRight=Math.max((r-c+n)*this.width/(this.width-c),0)}else{let s=C.height/2,c=g.height/2;l==="start"?(s=0,c=g.height):l==="end"&&(s=C.height,c=0),this.paddingTop=s+n,this.paddingBottom=c+n}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){q(this.options.afterFit,[this])}isHorizontal(){const{axis:g,position:C}=this.options;return C==="top"||C==="bottom"||g==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(g){this.beforeTickToLabelConversion(),this.generateTickLabels(g);let C,e;for(C=0,e=g.length;C<e;C++)P(g[C].label)&&(g.splice(C,1),e--,C--);this.afterTickToLabelConversion()}_getLabelSizes(){let g=this._labelSizes;if(!g){const C=this.options.ticks.sampleSize;let e=this.ticks;C<e.length&&(e=id(e,C)),this._labelSizes=g=this._computeLabelSizes(e,e.length,this.options.ticks.maxTicksLimit)}return g}_computeLabelSizes(g,C,e){const{ctx:t,_longestTextCache:l}=this,n=[],o=[],A=Math.floor(C/Ad(C,e));let i=0,s=0,c,a,r,m,b,G,u,Z,h,B,y;for(c=0;c<C;c+=A){if(m=g[c].label,b=this._resolveTickFontOptions(c),t.font=G=b.string,u=l[G]=l[G]||{data:{},gc:[]},Z=b.lineHeight,h=B=0,!P(m)&&!sg(m))h=Qn(t,u.data,u.gc,h,m),B=Z;else if(sg(m))for(a=0,r=m.length;a<r;++a)y=m[a],!P(y)&&!sg(y)&&(h=Qn(t,u.data,u.gc,h,y),B+=Z);n.push(h),o.push(B),i=Math.max(h,i),s=Math.max(B,s)}mp(l,C);const V=n.indexOf(i),W=o.indexOf(s),R=f=>({width:n[f]||0,height:o[f]||0});return{first:R(0),last:R(C-1),widest:R(V),highest:R(W),widths:n,heights:o}}getLabelForValue(g){return g}getPixelForValue(g,C){return NaN}getValueForPixel(g){}getPixelForTick(g){const C=this.ticks;return g<0||g>C.length-1?null:this.getPixelForValue(C[g].value)}getPixelForDecimal(g){this._reversePixels&&(g=1-g);const C=this._startPixel+g*this._length;return BB(this._alignToPixels?JC(this.chart,C,0):C)}getDecimalForPixel(g){const C=(g-this._startPixel)/this._length;return this._reversePixels?1-C:C}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:g,max:C}=this;return g<0&&C<0?C:g>0&&C>0?g:0}getContext(g){const C=this.ticks||[];if(g>=0&&g<C.length){const e=C[g];return e.$context||(e.$context=Zp(this.getContext(),g,e))}return this.$context||(this.$context=up(this.chart.getContext(),this))}_tickSize(){const g=this.options.ticks,C=kI(this.labelRotation),e=Math.abs(Math.cos(C)),t=Math.abs(Math.sin(C)),l=this._getLabelSizes(),n=g.autoSkipPadding||0,o=l?l.widest.width+n:0,A=l?l.highest.height+n:0;return this.isHorizontal()?A*e>o*t?o/e:A/t:A*t<o*e?A/e:o/t}_isVisible(){const g=this.options.display;return g!=="auto"?!!g:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(g){const C=this.axis,e=this.chart,t=this.options,{grid:l,position:n,border:o}=t,A=l.offset,i=this.isHorizontal(),c=this.ticks.length+(A?1:0),a=lt(l),r=[],m=o.setContext(this.getContext()),b=m.display?m.width:0,G=b/2,u=function(j){return JC(e,j,b)};let Z,h,B,y,V,W,R,f,J,H,K,T;if(n==="top")Z=u(this.bottom),W=this.bottom-a,f=Z-G,H=u(g.top)+G,T=g.bottom;else if(n==="bottom")Z=u(this.top),H=g.top,T=u(g.bottom)-G,W=Z+G,f=this.top+a;else if(n==="left")Z=u(this.right),V=this.right-a,R=Z-G,J=u(g.left)+G,K=g.right;else if(n==="right")Z=u(this.left),J=g.left,K=u(g.right)-G,V=Z+G,R=this.left+a;else if(C==="x"){if(n==="center")Z=u((g.top+g.bottom)/2+.5);else if(E(n)){const j=Object.keys(n)[0],gg=n[j];Z=u(this.chart.scales[j].getPixelForValue(gg))}H=g.top,T=g.bottom,W=Z+G,f=W+a}else if(C==="y"){if(n==="center")Z=u((g.left+g.right)/2);else if(E(n)){const j=Object.keys(n)[0],gg=n[j];Z=u(this.chart.scales[j].getPixelForValue(gg))}V=Z-G,R=V-a,J=g.left,K=g.right}const Ag=U(t.ticks.maxTicksLimit,c),Q=Math.max(1,Math.ceil(c/Ag));for(h=0;h<c;h+=Q){const j=this.getContext(h),gg=l.setContext(j),k=o.setContext(j),v=gg.lineWidth,F=gg.color,_=k.dash||[],Ig=k.dashOffset,yI=gg.tickWidth,Hg=gg.tickColor,HI=gg.tickBorderDash||[],vg=gg.tickBorderDashOffset;B=rp(this,h,A),B!==void 0&&(y=JC(e,B,v),i?V=R=J=K=y:W=f=H=T=y,r.push({tx1:V,ty1:W,tx2:R,ty2:f,x1:J,y1:H,x2:K,y2:T,width:v,color:F,borderDash:_,borderDashOffset:Ig,tickWidth:yI,tickColor:Hg,tickBorderDash:HI,tickBorderDashOffset:vg}))}return this._ticksLength=c,this._borderValue=Z,r}_computeLabelItems(g){const C=this.axis,e=this.options,{position:t,ticks:l}=e,n=this.isHorizontal(),o=this.ticks,{align:A,crossAlign:i,padding:s,mirror:c}=l,a=lt(e.grid),r=a+s,m=c?-s:r,b=-kI(this.labelRotation),G=[];let u,Z,h,B,y,V,W,R,f,J,H,K,T="middle";if(t==="top")V=this.bottom-m,W=this._getXAxisLabelAlignment();else if(t==="bottom")V=this.top+m,W=this._getXAxisLabelAlignment();else if(t==="left"){const Q=this._getYAxisLabelAlignment(a);W=Q.textAlign,y=Q.x}else if(t==="right"){const Q=this._getYAxisLabelAlignment(a);W=Q.textAlign,y=Q.x}else if(C==="x"){if(t==="center")V=(g.top+g.bottom)/2+r;else if(E(t)){const Q=Object.keys(t)[0],j=t[Q];V=this.chart.scales[Q].getPixelForValue(j)+r}W=this._getXAxisLabelAlignment()}else if(C==="y"){if(t==="center")y=(g.left+g.right)/2-r;else if(E(t)){const Q=Object.keys(t)[0],j=t[Q];y=this.chart.scales[Q].getPixelForValue(j)}W=this._getYAxisLabelAlignment(a).textAlign}C==="y"&&(A==="start"?T="top":A==="end"&&(T="bottom"));const Ag=this._getLabelSizes();for(u=0,Z=o.length;u<Z;++u){h=o[u],B=h.label;const Q=l.setContext(this.getContext(u));R=this.getPixelForTick(u)+l.labelOffset,f=this._resolveTickFontOptions(u),J=f.lineHeight,H=sg(B)?B.length:1;const j=H/2,gg=Q.color,k=Q.textStrokeColor,v=Q.textStrokeWidth;let F=W;n?(y=R,W==="inner"&&(u===Z-1?F=this.options.reverse?"left":"right":u===0?F=this.options.reverse?"right":"left":F="center"),t==="top"?i==="near"||b!==0?K=-H*J+J/2:i==="center"?K=-Ag.highest.height/2-j*J+J:K=-Ag.highest.height+J/2:i==="near"||b!==0?K=J/2:i==="center"?K=Ag.highest.height/2-j*J:K=Ag.highest.height-H*J,c&&(K*=-1),b!==0&&!Q.showLabelBackdrop&&(y+=J/2*Math.sin(b))):(V=R,K=(1-H)*J/2);let _;if(Q.showLabelBackdrop){const Ig=wg(Q.backdropPadding),yI=Ag.heights[u],Hg=Ag.widths[u];let HI=K-Ig.top,vg=0-Ig.left;switch(T){case"middle":HI-=yI/2;break;case"bottom":HI-=yI;break}switch(W){case"center":vg-=Hg/2;break;case"right":vg-=Hg;break;case"inner":u===Z-1?vg-=Hg:u>0&&(vg-=Hg/2);break}_={left:vg,top:HI,width:Hg+Ig.width,height:yI+Ig.height,color:Q.backdropColor}}G.push({label:B,font:f,textOffset:K,options:{rotation:b,color:gg,strokeColor:k,strokeWidth:v,textAlign:F,textBaseline:T,translation:[y,V],backdrop:_}})}return G}_getXAxisLabelAlignment(){const{position:g,ticks:C}=this.options;if(-kI(this.labelRotation))return g==="top"?"left":"right";let t="center";return C.align==="start"?t="left":C.align==="end"?t="right":C.align==="inner"&&(t="inner"),t}_getYAxisLabelAlignment(g){const{position:C,ticks:{crossAlign:e,mirror:t,padding:l}}=this.options,n=this._getLabelSizes(),o=g+l,A=n.widest.width;let i,s;return C==="left"?t?(s=this.right+l,e==="near"?i="left":e==="center"?(i="center",s+=A/2):(i="right",s+=A)):(s=this.right-o,e==="near"?i="right":e==="center"?(i="center",s-=A/2):(i="left",s=this.left)):C==="right"?t?(s=this.left+l,e==="near"?i="right":e==="center"?(i="center",s-=A/2):(i="left",s-=A)):(s=this.left+o,e==="near"?i="left":e==="center"?(i="center",s+=A/2):(i="right",s=this.right)):i="right",{textAlign:i,x:s}}_computeLabelArea(){if(this.options.ticks.mirror)return;const g=this.chart,C=this.options.position;if(C==="left"||C==="right")return{top:0,left:this.left,bottom:g.height,right:this.right};if(C==="top"||C==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:g.width}}drawBackground(){const{ctx:g,options:{backgroundColor:C},left:e,top:t,width:l,height:n}=this;C&&(g.save(),g.fillStyle=C,g.fillRect(e,t,l,n),g.restore())}getLineWidthForValue(g){const C=this.options.grid;if(!this._isVisible()||!C.display)return 0;const t=this.ticks.findIndex(l=>l.value===g);return t>=0?C.setContext(this.getContext(t)).lineWidth:0}drawGrid(g){const C=this.options.grid,e=this.ctx,t=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(g));let l,n;const o=(A,i,s)=>{!s.width||!s.color||(e.save(),e.lineWidth=s.width,e.strokeStyle=s.color,e.setLineDash(s.borderDash||[]),e.lineDashOffset=s.borderDashOffset,e.beginPath(),e.moveTo(A.x,A.y),e.lineTo(i.x,i.y),e.stroke(),e.restore())};if(C.display)for(l=0,n=t.length;l<n;++l){const A=t[l];C.drawOnChartArea&&o({x:A.x1,y:A.y1},{x:A.x2,y:A.y2},A),C.drawTicks&&o({x:A.tx1,y:A.ty1},{x:A.tx2,y:A.ty2},{color:A.tickColor,width:A.tickWidth,borderDash:A.tickBorderDash,borderDashOffset:A.tickBorderDashOffset})}}drawBorder(){const{chart:g,ctx:C,options:{border:e,grid:t}}=this,l=e.setContext(this.getContext()),n=e.display?l.width:0;if(!n)return;const o=t.setContext(this.getContext(0)).lineWidth,A=this._borderValue;let i,s,c,a;this.isHorizontal()?(i=JC(g,this.left,n)-n/2,s=JC(g,this.right,o)+o/2,c=a=A):(c=JC(g,this.top,n)-n/2,a=JC(g,this.bottom,o)+o/2,i=s=A),C.save(),C.lineWidth=l.width,C.strokeStyle=l.color,C.beginPath(),C.moveTo(i,c),C.lineTo(s,a),C.stroke(),C.restore()}drawLabels(g){if(!this.options.ticks.display)return;const e=this.ctx,t=this._computeLabelArea();t&&Es(e,t);const l=this.getLabelItems(g);for(const n of l){const o=n.options,A=n.font,i=n.label,s=n.textOffset;we(e,i,0,s,A,o)}t&&Qs(e)}drawTitle(){const{ctx:g,options:{position:C,title:e,reverse:t}}=this;if(!e.display)return;const l=Sg(e.font),n=wg(e.padding),o=e.align;let A=l.lineHeight/2;C==="bottom"||C==="center"||E(C)?(A+=n.bottom,sg(e.text)&&(A+=l.lineHeight*(e.text.length-1))):A+=n.top;const{titleX:i,titleY:s,maxWidth:c,rotation:a}=hp(this,A,C,o);we(g,e.text,0,0,l,{color:e.color,maxWidth:c,rotation:a,textAlign:bp(o,C,t),textBaseline:"middle",translation:[i,s]})}draw(g){this._isVisible()&&(this.drawBackground(),this.drawGrid(g),this.drawBorder(),this.drawTitle(),this.drawLabels(g))}_layers(){const g=this.options,C=g.ticks&&g.ticks.z||0,e=U(g.grid&&g.grid.z,-1),t=U(g.border&&g.border.z,0);return!this._isVisible()||this.draw!==te.prototype.draw?[{z:C,draw:l=>{this.draw(l)}}]:[{z:e,draw:l=>{this.drawBackground(),this.drawGrid(l),this.drawTitle()}},{z:t,draw:()=>{this.drawBorder()}},{z:C,draw:l=>{this.drawLabels(l)}}]}getMatchingVisibleMetas(g){const C=this.chart.getSortedVisibleDatasetMetas(),e=this.axis+"AxisID",t=[];let l,n;for(l=0,n=C.length;l<n;++l){const o=C[l];o[e]===this.id&&(!g||o.type===g)&&t.push(o)}return t}_resolveTickFontOptions(g){const C=this.options.ticks.setContext(this.getContext(g));return Sg(C.font)}_maxDigits(){const g=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/g}}class Ml{constructor(g,C,e){this.type=g,this.scope=C,this.override=e,this.items=Object.create(null)}isForType(g){return Object.prototype.isPrototypeOf.call(this.type.prototype,g.prototype)}register(g){const C=Object.getPrototypeOf(g);let e;yp(C)&&(e=this.register(C));const t=this.items,l=g.id,n=this.scope+"."+l;if(!l)throw new Error("class does not have id: "+g);return l in t||(t[l]=g,Gp(g,n,e),this.override&&ag.override(g.id,g.overrides)),n}get(g){return this.items[g]}unregister(g){const C=this.items,e=g.id,t=this.scope;e in C&&delete C[e],t&&e in ag[t]&&(delete ag[t][e],this.override&&delete qC[e])}}function Gp(I,g,C){const e=Pt(Object.create(null),[C?ag.get(C):{},ag.get(g),I.defaults]);ag.set(g,e),I.defaultRoutes&&Bp(g,I.defaultRoutes),I.descriptors&&ag.describe(g,I.descriptors)}function Bp(I,g){Object.keys(g).forEach(C=>{const e=C.split("."),t=e.pop(),l=[I].concat(e).join("."),n=g[C].split("."),o=n.pop(),A=n.join(".");ag.route(l,t,A,o)})}function yp(I){return"id"in I&&"defaults"in I}class pp{constructor(){this.controllers=new Ml(ke,"datasets",!0),this.elements=new Ml(yC,"elements"),this.plugins=new Ml(Object,"plugins"),this.scales=new Ml(te,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...g){this._each("register",g)}remove(...g){this._each("unregister",g)}addControllers(...g){this._each("register",g,this.controllers)}addElements(...g){this._each("register",g,this.elements)}addPlugins(...g){this._each("register",g,this.plugins)}addScales(...g){this._each("register",g,this.scales)}getController(g){return this._get(g,this.controllers,"controller")}getElement(g){return this._get(g,this.elements,"element")}getPlugin(g){return this._get(g,this.plugins,"plugin")}getScale(g){return this._get(g,this.scales,"scale")}removeControllers(...g){this._each("unregister",g,this.controllers)}removeElements(...g){this._each("unregister",g,this.elements)}removePlugins(...g){this._each("unregister",g,this.plugins)}removeScales(...g){this._each("unregister",g,this.scales)}_each(g,C,e){[...C].forEach(t=>{const l=e||this._getRegistryForType(t);e||l.isForType(t)||l===this.plugins&&t.id?this._exec(g,l,t):L(t,n=>{const o=e||this._getRegistryForType(n);this._exec(g,o,n)})})}_exec(g,C,e){const t=xs(g);q(e["before"+t],[],e),C[g](e),q(e["after"+t],[],e)}_getRegistryForType(g){for(let C=0;C<this._typedRegistries.length;C++){const e=this._typedRegistries[C];if(e.isForType(g))return e}return this.plugins}_get(g,C,e){const t=C.get(g);if(t===void 0)throw new Error('"'+g+'" is not a registered '+e+".");return t}}var RI=new pp;class Wp{constructor(){this._init=[]}notify(g,C,e,t){C==="beforeInit"&&(this._init=this._createDescriptors(g,!0),this._notify(this._init,g,"install"));const l=t?this._descriptors(g).filter(t):this._descriptors(g),n=this._notify(l,g,C,e);return C==="afterDestroy"&&(this._notify(l,g,"stop"),this._notify(this._init,g,"uninstall")),n}_notify(g,C,e,t){t=t||{};for(const l of g){const n=l.plugin,o=n[e],A=[C,t,l.options];if(q(o,A,n)===!1&&t.cancelable)return!1}return!0}invalidate(){P(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(g){if(this._cache)return this._cache;const C=this._cache=this._createDescriptors(g);return this._notifyStateChanges(g),C}_createDescriptors(g,C){const e=g&&g.config,t=U(e.options&&e.options.plugins,{}),l=Vp(e);return t===!1&&!C?[]:Rp(g,l,t,C)}_notifyStateChanges(g){const C=this._oldCache||[],e=this._cache,t=(l,n)=>l.filter(o=>!n.some(A=>o.plugin.id===A.plugin.id));this._notify(t(C,e),g,"stop"),this._notify(t(e,C),g,"start")}}function Vp(I){const g={},C=[],e=Object.keys(RI.plugins.items);for(let l=0;l<e.length;l++)C.push(RI.getPlugin(e[l]));const t=I.plugins||[];for(let l=0;l<t.length;l++){const n=t[l];C.indexOf(n)===-1&&(C.push(n),g[n.id]=!0)}return{plugins:C,localIds:g}}function Sp(I,g){return!g&&I===!1?null:I===!0?{}:I}function Rp(I,{plugins:g,localIds:C},e,t){const l=[],n=I.getContext();for(const o of g){const A=o.id,i=Sp(e[A],t);i!==null&&l.push({plugin:o,options:Xp(I.config,{plugin:o,local:C[A]},i,n)})}return l}function Xp(I,{plugin:g,local:C},e,t){const l=I.pluginScopeKeys(g),n=I.getOptionScopes(e,l);return C&&g.defaults&&n.push(g.defaults),I.createResolver(n,t,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Wi(I,g){const C=ag.datasets[I]||{};return((g.datasets||{})[I]||{}).indexAxis||g.indexAxis||C.indexAxis||"x"}function Jp(I,g){let C=I;return I==="_index_"?C=g:I==="_value_"&&(C=g==="x"?"y":"x"),C}function kp(I,g){return I===g?"_index_":"_value_"}function cd(I){if(I==="x"||I==="y"||I==="r")return I}function fp(I){if(I==="top"||I==="bottom")return"x";if(I==="left"||I==="right")return"y"}function Vi(I,...g){if(cd(I))return I;for(const C of g){const e=C.axis||fp(C.position)||I.length>1&&cd(I[0].toLowerCase());if(e)return e}throw new Error(`Cannot determine type of '${I}' axis. Please provide 'axis' or 'position' option.`)}function ad(I,g,C){if(C[g+"AxisID"]===I)return{axis:g}}function Yp(I,g){if(g.data&&g.data.datasets){const C=g.data.datasets.filter(e=>e.xAxisID===I||e.yAxisID===I);if(C.length)return ad(I,"x",C[0])||ad(I,"y",C[0])}return{}}function Hp(I,g){const C=qC[I.type]||{scales:{}},e=g.scales||{},t=Wi(I.type,g),l=Object.create(null);return Object.keys(e).forEach(n=>{const o=e[n];if(!E(o))return console.error(`Invalid scale configuration for scale: ${n}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${n}`);const A=Vi(n,o,Yp(n,I),ag.scales[o.type]),i=kp(A,t),s=C.scales||{};l[n]=St(Object.create(null),[{axis:A},o,s[A],s[i]])}),I.data.datasets.forEach(n=>{const o=n.type||I.type,A=n.indexAxis||Wi(o,g),s=(qC[o]||{}).scales||{};Object.keys(s).forEach(c=>{const a=Jp(c,A),r=n[a+"AxisID"]||a;l[r]=l[r]||Object.create(null),St(l[r],[{axis:a},e[r],s[c]])})}),Object.keys(l).forEach(n=>{const o=l[n];St(o,[ag.scales[o.type],ag.scale])}),l}function AZ(I){const g=I.options||(I.options={});g.plugins=U(g.plugins,{}),g.scales=Hp(I,g)}function iZ(I){return I=I||{},I.datasets=I.datasets||[],I.labels=I.labels||[],I}function vp(I){return I=I||{},I.data=iZ(I.data),AZ(I),I}const dd=new Map,sZ=new Set;function El(I,g){let C=dd.get(I);return C||(C=g(),dd.set(I,C),sZ.add(C)),C}const nt=(I,g,C)=>{const e=_C(g,C);e!==void 0&&I.add(e)};class Np{constructor(g){this._config=vp(g),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(g){this._config.type=g}get data(){return this._config.data}set data(g){this._config.data=iZ(g)}get options(){return this._config.options}set options(g){this._config.options=g}get plugins(){return this._config.plugins}update(){const g=this._config;this.clearCache(),AZ(g)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(g){return El(g,()=>[[`datasets.${g}`,""]])}datasetAnimationScopeKeys(g,C){return El(`${g}.transition.${C}`,()=>[[`datasets.${g}.transitions.${C}`,`transitions.${C}`],[`datasets.${g}`,""]])}datasetElementScopeKeys(g,C){return El(`${g}-${C}`,()=>[[`datasets.${g}.elements.${C}`,`datasets.${g}`,`elements.${C}`,""]])}pluginScopeKeys(g){const C=g.id,e=this.type;return El(`${e}-plugin-${C}`,()=>[[`plugins.${C}`,...g.additionalOptionScopes||[]]])}_cachedScopes(g,C){const e=this._scopeCache;let t=e.get(g);return(!t||C)&&(t=new Map,e.set(g,t)),t}getOptionScopes(g,C,e){const{options:t,type:l}=this,n=this._cachedScopes(g,e),o=n.get(C);if(o)return o;const A=new Set;C.forEach(s=>{g&&(A.add(g),s.forEach(c=>nt(A,g,c))),s.forEach(c=>nt(A,t,c)),s.forEach(c=>nt(A,qC[l]||{},c)),s.forEach(c=>nt(A,ag,c)),s.forEach(c=>nt(A,yi,c))});const i=Array.from(A);return i.length===0&&i.push(Object.create(null)),sZ.has(C)&&n.set(C,i),i}chartOptionScopes(){const{options:g,type:C}=this;return[g,qC[C]||{},ag.datasets[C]||{},{type:C},ag,yi]}resolveNamedOptions(g,C,e,t=[""]){const l={$shared:!0},{resolver:n,subPrefixes:o}=rd(this._resolverCache,g,t);let A=n;if(Kp(n,C)){l.$shared=!1,e=BC(e)?e():e;const i=this.createResolver(g,e,o);A=xe(n,e,i)}for(const i of C)l[i]=A[i];return l}createResolver(g,C,e=[""],t){const{resolver:l}=rd(this._resolverCache,g,e);return E(C)?xe(l,C,void 0,t):l}}function rd(I,g,C){let e=I.get(g);e||(e=new Map,I.set(g,e));const t=C.join();let l=e.get(t);return l||(l={resolver:Ls(g,C),subPrefixes:C.filter(o=>!o.toLowerCase().includes("hover"))},e.set(t,l)),l}const Fp=I=>E(I)&&Object.getOwnPropertyNames(I).some(g=>BC(I[g]));function Kp(I,g){const{isScriptable:C,isIndexable:e}=ju(I);for(const t of g){const l=C(t),n=e(t),o=(n||l)&&I[t];if(l&&(BC(o)||Fp(o))||n&&sg(o))return!0}return!1}var wp="4.4.3";const xp=["top","bottom","left","right","chartArea"];function md(I,g){return I==="top"||I==="bottom"||xp.indexOf(I)===-1&&g==="x"}function ud(I,g){return function(C,e){return C[I]===e[I]?C[g]-e[g]:C[I]-e[I]}}function Zd(I){const g=I.chart,C=g.options.animation;g.notifyPlugins("afterRender"),q(C&&C.onComplete,[I],g)}function zp(I){const g=I.chart,C=g.options.animation;q(C&&C.onProgress,[I],g)}function cZ(I){return js()&&typeof I=="string"?I=document.getElementById(I):I&&I.length&&(I=I[0]),I&&I.canvas&&(I=I.canvas),I}const An={},bd=I=>{const g=cZ(I);return Object.values(An).filter(C=>C.canvas===g).pop()};function Mp(I,g,C){const e=Object.keys(I);for(const t of e){const l=+t;if(l>=g){const n=I[t];delete I[t],(C>0||l>g)&&(I[l+C]=n)}}}function Ep(I,g,C,e){return!C||I.type==="mouseout"?null:e?g:I}function Ql(I,g,C){return I.options.clip?I[C]:g[C]}function Qp(I,g){const{xScale:C,yScale:e}=I;return C&&e?{left:Ql(C,g,"left"),right:Ql(C,g,"right"),top:Ql(e,g,"top"),bottom:Ql(e,g,"bottom")}:g}var _I;let ho=(_I=class{static register(...g){RI.add(...g),hd()}static unregister(...g){RI.remove(...g),hd()}constructor(g,C){const e=this.config=new Np(C),t=cZ(g),l=bd(t);if(l)throw new Error("Canvas is already in use. Chart with ID '"+l.id+"' must be destroyed before the canvas with ID '"+l.canvas.id+"' can be reused.");const n=e.createResolver(e.chartOptionScopes(),this.getContext());this.platform=new(e.platform||np(t)),this.platform.updateConfig(e);const o=this.platform.acquireContext(t,n.aspectRatio),A=o&&o.canvas,i=A&&A.height,s=A&&A.width;if(this.id=sB(),this.ctx=o,this.canvas=A,this.width=s,this.height=i,this._options=n,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Wp,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=VB(c=>this.update(c),n.resizeDelay||0),this._dataChanges=[],An[this.id]=this,!o||!A){console.error("Failed to create chart: can't acquire context from the given item");return}NI.listen(this,"complete",Zd),NI.listen(this,"progress",zp),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:g,maintainAspectRatio:C},width:e,height:t,_aspectRatio:l}=this;return P(g)?C&&l?l:t?e/t:null:g}get data(){return this.config.data}set data(g){this.config.data=g}get options(){return this._options}set options(g){this.config.options=g}get registry(){return RI}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Qa(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return xa(this.canvas,this.ctx),this}stop(){return NI.stop(this),this}resize(g,C){NI.running(this)?this._resizeBeforeDraw={width:g,height:C}:this._resize(g,C)}_resize(g,C){const e=this.options,t=this.canvas,l=e.maintainAspectRatio&&this.aspectRatio,n=this.platform.getMaximumSize(t,g,C,l),o=e.devicePixelRatio||this.platform.getDevicePixelRatio(),A=this.width?"resize":"attach";this.width=n.width,this.height=n.height,this._aspectRatio=this.aspectRatio,Qa(this,o,!0)&&(this.notifyPlugins("resize",{size:n}),q(e.onResize,[this,n],this),this.attached&&this._doResize(A)&&this.render())}ensureScalesHaveIDs(){const C=this.options.scales||{};L(C,(e,t)=>{e.id=t})}buildOrUpdateScales(){const g=this.options,C=g.scales,e=this.scales,t=Object.keys(e).reduce((n,o)=>(n[o]=!1,n),{});let l=[];C&&(l=l.concat(Object.keys(C).map(n=>{const o=C[n],A=Vi(n,o),i=A==="r",s=A==="x";return{options:o,dposition:i?"chartArea":s?"bottom":"left",dtype:i?"radialLinear":s?"category":"linear"}}))),L(l,n=>{const o=n.options,A=o.id,i=Vi(A,o),s=U(o.type,n.dtype);(o.position===void 0||md(o.position,i)!==md(n.dposition))&&(o.position=n.dposition),t[A]=!0;let c=null;if(A in e&&e[A].type===s)c=e[A];else{const a=RI.getScale(s);c=new a({id:A,type:s,ctx:this.ctx,chart:this}),e[c.id]=c}c.init(o,g)}),L(t,(n,o)=>{n||delete e[o]}),L(e,n=>{oC.configure(this,n,n.options),oC.addBox(this,n)})}_updateMetasets(){const g=this._metasets,C=this.data.datasets.length,e=g.length;if(g.sort((t,l)=>t.index-l.index),e>C){for(let t=C;t<e;++t)this._destroyDatasetMeta(t);g.splice(C,e-C)}this._sortedMetasets=g.slice(0).sort(ud("order","index"))}_removeUnreferencedMetasets(){const{_metasets:g,data:{datasets:C}}=this;g.length>C.length&&delete this._stacks,g.forEach((e,t)=>{C.filter(l=>l===e._dataset).length===0&&this._destroyDatasetMeta(t)})}buildOrUpdateControllers(){const g=[],C=this.data.datasets;let e,t;for(this._removeUnreferencedMetasets(),e=0,t=C.length;e<t;e++){const l=C[e];let n=this.getDatasetMeta(e);const o=l.type||this.config.type;if(n.type&&n.type!==o&&(this._destroyDatasetMeta(e),n=this.getDatasetMeta(e)),n.type=o,n.indexAxis=l.indexAxis||Wi(o,this.options),n.order=l.order||0,n.index=e,n.label=""+l.label,n.visible=this.isDatasetVisible(e),n.controller)n.controller.updateIndex(e),n.controller.linkScales();else{const A=RI.getController(o),{datasetElementType:i,dataElementType:s}=ag.datasets[o];Object.assign(A,{dataElementType:RI.getElement(s),datasetElementType:i&&RI.getElement(i)}),n.controller=new A(this,e),g.push(n.controller)}}return this._updateMetasets(),g}_resetElements(){L(this.data.datasets,(g,C)=>{this.getDatasetMeta(C).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(g){const C=this.config;C.update();const e=this._options=C.createResolver(C.chartOptionScopes(),this.getContext()),t=this._animationsDisabled=!e.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:g,cancelable:!0})===!1)return;const l=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let n=0;for(let i=0,s=this.data.datasets.length;i<s;i++){const{controller:c}=this.getDatasetMeta(i),a=!t&&l.indexOf(c)===-1;c.buildOrUpdateElements(a),n=Math.max(+c.getMaxOverflow(),n)}n=this._minPadding=e.layout.autoPadding?n:0,this._updateLayout(n),t||L(l,i=>{i.reset()}),this._updateDatasets(g),this.notifyPlugins("afterUpdate",{mode:g}),this._layers.sort(ud("z","_idx"));const{_active:o,_lastEvent:A}=this;A?this._eventHandler(A,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){L(this.scales,g=>{oC.removeBox(this,g)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const g=this.options,C=new Set(Object.keys(this._listeners)),e=new Set(g.events);(!ka(C,e)||!!this._responsiveListeners!==g.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:g}=this,C=this._getUniformDataChanges()||[];for(const{method:e,start:t,count:l}of C){const n=e==="_removeElements"?-l:l;Mp(g,t,n)}}_getUniformDataChanges(){const g=this._dataChanges;if(!g||!g.length)return;this._dataChanges=[];const C=this.data.datasets.length,e=l=>new Set(g.filter(n=>n[0]===l).map((n,o)=>o+","+n.splice(1).join(","))),t=e(0);for(let l=1;l<C;l++)if(!ka(t,e(l)))return;return Array.from(t).map(l=>l.split(",")).map(l=>({method:l[1],start:+l[2],count:+l[3]}))}_updateLayout(g){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;oC.update(this,this.width,this.height,g);const C=this.chartArea,e=C.width<=0||C.height<=0;this._layers=[],L(this.boxes,t=>{e&&t.position==="chartArea"||(t.configure&&t.configure(),this._layers.push(...t._layers()))},this),this._layers.forEach((t,l)=>{t._idx=l}),this.notifyPlugins("afterLayout")}_updateDatasets(g){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:g,cancelable:!0})!==!1){for(let C=0,e=this.data.datasets.length;C<e;++C)this.getDatasetMeta(C).controller.configure();for(let C=0,e=this.data.datasets.length;C<e;++C)this._updateDataset(C,BC(g)?g({datasetIndex:C}):g);this.notifyPlugins("afterDatasetsUpdate",{mode:g})}}_updateDataset(g,C){const e=this.getDatasetMeta(g),t={meta:e,index:g,mode:C,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",t)!==!1&&(e.controller._update(C),t.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",t))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(NI.has(this)?this.attached&&!NI.running(this)&&NI.start(this):(this.draw(),Zd({chart:this})))}draw(){let g;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resize(e,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const C=this._layers;for(g=0;g<C.length&&C[g].z<=0;++g)C[g].draw(this.chartArea);for(this._drawDatasets();g<C.length;++g)C[g].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(g){const C=this._sortedMetasets,e=[];let t,l;for(t=0,l=C.length;t<l;++t){const n=C[t];(!g||n.visible)&&e.push(n)}return e}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const g=this.getSortedVisibleDatasetMetas();for(let C=g.length-1;C>=0;--C)this._drawDataset(g[C]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(g){const C=this.ctx,e=g._clip,t=!e.disabled,l=Qp(g,this.chartArea),n={meta:g,index:g.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",n)!==!1&&(t&&Es(C,{left:e.left===!1?0:l.left-e.left,right:e.right===!1?this.width:l.right+e.right,top:e.top===!1?0:l.top-e.top,bottom:e.bottom===!1?this.height:l.bottom+e.bottom}),g.controller.draw(),t&&Qs(C),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(g){return Be(g,this.chartArea,this._minPadding)}getElementsAtEventForMode(g,C,e,t){const l=xy.modes[C];return typeof l=="function"?l(this,g,e,t):[]}getDatasetMeta(g){const C=this.data.datasets[g],e=this._metasets;let t=e.filter(l=>l&&l._dataset===C).pop();return t||(t={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:C&&C.order||0,index:g,_dataset:C,_parsed:[],_sorted:!1},e.push(t)),t}getContext(){return this.$context||(this.$context=ee(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(g){const C=this.data.datasets[g];if(!C)return!1;const e=this.getDatasetMeta(g);return typeof e.hidden=="boolean"?!e.hidden:!C.hidden}setDatasetVisibility(g,C){const e=this.getDatasetMeta(g);e.hidden=!C}toggleDataVisibility(g){this._hiddenIndices[g]=!this._hiddenIndices[g]}getDataVisibility(g){return!this._hiddenIndices[g]}_updateVisibility(g,C,e){const t=e?"show":"hide",l=this.getDatasetMeta(g),n=l.controller._resolveAnimations(void 0,t);Ot(C)?(l.data[C].hidden=!e,this.update()):(this.setDatasetVisibility(g,e),n.update(l,{visible:e}),this.update(o=>o.datasetIndex===g?t:void 0))}hide(g,C){this._updateVisibility(g,C,!1)}show(g,C){this._updateVisibility(g,C,!0)}_destroyDatasetMeta(g){const C=this._metasets[g];C&&C.controller&&C.controller._destroy(),delete this._metasets[g]}_stop(){let g,C;for(this.stop(),NI.remove(this),g=0,C=this.data.datasets.length;g<C;++g)this._destroyDatasetMeta(g)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:g,ctx:C}=this;this._stop(),this.config.clearCache(),g&&(this.unbindEvents(),xa(g,C),this.platform.releaseContext(C),this.canvas=null,this.ctx=null),delete An[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...g){return this.canvas.toDataURL(...g)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const g=this._listeners,C=this.platform,e=(l,n)=>{C.addEventListener(this,l,n),g[l]=n},t=(l,n,o)=>{l.offsetX=n,l.offsetY=o,this._eventHandler(l)};L(this.options.events,l=>e(l,t))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const g=this._responsiveListeners,C=this.platform,e=(A,i)=>{C.addEventListener(this,A,i),g[A]=i},t=(A,i)=>{g[A]&&(C.removeEventListener(this,A,i),delete g[A])},l=(A,i)=>{this.canvas&&this.resize(A,i)};let n;const o=()=>{t("attach",o),this.attached=!0,this.resize(),e("resize",l),e("detach",n)};n=()=>{this.attached=!1,t("resize",l),this._stop(),this._resize(0,0),e("attach",o)},C.isAttached(this.canvas)?o():n()}unbindEvents(){L(this._listeners,(g,C)=>{this.platform.removeEventListener(this,C,g)}),this._listeners={},L(this._responsiveListeners,(g,C)=>{this.platform.removeEventListener(this,C,g)}),this._responsiveListeners=void 0}updateHoverStyle(g,C,e){const t=e?"set":"remove";let l,n,o,A;for(C==="dataset"&&(l=this.getDatasetMeta(g[0].datasetIndex),l.controller["_"+t+"DatasetHoverStyle"]()),o=0,A=g.length;o<A;++o){n=g[o];const i=n&&this.getDatasetMeta(n.datasetIndex).controller;i&&i[t+"HoverStyle"](n.element,n.datasetIndex,n.index)}}getActiveElements(){return this._active||[]}setActiveElements(g){const C=this._active||[],e=g.map(({datasetIndex:l,index:n})=>{const o=this.getDatasetMeta(l);if(!o)throw new Error("No dataset found at index "+l);return{datasetIndex:l,element:o.data[n],index:n}});!wn(e,C)&&(this._active=e,this._lastEvent=null,this._updateHoverStyles(e,C))}notifyPlugins(g,C,e){return this._plugins.notify(this,g,C,e)}isPluginEnabled(g){return this._plugins._cache.filter(C=>C.plugin.id===g).length===1}_updateHoverStyles(g,C,e){const t=this.options.hover,l=(A,i)=>A.filter(s=>!i.some(c=>s.datasetIndex===c.datasetIndex&&s.index===c.index)),n=l(C,g),o=e?g:l(g,C);n.length&&this.updateHoverStyle(n,t.mode,!1),o.length&&t.mode&&this.updateHoverStyle(o,t.mode,!0)}_eventHandler(g,C){const e={event:g,replay:C,cancelable:!0,inChartArea:this.isPointInArea(g)},t=n=>(n.options.events||this.options.events).includes(g.native.type);if(this.notifyPlugins("beforeEvent",e,t)===!1)return;const l=this._handleEvent(g,C,e.inChartArea);return e.cancelable=!1,this.notifyPlugins("afterEvent",e,t),(l||e.changed)&&this.render(),this}_handleEvent(g,C,e){const{_active:t=[],options:l}=this,n=C,o=this._getActiveElements(g,t,e,n),A=uB(g),i=Ep(g,this._lastEvent,e,A);e&&(this._lastEvent=null,q(l.onHover,[g,o,this],this),A&&q(l.onClick,[g,o,this],this));const s=!wn(o,t);return(s||C)&&(this._active=o,this._updateHoverStyles(o,t,C)),this._lastEvent=i,s}_getActiveElements(g,C,e,t){if(g.type==="mouseout")return[];if(!e)return C;const l=this.options.hover;return this.getElementsAtEventForMode(g,l.mode,l,t)}},N(_I,"defaults",ag),N(_I,"instances",An),N(_I,"overrides",qC),N(_I,"registry",RI),N(_I,"version",wp),N(_I,"getChart",bd),_I);function hd(){return L(ho.instances,I=>I._plugins.invalidate())}function Up(I,g,C){const{startAngle:e,pixelMargin:t,x:l,y:n,outerRadius:o,innerRadius:A}=g;let i=t/o;I.beginPath(),I.arc(l,n,o,e-i,C+i),A>t?(i=t/A,I.arc(l,n,A,C+i,e-i,!0)):I.arc(l,n,t,C+rg,e-rg),I.closePath(),I.clip()}function Lp(I){return Us(I,["outerStart","outerEnd","innerStart","innerEnd"])}function Dp(I,g,C,e){const t=Lp(I.options.borderRadius),l=(C-g)/2,n=Math.min(l,e*g/2),o=A=>{const i=(C-Math.min(l,A))*e/2;return Lg(A,0,Math.min(l,i))};return{outerStart:o(t.outerStart),outerEnd:o(t.outerEnd),innerStart:Lg(t.innerStart,0,n),innerEnd:Lg(t.innerEnd,0,n)}}function oe(I,g,C,e){return{x:C+I*Math.cos(g),y:e+I*Math.sin(g)}}function Dn(I,g,C,e,t,l){const{x:n,y:o,startAngle:A,pixelMargin:i,innerRadius:s}=g,c=Math.max(g.outerRadius+e+C-i,0),a=s>0?s+e+C+i:0;let r=0;const m=t-A;if(e){const Q=s>0?s-e:0,j=c>0?c-e:0,gg=(Q+j)/2,k=gg!==0?m*gg/(gg+e):m;r=(m-k)/2}const b=Math.max(.001,m*c-C/bg)/c,G=(m-b)/2,u=A+G+r,Z=t-G-r,{outerStart:h,outerEnd:B,innerStart:y,innerEnd:V}=Dp(g,a,c,Z-u),W=c-h,R=c-B,f=u+h/W,J=Z-B/R,H=a+y,K=a+V,T=u+y/H,Ag=Z-V/K;if(I.beginPath(),l){const Q=(f+J)/2;if(I.arc(n,o,c,f,Q),I.arc(n,o,c,Q,J),B>0){const v=oe(R,J,n,o);I.arc(v.x,v.y,B,J,Z+rg)}const j=oe(K,Z,n,o);if(I.lineTo(j.x,j.y),V>0){const v=oe(K,Ag,n,o);I.arc(v.x,v.y,V,Z+rg,Ag+Math.PI)}const gg=(Z-V/a+(u+y/a))/2;if(I.arc(n,o,a,Z-V/a,gg,!0),I.arc(n,o,a,gg,u+y/a,!0),y>0){const v=oe(H,T,n,o);I.arc(v.x,v.y,y,T+Math.PI,u-rg)}const k=oe(W,u,n,o);if(I.lineTo(k.x,k.y),h>0){const v=oe(W,f,n,o);I.arc(v.x,v.y,h,u-rg,f)}}else{I.moveTo(n,o);const Q=Math.cos(f)*c+n,j=Math.sin(f)*c+o;I.lineTo(Q,j);const gg=Math.cos(J)*c+n,k=Math.sin(J)*c+o;I.lineTo(gg,k)}I.closePath()}function Tp(I,g,C,e,t){const{fullCircles:l,startAngle:n,circumference:o}=g;let A=g.endAngle;if(l){Dn(I,g,C,e,A,t);for(let i=0;i<l;++i)I.fill();isNaN(o)||(A=n+(o%cg||cg))}return Dn(I,g,C,e,A,t),I.fill(),A}function jp(I,g,C,e,t){const{fullCircles:l,startAngle:n,circumference:o,options:A}=g,{borderWidth:i,borderJoinStyle:s,borderDash:c,borderDashOffset:a}=A,r=A.borderAlign==="inner";if(!i)return;I.setLineDash(c||[]),I.lineDashOffset=a,r?(I.lineWidth=i*2,I.lineJoin=s||"round"):(I.lineWidth=i,I.lineJoin=s||"bevel");let m=g.endAngle;if(l){Dn(I,g,C,e,m,t);for(let b=0;b<l;++b)I.stroke();isNaN(o)||(m=n+(o%cg||cg))}r&&Up(I,g,m),l||(Dn(I,g,C,e,m,t),I.stroke())}class mt extends yC{constructor(C){super();N(this,"circumference");N(this,"endAngle");N(this,"fullCircles");N(this,"innerRadius");N(this,"outerRadius");N(this,"pixelMargin");N(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,C&&Object.assign(this,C)}inRange(C,e,t){const l=this.getProps(["x","y"],t),{angle:n,distance:o}=wu(l,{x:C,y:e}),{startAngle:A,endAngle:i,innerRadius:s,outerRadius:c,circumference:a}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],t),r=(this.options.spacing+this.options.borderWidth)/2,b=U(a,i-A)>=cg||En(n,A,i),G=wC(o,s+r,c+r);return b&&G}getCenterPoint(C){const{x:e,y:t,startAngle:l,endAngle:n,innerRadius:o,outerRadius:A}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],C),{offset:i,spacing:s}=this.options,c=(l+n)/2,a=(o+A+s+i)/2;return{x:e+Math.cos(c)*a,y:t+Math.sin(c)*a}}tooltipPosition(C){return this.getCenterPoint(C)}draw(C){const{options:e,circumference:t}=this,l=(e.offset||0)/4,n=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin=e.borderAlign==="inner"?.33:0,this.fullCircles=t>cg?Math.floor(t/cg):0,t===0||this.innerRadius<0||this.outerRadius<0)return;C.save();const A=(this.startAngle+this.endAngle)/2;C.translate(Math.cos(A)*l,Math.sin(A)*l);const i=1-Math.sin(Math.min(bg,t||0)),s=l*i;C.fillStyle=e.backgroundColor,C.strokeStyle=e.borderColor,Tp(C,this,s,n,o),jp(C,this,s,n,o),C.restore()}}N(mt,"id","arc"),N(mt,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),N(mt,"defaultRoutes",{backgroundColor:"backgroundColor"}),N(mt,"descriptors",{_scriptable:!0,_indexable:C=>C!=="borderDash"});function aZ(I,g){const{x:C,y:e,base:t,width:l,height:n}=I.getProps(["x","y","base","width","height"],g);let o,A,i,s,c;return I.horizontal?(c=n/2,o=Math.min(C,t),A=Math.max(C,t),i=e-c,s=e+c):(c=l/2,o=C-c,A=C+c,i=Math.min(e,t),s=Math.max(e,t)),{left:o,top:i,right:A,bottom:s}}function AC(I,g,C,e){return I?0:Lg(g,C,e)}function Pp(I,g,C){const e=I.options.borderWidth,t=I.borderSkipped,l=Tu(e);return{t:AC(t.top,l.top,0,C),r:AC(t.right,l.right,0,g),b:AC(t.bottom,l.bottom,0,C),l:AC(t.left,l.left,0,g)}}function Op(I,g,C){const{enableBorderRadius:e}=I.getProps(["enableBorderRadius"]),t=I.options.borderRadius,l=EC(t),n=Math.min(g,C),o=I.borderSkipped,A=e||E(t);return{topLeft:AC(!A||o.top||o.left,l.topLeft,0,n),topRight:AC(!A||o.top||o.right,l.topRight,0,n),bottomLeft:AC(!A||o.bottom||o.left,l.bottomLeft,0,n),bottomRight:AC(!A||o.bottom||o.right,l.bottomRight,0,n)}}function _p(I){const g=aZ(I),C=g.right-g.left,e=g.bottom-g.top,t=Pp(I,C/2,e/2),l=Op(I,C/2,e/2);return{outer:{x:g.left,y:g.top,w:C,h:e,radius:l},inner:{x:g.left+t.l,y:g.top+t.t,w:C-t.l-t.r,h:e-t.t-t.b,radius:{topLeft:Math.max(0,l.topLeft-Math.max(t.t,t.l)),topRight:Math.max(0,l.topRight-Math.max(t.t,t.r)),bottomLeft:Math.max(0,l.bottomLeft-Math.max(t.b,t.l)),bottomRight:Math.max(0,l.bottomRight-Math.max(t.b,t.r))}}}}function hA(I,g,C,e){const t=g===null,l=C===null,o=I&&!(t&&l)&&aZ(I,e);return o&&(t||wC(g,o.left,o.right))&&(l||wC(C,o.top,o.bottom))}function qp(I){return I.topLeft||I.topRight||I.bottomLeft||I.bottomRight}function $p(I,g){I.rect(g.x,g.y,g.w,g.h)}function GA(I,g,C={}){const e=I.x!==C.x?-g:0,t=I.y!==C.y?-g:0,l=(I.x+I.w!==C.x+C.w?g:0)-e,n=(I.y+I.h!==C.y+C.h?g:0)-t;return{x:I.x+e,y:I.y+t,w:I.w+l,h:I.h+n,radius:I.radius}}class sn extends yC{constructor(g){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,g&&Object.assign(this,g)}draw(g){const{inflateAmount:C,options:{borderColor:e,backgroundColor:t}}=this,{inner:l,outer:n}=_p(this),o=qp(n.radius)?_t:$p;g.save(),(n.w!==l.w||n.h!==l.h)&&(g.beginPath(),o(g,GA(n,C,l)),g.clip(),o(g,GA(l,-C,n)),g.fillStyle=e,g.fill("evenodd")),g.beginPath(),o(g,GA(l,C)),g.fillStyle=t,g.fill(),g.restore()}inRange(g,C,e){return hA(this,g,C,e)}inXRange(g,C){return hA(this,g,null,C)}inYRange(g,C){return hA(this,null,g,C)}getCenterPoint(g){const{x:C,y:e,base:t,horizontal:l}=this.getProps(["x","y","base","horizontal"],g);return{x:l?(C+t)/2:C,y:l?e:(e+t)/2}}getRange(g){return g==="x"?this.width/2:this.height/2}}N(sn,"id","bar"),N(sn,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),N(sn,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const Gd=(I,g)=>{let{boxHeight:C=g,boxWidth:e=g}=I;return I.usePointStyle&&(C=Math.min(C,g),e=I.pointStyleWidth||Math.min(e,g)),{boxWidth:e,boxHeight:C,itemHeight:Math.max(g,C)}},gW=(I,g)=>I!==null&&g!==null&&I.datasetIndex===g.datasetIndex&&I.index===g.index;class Bd extends yC{constructor(g){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=g.chart,this.options=g.options,this.ctx=g.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(g,C,e){this.maxWidth=g,this.maxHeight=C,this._margins=e,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const g=this.options.labels||{};let C=q(g.generateLabels,[this.chart],this)||[];g.filter&&(C=C.filter(e=>g.filter(e,this.chart.data))),g.sort&&(C=C.sort((e,t)=>g.sort(e,t,this.chart.data))),this.options.reverse&&C.reverse(),this.legendItems=C}fit(){const{options:g,ctx:C}=this;if(!g.display){this.width=this.height=0;return}const e=g.labels,t=Sg(e.font),l=t.size,n=this._computeTitleHeight(),{boxWidth:o,itemHeight:A}=Gd(e,l);let i,s;C.font=t.string,this.isHorizontal()?(i=this.maxWidth,s=this._fitRows(n,l,o,A)+10):(s=this.maxHeight,i=this._fitCols(n,t,o,A)+10),this.width=Math.min(i,g.maxWidth||this.maxWidth),this.height=Math.min(s,g.maxHeight||this.maxHeight)}_fitRows(g,C,e,t){const{ctx:l,maxWidth:n,options:{labels:{padding:o}}}=this,A=this.legendHitBoxes=[],i=this.lineWidths=[0],s=t+o;let c=g;l.textAlign="left",l.textBaseline="middle";let a=-1,r=-s;return this.legendItems.forEach((m,b)=>{const G=e+C/2+l.measureText(m.text).width;(b===0||i[i.length-1]+G+2*o>n)&&(c+=s,i[i.length-(b>0?0:1)]=0,r+=s,a++),A[b]={left:0,top:r,row:a,width:G,height:t},i[i.length-1]+=G+o}),c}_fitCols(g,C,e,t){const{ctx:l,maxHeight:n,options:{labels:{padding:o}}}=this,A=this.legendHitBoxes=[],i=this.columnSizes=[],s=n-g;let c=o,a=0,r=0,m=0,b=0;return this.legendItems.forEach((G,u)=>{const{itemWidth:Z,itemHeight:h}=IW(e,C,l,G,t);u>0&&r+h+2*o>s&&(c+=a+o,i.push({width:a,height:r}),m+=a+o,b++,a=r=0),A[u]={left:m,top:r,col:b,width:Z,height:h},a=Math.max(a,Z),r+=h+o}),c+=a,i.push({width:a,height:r}),c}adjustHitBoxes(){if(!this.options.display)return;const g=this._computeTitleHeight(),{legendHitBoxes:C,options:{align:e,labels:{padding:t},rtl:l}}=this,n=Je(l,this.left,this.width);if(this.isHorizontal()){let o=0,A=Og(e,this.left+t,this.right-this.lineWidths[o]);for(const i of C)o!==i.row&&(o=i.row,A=Og(e,this.left+t,this.right-this.lineWidths[o])),i.top+=this.top+g+t,i.left=n.leftForLtr(n.x(A),i.width),A+=i.width+t}else{let o=0,A=Og(e,this.top+g+t,this.bottom-this.columnSizes[o].height);for(const i of C)i.col!==o&&(o=i.col,A=Og(e,this.top+g+t,this.bottom-this.columnSizes[o].height)),i.top=A,i.left+=this.left+t,i.left=n.leftForLtr(n.x(i.left),i.width),A+=i.height+t}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const g=this.ctx;Es(g,this),this._draw(),Qs(g)}}_draw(){const{options:g,columnSizes:C,lineWidths:e,ctx:t}=this,{align:l,labels:n}=g,o=ag.color,A=Je(g.rtl,this.left,this.width),i=Sg(n.font),{padding:s}=n,c=i.size,a=c/2;let r;this.drawTitle(),t.textAlign=A.textAlign("left"),t.textBaseline="middle",t.lineWidth=.5,t.font=i.string;const{boxWidth:m,boxHeight:b,itemHeight:G}=Gd(n,c),u=function(V,W,R){if(isNaN(m)||m<=0||isNaN(b)||b<0)return;t.save();const f=U(R.lineWidth,1);if(t.fillStyle=U(R.fillStyle,o),t.lineCap=U(R.lineCap,"butt"),t.lineDashOffset=U(R.lineDashOffset,0),t.lineJoin=U(R.lineJoin,"miter"),t.lineWidth=f,t.strokeStyle=U(R.strokeStyle,o),t.setLineDash(U(R.lineDash,[])),n.usePointStyle){const J={radius:b*Math.SQRT2/2,pointStyle:R.pointStyle,rotation:R.rotation,borderWidth:f},H=A.xPlus(V,m/2),K=W+a;Du(t,J,H,K,n.pointStyleWidth&&m)}else{const J=W+Math.max((c-b)/2,0),H=A.leftForLtr(V,m),K=EC(R.borderRadius);t.beginPath(),Object.values(K).some(T=>T!==0)?_t(t,{x:H,y:J,w:m,h:b,radius:K}):t.rect(H,J,m,b),t.fill(),f!==0&&t.stroke()}t.restore()},Z=function(V,W,R){we(t,R.text,V,W+G/2,i,{strikethrough:R.hidden,textAlign:A.textAlign(R.textAlign)})},h=this.isHorizontal(),B=this._computeTitleHeight();h?r={x:Og(l,this.left+s,this.right-e[0]),y:this.top+s+B,line:0}:r={x:this.left+s,y:Og(l,this.top+B+s,this.bottom-C[0].height),line:0},qu(this.ctx,g.textDirection);const y=G+s;this.legendItems.forEach((V,W)=>{t.strokeStyle=V.fontColor,t.fillStyle=V.fontColor;const R=t.measureText(V.text).width,f=A.textAlign(V.textAlign||(V.textAlign=n.textAlign)),J=m+a+R;let H=r.x,K=r.y;A.setWidth(this.width),h?W>0&&H+J+s>this.right&&(K=r.y+=y,r.line++,H=r.x=Og(l,this.left+s,this.right-e[r.line])):W>0&&K+y>this.bottom&&(H=r.x=H+C[r.line].width+s,r.line++,K=r.y=Og(l,this.top+B+s,this.bottom-C[r.line].height));const T=A.x(H);if(u(T,K,V),H=SB(f,H+m+a,h?H+J:this.right,g.rtl),Z(A.x(H),K,V),h)r.x+=J+s;else if(typeof V.text!="string"){const Ag=i.lineHeight;r.y+=dZ(V,Ag)+s}else r.y+=y}),$u(this.ctx,g.textDirection)}drawTitle(){const g=this.options,C=g.title,e=Sg(C.font),t=wg(C.padding);if(!C.display)return;const l=Je(g.rtl,this.left,this.width),n=this.ctx,o=C.position,A=e.size/2,i=t.top+A;let s,c=this.left,a=this.width;if(this.isHorizontal())a=Math.max(...this.lineWidths),s=this.top+i,c=Og(g.align,c,this.right-a);else{const m=this.columnSizes.reduce((b,G)=>Math.max(b,G.height),0);s=i+Og(g.align,this.top,this.bottom-m-g.labels.padding-this._computeTitleHeight())}const r=Og(o,c,c+a);n.textAlign=l.textAlign(Qu(o)),n.textBaseline="middle",n.strokeStyle=C.color,n.fillStyle=C.color,n.font=e.string,we(n,C.text,r,s,e)}_computeTitleHeight(){const g=this.options.title,C=Sg(g.font),e=wg(g.padding);return g.display?C.lineHeight+e.height:0}_getLegendItemAt(g,C){let e,t,l;if(wC(g,this.left,this.right)&&wC(C,this.top,this.bottom)){for(l=this.legendHitBoxes,e=0;e<l.length;++e)if(t=l[e],wC(g,t.left,t.left+t.width)&&wC(C,t.top,t.top+t.height))return this.legendItems[e]}return null}handleEvent(g){const C=this.options;if(!tW(g.type,C))return;const e=this._getLegendItemAt(g.x,g.y);if(g.type==="mousemove"||g.type==="mouseout"){const t=this._hoveredItem,l=gW(t,e);t&&!l&&q(C.onLeave,[g,t,this],this),this._hoveredItem=e,e&&!l&&q(C.onHover,[g,e,this],this)}else e&&q(C.onClick,[g,e,this],this)}}function IW(I,g,C,e,t){const l=CW(e,I,g,C),n=eW(t,e,g.lineHeight);return{itemWidth:l,itemHeight:n}}function CW(I,g,C,e){let t=I.text;return t&&typeof t!="string"&&(t=t.reduce((l,n)=>l.length>n.length?l:n)),g+C.size/2+e.measureText(t).width}function eW(I,g,C){let e=I;return typeof g.text!="string"&&(e=dZ(g,C)),e}function dZ(I,g){const C=I.text?I.text.length:0;return g*C}function tW(I,g){return!!((I==="mousemove"||I==="mouseout")&&(g.onHover||g.onLeave)||g.onClick&&(I==="click"||I==="mouseup"))}var lW={id:"legend",_element:Bd,start(I,g,C){const e=I.legend=new Bd({ctx:I.ctx,options:C,chart:I});oC.configure(I,e,C),oC.addBox(I,e)},stop(I){oC.removeBox(I,I.legend),delete I.legend},beforeUpdate(I,g,C){const e=I.legend;oC.configure(I,e,C),e.options=C},afterUpdate(I){const g=I.legend;g.buildLabels(),g.adjustHitBoxes()},afterEvent(I,g){g.replay||I.legend.handleEvent(g.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(I,g,C){const e=g.datasetIndex,t=C.chart;t.isDatasetVisible(e)?(t.hide(e),g.hidden=!0):(t.show(e),g.hidden=!1)},onHover:null,onLeave:null,labels:{color:I=>I.chart.options.color,boxWidth:40,padding:10,generateLabels(I){const g=I.data.datasets,{labels:{usePointStyle:C,pointStyle:e,textAlign:t,color:l,useBorderRadius:n,borderRadius:o}}=I.legend.options;return I._getSortedDatasetMetas().map(A=>{const i=A.controller.getStyle(C?0:void 0),s=wg(i.borderWidth);return{text:g[A.index].label,fillStyle:i.backgroundColor,fontColor:l,hidden:!A.visible,lineCap:i.borderCapStyle,lineDash:i.borderDash,lineDashOffset:i.borderDashOffset,lineJoin:i.borderJoinStyle,lineWidth:(s.width+s.height)/4,strokeStyle:i.borderColor,pointStyle:e||i.pointStyle,rotation:i.rotation,textAlign:t||i.textAlign,borderRadius:n&&(o||i.borderRadius),datasetIndex:A.index}},this)}},title:{color:I=>I.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:I=>!I.startsWith("on"),labels:{_scriptable:I=>!["generateLabels","filter","sort"].includes(I)}}};const ut={average(I){if(!I.length)return!1;let g,C,e=new Set,t=0,l=0;for(g=0,C=I.length;g<C;++g){const o=I[g].element;if(o&&o.hasValue()){const A=o.tooltipPosition();e.add(A.x),t+=A.y,++l}}return{x:[...e].reduce((o,A)=>o+A)/e.size,y:t/l}},nearest(I,g){if(!I.length)return!1;let C=g.x,e=g.y,t=Number.POSITIVE_INFINITY,l,n,o;for(l=0,n=I.length;l<n;++l){const A=I[l].element;if(A&&A.hasValue()){const i=A.getCenterPoint(),s=GB(g,i);s<t&&(t=s,o=A)}}if(o){const A=o.tooltipPosition();C=A.x,e=A.y}return{x:C,y:e}}};function WI(I,g){return g&&(sg(g)?Array.prototype.push.apply(I,g):I.push(g)),I}function FI(I){return(typeof I=="string"||I instanceof String)&&I.indexOf(`
`)>-1?I.split(`
`):I}function nW(I,g){const{element:C,datasetIndex:e,index:t}=g,l=I.getDatasetMeta(e).controller,{label:n,value:o}=l.getLabelAndValue(t);return{chart:I,label:n,parsed:l.getParsed(t),raw:I.data.datasets[e].data[t],formattedValue:o,dataset:l.getDataset(),dataIndex:t,datasetIndex:e,element:C}}function yd(I,g){const C=I.chart.ctx,{body:e,footer:t,title:l}=I,{boxWidth:n,boxHeight:o}=g,A=Sg(g.bodyFont),i=Sg(g.titleFont),s=Sg(g.footerFont),c=l.length,a=t.length,r=e.length,m=wg(g.padding);let b=m.height,G=0,u=e.reduce((B,y)=>B+y.before.length+y.lines.length+y.after.length,0);if(u+=I.beforeBody.length+I.afterBody.length,c&&(b+=c*i.lineHeight+(c-1)*g.titleSpacing+g.titleMarginBottom),u){const B=g.displayColors?Math.max(o,A.lineHeight):A.lineHeight;b+=r*B+(u-r)*A.lineHeight+(u-1)*g.bodySpacing}a&&(b+=g.footerMarginTop+a*s.lineHeight+(a-1)*g.footerSpacing);let Z=0;const h=function(B){G=Math.max(G,C.measureText(B).width+Z)};return C.save(),C.font=i.string,L(I.title,h),C.font=A.string,L(I.beforeBody.concat(I.afterBody),h),Z=g.displayColors?n+2+g.boxPadding:0,L(e,B=>{L(B.before,h),L(B.lines,h),L(B.after,h)}),Z=0,C.font=s.string,L(I.footer,h),C.restore(),G+=m.width,{width:G,height:b}}function oW(I,g){const{y:C,height:e}=g;return C<e/2?"top":C>I.height-e/2?"bottom":"center"}function AW(I,g,C,e){const{x:t,width:l}=e,n=C.caretSize+C.caretPadding;if(I==="left"&&t+l+n>g.width||I==="right"&&t-l-n<0)return!0}function iW(I,g,C,e){const{x:t,width:l}=C,{width:n,chartArea:{left:o,right:A}}=I;let i="center";return e==="center"?i=t<=(o+A)/2?"left":"right":t<=l/2?i="left":t>=n-l/2&&(i="right"),AW(i,I,g,C)&&(i="center"),i}function pd(I,g,C){const e=C.yAlign||g.yAlign||oW(I,C);return{xAlign:C.xAlign||g.xAlign||iW(I,g,C,e),yAlign:e}}function sW(I,g){let{x:C,width:e}=I;return g==="right"?C-=e:g==="center"&&(C-=e/2),C}function cW(I,g,C){let{y:e,height:t}=I;return g==="top"?e+=C:g==="bottom"?e-=t+C:e-=t/2,e}function Wd(I,g,C,e){const{caretSize:t,caretPadding:l,cornerRadius:n}=I,{xAlign:o,yAlign:A}=C,i=t+l,{topLeft:s,topRight:c,bottomLeft:a,bottomRight:r}=EC(n);let m=sW(g,o);const b=cW(g,A,i);return A==="center"?o==="left"?m+=i:o==="right"&&(m-=i):o==="left"?m-=Math.max(s,a)+t:o==="right"&&(m+=Math.max(c,r)+t),{x:Lg(m,0,e.width-g.width),y:Lg(b,0,e.height-g.height)}}function Ul(I,g,C){const e=wg(C.padding);return g==="center"?I.x+I.width/2:g==="right"?I.x+I.width-e.right:I.x+e.left}function Vd(I){return WI([],FI(I))}function aW(I,g,C){return ee(I,{tooltip:g,tooltipItems:C,type:"tooltip"})}function Sd(I,g){const C=g&&g.dataset&&g.dataset.tooltip&&g.dataset.tooltip.callbacks;return C?I.override(C):I}const rZ={beforeTitle:vI,title(I){if(I.length>0){const g=I[0],C=g.chart.data.labels,e=C?C.length:0;if(this&&this.options&&this.options.mode==="dataset")return g.dataset.label||"";if(g.label)return g.label;if(e>0&&g.dataIndex<e)return C[g.dataIndex]}return""},afterTitle:vI,beforeBody:vI,beforeLabel:vI,label(I){if(this&&this.options&&this.options.mode==="dataset")return I.label+": "+I.formattedValue||I.formattedValue;let g=I.dataset.label||"";g&&(g+=": ");const C=I.formattedValue;return P(C)||(g+=C),g},labelColor(I){const C=I.chart.getDatasetMeta(I.datasetIndex).controller.getStyle(I.dataIndex);return{borderColor:C.borderColor,backgroundColor:C.backgroundColor,borderWidth:C.borderWidth,borderDash:C.borderDash,borderDashOffset:C.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(I){const C=I.chart.getDatasetMeta(I.datasetIndex).controller.getStyle(I.dataIndex);return{pointStyle:C.pointStyle,rotation:C.rotation}},afterLabel:vI,afterBody:vI,beforeFooter:vI,footer:vI,afterFooter:vI};function Mg(I,g,C,e){const t=I[g].call(C,e);return typeof t>"u"?rZ[g].call(C,e):t}class Si extends yC{constructor(g){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=g.chart,this.options=g.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(g){this.options=g,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const g=this._cachedAnimations;if(g)return g;const C=this.chart,e=this.options.setContext(this.getContext()),t=e.enabled&&C.options.animation&&e.animations,l=new gZ(this.chart,t);return t._cacheable&&(this._cachedAnimations=Object.freeze(l)),l}getContext(){return this.$context||(this.$context=aW(this.chart.getContext(),this,this._tooltipItems))}getTitle(g,C){const{callbacks:e}=C,t=Mg(e,"beforeTitle",this,g),l=Mg(e,"title",this,g),n=Mg(e,"afterTitle",this,g);let o=[];return o=WI(o,FI(t)),o=WI(o,FI(l)),o=WI(o,FI(n)),o}getBeforeBody(g,C){return Vd(Mg(C.callbacks,"beforeBody",this,g))}getBody(g,C){const{callbacks:e}=C,t=[];return L(g,l=>{const n={before:[],lines:[],after:[]},o=Sd(e,l);WI(n.before,FI(Mg(o,"beforeLabel",this,l))),WI(n.lines,Mg(o,"label",this,l)),WI(n.after,FI(Mg(o,"afterLabel",this,l))),t.push(n)}),t}getAfterBody(g,C){return Vd(Mg(C.callbacks,"afterBody",this,g))}getFooter(g,C){const{callbacks:e}=C,t=Mg(e,"beforeFooter",this,g),l=Mg(e,"footer",this,g),n=Mg(e,"afterFooter",this,g);let o=[];return o=WI(o,FI(t)),o=WI(o,FI(l)),o=WI(o,FI(n)),o}_createItems(g){const C=this._active,e=this.chart.data,t=[],l=[],n=[];let o=[],A,i;for(A=0,i=C.length;A<i;++A)o.push(nW(this.chart,C[A]));return g.filter&&(o=o.filter((s,c,a)=>g.filter(s,c,a,e))),g.itemSort&&(o=o.sort((s,c)=>g.itemSort(s,c,e))),L(o,s=>{const c=Sd(g.callbacks,s);t.push(Mg(c,"labelColor",this,s)),l.push(Mg(c,"labelPointStyle",this,s)),n.push(Mg(c,"labelTextColor",this,s))}),this.labelColors=t,this.labelPointStyles=l,this.labelTextColors=n,this.dataPoints=o,o}update(g,C){const e=this.options.setContext(this.getContext()),t=this._active;let l,n=[];if(!t.length)this.opacity!==0&&(l={opacity:0});else{const o=ut[e.position].call(this,t,this._eventPosition);n=this._createItems(e),this.title=this.getTitle(n,e),this.beforeBody=this.getBeforeBody(n,e),this.body=this.getBody(n,e),this.afterBody=this.getAfterBody(n,e),this.footer=this.getFooter(n,e);const A=this._size=yd(this,e),i=Object.assign({},o,A),s=pd(this.chart,e,i),c=Wd(e,i,s,this.chart);this.xAlign=s.xAlign,this.yAlign=s.yAlign,l={opacity:1,x:c.x,y:c.y,width:A.width,height:A.height,caretX:o.x,caretY:o.y}}this._tooltipItems=n,this.$context=void 0,l&&this._resolveAnimations().update(this,l),g&&e.external&&e.external.call(this,{chart:this.chart,tooltip:this,replay:C})}drawCaret(g,C,e,t){const l=this.getCaretPosition(g,e,t);C.lineTo(l.x1,l.y1),C.lineTo(l.x2,l.y2),C.lineTo(l.x3,l.y3)}getCaretPosition(g,C,e){const{xAlign:t,yAlign:l}=this,{caretSize:n,cornerRadius:o}=e,{topLeft:A,topRight:i,bottomLeft:s,bottomRight:c}=EC(o),{x:a,y:r}=g,{width:m,height:b}=C;let G,u,Z,h,B,y;return l==="center"?(B=r+b/2,t==="left"?(G=a,u=G-n,h=B+n,y=B-n):(G=a+m,u=G+n,h=B-n,y=B+n),Z=G):(t==="left"?u=a+Math.max(A,s)+n:t==="right"?u=a+m-Math.max(i,c)-n:u=this.caretX,l==="top"?(h=r,B=h-n,G=u-n,Z=u+n):(h=r+b,B=h+n,G=u+n,Z=u-n),y=h),{x1:G,x2:u,x3:Z,y1:h,y2:B,y3:y}}drawTitle(g,C,e){const t=this.title,l=t.length;let n,o,A;if(l){const i=Je(e.rtl,this.x,this.width);for(g.x=Ul(this,e.titleAlign,e),C.textAlign=i.textAlign(e.titleAlign),C.textBaseline="middle",n=Sg(e.titleFont),o=e.titleSpacing,C.fillStyle=e.titleColor,C.font=n.string,A=0;A<l;++A)C.fillText(t[A],i.x(g.x),g.y+n.lineHeight/2),g.y+=n.lineHeight+o,A+1===l&&(g.y+=e.titleMarginBottom-o)}}_drawColorBox(g,C,e,t,l){const n=this.labelColors[e],o=this.labelPointStyles[e],{boxHeight:A,boxWidth:i}=l,s=Sg(l.bodyFont),c=Ul(this,"left",l),a=t.x(c),r=A<s.lineHeight?(s.lineHeight-A)/2:0,m=C.y+r;if(l.usePointStyle){const b={radius:Math.min(i,A)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},G=t.leftForLtr(a,i)+i/2,u=m+A/2;g.strokeStyle=l.multiKeyBackground,g.fillStyle=l.multiKeyBackground,za(g,b,G,u),g.strokeStyle=n.borderColor,g.fillStyle=n.backgroundColor,za(g,b,G,u)}else{g.lineWidth=E(n.borderWidth)?Math.max(...Object.values(n.borderWidth)):n.borderWidth||1,g.strokeStyle=n.borderColor,g.setLineDash(n.borderDash||[]),g.lineDashOffset=n.borderDashOffset||0;const b=t.leftForLtr(a,i),G=t.leftForLtr(t.xPlus(a,1),i-2),u=EC(n.borderRadius);Object.values(u).some(Z=>Z!==0)?(g.beginPath(),g.fillStyle=l.multiKeyBackground,_t(g,{x:b,y:m,w:i,h:A,radius:u}),g.fill(),g.stroke(),g.fillStyle=n.backgroundColor,g.beginPath(),_t(g,{x:G,y:m+1,w:i-2,h:A-2,radius:u}),g.fill()):(g.fillStyle=l.multiKeyBackground,g.fillRect(b,m,i,A),g.strokeRect(b,m,i,A),g.fillStyle=n.backgroundColor,g.fillRect(G,m+1,i-2,A-2))}g.fillStyle=this.labelTextColors[e]}drawBody(g,C,e){const{body:t}=this,{bodySpacing:l,bodyAlign:n,displayColors:o,boxHeight:A,boxWidth:i,boxPadding:s}=e,c=Sg(e.bodyFont);let a=c.lineHeight,r=0;const m=Je(e.rtl,this.x,this.width),b=function(R){C.fillText(R,m.x(g.x+r),g.y+a/2),g.y+=a+l},G=m.textAlign(n);let u,Z,h,B,y,V,W;for(C.textAlign=n,C.textBaseline="middle",C.font=c.string,g.x=Ul(this,G,e),C.fillStyle=e.bodyColor,L(this.beforeBody,b),r=o&&G!=="right"?n==="center"?i/2+s:i+2+s:0,B=0,V=t.length;B<V;++B){for(u=t[B],Z=this.labelTextColors[B],C.fillStyle=Z,L(u.before,b),h=u.lines,o&&h.length&&(this._drawColorBox(C,g,B,m,e),a=Math.max(c.lineHeight,A)),y=0,W=h.length;y<W;++y)b(h[y]),a=c.lineHeight;L(u.after,b)}r=0,a=c.lineHeight,L(this.afterBody,b),g.y-=l}drawFooter(g,C,e){const t=this.footer,l=t.length;let n,o;if(l){const A=Je(e.rtl,this.x,this.width);for(g.x=Ul(this,e.footerAlign,e),g.y+=e.footerMarginTop,C.textAlign=A.textAlign(e.footerAlign),C.textBaseline="middle",n=Sg(e.footerFont),C.fillStyle=e.footerColor,C.font=n.string,o=0;o<l;++o)C.fillText(t[o],A.x(g.x),g.y+n.lineHeight/2),g.y+=n.lineHeight+e.footerSpacing}}drawBackground(g,C,e,t){const{xAlign:l,yAlign:n}=this,{x:o,y:A}=g,{width:i,height:s}=e,{topLeft:c,topRight:a,bottomLeft:r,bottomRight:m}=EC(t.cornerRadius);C.fillStyle=t.backgroundColor,C.strokeStyle=t.borderColor,C.lineWidth=t.borderWidth,C.beginPath(),C.moveTo(o+c,A),n==="top"&&this.drawCaret(g,C,e,t),C.lineTo(o+i-a,A),C.quadraticCurveTo(o+i,A,o+i,A+a),n==="center"&&l==="right"&&this.drawCaret(g,C,e,t),C.lineTo(o+i,A+s-m),C.quadraticCurveTo(o+i,A+s,o+i-m,A+s),n==="bottom"&&this.drawCaret(g,C,e,t),C.lineTo(o+r,A+s),C.quadraticCurveTo(o,A+s,o,A+s-r),n==="center"&&l==="left"&&this.drawCaret(g,C,e,t),C.lineTo(o,A+c),C.quadraticCurveTo(o,A,o+c,A),C.closePath(),C.fill(),t.borderWidth>0&&C.stroke()}_updateAnimationTarget(g){const C=this.chart,e=this.$animations,t=e&&e.x,l=e&&e.y;if(t||l){const n=ut[g.position].call(this,this._active,this._eventPosition);if(!n)return;const o=this._size=yd(this,g),A=Object.assign({},n,this._size),i=pd(C,g,A),s=Wd(g,A,i,C);(t._to!==s.x||l._to!==s.y)&&(this.xAlign=i.xAlign,this.yAlign=i.yAlign,this.width=o.width,this.height=o.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,s))}}_willRender(){return!!this.opacity}draw(g){const C=this.options.setContext(this.getContext());let e=this.opacity;if(!e)return;this._updateAnimationTarget(C);const t={width:this.width,height:this.height},l={x:this.x,y:this.y};e=Math.abs(e)<.001?0:e;const n=wg(C.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;C.enabled&&o&&(g.save(),g.globalAlpha=e,this.drawBackground(l,g,t,C),qu(g,C.textDirection),l.y+=n.top,this.drawTitle(l,g,C),this.drawBody(l,g,C),this.drawFooter(l,g,C),$u(g,C.textDirection),g.restore())}getActiveElements(){return this._active||[]}setActiveElements(g,C){const e=this._active,t=g.map(({datasetIndex:o,index:A})=>{const i=this.chart.getDatasetMeta(o);if(!i)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:i.data[A],index:A}}),l=!wn(e,t),n=this._positionChanged(t,C);(l||n)&&(this._active=t,this._eventPosition=C,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(g,C,e=!0){if(C&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const t=this.options,l=this._active||[],n=this._getActiveElements(g,l,C,e),o=this._positionChanged(n,g),A=C||!wn(n,l)||o;return A&&(this._active=n,(t.enabled||t.external)&&(this._eventPosition={x:g.x,y:g.y},this.update(!0,C))),A}_getActiveElements(g,C,e,t){const l=this.options;if(g.type==="mouseout")return[];if(!t)return C.filter(o=>this.chart.data.datasets[o.datasetIndex]&&this.chart.getDatasetMeta(o.datasetIndex).controller.getParsed(o.index)!==void 0);const n=this.chart.getElementsAtEventForMode(g,l.mode,l,e);return l.reverse&&n.reverse(),n}_positionChanged(g,C){const{caretX:e,caretY:t,options:l}=this,n=ut[l.position].call(this,g,C);return n!==!1&&(e!==n.x||t!==n.y)}}N(Si,"positioners",ut);var dW={id:"tooltip",_element:Si,positioners:ut,afterInit(I,g,C){C&&(I.tooltip=new Si({chart:I,options:C}))},beforeUpdate(I,g,C){I.tooltip&&I.tooltip.initialize(C)},reset(I,g,C){I.tooltip&&I.tooltip.initialize(C)},afterDraw(I){const g=I.tooltip;if(g&&g._willRender()){const C={tooltip:g};if(I.notifyPlugins("beforeTooltipDraw",{...C,cancelable:!0})===!1)return;g.draw(I.ctx),I.notifyPlugins("afterTooltipDraw",C)}},afterEvent(I,g){if(I.tooltip){const C=g.replay;I.tooltip.handleEvent(g.event,C,g.inChartArea)&&(g.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(I,g)=>g.bodyFont.size,boxWidth:(I,g)=>g.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:rZ},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:I=>I!=="filter"&&I!=="itemSort"&&I!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const rW=(I,g,C,e)=>(typeof g=="string"?(C=I.push(g)-1,e.unshift({index:C,label:g})):isNaN(g)&&(C=null),C);function mW(I,g,C,e){const t=I.indexOf(g);if(t===-1)return rW(I,g,C,e);const l=I.lastIndexOf(g);return t!==l?C:t}const uW=(I,g)=>I===null?null:Lg(Math.round(I),0,g);function Rd(I){const g=this.getLabels();return I>=0&&I<g.length?g[I]:I}class Ri extends te{constructor(g){super(g),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(g){const C=this._addedLabels;if(C.length){const e=this.getLabels();for(const{index:t,label:l}of C)e[t]===l&&e.splice(t,1);this._addedLabels=[]}super.init(g)}parse(g,C){if(P(g))return null;const e=this.getLabels();return C=isFinite(C)&&e[C]===g?C:mW(e,g,U(C,g),this._addedLabels),uW(C,e.length-1)}determineDataLimits(){const{minDefined:g,maxDefined:C}=this.getUserBounds();let{min:e,max:t}=this.getMinMax(!0);this.options.bounds==="ticks"&&(g||(e=0),C||(t=this.getLabels().length-1)),this.min=e,this.max=t}buildTicks(){const g=this.min,C=this.max,e=this.options.offset,t=[];let l=this.getLabels();l=g===0&&C===l.length-1?l:l.slice(g,C+1),this._valueRange=Math.max(l.length-(e?0:1),1),this._startValue=this.min-(e?.5:0);for(let n=g;n<=C;n++)t.push({value:n});return t}getLabelForValue(g){return Rd.call(this,g)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(g){return typeof g!="number"&&(g=this.parse(g)),g===null?NaN:this.getPixelForDecimal((g-this._startValue)/this._valueRange)}getPixelForTick(g){const C=this.ticks;return g<0||g>C.length-1?null:this.getPixelForValue(C[g].value)}getValueForPixel(g){return Math.round(this._startValue+this.getDecimalForPixel(g)*this._valueRange)}getBasePixel(){return this.bottom}}N(Ri,"id","category"),N(Ri,"defaults",{ticks:{callback:Rd}});function ZW(I,g){const C=[],{bounds:t,step:l,min:n,max:o,precision:A,count:i,maxTicks:s,maxDigits:c,includeBounds:a}=I,r=l||1,m=s-1,{min:b,max:G}=g,u=!P(n),Z=!P(o),h=!P(i),B=(G-b)/(c+1);let y=Ya((G-b)/m/r)*r,V,W,R,f;if(y<1e-14&&!u&&!Z)return[{value:b},{value:G}];f=Math.ceil(G/y)-Math.floor(b/y),f>m&&(y=Ya(f*y/m/r)*r),P(A)||(V=Math.pow(10,A),y=Math.ceil(y*V)/V),t==="ticks"?(W=Math.floor(b/y)*y,R=Math.ceil(G/y)*y):(W=b,R=G),u&&Z&&l&&hB((o-n)/l,y/1e3)?(f=Math.round(Math.min((o-n)/y,s)),y=(o-n)/f,W=n,R=o):h?(W=u?n:W,R=Z?o:R,f=i-1,y=(R-W)/f):(f=(R-W)/y,ln(f,Math.round(f),y/1e3)?f=Math.round(f):f=Math.ceil(f));const J=Math.max(Ha(y),Ha(W));V=Math.pow(10,P(A)?J:A),W=Math.round(W*V)/V,R=Math.round(R*V)/V;let H=0;for(u&&(a&&W!==n?(C.push({value:n}),W<n&&H++,ln(Math.round((W+H*y)*V)/V,n,Xd(n,B,I))&&H++):W<n&&H++);H<f;++H){const K=Math.round((W+H*y)*V)/V;if(Z&&K>o)break;C.push({value:K})}return Z&&a&&R!==o?C.length&&ln(C[C.length-1].value,o,Xd(o,B,I))?C[C.length-1].value=o:C.push({value:o}):(!Z||R===o)&&C.push({value:R}),C}function Xd(I,g,{horizontal:C,minRotation:e}){const t=kI(e),l=(C?Math.sin(t):Math.cos(t))||.001,n=.75*g*(""+I).length;return Math.min(g/l,n)}class Tn extends te{constructor(g){super(g),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(g,C){return P(g)||(typeof g=="number"||g instanceof Number)&&!isFinite(+g)?null:+g}handleTickRangeOptions(){const{beginAtZero:g}=this.options,{minDefined:C,maxDefined:e}=this.getUserBounds();let{min:t,max:l}=this;const n=A=>t=C?t:A,o=A=>l=e?l:A;if(g){const A=bC(t),i=bC(l);A<0&&i<0?o(0):A>0&&i>0&&n(0)}if(t===l){let A=l===0?1:Math.abs(l*.05);o(l+A),g||n(t-A)}this.min=t,this.max=l}getTickLimit(){const g=this.options.ticks;let{maxTicksLimit:C,stepSize:e}=g,t;return e?(t=Math.ceil(this.max/e)-Math.floor(this.min/e)+1,t>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${e} would result generating up to ${t} ticks. Limiting to 1000.`),t=1e3)):(t=this.computeTickLimit(),C=C||11),C&&(t=Math.min(C,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const g=this.options,C=g.ticks;let e=this.getTickLimit();e=Math.max(2,e);const t={maxTicks:e,bounds:g.bounds,min:g.min,max:g.max,precision:C.precision,step:C.stepSize,count:C.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:C.minRotation||0,includeBounds:C.includeBounds!==!1},l=this._range||this,n=ZW(t,l);return g.bounds==="ticks"&&Ku(n,this,"value"),g.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}configure(){const g=this.ticks;let C=this.min,e=this.max;if(super.configure(),this.options.offset&&g.length){const t=(e-C)/Math.max(g.length-1,1)/2;C-=t,e+=t}this._startValue=C,this._endValue=e,this._valueRange=e-C}getLabelForValue(g){return uo(g,this.chart.options.locale,this.options.ticks.format)}}class Xi extends Tn{determineDataLimits(){const{min:g,max:C}=this.getMinMax(!0);this.min=yg(g)?g:0,this.max=yg(C)?C:1,this.handleTickRangeOptions()}computeTickLimit(){const g=this.isHorizontal(),C=g?this.width:this.height,e=kI(this.options.ticks.minRotation),t=(g?Math.sin(e):Math.cos(e))||.001,l=this._resolveTickFontOptions(0);return Math.ceil(C/Math.min(40,l.lineHeight/t))}getPixelForValue(g){return g===null?NaN:this.getPixelForDecimal((g-this._startValue)/this._valueRange)}getValueForPixel(g){return this._startValue+this.getDecimalForPixel(g)*this._valueRange}}N(Xi,"id","linear"),N(Xi,"defaults",{ticks:{callback:Zo.formatters.numeric}});const $t=I=>Math.floor(nC(I)),fC=(I,g)=>Math.pow(10,$t(I)+g);function Jd(I){return I/Math.pow(10,$t(I))===1}function kd(I,g,C){const e=Math.pow(10,C),t=Math.floor(I/e);return Math.ceil(g/e)-t}function bW(I,g){const C=g-I;let e=$t(C);for(;kd(I,g,e)>10;)e++;for(;kd(I,g,e)<10;)e--;return Math.min(e,$t(I))}function hW(I,{min:g,max:C}){g=_g(I.min,g);const e=[],t=$t(g);let l=bW(g,C),n=l<0?Math.pow(10,Math.abs(l)):1;const o=Math.pow(10,l),A=t>l?Math.pow(10,t):0,i=Math.round((g-A)*n)/n,s=Math.floor((g-A)/o/10)*o*10;let c=Math.floor((i-s)/Math.pow(10,l)),a=_g(I.min,Math.round((A+s+c*Math.pow(10,l))*n)/n);for(;a<C;)e.push({value:a,major:Jd(a),significand:c}),c>=10?c=c<15?15:20:c++,c>=20&&(l++,c=2,n=l>=0?1:n),a=Math.round((A+s+c*Math.pow(10,l))*n)/n;const r=_g(I.max,a);return e.push({value:r,major:Jd(r),significand:c}),e}class fd extends te{constructor(g){super(g),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(g,C){const e=Tn.prototype.parse.apply(this,[g,C]);if(e===0){this._zero=!0;return}return yg(e)&&e>0?e:null}determineDataLimits(){const{min:g,max:C}=this.getMinMax(!0);this.min=yg(g)?Math.max(0,g):null,this.max=yg(C)?Math.max(0,C):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!yg(this._userMin)&&(this.min=g===fC(this.min,0)?fC(this.min,-1):fC(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:g,maxDefined:C}=this.getUserBounds();let e=this.min,t=this.max;const l=o=>e=g?e:o,n=o=>t=C?t:o;e===t&&(e<=0?(l(1),n(10)):(l(fC(e,-1)),n(fC(t,1)))),e<=0&&l(fC(t,-1)),t<=0&&n(fC(e,1)),this.min=e,this.max=t}buildTicks(){const g=this.options,C={min:this._userMin,max:this._userMax},e=hW(C,this);return g.bounds==="ticks"&&Ku(e,this,"value"),g.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(g){return g===void 0?"0":uo(g,this.chart.options.locale,this.options.ticks.format)}configure(){const g=this.min;super.configure(),this._startValue=nC(g),this._valueRange=nC(this.max)-nC(g)}getPixelForValue(g){return(g===void 0||g===0)&&(g=this.min),g===null||isNaN(g)?NaN:this.getPixelForDecimal(g===this.min?0:(nC(g)-this._startValue)/this._valueRange)}getValueForPixel(g){const C=this.getDecimalForPixel(g);return Math.pow(10,this._startValue+C*this._valueRange)}}N(fd,"id","logarithmic"),N(fd,"defaults",{ticks:{callback:Zo.formatters.logarithmic,major:{enabled:!0}}});function Ji(I){const g=I.ticks;if(g.display&&I.display){const C=wg(g.backdropPadding);return U(g.font&&g.font.size,ag.font.size)+C.height}return 0}function GW(I,g,C){return C=sg(C)?C:[C],{w:FB(I,g.string,C),h:C.length*g.lineHeight}}function Yd(I,g,C,e,t){return I===e||I===t?{start:g-C/2,end:g+C/2}:I<e||I>t?{start:g-C,end:g}:{start:g,end:g+C}}function BW(I){const g={l:I.left+I._padding.left,r:I.right-I._padding.right,t:I.top+I._padding.top,b:I.bottom-I._padding.bottom},C=Object.assign({},g),e=[],t=[],l=I._pointLabels.length,n=I.options.pointLabels,o=n.centerPointLabels?bg/l:0;for(let A=0;A<l;A++){const i=n.setContext(I.getPointLabelContext(A));t[A]=i.padding;const s=I.getPointPosition(A,I.drawingArea+t[A],o),c=Sg(i.font),a=GW(I.ctx,c,I._pointLabels[A]);e[A]=a;const r=XI(I.getIndexAngle(A)+o),m=Math.round(zs(r)),b=Yd(m,s.x,a.w,0,180),G=Yd(m,s.y,a.h,90,270);yW(C,g,r,b,G)}I.setCenterPoint(g.l-C.l,C.r-g.r,g.t-C.t,C.b-g.b),I._pointLabelItems=VW(I,e,t)}function yW(I,g,C,e,t){const l=Math.abs(Math.sin(C)),n=Math.abs(Math.cos(C));let o=0,A=0;e.start<g.l?(o=(g.l-e.start)/l,I.l=Math.min(I.l,g.l-o)):e.end>g.r&&(o=(e.end-g.r)/l,I.r=Math.max(I.r,g.r+o)),t.start<g.t?(A=(g.t-t.start)/n,I.t=Math.min(I.t,g.t-A)):t.end>g.b&&(A=(t.end-g.b)/n,I.b=Math.max(I.b,g.b+A))}function pW(I,g,C){const e=I.drawingArea,{extra:t,additionalAngle:l,padding:n,size:o}=C,A=I.getPointPosition(g,e+t+n,l),i=Math.round(zs(XI(A.angle+rg))),s=XW(A.y,o.h,i),c=SW(i),a=RW(A.x,o.w,c);return{visible:!0,x:A.x,y:s,textAlign:c,left:a,top:s,right:a+o.w,bottom:s+o.h}}function WW(I,g){if(!g)return!0;const{left:C,top:e,right:t,bottom:l}=I;return!(Be({x:C,y:e},g)||Be({x:C,y:l},g)||Be({x:t,y:e},g)||Be({x:t,y:l},g))}function VW(I,g,C){const e=[],t=I._pointLabels.length,l=I.options,{centerPointLabels:n,display:o}=l.pointLabels,A={extra:Ji(l)/2,additionalAngle:n?bg/t:0};let i;for(let s=0;s<t;s++){A.padding=C[s],A.size=g[s];const c=pW(I,s,A);e.push(c),o==="auto"&&(c.visible=WW(c,i),c.visible&&(i=c))}return e}function SW(I){return I===0||I===180?"center":I<180?"left":"right"}function RW(I,g,C){return C==="right"?I-=g:C==="center"&&(I-=g/2),I}function XW(I,g,C){return C===90||C===270?I-=g/2:(C>270||C<90)&&(I-=g),I}function JW(I,g,C){const{left:e,top:t,right:l,bottom:n}=C,{backdropColor:o}=g;if(!P(o)){const A=EC(g.borderRadius),i=wg(g.backdropPadding);I.fillStyle=o;const s=e-i.left,c=t-i.top,a=l-e+i.width,r=n-t+i.height;Object.values(A).some(m=>m!==0)?(I.beginPath(),_t(I,{x:s,y:c,w:a,h:r,radius:A}),I.fill()):I.fillRect(s,c,a,r)}}function kW(I,g){const{ctx:C,options:{pointLabels:e}}=I;for(let t=g-1;t>=0;t--){const l=I._pointLabelItems[t];if(!l.visible)continue;const n=e.setContext(I.getPointLabelContext(t));JW(C,n,l);const o=Sg(n.font),{x:A,y:i,textAlign:s}=l;we(C,I._pointLabels[t],A,i+o.lineHeight/2,o,{color:n.color,textAlign:s,textBaseline:"middle"})}}function mZ(I,g,C,e){const{ctx:t}=I;if(C)t.arc(I.xCenter,I.yCenter,g,0,cg);else{let l=I.getPointPosition(0,g);t.moveTo(l.x,l.y);for(let n=1;n<e;n++)l=I.getPointPosition(n,g),t.lineTo(l.x,l.y)}}function fW(I,g,C,e,t){const l=I.ctx,n=g.circular,{color:o,lineWidth:A}=g;!n&&!e||!o||!A||C<0||(l.save(),l.strokeStyle=o,l.lineWidth=A,l.setLineDash(t.dash),l.lineDashOffset=t.dashOffset,l.beginPath(),mZ(I,C,n,e),l.closePath(),l.stroke(),l.restore())}function YW(I,g,C){return ee(I,{label:C,index:g,type:"pointLabel"})}class Ll extends Tn{constructor(g){super(g),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const g=this._padding=wg(Ji(this.options)/2),C=this.width=this.maxWidth-g.width,e=this.height=this.maxHeight-g.height;this.xCenter=Math.floor(this.left+C/2+g.left),this.yCenter=Math.floor(this.top+e/2+g.top),this.drawingArea=Math.floor(Math.min(C,e)/2)}determineDataLimits(){const{min:g,max:C}=this.getMinMax(!1);this.min=yg(g)&&!isNaN(g)?g:0,this.max=yg(C)&&!isNaN(C)?C:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Ji(this.options))}generateTickLabels(g){Tn.prototype.generateTickLabels.call(this,g),this._pointLabels=this.getLabels().map((C,e)=>{const t=q(this.options.pointLabels.callback,[C,e],this);return t||t===0?t:""}).filter((C,e)=>this.chart.getDataVisibility(e))}fit(){const g=this.options;g.display&&g.pointLabels.display?BW(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(g,C,e,t){this.xCenter+=Math.floor((g-C)/2),this.yCenter+=Math.floor((e-t)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(g,C,e,t))}getIndexAngle(g){const C=cg/(this._pointLabels.length||1),e=this.options.startAngle||0;return XI(g*C+kI(e))}getDistanceFromCenterForValue(g){if(P(g))return NaN;const C=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-g)*C:(g-this.min)*C}getValueForDistanceFromCenter(g){if(P(g))return NaN;const C=g/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-C:this.min+C}getPointLabelContext(g){const C=this._pointLabels||[];if(g>=0&&g<C.length){const e=C[g];return YW(this.getContext(),g,e)}}getPointPosition(g,C,e=0){const t=this.getIndexAngle(g)-rg+e;return{x:Math.cos(t)*C+this.xCenter,y:Math.sin(t)*C+this.yCenter,angle:t}}getPointPositionForValue(g,C){return this.getPointPosition(g,this.getDistanceFromCenterForValue(C))}getBasePosition(g){return this.getPointPositionForValue(g||0,this.getBaseValue())}getPointLabelPosition(g){const{left:C,top:e,right:t,bottom:l}=this._pointLabelItems[g];return{left:C,top:e,right:t,bottom:l}}drawBackground(){const{backgroundColor:g,grid:{circular:C}}=this.options;if(g){const e=this.ctx;e.save(),e.beginPath(),mZ(this,this.getDistanceFromCenterForValue(this._endValue),C,this._pointLabels.length),e.closePath(),e.fillStyle=g,e.fill(),e.restore()}}drawGrid(){const g=this.ctx,C=this.options,{angleLines:e,grid:t,border:l}=C,n=this._pointLabels.length;let o,A,i;if(C.pointLabels.display&&kW(this,n),t.display&&this.ticks.forEach((s,c)=>{if(c!==0||c===0&&this.min<0){A=this.getDistanceFromCenterForValue(s.value);const a=this.getContext(c),r=t.setContext(a),m=l.setContext(a);fW(this,r,A,n,m)}}),e.display){for(g.save(),o=n-1;o>=0;o--){const s=e.setContext(this.getPointLabelContext(o)),{color:c,lineWidth:a}=s;!a||!c||(g.lineWidth=a,g.strokeStyle=c,g.setLineDash(s.borderDash),g.lineDashOffset=s.borderDashOffset,A=this.getDistanceFromCenterForValue(C.ticks.reverse?this.min:this.max),i=this.getPointPosition(o,A),g.beginPath(),g.moveTo(this.xCenter,this.yCenter),g.lineTo(i.x,i.y),g.stroke())}g.restore()}}drawBorder(){}drawLabels(){const g=this.ctx,C=this.options,e=C.ticks;if(!e.display)return;const t=this.getIndexAngle(0);let l,n;g.save(),g.translate(this.xCenter,this.yCenter),g.rotate(t),g.textAlign="center",g.textBaseline="middle",this.ticks.forEach((o,A)=>{if(A===0&&this.min>=0&&!C.reverse)return;const i=e.setContext(this.getContext(A)),s=Sg(i.font);if(l=this.getDistanceFromCenterForValue(this.ticks[A].value),i.showLabelBackdrop){g.font=s.string,n=g.measureText(o.label).width,g.fillStyle=i.backdropColor;const c=wg(i.backdropPadding);g.fillRect(-n/2-c.left,-l-s.size/2-c.top,n+c.width,s.size+c.height)}we(g,o.label,0,-l,s,{color:i.color,strokeColor:i.textStrokeColor,strokeWidth:i.textStrokeWidth})}),g.restore()}drawTitle(){}}N(Ll,"id","radialLinear"),N(Ll,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Zo.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(g){return g},padding:5,centerPointLabels:!1}}),N(Ll,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),N(Ll,"descriptors",{angleLines:{_fallback:"grid"}});const Go={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Qg=Object.keys(Go);function Hd(I,g){return I-g}function vd(I,g){if(P(g))return null;const C=I._adapter,{parser:e,round:t,isoWeekday:l}=I._parseOpts;let n=g;return typeof e=="function"&&(n=e(n)),yg(n)||(n=typeof e=="string"?C.parse(n,e):C.parse(n)),n===null?null:(t&&(n=t==="week"&&(Mn(l)||l===!0)?C.startOf(n,"isoWeek",l):C.startOf(n,t)),+n)}function Nd(I,g,C,e){const t=Qg.length;for(let l=Qg.indexOf(I);l<t-1;++l){const n=Go[Qg[l]],o=n.steps?n.steps:Number.MAX_SAFE_INTEGER;if(n.common&&Math.ceil((C-g)/(o*n.size))<=e)return Qg[l]}return Qg[t-1]}function HW(I,g,C,e,t){for(let l=Qg.length-1;l>=Qg.indexOf(C);l--){const n=Qg[l];if(Go[n].common&&I._adapter.diff(t,e,n)>=g-1)return n}return Qg[C?Qg.indexOf(C):0]}function vW(I){for(let g=Qg.indexOf(I)+1,C=Qg.length;g<C;++g)if(Go[Qg[g]].common)return Qg[g]}function Fd(I,g,C){if(!C)I[g]=!0;else if(C.length){const{lo:e,hi:t}=Ms(C,g),l=C[e]>=g?C[e]:C[t];I[l]=!0}}function NW(I,g,C,e){const t=I._adapter,l=+t.startOf(g[0].value,e),n=g[g.length-1].value;let o,A;for(o=l;o<=n;o=+t.add(o,1,e))A=C[o],A>=0&&(g[A].major=!0);return g}function Kd(I,g,C){const e=[],t={},l=g.length;let n,o;for(n=0;n<l;++n)o=g[n],t[o]=n,e.push({value:o,major:!1});return l===0||!C?e:NW(I,e,t,C)}class jn extends te{constructor(g){super(g),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(g,C={}){const e=g.time||(g.time={}),t=this._adapter=new vy._date(g.adapters.date);t.init(C),St(e.displayFormats,t.formats()),this._parseOpts={parser:e.parser,round:e.round,isoWeekday:e.isoWeekday},super.init(g),this._normalized=C.normalized}parse(g,C){return g===void 0?null:vd(this,g)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const g=this.options,C=this._adapter,e=g.time.unit||"day";let{min:t,max:l,minDefined:n,maxDefined:o}=this.getUserBounds();function A(i){!n&&!isNaN(i.min)&&(t=Math.min(t,i.min)),!o&&!isNaN(i.max)&&(l=Math.max(l,i.max))}(!n||!o)&&(A(this._getLabelBounds()),(g.bounds!=="ticks"||g.ticks.source!=="labels")&&A(this.getMinMax(!1))),t=yg(t)&&!isNaN(t)?t:+C.startOf(Date.now(),e),l=yg(l)&&!isNaN(l)?l:+C.endOf(Date.now(),e)+1,this.min=Math.min(t,l-1),this.max=Math.max(t+1,l)}_getLabelBounds(){const g=this.getLabelTimestamps();let C=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;return g.length&&(C=g[0],e=g[g.length-1]),{min:C,max:e}}buildTicks(){const g=this.options,C=g.time,e=g.ticks,t=e.source==="labels"?this.getLabelTimestamps():this._generate();g.bounds==="ticks"&&t.length&&(this.min=this._userMin||t[0],this.max=this._userMax||t[t.length-1]);const l=this.min,n=this.max,o=pB(t,l,n);return this._unit=C.unit||(e.autoSkip?Nd(C.minUnit,this.min,this.max,this._getLabelCapacity(l)):HW(this,o.length,C.minUnit,this.min,this.max)),this._majorUnit=!e.major.enabled||this._unit==="year"?void 0:vW(this._unit),this.initOffsets(t),g.reverse&&o.reverse(),Kd(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(g=>+g.value))}initOffsets(g=[]){let C=0,e=0,t,l;this.options.offset&&g.length&&(t=this.getDecimalForValue(g[0]),g.length===1?C=1-t:C=(this.getDecimalForValue(g[1])-t)/2,l=this.getDecimalForValue(g[g.length-1]),g.length===1?e=l:e=(l-this.getDecimalForValue(g[g.length-2]))/2);const n=g.length<3?.5:.25;C=Lg(C,0,n),e=Lg(e,0,n),this._offsets={start:C,end:e,factor:1/(C+1+e)}}_generate(){const g=this._adapter,C=this.min,e=this.max,t=this.options,l=t.time,n=l.unit||Nd(l.minUnit,C,e,this._getLabelCapacity(C)),o=U(t.ticks.stepSize,1),A=n==="week"?l.isoWeekday:!1,i=Mn(A)||A===!0,s={};let c=C,a,r;if(i&&(c=+g.startOf(c,"isoWeek",A)),c=+g.startOf(c,i?"day":n),g.diff(e,C,n)>1e5*o)throw new Error(C+" and "+e+" are too far apart with stepSize of "+o+" "+n);const m=t.ticks.source==="data"&&this.getDataTimestamps();for(a=c,r=0;a<e;a=+g.add(a,o,n),r++)Fd(s,a,m);return(a===e||t.bounds==="ticks"||r===1)&&Fd(s,a,m),Object.keys(s).sort(Hd).map(b=>+b)}getLabelForValue(g){const C=this._adapter,e=this.options.time;return e.tooltipFormat?C.format(g,e.tooltipFormat):C.format(g,e.displayFormats.datetime)}format(g,C){const t=this.options.time.displayFormats,l=this._unit,n=C||t[l];return this._adapter.format(g,n)}_tickFormatFunction(g,C,e,t){const l=this.options,n=l.ticks.callback;if(n)return q(n,[g,C,e],this);const o=l.time.displayFormats,A=this._unit,i=this._majorUnit,s=A&&o[A],c=i&&o[i],a=e[C],r=i&&c&&a&&a.major;return this._adapter.format(g,t||(r?c:s))}generateTickLabels(g){let C,e,t;for(C=0,e=g.length;C<e;++C)t=g[C],t.label=this._tickFormatFunction(t.value,C,g)}getDecimalForValue(g){return g===null?NaN:(g-this.min)/(this.max-this.min)}getPixelForValue(g){const C=this._offsets,e=this.getDecimalForValue(g);return this.getPixelForDecimal((C.start+e)*C.factor)}getValueForPixel(g){const C=this._offsets,e=this.getDecimalForPixel(g)/C.factor-C.end;return this.min+e*(this.max-this.min)}_getLabelSize(g){const C=this.options.ticks,e=this.ctx.measureText(g).width,t=kI(this.isHorizontal()?C.maxRotation:C.minRotation),l=Math.cos(t),n=Math.sin(t),o=this._resolveTickFontOptions(0).size;return{w:e*l+o*n,h:e*n+o*l}}_getLabelCapacity(g){const C=this.options.time,e=C.displayFormats,t=e[C.unit]||e.millisecond,l=this._tickFormatFunction(g,0,Kd(this,[g],this._majorUnit),t),n=this._getLabelSize(l),o=Math.floor(this.isHorizontal()?this.width/n.w:this.height/n.h)-1;return o>0?o:1}getDataTimestamps(){let g=this._cache.data||[],C,e;if(g.length)return g;const t=this.getMatchingVisibleMetas();if(this._normalized&&t.length)return this._cache.data=t[0].controller.getAllParsedValues(this);for(C=0,e=t.length;C<e;++C)g=g.concat(t[C].controller.getAllParsedValues(this));return this._cache.data=this.normalize(g)}getLabelTimestamps(){const g=this._cache.labels||[];let C,e;if(g.length)return g;const t=this.getLabels();for(C=0,e=t.length;C<e;++C)g.push(vd(this,t[C]));return this._cache.labels=this._normalized?g:this.normalize(g)}normalize(g){return zu(g.sort(Hd))}}N(jn,"id","time"),N(jn,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Dl(I,g,C){let e=0,t=I.length-1,l,n,o,A;C?(g>=I[e].pos&&g<=I[t].pos&&({lo:e,hi:t}=Bi(I,"pos",g)),{pos:l,time:o}=I[e],{pos:n,time:A}=I[t]):(g>=I[e].time&&g<=I[t].time&&({lo:e,hi:t}=Bi(I,"time",g)),{time:l,pos:o}=I[e],{time:n,pos:A}=I[t]);const i=n-l;return i?o+(A-o)*(g-l)/i:o}class wd extends jn{constructor(g){super(g),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const g=this._getTimestampsForTable(),C=this._table=this.buildLookupTable(g);this._minPos=Dl(C,this.min),this._tableRange=Dl(C,this.max)-this._minPos,super.initOffsets(g)}buildLookupTable(g){const{min:C,max:e}=this,t=[],l=[];let n,o,A,i,s;for(n=0,o=g.length;n<o;++n)i=g[n],i>=C&&i<=e&&t.push(i);if(t.length<2)return[{time:C,pos:0},{time:e,pos:1}];for(n=0,o=t.length;n<o;++n)s=t[n+1],A=t[n-1],i=t[n],Math.round((s+A)/2)!==i&&l.push({time:i,pos:n/(o-1)});return l}_generate(){const g=this.min,C=this.max;let e=super.getDataTimestamps();return(!e.includes(g)||!e.length)&&e.splice(0,0,g),(!e.includes(C)||e.length===1)&&e.push(C),e.sort((t,l)=>t-l)}_getTimestampsForTable(){let g=this._cache.all||[];if(g.length)return g;const C=this.getDataTimestamps(),e=this.getLabelTimestamps();return C.length&&e.length?g=this.normalize(C.concat(e)):g=C.length?C:e,g=this._cache.all=g,g}getDecimalForValue(g){return(Dl(this._table,g)-this._minPos)/this._tableRange}getValueForPixel(g){const C=this._offsets,e=this.getDecimalForPixel(g)/C.factor-C.end;return Dl(this._table,e*this._tableRange+this._minPos,!0)}}N(wd,"id","timeseries"),N(wd,"defaults",jn.defaults);const uZ="label";function xd(I,g){typeof I=="function"?I(g):I&&(I.current=g)}function FW(I,g){const C=I.options;C&&g&&Object.assign(C,g)}function ZZ(I,g){I.labels=g}function bZ(I,g){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:uZ;const e=[];I.datasets=g.map(t=>{const l=I.datasets.find(n=>n[C]===t[C]);return!l||!t.data||e.includes(l)?{...t}:(e.push(l),Object.assign(l,t),l)})}function KW(I){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:uZ;const C={labels:[],datasets:[]};return ZZ(C,I.labels),bZ(C,I.datasets,g),C}function wW(I,g){const{height:C=150,width:e=300,redraw:t=!1,datasetIdKey:l,type:n,data:o,options:A,plugins:i=[],fallbackContent:s,updateMode:c,...a}=I,r=p.useRef(null),m=p.useRef(),b=()=>{r.current&&(m.current=new ho(r.current,{type:n,data:KW(o,l),options:A&&{...A},plugins:i}),xd(g,m.current))},G=()=>{xd(g,null),m.current&&(m.current.destroy(),m.current=null)};return p.useEffect(()=>{!t&&m.current&&A&&FW(m.current,A)},[t,A]),p.useEffect(()=>{!t&&m.current&&ZZ(m.current.config.data,o.labels)},[t,o.labels]),p.useEffect(()=>{!t&&m.current&&o.datasets&&bZ(m.current.config.data,o.datasets,l)},[t,o.datasets]),p.useEffect(()=>{m.current&&(t?(G(),setTimeout(b)):m.current.update(c))},[t,A,o.labels,o.datasets,c]),p.useEffect(()=>{m.current&&(G(),setTimeout(b))},[n]),p.useEffect(()=>(b(),()=>G()),[]),Fg.createElement("canvas",Object.assign({ref:r,role:"img",height:C,width:e},a),s)}const xW=p.forwardRef(wW);function hZ(I,g){return ho.register(g),p.forwardRef((C,e)=>Fg.createElement(xW,Object.assign({},C,{ref:e,type:I})))}const zW=hZ("bar",nn),MW=hZ("pie",pi);ho.register(mt,dW,lW,Ri,Xi,sn);const EW=({data:I})=>{const g=I.reduce((l,n)=>(l[n.Casa]=(l[n.Casa]||0)+1,l),{}),C=I.reduce((l,n)=>(l[n.Motivo]=(l[n.Motivo]||0)+1,l),{}),e={labels:Object.keys(g),datasets:[{label:"Entradas por Casa",data:Object.values(g),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40"]}]},t={labels:Object.keys(C),datasets:[{label:"Entradas por Motivo",data:Object.values(C),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40"]}]};return d.jsxs("div",{className:"w-full max-w-4xl mt-8",children:[d.jsx("h2",{className:"text-xl font-bold text-center mb-4",children:"Entradas por Casa"}),d.jsx(MW,{data:e}),d.jsx("h2",{className:"text-xl font-bold text-center mt-8 mb-4",children:"Entradas por Motivo"}),d.jsx(zW,{data:t})]})},QW=()=>{const[I,g]=p.useState([]),[C,e]=p.useState([]),t=async()=>{const n=await new Promise(o=>setTimeout(()=>o([{Casa:"100",Correo_electronico:"holamundo@gmail.com",Documento:"--------",Motivo:"Visita",Fecha:"2024-04-27",Hora:"1:00 p.m"},{Casa:"101",Correo_electronico:"holamundo@gmail.com",Documento:"00975677-2",Motivo:"Entrega",Fecha:"2024-04-28",Hora:"2:00 p.m"},{Casa:"102",Correo_electronico:"holamundo@gmail.com",Documento:"00975677-2",Motivo:"Servicio",Fecha:"2024-04-29",Hora:"3:00 p.m"},{Casa:"103",Correo_electronico:"holamundo@gmail.com",Documento:"00975677-2",Motivo:"Visita",Fecha:"2024-04-27",Hora:"4:00 p.m"}]),1e3));e(n),g(n)};p.useEffect(()=>{t()},[]);const l=(n,o="")=>{let A=[];switch(n){case"all":A=C;break;case"casa":A=C.filter(i=>i.Casa==="100");break;case"motivo":A=C.filter(i=>i.Motivo==="Visita");break;case"fecha":o?A=C.filter(i=>i.Fecha===o):A=C;break;default:A=C;break}g(A)};return d.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4",children:[d.jsx("h1",{className:"text-2xl font-bold text-center text-azul-principal m-3 font-roboto_mono",children:"Listado de Entradas"}),d.jsxs("div",{className:"flex flex-col items-center w-full",children:[d.jsxs("div",{className:"flex justify-between items-center w-full max-w-4xl mb-4",children:[d.jsx("label",{htmlFor:"houseNumber",className:"text-base font-roboto_mono",children:"Últimas visitas registradas:"}),d.jsx(M0,{filterResults:l})]}),d.jsx(z0,{data:I}),d.jsx(EW,{data:I})]})]})},UW=({houseNumber:I,representative:g})=>{const C=SC(),e=()=>{C(`/admon/gestionar/${I}`)};return d.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md w-full sm:w-96 mb-4",children:[d.jsxs("p",{className:"text-gray-700 font-roboto_mono mb-2",children:[d.jsx("span",{className:"font-bold",children:"Casa Número:"})," ",I]}),d.jsxs("p",{className:"text-gray-700 font-roboto_mono mb-4",children:[d.jsx("span",{className:"font-bold",children:"Representante:"})," ",g]}),d.jsx("button",{className:"bg-amarillo-principal text-black py-2 px-4 rounded-md font-roboto_mono hover:bg-yellow-600 transition duration-300",onClick:e,children:"Gestión de residentes"})]})},LW=()=>{const I=SC(),[g,C]=p.useState([{houseNumber:"100",representative:"Juan Francisco Flores"},{houseNumber:"200",representative:"Melissa Estefania Zaragoza"}]),[e,t]=p.useState(""),[l,n]=p.useState(g),o=()=>{const i=g.filter(s=>s.houseNumber.includes(e)||s.representative.toLowerCase().includes(e.toLowerCase()));n(i)},A=i=>{I(`/gestionar/${i}`)};return d.jsx("div",{className:"p-4",children:d.jsxs("div",{className:"flex flex-col items-center w-full",children:[d.jsx("h2",{className:"text-3xl font-bold text-center text-azul-principal m-2 font-roboto_mono",children:"Búsqueda de Hogar"}),d.jsx("p",{className:"text-center text-base mb-2 font-roboto_mono mt-5",children:"Ingrese número de casa o nombre de encargado para realizar su búsqueda"}),d.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center mt-2 w-full sm:w-auto",children:[d.jsx("input",{type:"text",placeholder:"Número Hogar o Encargado",className:"border border-gray-300 p-2 rounded-md w-full sm:w-64",value:e,onChange:i=>t(i.target.value)}),d.jsx("button",{className:"bg-amarillo-principal text-black m-2 py-2 px-4 rounded-md font-roboto_mono hover:bg-yellow-600 transition duration-300",onClick:o,children:"Buscar"})]}),d.jsx("h2",{className:"text-3xl font-bold text-center text-azul-principal m-2 font-roboto_mono mt-7 mb-7",children:"Listado de Hogares"}),d.jsx("div",{className:"flex flex-col items-center w-full",children:l.length>0?l.map((i,s)=>d.jsx(UW,{houseNumber:i.houseNumber,representative:i.representative,onGestionClick:A},s)):d.jsx("p",{className:"text-gray-700 font-roboto_mono mt-4",children:"No se encontraron resultados."})})]})})},GZ="/assets/userimage-JMHQUWub.png",al=({menuItems:I})=>{const[g,C]=p.useState(!1),[e,t]=p.useState(!1),l=()=>{C(!g)},n=()=>{t(!e)},o=SC(),A=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("role"),o("/")};return d.jsx(d.Fragment,{children:d.jsx("nav",{class:"bg-white border-gray-200 dark:bg-gray-900",children:d.jsxs("div",{class:"max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4",children:[d.jsx("a",{href:"home",class:"flex items-center space-x-3 rtl:space-x-reverse",children:d.jsx("span",{class:"self-center text-2xl font-semibold whitespace-nowrap dark:text-white",children:"Security Flow"})}),d.jsxs("div",{class:"flex flex-row md:flex-col md:items-end  md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse",children:[d.jsx("button",{type:"button",class:"flex items-center text-sm md:bg-gray-800 rounded-full md:me-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600",id:"user-picture-button","aria-expanded":g?"true":"false",onClick:l,"data-dropdown-toggle":"user-dropdown","data-dropdown-placement":"bottom",children:d.jsx("img",{class:"w-8 h-8 rounded-full",src:GZ,alt:"user photo"})}),g&&d.jsxs("div",{className:"z-50 absolute right-0 text-base m-10 list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600",children:[d.jsxs("div",{className:"px-3 py-3",children:[d.jsx("span",{className:"block text-sm text-gray-900 dark:text-white",children:"Carlos Guerra"}),d.jsx("span",{className:"block text-sm text-gray-500 truncate dark:text-gray-400",children:"chernandez@hotmail.com"})]}),d.jsx("ul",{className:"py-1","aria-labelledby":"user-menu-button",children:d.jsx("li",{children:d.jsx("button",{onClick:A,className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white",children:"Sign out"})})})]}),d.jsx("button",{"data-collapse-toggle":"navbar-user",type:"button",class:"inline-flex items-center  p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-expanded":e?"true":"false",onClick:n,children:d.jsx("svg",{class:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 14",children:d.jsx("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M1 1h15M1 7h15M1 13h15"})})}),e&&d.jsx("div",{className:"z-50 absolute right-0 text-base m-11 list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600 md:hidden",children:d.jsx("ul",{className:"py-1","aria-labelledby":"user-menu-button",children:I.map((i,s)=>d.jsx("li",{children:d.jsx("a",{href:i.url,className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white",children:i.label})},s))})})]}),d.jsx("div",{className:"items-center justify-between hidden w-full md:flex md:w-auto md:order-1",id:"navbar-user",children:d.jsx("ul",{className:"flex flex-col font-medium p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700",children:I.map((i,s)=>d.jsx("li",{children:d.jsx("a",{href:i.url,className:" text-xl block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700",children:i.label})},s))})})]})})})},DW="/assets/error-csJoMxGL.png",TW="/assets/check-CBXK7Dh5.png",jW=({message:I,isVisible:g,duration:C=3e3,onClose:e,type:t})=>{if(p.useEffect(()=>{if(g){const o=setTimeout(()=>{e()},C);return()=>clearTimeout(o)}},[g,C,e]),!g)return null;const l=()=>t===!0?"text-green-600 p-8":"text-red-600 p-8",n=()=>t===!0?TW:DW;return d.jsxs("div",{className:"font-roboto_mono flex flex-row items-center fixed bottom-4 right-4 bg-slate-100 rounded shadow-lg animate-bounce",children:[d.jsx("p",{className:l(),children:I}),d.jsx("img",{src:n(),alt:t,class:"h-12 w-12 mr-8"})]})},BZ=p.createContext(),RC=()=>p.useContext(BZ),PW=({children:I})=>{const[g,C]=p.useState(!1),[e,t]=p.useState(""),[l,n]=p.useState(""),o=p.useCallback((A,i)=>{t(A),n(i),C(!0),setTimeout(()=>{C(!1)},3e3)},[]);return d.jsxs(BZ.Provider,{value:{showPopup:o},children:[I,d.jsx(jW,{message:e,isVisible:g,type:l,onClose:()=>C(!1)})]})},OW=()=>{const[I,g]=p.useState(""),[C,e]=p.useState(""),{showPopup:t}=RC(),[l,n]=p.useState([{houseNumber:"100",representative:"Juan Francisco Flores"},{houseNumber:"200",representative:"Melissa Estefania Zaragoza"}]),o=()=>{I&&C?(n(A=>[...A,{houseNumber:I,representative:C}]),g(""),e(""),t("Hogar agregado exitosamente",!0)):t("Por favor, complete ambos campos.",!1)};return d.jsx("div",{children:d.jsxs("div",{className:"flex justify-center items-center h-screen flex-col w-full",children:[d.jsx("h1",{className:"text-2xl font-bold text-center text-azul-principal m-2 font-roboto_mono",children:"Agregar Hogar"}),d.jsxs("div",{className:"flex flex-col mt-2 w-[150px] sm:w-[332px]",children:[d.jsx("label",{htmlFor:"houseNumber",className:"text-base m-2 font-roboto_mono",children:"Número de casa:"}),d.jsx("input",{type:"number",id:"houseNumber",placeholder:"Ingrese el número de casa",className:"border border-gray-300 p-2 rounded-md",value:I,onChange:A=>g(A.target.value)}),d.jsx("label",{htmlFor:"residentName",className:"text-base m-2 font-roboto_mono",children:"Residente encargado de hogar:"}),d.jsx("input",{type:"text",id:"residentName",placeholder:"Ingrese nombre del encargado",className:"border border-gray-300 p-2 rounded-md",value:C,onChange:A=>e(A.target.value)}),d.jsx("button",{className:"bg-amarillo-principal text-black m-2 w-20 py-2 rounded-md font-roboto_mono mt-7",onClick:o,children:"Agregar"})]})]})})},_W=({columnas:I,datos:g,handleEliminar:C,handleRoleChange:e})=>d.jsxs("div",{className:"w-full h-full mt-6 mr-6 ml-auto pl-5 pr-5",children:[d.jsx("div",{className:"m-6 flex justify-center",children:d.jsx("h1",{className:"font-bold text-2xl font-roboto_mono",children:"Tabla de Residentes"})}),d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"min-w-full divide-y border-separate border-spacing-0.5 border border-gray-500",children:[d.jsx("thead",{children:d.jsxs("tr",{className:"bg-[#F8BD0D] bg-opacity-70 font-semibold font-roboto_mono",children:[I.map(t=>d.jsx("th",{className:"px-4 py-2 text-center border border-gray-500",children:t.Header},t.accessor)),d.jsx("th",{className:"px-4 py-2 text-center border border-gray-500",children:"Rol"}),d.jsx("th",{className:"px-4 py-2 text-center border border-gray-500",children:"Acciones"})]})}),d.jsx("tbody",{className:"text-center bg-gray-100 border-stone-500 font-roboto_mono",children:g.map((t,l)=>d.jsxs("tr",{className:"hover:bg-gray-100 border-black",children:[I.map(n=>d.jsx("td",{className:"border px-4 py-2 border-gray-500",children:t[n.accessor]},n.accessor)),d.jsx("td",{className:"border px-4 py-2 border-gray-500",children:d.jsx("button",{onClick:()=>e(t.id),className:`py-1 px-3 rounded-md font-roboto_mono ${t.rol==="Encargado"?"bg-yellow-300":"bg-yellow-100"}`,children:t.rol==="Encargado"?"Encargado":"Asignar"})}),d.jsx("td",{className:"border px-4 py-2 border-gray-500",children:d.jsx("button",{onClick:()=>C(t.id),className:"bg-red-300 py-1 px-3 rounded-md font-roboto_mono",children:"Eliminar"})})]},l))})]})})]}),qW=()=>{const{houseNumber:I}=Z0(),[g,C]=p.useState([{id:1,nombre:"Ilcia",apellido:"Huezo",correo:"holamundo@gmail.com",documento:"00295333-2",rol:"Residente"},{id:2,nombre:"Ilcia",apellido:"Huezo",correo:"holamundo@gmail.com",documento:"--------",rol:"Residente"},{id:3,nombre:"Ilcia",apellido:"Huezo",correo:"holamundo@gmail.com",documento:"00295333-2",rol:"Residente"},{id:4,nombre:"Ilcia",apellido:"Huezo",correo:"holamundo@gmail.com",documento:"00295333-2",rol:"Residente"}]),[e,t]=p.useState(""),l=()=>{alert(`Buscando residente con el correo: ${e}`),t("")},n=i=>{C(g.filter(s=>s.id!==i))},o=i=>{C(g.map(s=>({...s,rol:s.id===i?"Encargado":"Residente"})))},A=[{Header:"Nombre",accessor:"nombre"},{Header:"Apellido",accessor:"apellido"},{Header:"Correo electrónico",accessor:"correo"},{Header:"Documento",accessor:"documento"},{Header:"Rol",accessor:"rol"}];return d.jsxs("div",{children:[d.jsxs("h1",{className:"text-3xl font-bold mb-4 text-center text-azul-claro mt-4 md:mt-8 font-roboto_mono",children:["Gestión de residentes para la casa ",I]}),d.jsxs("div",{className:"flex flex-col items-center",children:[d.jsx("h2",{className:"text-2xl font-bold text-center text-azul-principal m-2 font-roboto_mono",children:"Añadir Residentes al hogar"}),d.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md w-full sm:w-96 mb-4",children:[d.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-roboto_mono mb-2",children:"Correo electrónico :"}),d.jsx("input",{type:"email",id:"email",placeholder:"Ingresa el correo electrónico",className:"border border-gray-300 p-2 rounded-md w-full",value:e,onChange:i=>t(i.target.value)}),d.jsx("button",{className:"bg-amarillo-principal text-black mt-4 py-2 px-4 rounded-md font-roboto_mono hover:bg-yellow-600 transition duration-300",onClick:l,children:"Agregar"})]})]}),d.jsx(_W,{columnas:A,datos:g,handleEliminar:n,handleRoleChange:o})]})},$W=()=>{const I=[{label:"Entradas",url:"/admon/history"},{label:"Gestionar Hogares",url:"/admon/manager"},{label:"Historial",url:"/admon/home"},{label:"Gestionar Guardias",url:"/admon/guard"}];return d.jsxs(d.Fragment,{children:[d.jsx(al,{menuItems:I}),d.jsxs(Ue,{children:[d.jsx(x,{path:"/home",element:d.jsx(LW,{})}),d.jsx(x,{path:"/manager",element:d.jsx(OW,{})}),d.jsx(x,{path:"/guard",element:d.jsx(x0,{})}),d.jsx(x,{path:"/history",element:d.jsx(QW,{})}),d.jsx(x,{path:"/gestionar/:houseNumber",element:d.jsx(qW,{})}),d.jsx(x,{path:"/",element:d.jsx(OC,{to:"/admon/history"})})]})]})},gV=()=>{const{showPopup:I}=RC(),[g,C]=p.useState({email:"",dateVisit:"",timeVisit:""}),e=n=>{const{name:o,value:A}=n.target;C({...g,[o]:A})},t=n=>{n.preventDefault(),console.log("Formulario enviado:",g),I("Solicitud enviada exitosamente",!0)},l=n=>{n.preventDefault(),I("Solicitud cancelado",!1)};return d.jsxs("div",{className:"flex  items-center h-screen flex-col  w-full  font-roboto_mono ",children:[d.jsx("h1",{className:"text-2xl text-[#6185A9] text-center m-2 ",children:"Detalles de la solicitud"}),d.jsx("h2",{className:"text-center text-xl text-[#6185A9] pb-2",children:"Acceso Frecuente"}),d.jsxs("form",{onSubmit:t,className:"max-w-md mx-auto",children:[d.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Correo electrónico:"}),d.jsx("input",{type:"email",name:"email",placeholder:"Correo electrónico",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.email,onChange:e})]}),d.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Fecha inicial de visita:"}),d.jsx("input",{type:"date",name:"date1",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.date,onChange:e})]}),d.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Fecha final de visita:"}),d.jsx("input",{type:"date",name:"date2",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.date,onChange:e})]}),d.jsxs("div",{className:"flex flex-col mt-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Permiso habilitado desde:"}),d.jsx("input",{type:"time",name:"time1",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.time,onChange:e})]}),d.jsxs("div",{className:"flex flex-col mt-4 mb-8",children:[d.jsx("label",{className:"text-lg mb-2",children:"Hasta:"}),d.jsx("input",{type:"time",name:"time2",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.time,onChange:e})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("button",{type:"submit",className:"p-2 rounded-lg bg-[#F8BD0D] bg-opacity-70 w-full md:w-1/2 lg:w-1/3 mx-2",children:"Aceptar"}),d.jsx("button",{type:"button",className:"p-2 rounded-lg bg-[#F79E9E] w-full md:w-1/2 lg:w-1/3 mx-2",onClick:l,children:"Cancelar"})]})]})]})},zd="data:image/svg+xml,%3csvg%20width='34'%20height='32'%20viewBox='0%200%2034%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M17%200.5625C8.03984%200.5625%200.75%207.48785%200.75%2016C0.75%2024.5121%208.03984%2031.4375%2017%2031.4375C25.9602%2031.4375%2033.25%2024.5121%2033.25%2016C33.25%207.48785%2025.9602%200.5625%2017%200.5625ZM24.5%2017.1875H18.25V23.125H15.75V17.1875H9.5V14.8125H15.75V8.875H18.25V14.8125H24.5V17.1875Z'%20fill='black'/%3e%3c/svg%3e",ki="/assets/profile_lg-0JT_uoxj.png",VI=()=>{const{showPopup:I}=RC(),g=()=>{I("Removido exitosamente",!0)};return d.jsxs("div",{className:"bg-[#D9D9D9] bg-opacity-52 p-2 rounded-md flex flex-col sm:flex-row justify-center items-center m-2 w-auto font-roboto_mono",children:[d.jsx("img",{className:"w-10 h-10 sm:mr-5 m-1",src:ki,alt:"profile"}),d.jsxs("div",{className:"flex flex-col justify-center items-center sm:mr-5 m-1",children:[d.jsx("p",{className:"pt-1 text-center",children:"Carlos Sosa"}),d.jsx("p",{className:"pt-1 text-center",children:"24/11/2024"}),d.jsx("p",{className:"pt-1 text-center",children:"11:20 AM"})]}),d.jsx("div",{className:"flex justify-center items-center",children:d.jsx("button",{className:"rounded-md bg-[#F79E9E] p-2 m-1",onClick:g,children:"Revocar"})})]})},IV=()=>{const I=SC(),g=()=>{I("/resident/UniqueP")},C=()=>{I("/resident/MultipleP")};return d.jsxs("div",{className:"flex flex-col items-center font-roboto_mono",children:[d.jsx("h1",{className:"text-2xl text-[#6185A9] text-center  pt-6",children:"Crear permisos de acceso"}),d.jsx("h2",{className:"text-center text-xl text-[#6185A9] pt-4 pb-4 mt-1",children:"Seleccionar el tipo de acceso"}),d.jsxs("div",{onClick:g,className:"bg-[#F5CB50] bg-opacity-70 rounded-lg p-3 m-2 flex flex-row justify-between w-44",children:[d.jsx("p",{className:"pr-3",children:"Único"}),d.jsx("img",{className:"w-4 h-4",src:zd,alt:"añadir"})]}),d.jsxs("div",{onClick:C,className:"bg-[#F5CB50] bg-opacity-70 rounded-lg p-3 m-2 flex flex-row items-center justify-between w-44",children:[d.jsx("p",{className:"pr-3",children:"Frecuente"}),d.jsx("img",{className:"w-4 h-4",src:zd,alt:"añadir"})]}),d.jsx("h2",{className:"text-center text-xl text-[#6185A9] pt-4 pb-4 mt-1",children:"Permisos creados"}),d.jsxs("div",{className:"overflow-y-auto h-96 mb-8",children:[d.jsx(VI,{}),d.jsx(VI,{}),d.jsx(VI,{}),d.jsx(VI,{}),d.jsx(VI,{}),d.jsx(VI,{}),d.jsx(VI,{}),d.jsx(VI,{}),d.jsx(VI,{})]})]})},CV=()=>{const{showPopup:I}=RC(),[g,C]=p.useState({email:"",dateVisit:"",timeVisit:""}),e=n=>{const{name:o,value:A}=n.target;C({...g,[o]:A})},t=n=>{n.preventDefault(),console.log("Formulario enviado:",g),I("Solicitud enviada exitosamente",!0)},l=n=>{n.preventDefault(),I("Solicitud cancelado",!1)};return d.jsxs("div",{className:"flex  items-center h-screen flex-col  w-full  font-roboto_mono ",children:[d.jsx("h1",{className:"text-2xl text-[#6185A9] text-center pt-4 pb-1",children:"Detalles de la solicitud"}),d.jsxs("form",{onSubmit:t,children:[d.jsxs("div",{className:"flex flex-col mt-4 mb-4 width-auto",children:[d.jsx("label",{className:"text-xl mb-2",children:"Correo electrónico:"}),d.jsx("input",{type:"email",name:"email",placeholder:"Correo electrónico",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.email,onChange:e})]}),d.jsxs("div",{className:" flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-xl mb-2",children:"Fecha de visita:"}),d.jsx("input",{type:"date",name:"date",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.date,onChange:e})]}),d.jsxs("div",{className:" flex flex-col mt-4 mb-8",children:[d.jsx("label",{className:"text-xl mb-2",children:"Hora de llegada:"}),d.jsx("input",{type:"time",name:"time",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.time,onChange:e})]}),d.jsxs("div",{className:"flex flex-row pt-2",children:[d.jsx("div",{className:"p-4 mr-4 rounded-lg bg-[#F8BD0D] bg-opacity-70",children:d.jsx("button",{type:"submit",children:"Aceptar"})}),d.jsx("div",{className:"p-4 rounded-lg bg-[#F79E9E]",children:d.jsx("button",{type:"button",onClick:l,children:"Cancelar"})})]})]})]})},Bo=()=>{const{user:I}=p.useContext(Qi);return console.log("User context:",I),I?d.jsx("div",{className:"flex items-center justify-center h-screen",children:d.jsxs("div",{className:"flex flex-col items-center bg-gray-900 w-4/5 rounded-2xl font-roboto_mono text-white",children:[d.jsx("div",{className:"mt-12 mb-4",children:d.jsx("img",{src:GZ,alt:"Avatar",className:"w-40 h-40 rounded-full"})}),d.jsx("p",{className:"text-center text-3xl mb-2",children:I.name}),d.jsx("p",{className:"text-center text-base sm:text-2xl mb-2",children:I.email}),d.jsx("p",{className:"text-center text-2xl mb-2",children:I.id}),d.jsx("p",{className:"text-center text-2xl mb-12",children:I.address})]})}):d.jsx("div",{children:"Loading..."})},eV=()=>d.jsx("div",{children:d.jsx(Bo,{})}),tV=()=>{p.useState(!1);const[I,g]=p.useState({email:"",dateVisit:""}),C=t=>{const{name:l,value:n}=t.target;g({...I,[l]:n})},e=t=>{t.preventDefault(),console.log("Formulario enviado:",I)};return d.jsxs("div",{className:"flex  items-center h-screen flex-col  w-full font-roboto_mono pt-10",children:[d.jsx("h1",{className:"text-2xl text-[#6185A9] text-center",children:"Añadir residentes al hogar"}),d.jsxs("form",{onSubmit:e,children:[d.jsxs("div",{className:"flex flex-col mt-4 mb-4 width-auto",children:[d.jsx("label",{className:"text-lg mb-2 pt-5",children:"Correo electrónico:"}),d.jsx("input",{type:"email",name:"email",placeholder:"Correo electrónico",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:I.email,onChange:C})]}),d.jsxs("div",{className:" flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Número de identificación:"}),d.jsx("input",{type:"number",name:"number",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:I.date,onChange:C})]})]}),d.jsx("button",{className:"p-3 rounded-md bg-[#F79E9E] w-30 mb-4 mt-3",children:"Añadir"}),d.jsx("h1",{className:"text-2xl text-[#6185A9] text-center font-bold mb-4 mt-5",children:"Residentes activos"}),d.jsxs("div",{className:"bg-[#D9D9D9] bg-opacity-52 p-2 rounded-md flex flex-col sm:flex-row justify-center items-center m-2 w-auto",children:[d.jsx("img",{className:"w-10 h-10 sm:mr-5 m-1",src:ki,alt:"profile"}),d.jsxs("div",{className:"flex flex-col justify-center items-center sm:mr-5 m-1",children:[d.jsx("p",{className:"pt-1 text-center",children:"Carlos Hernández"}),d.jsx("p",{className:"pt-1 text-center",children:"00002721@uca.edu.sv"})]}),d.jsx("div",{className:"flex justify-center items-center",children:d.jsx("button",{className:"bg-[#F8BD0D] bg-opacity-70 p-2 m-1 rounded-md",children:"Eliminar"})})]}),d.jsxs("div",{className:"bg-[#D9D9D9] bg-opacity-52 p-2 rounded-md flex flex-col sm:flex-row justify-center items-center m-2 w-auto",children:[d.jsx("img",{className:"w-10 h-10 sm:mr-5 m-1",src:ki,alt:"profile"}),d.jsxs("div",{className:"flex flex-col justify-center items-center sm:mr-5 m-1",children:[d.jsx("p",{className:"pt-1 text-center",children:"Carlos Hernández"}),d.jsx("p",{className:"pt-1 text-center",children:"00002721@uca.edu.sv"})]}),d.jsx("div",{className:"flex justify-center items-center",children:d.jsx("button",{className:"bg-[#F8BD0D] bg-opacity-70 p-2 m-1 rounded-md",children:"Eliminar"})})]})]})},lV=()=>{const[I]=p.useState([{id:1,nombre:"Carlos Sosa",fecha:"2024-11-24",hora:"11:20 AM"},{id:2,nombre:"María Perez",fecha:"2024-11-20",hora:"02:30 PM"},{id:2,nombre:"María Perez",fecha:"2024-11-20",hora:"02:30 PM"},{id:2,nombre:"María Perez",fecha:"2024-11-20",hora:"02:30 PM"},{id:2,nombre:"María Perez",fecha:"2024-11-20",hora:"02:30 PM"}]),[g,C]=p.useState(""),[e,t]=p.useState("all"),[l,n]=p.useState(!1),o=c=>{C(c.target.value)},A=c=>{t(c),n(!1)},s=(()=>{const c=new Date;let a=I;switch(e){case"last10":const r=new Date;r.setDate(c.getDate()-10),a=I.filter(b=>new Date(b.fecha)>=r);break;case"month":const m=new Date().getMonth();a=I.filter(b=>new Date(b.fecha).getMonth()===m);break;case"name":a=I.filter(b=>b.nombre.toLowerCase().includes(g.toLowerCase()));break;default:a=I;break}return a})();return d.jsxs("div",{className:"flex items-center flex-col w-full font-roboto_mono",children:[d.jsx("h1",{className:"text-2xl text-[#6185A9] text-center mt-4",children:"Registro de visitas"}),d.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center w-full mt-4",children:[d.jsx("h2",{className:"text-xl text-[#6185A9] text-center",children:"Últimas visitas registradas"}),d.jsxs("div",{className:"relative ml-4 sm:ml-10",children:[d.jsx("button",{type:"button",className:"bg-amarillo-principal text-black py-1 px-4 rounded-md text-sm font-roboto_mono",onClick:()=>n(!l),children:"Filtrar resultados"}),l&&d.jsx("div",{className:"absolute right-0 mt-2 w-56 origin-top-right bg-white divide-y divide-gray-100 rounded-md shadow-lg",children:d.jsxs("div",{className:"py-1",children:[d.jsx("button",{onClick:()=>A("last10"),className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"Últimos 10 días"}),d.jsx("button",{onClick:()=>A("month"),className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"Mes actual"}),d.jsx("button",{onClick:()=>A("name"),className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:"Por nombre"}),d.jsx("input",{type:"text",placeholder:"Buscar nombre",value:g,onChange:o,className:"block px-4 py-2 text-sm text-gray-700 w-full text-left"})]})})]})]}),d.jsx("div",{className:"mt-7 overflow-y-auto h-96 mb-8",children:s.length>0?s.map(c=>d.jsx(VI,{nombre:c.nombre,fecha:c.fecha,hora:c.hora},c.id)):d.jsx("p",{className:"text-gray-700 mt-4",children:"No se encontraron resultados."})})]})};var nV=Object.defineProperty,Pn=Object.getOwnPropertySymbols,yZ=Object.prototype.hasOwnProperty,pZ=Object.prototype.propertyIsEnumerable,Md=(I,g,C)=>g in I?nV(I,g,{enumerable:!0,configurable:!0,writable:!0,value:C}):I[g]=C,gl=(I,g)=>{for(var C in g||(g={}))yZ.call(g,C)&&Md(I,C,g[C]);if(Pn)for(var C of Pn(g))pZ.call(g,C)&&Md(I,C,g[C]);return I},_s=(I,g)=>{var C={};for(var e in I)yZ.call(I,e)&&g.indexOf(e)<0&&(C[e]=I[e]);if(I!=null&&Pn)for(var e of Pn(I))g.indexOf(e)<0&&pZ.call(I,e)&&(C[e]=I[e]);return C};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var $C;(I=>{const g=class{constructor(A,i,s,c){if(this.version=A,this.errorCorrectionLevel=i,this.modules=[],this.isFunction=[],A<g.MIN_VERSION||A>g.MAX_VERSION)throw new RangeError("Version value out of range");if(c<-1||c>7)throw new RangeError("Mask value out of range");this.size=A*4+17;let a=[];for(let m=0;m<this.size;m++)a.push(!1);for(let m=0;m<this.size;m++)this.modules.push(a.slice()),this.isFunction.push(a.slice());this.drawFunctionPatterns();const r=this.addEccAndInterleave(s);if(this.drawCodewords(r),c==-1){let m=1e9;for(let b=0;b<8;b++){this.applyMask(b),this.drawFormatBits(b);const G=this.getPenaltyScore();G<m&&(c=b,m=G),this.applyMask(b)}}l(0<=c&&c<=7),this.mask=c,this.applyMask(c),this.drawFormatBits(c),this.isFunction=[]}static encodeText(A,i){const s=I.QrSegment.makeSegments(A);return g.encodeSegments(s,i)}static encodeBinary(A,i){const s=I.QrSegment.makeBytes(A);return g.encodeSegments([s],i)}static encodeSegments(A,i,s=1,c=40,a=-1,r=!0){if(!(g.MIN_VERSION<=s&&s<=c&&c<=g.MAX_VERSION)||a<-1||a>7)throw new RangeError("Invalid value");let m,b;for(m=s;;m++){const h=g.getNumDataCodewords(m,i)*8,B=o.getTotalBits(A,m);if(B<=h){b=B;break}if(m>=c)throw new RangeError("Data too long")}for(const h of[g.Ecc.MEDIUM,g.Ecc.QUARTILE,g.Ecc.HIGH])r&&b<=g.getNumDataCodewords(m,h)*8&&(i=h);let G=[];for(const h of A){e(h.mode.modeBits,4,G),e(h.numChars,h.mode.numCharCountBits(m),G);for(const B of h.getData())G.push(B)}l(G.length==b);const u=g.getNumDataCodewords(m,i)*8;l(G.length<=u),e(0,Math.min(4,u-G.length),G),e(0,(8-G.length%8)%8,G),l(G.length%8==0);for(let h=236;G.length<u;h^=253)e(h,8,G);let Z=[];for(;Z.length*8<G.length;)Z.push(0);return G.forEach((h,B)=>Z[B>>>3]|=h<<7-(B&7)),new g(m,i,Z,a)}getModule(A,i){return 0<=A&&A<this.size&&0<=i&&i<this.size&&this.modules[i][A]}getModules(){return this.modules}drawFunctionPatterns(){for(let s=0;s<this.size;s++)this.setFunctionModule(6,s,s%2==0),this.setFunctionModule(s,6,s%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const A=this.getAlignmentPatternPositions(),i=A.length;for(let s=0;s<i;s++)for(let c=0;c<i;c++)s==0&&c==0||s==0&&c==i-1||s==i-1&&c==0||this.drawAlignmentPattern(A[s],A[c]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(A){const i=this.errorCorrectionLevel.formatBits<<3|A;let s=i;for(let a=0;a<10;a++)s=s<<1^(s>>>9)*1335;const c=(i<<10|s)^21522;l(c>>>15==0);for(let a=0;a<=5;a++)this.setFunctionModule(8,a,t(c,a));this.setFunctionModule(8,7,t(c,6)),this.setFunctionModule(8,8,t(c,7)),this.setFunctionModule(7,8,t(c,8));for(let a=9;a<15;a++)this.setFunctionModule(14-a,8,t(c,a));for(let a=0;a<8;a++)this.setFunctionModule(this.size-1-a,8,t(c,a));for(let a=8;a<15;a++)this.setFunctionModule(8,this.size-15+a,t(c,a));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let A=this.version;for(let s=0;s<12;s++)A=A<<1^(A>>>11)*7973;const i=this.version<<12|A;l(i>>>18==0);for(let s=0;s<18;s++){const c=t(i,s),a=this.size-11+s%3,r=Math.floor(s/3);this.setFunctionModule(a,r,c),this.setFunctionModule(r,a,c)}}drawFinderPattern(A,i){for(let s=-4;s<=4;s++)for(let c=-4;c<=4;c++){const a=Math.max(Math.abs(c),Math.abs(s)),r=A+c,m=i+s;0<=r&&r<this.size&&0<=m&&m<this.size&&this.setFunctionModule(r,m,a!=2&&a!=4)}}drawAlignmentPattern(A,i){for(let s=-2;s<=2;s++)for(let c=-2;c<=2;c++)this.setFunctionModule(A+c,i+s,Math.max(Math.abs(c),Math.abs(s))!=1)}setFunctionModule(A,i,s){this.modules[i][A]=s,this.isFunction[i][A]=!0}addEccAndInterleave(A){const i=this.version,s=this.errorCorrectionLevel;if(A.length!=g.getNumDataCodewords(i,s))throw new RangeError("Invalid argument");const c=g.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][i],a=g.ECC_CODEWORDS_PER_BLOCK[s.ordinal][i],r=Math.floor(g.getNumRawDataModules(i)/8),m=c-r%c,b=Math.floor(r/c);let G=[];const u=g.reedSolomonComputeDivisor(a);for(let h=0,B=0;h<c;h++){let y=A.slice(B,B+b-a+(h<m?0:1));B+=y.length;const V=g.reedSolomonComputeRemainder(y,u);h<m&&y.push(0),G.push(y.concat(V))}let Z=[];for(let h=0;h<G[0].length;h++)G.forEach((B,y)=>{(h!=b-a||y>=m)&&Z.push(B[h])});return l(Z.length==r),Z}drawCodewords(A){if(A.length!=Math.floor(g.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let i=0;for(let s=this.size-1;s>=1;s-=2){s==6&&(s=5);for(let c=0;c<this.size;c++)for(let a=0;a<2;a++){const r=s-a,b=(s+1&2)==0?this.size-1-c:c;!this.isFunction[b][r]&&i<A.length*8&&(this.modules[b][r]=t(A[i>>>3],7-(i&7)),i++)}}l(i==A.length*8)}applyMask(A){if(A<0||A>7)throw new RangeError("Mask value out of range");for(let i=0;i<this.size;i++)for(let s=0;s<this.size;s++){let c;switch(A){case 0:c=(s+i)%2==0;break;case 1:c=i%2==0;break;case 2:c=s%3==0;break;case 3:c=(s+i)%3==0;break;case 4:c=(Math.floor(s/3)+Math.floor(i/2))%2==0;break;case 5:c=s*i%2+s*i%3==0;break;case 6:c=(s*i%2+s*i%3)%2==0;break;case 7:c=((s+i)%2+s*i%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[i][s]&&c&&(this.modules[i][s]=!this.modules[i][s])}}getPenaltyScore(){let A=0;for(let a=0;a<this.size;a++){let r=!1,m=0,b=[0,0,0,0,0,0,0];for(let G=0;G<this.size;G++)this.modules[a][G]==r?(m++,m==5?A+=g.PENALTY_N1:m>5&&A++):(this.finderPenaltyAddHistory(m,b),r||(A+=this.finderPenaltyCountPatterns(b)*g.PENALTY_N3),r=this.modules[a][G],m=1);A+=this.finderPenaltyTerminateAndCount(r,m,b)*g.PENALTY_N3}for(let a=0;a<this.size;a++){let r=!1,m=0,b=[0,0,0,0,0,0,0];for(let G=0;G<this.size;G++)this.modules[G][a]==r?(m++,m==5?A+=g.PENALTY_N1:m>5&&A++):(this.finderPenaltyAddHistory(m,b),r||(A+=this.finderPenaltyCountPatterns(b)*g.PENALTY_N3),r=this.modules[G][a],m=1);A+=this.finderPenaltyTerminateAndCount(r,m,b)*g.PENALTY_N3}for(let a=0;a<this.size-1;a++)for(let r=0;r<this.size-1;r++){const m=this.modules[a][r];m==this.modules[a][r+1]&&m==this.modules[a+1][r]&&m==this.modules[a+1][r+1]&&(A+=g.PENALTY_N2)}let i=0;for(const a of this.modules)i=a.reduce((r,m)=>r+(m?1:0),i);const s=this.size*this.size,c=Math.ceil(Math.abs(i*20-s*10)/s)-1;return l(0<=c&&c<=9),A+=c*g.PENALTY_N4,l(0<=A&&A<=2568888),A}getAlignmentPatternPositions(){if(this.version==1)return[];{const A=Math.floor(this.version/7)+2,i=this.version==32?26:Math.ceil((this.version*4+4)/(A*2-2))*2;let s=[6];for(let c=this.size-7;s.length<A;c-=i)s.splice(1,0,c);return s}}static getNumRawDataModules(A){if(A<g.MIN_VERSION||A>g.MAX_VERSION)throw new RangeError("Version number out of range");let i=(16*A+128)*A+64;if(A>=2){const s=Math.floor(A/7)+2;i-=(25*s-10)*s-55,A>=7&&(i-=36)}return l(208<=i&&i<=29648),i}static getNumDataCodewords(A,i){return Math.floor(g.getNumRawDataModules(A)/8)-g.ECC_CODEWORDS_PER_BLOCK[i.ordinal][A]*g.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][A]}static reedSolomonComputeDivisor(A){if(A<1||A>255)throw new RangeError("Degree out of range");let i=[];for(let c=0;c<A-1;c++)i.push(0);i.push(1);let s=1;for(let c=0;c<A;c++){for(let a=0;a<i.length;a++)i[a]=g.reedSolomonMultiply(i[a],s),a+1<i.length&&(i[a]^=i[a+1]);s=g.reedSolomonMultiply(s,2)}return i}static reedSolomonComputeRemainder(A,i){let s=i.map(c=>0);for(const c of A){const a=c^s.shift();s.push(0),i.forEach((r,m)=>s[m]^=g.reedSolomonMultiply(r,a))}return s}static reedSolomonMultiply(A,i){if(A>>>8||i>>>8)throw new RangeError("Byte out of range");let s=0;for(let c=7;c>=0;c--)s=s<<1^(s>>>7)*285,s^=(i>>>c&1)*A;return l(s>>>8==0),s}finderPenaltyCountPatterns(A){const i=A[1];l(i<=this.size*3);const s=i>0&&A[2]==i&&A[3]==i*3&&A[4]==i&&A[5]==i;return(s&&A[0]>=i*4&&A[6]>=i?1:0)+(s&&A[6]>=i*4&&A[0]>=i?1:0)}finderPenaltyTerminateAndCount(A,i,s){return A&&(this.finderPenaltyAddHistory(i,s),i=0),i+=this.size,this.finderPenaltyAddHistory(i,s),this.finderPenaltyCountPatterns(s)}finderPenaltyAddHistory(A,i){i[0]==0&&(A+=this.size),i.pop(),i.unshift(A)}};let C=g;C.MIN_VERSION=1,C.MAX_VERSION=40,C.PENALTY_N1=3,C.PENALTY_N2=3,C.PENALTY_N3=40,C.PENALTY_N4=10,C.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],C.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],I.QrCode=C;function e(A,i,s){if(i<0||i>31||A>>>i)throw new RangeError("Value out of range");for(let c=i-1;c>=0;c--)s.push(A>>>c&1)}function t(A,i){return(A>>>i&1)!=0}function l(A){if(!A)throw new Error("Assertion error")}const n=class{constructor(A,i,s){if(this.mode=A,this.numChars=i,this.bitData=s,i<0)throw new RangeError("Invalid argument");this.bitData=s.slice()}static makeBytes(A){let i=[];for(const s of A)e(s,8,i);return new n(n.Mode.BYTE,A.length,i)}static makeNumeric(A){if(!n.isNumeric(A))throw new RangeError("String contains non-numeric characters");let i=[];for(let s=0;s<A.length;){const c=Math.min(A.length-s,3);e(parseInt(A.substr(s,c),10),c*3+1,i),s+=c}return new n(n.Mode.NUMERIC,A.length,i)}static makeAlphanumeric(A){if(!n.isAlphanumeric(A))throw new RangeError("String contains unencodable characters in alphanumeric mode");let i=[],s;for(s=0;s+2<=A.length;s+=2){let c=n.ALPHANUMERIC_CHARSET.indexOf(A.charAt(s))*45;c+=n.ALPHANUMERIC_CHARSET.indexOf(A.charAt(s+1)),e(c,11,i)}return s<A.length&&e(n.ALPHANUMERIC_CHARSET.indexOf(A.charAt(s)),6,i),new n(n.Mode.ALPHANUMERIC,A.length,i)}static makeSegments(A){return A==""?[]:n.isNumeric(A)?[n.makeNumeric(A)]:n.isAlphanumeric(A)?[n.makeAlphanumeric(A)]:[n.makeBytes(n.toUtf8ByteArray(A))]}static makeEci(A){let i=[];if(A<0)throw new RangeError("ECI assignment value out of range");if(A<128)e(A,8,i);else if(A<16384)e(2,2,i),e(A,14,i);else if(A<1e6)e(6,3,i),e(A,21,i);else throw new RangeError("ECI assignment value out of range");return new n(n.Mode.ECI,0,i)}static isNumeric(A){return n.NUMERIC_REGEX.test(A)}static isAlphanumeric(A){return n.ALPHANUMERIC_REGEX.test(A)}getData(){return this.bitData.slice()}static getTotalBits(A,i){let s=0;for(const c of A){const a=c.mode.numCharCountBits(i);if(c.numChars>=1<<a)return 1/0;s+=4+a+c.bitData.length}return s}static toUtf8ByteArray(A){A=encodeURI(A);let i=[];for(let s=0;s<A.length;s++)A.charAt(s)!="%"?i.push(A.charCodeAt(s)):(i.push(parseInt(A.substr(s+1,2),16)),s+=2);return i}};let o=n;o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",I.QrSegment=o})($C||($C={}));(I=>{(g=>{const C=class{constructor(t,l){this.ordinal=t,this.formatBits=l}};let e=C;e.LOW=new C(0,1),e.MEDIUM=new C(1,0),e.QUARTILE=new C(2,3),e.HIGH=new C(3,2),g.Ecc=e})(I.QrCode||(I.QrCode={}))})($C||($C={}));(I=>{(g=>{const C=class{constructor(t,l){this.modeBits=t,this.numBitsCharCount=l}numCharCountBits(t){return this.numBitsCharCount[Math.floor((t+7)/17)]}};let e=C;e.NUMERIC=new C(1,[10,12,14]),e.ALPHANUMERIC=new C(2,[9,11,13]),e.BYTE=new C(4,[8,16,16]),e.KANJI=new C(8,[8,10,12]),e.ECI=new C(7,[0,0,0]),g.Mode=e})(I.QrSegment||(I.QrSegment={}))})($C||($C={}));var ye=$C;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var WZ={L:ye.QrCode.Ecc.LOW,M:ye.QrCode.Ecc.MEDIUM,Q:ye.QrCode.Ecc.QUARTILE,H:ye.QrCode.Ecc.HIGH},VZ=128,SZ="L",RZ="#FFFFFF",XZ="#000000",JZ=!1,qs=4,oV=.1;function kZ(I,g=0){const C=[];return I.forEach(function(e,t){let l=null;e.forEach(function(n,o){if(!n&&l!==null){C.push(`M${l+g} ${t+g}h${o-l}v1H${l+g}z`),l=null;return}if(o===e.length-1){if(!n)return;l===null?C.push(`M${o+g},${t+g} h1v1H${o+g}z`):C.push(`M${l+g},${t+g} h${o+1-l}v1H${l+g}z`);return}n&&l===null&&(l=o)})}),C.join("")}function fZ(I,g){return I.slice().map((C,e)=>e<g.y||e>=g.y+g.h?C:C.map((t,l)=>l<g.x||l>=g.x+g.w?t:!1))}function YZ(I,g,C,e){if(e==null)return null;const t=C?qs:0,l=I.length+t*2,n=Math.floor(g*oV),o=l/g,A=(e.width||n)*o,i=(e.height||n)*o,s=e.x==null?I.length/2-A/2:e.x*o,c=e.y==null?I.length/2-i/2:e.y*o;let a=null;if(e.excavate){let r=Math.floor(s),m=Math.floor(c),b=Math.ceil(A+s-r),G=Math.ceil(i+c-m);a={x:r,y:m,w:b,h:G}}return{x:s,y:c,h:i,w:A,excavation:a}}var AV=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}();function iV(I){const g=I,{value:C,size:e=VZ,level:t=SZ,bgColor:l=RZ,fgColor:n=XZ,includeMargin:o=JZ,style:A,imageSettings:i}=g,s=_s(g,["value","size","level","bgColor","fgColor","includeMargin","style","imageSettings"]),c=i==null?void 0:i.src,a=p.useRef(null),r=p.useRef(null),[m,b]=p.useState(!1);p.useEffect(()=>{if(a.current!=null){const Z=a.current,h=Z.getContext("2d");if(!h)return;let B=ye.QrCode.encodeText(C,WZ[t]).getModules();const y=o?qs:0,V=B.length+y*2,W=YZ(B,e,o,i),R=r.current,f=W!=null&&R!==null&&R.complete&&R.naturalHeight!==0&&R.naturalWidth!==0;f&&W.excavation!=null&&(B=fZ(B,W.excavation));const J=window.devicePixelRatio||1;Z.height=Z.width=e*J;const H=e/V*J;h.scale(H,H),h.fillStyle=l,h.fillRect(0,0,V,V),h.fillStyle=n,AV?h.fill(new Path2D(kZ(B,y))):B.forEach(function(K,T){K.forEach(function(Ag,Q){Ag&&h.fillRect(Q+y,T+y,1,1)})}),f&&h.drawImage(R,W.x+y,W.y+y,W.w,W.h)}}),p.useEffect(()=>{b(!1)},[c]);const G=gl({height:e,width:e},A);let u=null;return c!=null&&(u=Fg.createElement("img",{src:c,key:c,style:{display:"none"},onLoad:()=>{b(!0)},ref:r})),Fg.createElement(Fg.Fragment,null,Fg.createElement("canvas",gl({style:G,height:e,width:e,ref:a},s)),u)}function sV(I){const g=I,{value:C,size:e=VZ,level:t=SZ,bgColor:l=RZ,fgColor:n=XZ,includeMargin:o=JZ,imageSettings:A}=g,i=_s(g,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let s=ye.QrCode.encodeText(C,WZ[t]).getModules();const c=o?qs:0,a=s.length+c*2,r=YZ(s,e,o,A);let m=null;A!=null&&r!=null&&(r.excavation!=null&&(s=fZ(s,r.excavation)),m=Fg.createElement("image",{xlinkHref:A.src,height:r.h,width:r.w,x:r.x+c,y:r.y+c,preserveAspectRatio:"none"}));const b=kZ(s,c);return Fg.createElement("svg",gl({height:e,width:e,viewBox:`0 0 ${a} ${a}`},i),Fg.createElement("path",{fill:l,d:`M0,0 h${a}v${a}H0z`,shapeRendering:"crispEdges"}),Fg.createElement("path",{fill:n,d:b,shapeRendering:"crispEdges"}),m)}var cV=I=>{const g=I,{renderAs:C}=g,e=_s(g,["renderAs"]);return C==="svg"?Fg.createElement(sV,gl({},e)):Fg.createElement(iV,gl({},e))};function HZ(I,g){return function(){return I.apply(g,arguments)}}const{toString:aV}=Object.prototype,{getPrototypeOf:$s}=Object,yo=(I=>g=>{const C=aV.call(g);return I[C]||(I[C]=C.slice(8,-1).toLowerCase())})(Object.create(null)),BI=I=>(I=I.toLowerCase(),g=>yo(g)===I),po=I=>g=>typeof g===I,{isArray:Le}=Array,Il=po("undefined");function dV(I){return I!==null&&!Il(I)&&I.constructor!==null&&!Il(I.constructor)&&sI(I.constructor.isBuffer)&&I.constructor.isBuffer(I)}const vZ=BI("ArrayBuffer");function rV(I){let g;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?g=ArrayBuffer.isView(I):g=I&&I.buffer&&vZ(I.buffer),g}const mV=po("string"),sI=po("function"),NZ=po("number"),Wo=I=>I!==null&&typeof I=="object",uV=I=>I===!0||I===!1,cn=I=>{if(yo(I)!=="object")return!1;const g=$s(I);return(g===null||g===Object.prototype||Object.getPrototypeOf(g)===null)&&!(Symbol.toStringTag in I)&&!(Symbol.iterator in I)},ZV=BI("Date"),bV=BI("File"),hV=BI("Blob"),GV=BI("FileList"),BV=I=>Wo(I)&&sI(I.pipe),yV=I=>{let g;return I&&(typeof FormData=="function"&&I instanceof FormData||sI(I.append)&&((g=yo(I))==="formdata"||g==="object"&&sI(I.toString)&&I.toString()==="[object FormData]"))},pV=BI("URLSearchParams"),[WV,VV,SV,RV]=["ReadableStream","Request","Response","Headers"].map(BI),XV=I=>I.trim?I.trim():I.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function dl(I,g,{allOwnKeys:C=!1}={}){if(I===null||typeof I>"u")return;let e,t;if(typeof I!="object"&&(I=[I]),Le(I))for(e=0,t=I.length;e<t;e++)g.call(null,I[e],e,I);else{const l=C?Object.getOwnPropertyNames(I):Object.keys(I),n=l.length;let o;for(e=0;e<n;e++)o=l[e],g.call(null,I[o],o,I)}}function FZ(I,g){g=g.toLowerCase();const C=Object.keys(I);let e=C.length,t;for(;e-- >0;)if(t=C[e],g===t.toLowerCase())return t;return null}const KZ=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,wZ=I=>!Il(I)&&I!==KZ;function fi(){const{caseless:I}=wZ(this)&&this||{},g={},C=(e,t)=>{const l=I&&FZ(g,t)||t;cn(g[l])&&cn(e)?g[l]=fi(g[l],e):cn(e)?g[l]=fi({},e):Le(e)?g[l]=e.slice():g[l]=e};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&dl(arguments[e],C);return g}const JV=(I,g,C,{allOwnKeys:e}={})=>(dl(g,(t,l)=>{C&&sI(t)?I[l]=HZ(t,C):I[l]=t},{allOwnKeys:e}),I),kV=I=>(I.charCodeAt(0)===65279&&(I=I.slice(1)),I),fV=(I,g,C,e)=>{I.prototype=Object.create(g.prototype,e),I.prototype.constructor=I,Object.defineProperty(I,"super",{value:g.prototype}),C&&Object.assign(I.prototype,C)},YV=(I,g,C,e)=>{let t,l,n;const o={};if(g=g||{},I==null)return g;do{for(t=Object.getOwnPropertyNames(I),l=t.length;l-- >0;)n=t[l],(!e||e(n,I,g))&&!o[n]&&(g[n]=I[n],o[n]=!0);I=C!==!1&&$s(I)}while(I&&(!C||C(I,g))&&I!==Object.prototype);return g},HV=(I,g,C)=>{I=String(I),(C===void 0||C>I.length)&&(C=I.length),C-=g.length;const e=I.indexOf(g,C);return e!==-1&&e===C},vV=I=>{if(!I)return null;if(Le(I))return I;let g=I.length;if(!NZ(g))return null;const C=new Array(g);for(;g-- >0;)C[g]=I[g];return C},NV=(I=>g=>I&&g instanceof I)(typeof Uint8Array<"u"&&$s(Uint8Array)),FV=(I,g)=>{const e=(I&&I[Symbol.iterator]).call(I);let t;for(;(t=e.next())&&!t.done;){const l=t.value;g.call(I,l[0],l[1])}},KV=(I,g)=>{let C;const e=[];for(;(C=I.exec(g))!==null;)e.push(C);return e},wV=BI("HTMLFormElement"),xV=I=>I.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(C,e,t){return e.toUpperCase()+t}),Ed=(({hasOwnProperty:I})=>(g,C)=>I.call(g,C))(Object.prototype),zV=BI("RegExp"),xZ=(I,g)=>{const C=Object.getOwnPropertyDescriptors(I),e={};dl(C,(t,l)=>{let n;(n=g(t,l,I))!==!1&&(e[l]=n||t)}),Object.defineProperties(I,e)},MV=I=>{xZ(I,(g,C)=>{if(sI(I)&&["arguments","caller","callee"].indexOf(C)!==-1)return!1;const e=I[C];if(sI(e)){if(g.enumerable=!1,"writable"in g){g.writable=!1;return}g.set||(g.set=()=>{throw Error("Can not rewrite read-only method '"+C+"'")})}})},EV=(I,g)=>{const C={},e=t=>{t.forEach(l=>{C[l]=!0})};return Le(I)?e(I):e(String(I).split(g)),C},QV=()=>{},UV=(I,g)=>I!=null&&Number.isFinite(I=+I)?I:g,BA="abcdefghijklmnopqrstuvwxyz",Qd="0123456789",zZ={DIGIT:Qd,ALPHA:BA,ALPHA_DIGIT:BA+BA.toUpperCase()+Qd},LV=(I=16,g=zZ.ALPHA_DIGIT)=>{let C="";const{length:e}=g;for(;I--;)C+=g[Math.random()*e|0];return C};function DV(I){return!!(I&&sI(I.append)&&I[Symbol.toStringTag]==="FormData"&&I[Symbol.iterator])}const TV=I=>{const g=new Array(10),C=(e,t)=>{if(Wo(e)){if(g.indexOf(e)>=0)return;if(!("toJSON"in e)){g[t]=e;const l=Le(e)?[]:{};return dl(e,(n,o)=>{const A=C(n,t+1);!Il(A)&&(l[o]=A)}),g[t]=void 0,l}}return e};return C(I,0)},jV=BI("AsyncFunction"),PV=I=>I&&(Wo(I)||sI(I))&&sI(I.then)&&sI(I.catch),S={isArray:Le,isArrayBuffer:vZ,isBuffer:dV,isFormData:yV,isArrayBufferView:rV,isString:mV,isNumber:NZ,isBoolean:uV,isObject:Wo,isPlainObject:cn,isReadableStream:WV,isRequest:VV,isResponse:SV,isHeaders:RV,isUndefined:Il,isDate:ZV,isFile:bV,isBlob:hV,isRegExp:zV,isFunction:sI,isStream:BV,isURLSearchParams:pV,isTypedArray:NV,isFileList:GV,forEach:dl,merge:fi,extend:JV,trim:XV,stripBOM:kV,inherits:fV,toFlatObject:YV,kindOf:yo,kindOfTest:BI,endsWith:HV,toArray:vV,forEachEntry:FV,matchAll:KV,isHTMLForm:wV,hasOwnProperty:Ed,hasOwnProp:Ed,reduceDescriptors:xZ,freezeMethods:MV,toObjectSet:EV,toCamelCase:xV,noop:QV,toFiniteNumber:UV,findKey:FZ,global:KZ,isContextDefined:wZ,ALPHABET:zZ,generateString:LV,isSpecCompliantForm:DV,toJSONObject:TV,isAsyncFn:jV,isThenable:PV};function w(I,g,C,e,t){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=I,this.name="AxiosError",g&&(this.code=g),C&&(this.config=C),e&&(this.request=e),t&&(this.response=t)}S.inherits(w,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:S.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const MZ=w.prototype,EZ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(I=>{EZ[I]={value:I}});Object.defineProperties(w,EZ);Object.defineProperty(MZ,"isAxiosError",{value:!0});w.from=(I,g,C,e,t,l)=>{const n=Object.create(MZ);return S.toFlatObject(I,n,function(A){return A!==Error.prototype},o=>o!=="isAxiosError"),w.call(n,I.message,g,C,e,t),n.cause=I,n.name=I.name,l&&Object.assign(n,l),n};const OV=null;function Yi(I){return S.isPlainObject(I)||S.isArray(I)}function QZ(I){return S.endsWith(I,"[]")?I.slice(0,-2):I}function Ud(I,g,C){return I?I.concat(g).map(function(t,l){return t=QZ(t),!C&&l?"["+t+"]":t}).join(C?".":""):g}function _V(I){return S.isArray(I)&&!I.some(Yi)}const qV=S.toFlatObject(S,{},null,function(g){return/^is[A-Z]/.test(g)});function Vo(I,g,C){if(!S.isObject(I))throw new TypeError("target must be an object");g=g||new FormData,C=S.toFlatObject(C,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,G){return!S.isUndefined(G[b])});const e=C.metaTokens,t=C.visitor||s,l=C.dots,n=C.indexes,A=(C.Blob||typeof Blob<"u"&&Blob)&&S.isSpecCompliantForm(g);if(!S.isFunction(t))throw new TypeError("visitor must be a function");function i(m){if(m===null)return"";if(S.isDate(m))return m.toISOString();if(!A&&S.isBlob(m))throw new w("Blob is not supported. Use a Buffer instead.");return S.isArrayBuffer(m)||S.isTypedArray(m)?A&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function s(m,b,G){let u=m;if(m&&!G&&typeof m=="object"){if(S.endsWith(b,"{}"))b=e?b:b.slice(0,-2),m=JSON.stringify(m);else if(S.isArray(m)&&_V(m)||(S.isFileList(m)||S.endsWith(b,"[]"))&&(u=S.toArray(m)))return b=QZ(b),u.forEach(function(h,B){!(S.isUndefined(h)||h===null)&&g.append(n===!0?Ud([b],B,l):n===null?b:b+"[]",i(h))}),!1}return Yi(m)?!0:(g.append(Ud(G,b,l),i(m)),!1)}const c=[],a=Object.assign(qV,{defaultVisitor:s,convertValue:i,isVisitable:Yi});function r(m,b){if(!S.isUndefined(m)){if(c.indexOf(m)!==-1)throw Error("Circular reference detected in "+b.join("."));c.push(m),S.forEach(m,function(u,Z){(!(S.isUndefined(u)||u===null)&&t.call(g,u,S.isString(Z)?Z.trim():Z,b,a))===!0&&r(u,b?b.concat(Z):[Z])}),c.pop()}}if(!S.isObject(I))throw new TypeError("data must be an object");return r(I),g}function Ld(I){const g={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(I).replace(/[!'()~]|%20|%00/g,function(e){return g[e]})}function gc(I,g){this._pairs=[],I&&Vo(I,this,g)}const UZ=gc.prototype;UZ.append=function(g,C){this._pairs.push([g,C])};UZ.toString=function(g){const C=g?function(e){return g.call(this,e,Ld)}:Ld;return this._pairs.map(function(t){return C(t[0])+"="+C(t[1])},"").join("&")};function $V(I){return encodeURIComponent(I).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function LZ(I,g,C){if(!g)return I;const e=C&&C.encode||$V,t=C&&C.serialize;let l;if(t?l=t(g,C):l=S.isURLSearchParams(g)?g.toString():new gc(g,C).toString(e),l){const n=I.indexOf("#");n!==-1&&(I=I.slice(0,n)),I+=(I.indexOf("?")===-1?"?":"&")+l}return I}class Dd{constructor(){this.handlers=[]}use(g,C,e){return this.handlers.push({fulfilled:g,rejected:C,synchronous:e?e.synchronous:!1,runWhen:e?e.runWhen:null}),this.handlers.length-1}eject(g){this.handlers[g]&&(this.handlers[g]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(g){S.forEach(this.handlers,function(e){e!==null&&g(e)})}}const DZ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},gS=typeof URLSearchParams<"u"?URLSearchParams:gc,IS=typeof FormData<"u"?FormData:null,CS=typeof Blob<"u"?Blob:null,eS={isBrowser:!0,classes:{URLSearchParams:gS,FormData:IS,Blob:CS},protocols:["http","https","file","blob","url","data"]},Ic=typeof window<"u"&&typeof document<"u",tS=(I=>Ic&&["ReactNative","NativeScript","NS"].indexOf(I)<0)(typeof navigator<"u"&&navigator.product),lS=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",nS=Ic&&window.location.href||"http://localhost",oS=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ic,hasStandardBrowserEnv:tS,hasStandardBrowserWebWorkerEnv:lS,origin:nS},Symbol.toStringTag,{value:"Module"})),hI={...oS,...eS};function AS(I,g){return Vo(I,new hI.classes.URLSearchParams,Object.assign({visitor:function(C,e,t,l){return hI.isNode&&S.isBuffer(C)?(this.append(e,C.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},g))}function iS(I){return S.matchAll(/\w+|\[(\w*)]/g,I).map(g=>g[0]==="[]"?"":g[1]||g[0])}function sS(I){const g={},C=Object.keys(I);let e;const t=C.length;let l;for(e=0;e<t;e++)l=C[e],g[l]=I[l];return g}function TZ(I){function g(C,e,t,l){let n=C[l++];if(n==="__proto__")return!0;const o=Number.isFinite(+n),A=l>=C.length;return n=!n&&S.isArray(t)?t.length:n,A?(S.hasOwnProp(t,n)?t[n]=[t[n],e]:t[n]=e,!o):((!t[n]||!S.isObject(t[n]))&&(t[n]=[]),g(C,e,t[n],l)&&S.isArray(t[n])&&(t[n]=sS(t[n])),!o)}if(S.isFormData(I)&&S.isFunction(I.entries)){const C={};return S.forEachEntry(I,(e,t)=>{g(iS(e),t,C,0)}),C}return null}function cS(I,g,C){if(S.isString(I))try{return(g||JSON.parse)(I),S.trim(I)}catch(e){if(e.name!=="SyntaxError")throw e}return(C||JSON.stringify)(I)}const rl={transitional:DZ,adapter:["xhr","http","fetch"],transformRequest:[function(g,C){const e=C.getContentType()||"",t=e.indexOf("application/json")>-1,l=S.isObject(g);if(l&&S.isHTMLForm(g)&&(g=new FormData(g)),S.isFormData(g))return t?JSON.stringify(TZ(g)):g;if(S.isArrayBuffer(g)||S.isBuffer(g)||S.isStream(g)||S.isFile(g)||S.isBlob(g)||S.isReadableStream(g))return g;if(S.isArrayBufferView(g))return g.buffer;if(S.isURLSearchParams(g))return C.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),g.toString();let o;if(l){if(e.indexOf("application/x-www-form-urlencoded")>-1)return AS(g,this.formSerializer).toString();if((o=S.isFileList(g))||e.indexOf("multipart/form-data")>-1){const A=this.env&&this.env.FormData;return Vo(o?{"files[]":g}:g,A&&new A,this.formSerializer)}}return l||t?(C.setContentType("application/json",!1),cS(g)):g}],transformResponse:[function(g){const C=this.transitional||rl.transitional,e=C&&C.forcedJSONParsing,t=this.responseType==="json";if(S.isResponse(g)||S.isReadableStream(g))return g;if(g&&S.isString(g)&&(e&&!this.responseType||t)){const n=!(C&&C.silentJSONParsing)&&t;try{return JSON.parse(g)}catch(o){if(n)throw o.name==="SyntaxError"?w.from(o,w.ERR_BAD_RESPONSE,this,null,this.response):o}}return g}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:hI.classes.FormData,Blob:hI.classes.Blob},validateStatus:function(g){return g>=200&&g<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};S.forEach(["delete","get","head","post","put","patch"],I=>{rl.headers[I]={}});const aS=S.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),dS=I=>{const g={};let C,e,t;return I&&I.split(`
`).forEach(function(n){t=n.indexOf(":"),C=n.substring(0,t).trim().toLowerCase(),e=n.substring(t+1).trim(),!(!C||g[C]&&aS[C])&&(C==="set-cookie"?g[C]?g[C].push(e):g[C]=[e]:g[C]=g[C]?g[C]+", "+e:e)}),g},Td=Symbol("internals");function ot(I){return I&&String(I).trim().toLowerCase()}function an(I){return I===!1||I==null?I:S.isArray(I)?I.map(an):String(I)}function rS(I){const g=Object.create(null),C=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let e;for(;e=C.exec(I);)g[e[1]]=e[2];return g}const mS=I=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(I.trim());function yA(I,g,C,e,t){if(S.isFunction(e))return e.call(this,g,C);if(t&&(g=C),!!S.isString(g)){if(S.isString(e))return g.indexOf(e)!==-1;if(S.isRegExp(e))return e.test(g)}}function uS(I){return I.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(g,C,e)=>C.toUpperCase()+e)}function ZS(I,g){const C=S.toCamelCase(" "+g);["get","set","has"].forEach(e=>{Object.defineProperty(I,e+C,{value:function(t,l,n){return this[e].call(this,g,t,l,n)},configurable:!0})})}class Pg{constructor(g){g&&this.set(g)}set(g,C,e){const t=this;function l(o,A,i){const s=ot(A);if(!s)throw new Error("header name must be a non-empty string");const c=S.findKey(t,s);(!c||t[c]===void 0||i===!0||i===void 0&&t[c]!==!1)&&(t[c||A]=an(o))}const n=(o,A)=>S.forEach(o,(i,s)=>l(i,s,A));if(S.isPlainObject(g)||g instanceof this.constructor)n(g,C);else if(S.isString(g)&&(g=g.trim())&&!mS(g))n(dS(g),C);else if(S.isHeaders(g))for(const[o,A]of g.entries())l(A,o,e);else g!=null&&l(C,g,e);return this}get(g,C){if(g=ot(g),g){const e=S.findKey(this,g);if(e){const t=this[e];if(!C)return t;if(C===!0)return rS(t);if(S.isFunction(C))return C.call(this,t,e);if(S.isRegExp(C))return C.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(g,C){if(g=ot(g),g){const e=S.findKey(this,g);return!!(e&&this[e]!==void 0&&(!C||yA(this,this[e],e,C)))}return!1}delete(g,C){const e=this;let t=!1;function l(n){if(n=ot(n),n){const o=S.findKey(e,n);o&&(!C||yA(e,e[o],o,C))&&(delete e[o],t=!0)}}return S.isArray(g)?g.forEach(l):l(g),t}clear(g){const C=Object.keys(this);let e=C.length,t=!1;for(;e--;){const l=C[e];(!g||yA(this,this[l],l,g,!0))&&(delete this[l],t=!0)}return t}normalize(g){const C=this,e={};return S.forEach(this,(t,l)=>{const n=S.findKey(e,l);if(n){C[n]=an(t),delete C[l];return}const o=g?uS(l):String(l).trim();o!==l&&delete C[l],C[o]=an(t),e[o]=!0}),this}concat(...g){return this.constructor.concat(this,...g)}toJSON(g){const C=Object.create(null);return S.forEach(this,(e,t)=>{e!=null&&e!==!1&&(C[t]=g&&S.isArray(e)?e.join(", "):e)}),C}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([g,C])=>g+": "+C).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(g){return g instanceof this?g:new this(g)}static concat(g,...C){const e=new this(g);return C.forEach(t=>e.set(t)),e}static accessor(g){const e=(this[Td]=this[Td]={accessors:{}}).accessors,t=this.prototype;function l(n){const o=ot(n);e[o]||(ZS(t,n),e[o]=!0)}return S.isArray(g)?g.forEach(l):l(g),this}}Pg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);S.reduceDescriptors(Pg.prototype,({value:I},g)=>{let C=g[0].toUpperCase()+g.slice(1);return{get:()=>I,set(e){this[C]=e}}});S.freezeMethods(Pg);function pA(I,g){const C=this||rl,e=g||C,t=Pg.from(e.headers);let l=e.data;return S.forEach(I,function(o){l=o.call(C,l,t.normalize(),g?g.status:void 0)}),t.normalize(),l}function jZ(I){return!!(I&&I.__CANCEL__)}function De(I,g,C){w.call(this,I??"canceled",w.ERR_CANCELED,g,C),this.name="CanceledError"}S.inherits(De,w,{__CANCEL__:!0});function PZ(I,g,C){const e=C.config.validateStatus;!C.status||!e||e(C.status)?I(C):g(new w("Request failed with status code "+C.status,[w.ERR_BAD_REQUEST,w.ERR_BAD_RESPONSE][Math.floor(C.status/100)-4],C.config,C.request,C))}function bS(I){const g=/^([-+\w]{1,25})(:?\/\/|:)/.exec(I);return g&&g[1]||""}function hS(I,g){I=I||10;const C=new Array(I),e=new Array(I);let t=0,l=0,n;return g=g!==void 0?g:1e3,function(A){const i=Date.now(),s=e[l];n||(n=i),C[t]=A,e[t]=i;let c=l,a=0;for(;c!==t;)a+=C[c++],c=c%I;if(t=(t+1)%I,t===l&&(l=(l+1)%I),i-n<g)return;const r=s&&i-s;return r?Math.round(a*1e3/r):void 0}}function GS(I,g){let C=0;const e=1e3/g;let t=null;return function(){const n=this===!0,o=Date.now();if(n||o-C>e)return t&&(clearTimeout(t),t=null),C=o,I.apply(null,arguments);t||(t=setTimeout(()=>(t=null,C=Date.now(),I.apply(null,arguments)),e-(o-C)))}}const On=(I,g,C=3)=>{let e=0;const t=hS(50,250);return GS(l=>{const n=l.loaded,o=l.lengthComputable?l.total:void 0,A=n-e,i=t(A),s=n<=o;e=n;const c={loaded:n,total:o,progress:o?n/o:void 0,bytes:A,rate:i||void 0,estimated:i&&o&&s?(o-n)/i:void 0,event:l,lengthComputable:o!=null};c[g?"download":"upload"]=!0,I(c)},C)},BS=hI.hasStandardBrowserEnv?function(){const g=/(msie|trident)/i.test(navigator.userAgent),C=document.createElement("a");let e;function t(l){let n=l;return g&&(C.setAttribute("href",n),n=C.href),C.setAttribute("href",n),{href:C.href,protocol:C.protocol?C.protocol.replace(/:$/,""):"",host:C.host,search:C.search?C.search.replace(/^\?/,""):"",hash:C.hash?C.hash.replace(/^#/,""):"",hostname:C.hostname,port:C.port,pathname:C.pathname.charAt(0)==="/"?C.pathname:"/"+C.pathname}}return e=t(window.location.href),function(n){const o=S.isString(n)?t(n):n;return o.protocol===e.protocol&&o.host===e.host}}():function(){return function(){return!0}}(),yS=hI.hasStandardBrowserEnv?{write(I,g,C,e,t,l){const n=[I+"="+encodeURIComponent(g)];S.isNumber(C)&&n.push("expires="+new Date(C).toGMTString()),S.isString(e)&&n.push("path="+e),S.isString(t)&&n.push("domain="+t),l===!0&&n.push("secure"),document.cookie=n.join("; ")},read(I){const g=document.cookie.match(new RegExp("(^|;\\s*)("+I+")=([^;]*)"));return g?decodeURIComponent(g[3]):null},remove(I){this.write(I,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function pS(I){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(I)}function WS(I,g){return g?I.replace(/\/?\/$/,"")+"/"+g.replace(/^\/+/,""):I}function OZ(I,g){return I&&!pS(g)?WS(I,g):g}const jd=I=>I instanceof Pg?{...I}:I;function ge(I,g){g=g||{};const C={};function e(i,s,c){return S.isPlainObject(i)&&S.isPlainObject(s)?S.merge.call({caseless:c},i,s):S.isPlainObject(s)?S.merge({},s):S.isArray(s)?s.slice():s}function t(i,s,c){if(S.isUndefined(s)){if(!S.isUndefined(i))return e(void 0,i,c)}else return e(i,s,c)}function l(i,s){if(!S.isUndefined(s))return e(void 0,s)}function n(i,s){if(S.isUndefined(s)){if(!S.isUndefined(i))return e(void 0,i)}else return e(void 0,s)}function o(i,s,c){if(c in g)return e(i,s);if(c in I)return e(void 0,i)}const A={url:l,method:l,data:l,baseURL:n,transformRequest:n,transformResponse:n,paramsSerializer:n,timeout:n,timeoutMessage:n,withCredentials:n,withXSRFToken:n,adapter:n,responseType:n,xsrfCookieName:n,xsrfHeaderName:n,onUploadProgress:n,onDownloadProgress:n,decompress:n,maxContentLength:n,maxBodyLength:n,beforeRedirect:n,transport:n,httpAgent:n,httpsAgent:n,cancelToken:n,socketPath:n,responseEncoding:n,validateStatus:o,headers:(i,s)=>t(jd(i),jd(s),!0)};return S.forEach(Object.keys(Object.assign({},I,g)),function(s){const c=A[s]||t,a=c(I[s],g[s],s);S.isUndefined(a)&&c!==o||(C[s]=a)}),C}const _Z=I=>{const g=ge({},I);let{data:C,withXSRFToken:e,xsrfHeaderName:t,xsrfCookieName:l,headers:n,auth:o}=g;g.headers=n=Pg.from(n),g.url=LZ(OZ(g.baseURL,g.url),I.params,I.paramsSerializer),o&&n.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let A;if(S.isFormData(C)){if(hI.hasStandardBrowserEnv||hI.hasStandardBrowserWebWorkerEnv)n.setContentType(void 0);else if((A=n.getContentType())!==!1){const[i,...s]=A?A.split(";").map(c=>c.trim()).filter(Boolean):[];n.setContentType([i||"multipart/form-data",...s].join("; "))}}if(hI.hasStandardBrowserEnv&&(e&&S.isFunction(e)&&(e=e(g)),e||e!==!1&&BS(g.url))){const i=t&&l&&yS.read(l);i&&n.set(t,i)}return g},VS=typeof XMLHttpRequest<"u",SS=VS&&function(I){return new Promise(function(C,e){const t=_Z(I);let l=t.data;const n=Pg.from(t.headers).normalize();let{responseType:o}=t,A;function i(){t.cancelToken&&t.cancelToken.unsubscribe(A),t.signal&&t.signal.removeEventListener("abort",A)}let s=new XMLHttpRequest;s.open(t.method.toUpperCase(),t.url,!0),s.timeout=t.timeout;function c(){if(!s)return;const r=Pg.from("getAllResponseHeaders"in s&&s.getAllResponseHeaders()),b={data:!o||o==="text"||o==="json"?s.responseText:s.response,status:s.status,statusText:s.statusText,headers:r,config:I,request:s};PZ(function(u){C(u),i()},function(u){e(u),i()},b),s=null}"onloadend"in s?s.onloadend=c:s.onreadystatechange=function(){!s||s.readyState!==4||s.status===0&&!(s.responseURL&&s.responseURL.indexOf("file:")===0)||setTimeout(c)},s.onabort=function(){s&&(e(new w("Request aborted",w.ECONNABORTED,t,s)),s=null)},s.onerror=function(){e(new w("Network Error",w.ERR_NETWORK,t,s)),s=null},s.ontimeout=function(){let m=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const b=t.transitional||DZ;t.timeoutErrorMessage&&(m=t.timeoutErrorMessage),e(new w(m,b.clarifyTimeoutError?w.ETIMEDOUT:w.ECONNABORTED,t,s)),s=null},l===void 0&&n.setContentType(null),"setRequestHeader"in s&&S.forEach(n.toJSON(),function(m,b){s.setRequestHeader(b,m)}),S.isUndefined(t.withCredentials)||(s.withCredentials=!!t.withCredentials),o&&o!=="json"&&(s.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&s.addEventListener("progress",On(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&s.upload&&s.upload.addEventListener("progress",On(t.onUploadProgress)),(t.cancelToken||t.signal)&&(A=r=>{s&&(e(!r||r.type?new De(null,I,s):r),s.abort(),s=null)},t.cancelToken&&t.cancelToken.subscribe(A),t.signal&&(t.signal.aborted?A():t.signal.addEventListener("abort",A)));const a=bS(t.url);if(a&&hI.protocols.indexOf(a)===-1){e(new w("Unsupported protocol "+a+":",w.ERR_BAD_REQUEST,I));return}s.send(l||null)})},RS=(I,g)=>{let C=new AbortController,e;const t=function(A){if(!e){e=!0,n();const i=A instanceof Error?A:this.reason;C.abort(i instanceof w?i:new De(i instanceof Error?i.message:i))}};let l=g&&setTimeout(()=>{t(new w(`timeout ${g} of ms exceeded`,w.ETIMEDOUT))},g);const n=()=>{I&&(l&&clearTimeout(l),l=null,I.forEach(A=>{A&&(A.removeEventListener?A.removeEventListener("abort",t):A.unsubscribe(t))}),I=null)};I.forEach(A=>A&&A.addEventListener&&A.addEventListener("abort",t));const{signal:o}=C;return o.unsubscribe=n,[o,()=>{l&&clearTimeout(l),l=null}]},XS=function*(I,g){let C=I.byteLength;if(!g||C<g){yield I;return}let e=0,t;for(;e<C;)t=e+g,yield I.slice(e,t),e=t},JS=async function*(I,g,C){for await(const e of I)yield*XS(ArrayBuffer.isView(e)?e:await C(String(e)),g)},Pd=(I,g,C,e,t)=>{const l=JS(I,g,t);let n=0;return new ReadableStream({type:"bytes",async pull(o){const{done:A,value:i}=await l.next();if(A){o.close(),e();return}let s=i.byteLength;C&&C(n+=s),o.enqueue(new Uint8Array(i))},cancel(o){return e(o),l.return()}},{highWaterMark:2})},Od=(I,g)=>{const C=I!=null;return e=>setTimeout(()=>g({lengthComputable:C,total:I,loaded:e}))},So=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",qZ=So&&typeof ReadableStream=="function",Hi=So&&(typeof TextEncoder=="function"?(I=>g=>I.encode(g))(new TextEncoder):async I=>new Uint8Array(await new Response(I).arrayBuffer())),kS=qZ&&(()=>{let I=!1;const g=new Request(hI.origin,{body:new ReadableStream,method:"POST",get duplex(){return I=!0,"half"}}).headers.has("Content-Type");return I&&!g})(),_d=64*1024,vi=qZ&&!!(()=>{try{return S.isReadableStream(new Response("").body)}catch{}})(),_n={stream:vi&&(I=>I.body)};So&&(I=>{["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!_n[g]&&(_n[g]=S.isFunction(I[g])?C=>C[g]():(C,e)=>{throw new w(`Response type '${g}' is not supported`,w.ERR_NOT_SUPPORT,e)})})})(new Response);const fS=async I=>{if(I==null)return 0;if(S.isBlob(I))return I.size;if(S.isSpecCompliantForm(I))return(await new Request(I).arrayBuffer()).byteLength;if(S.isArrayBufferView(I))return I.byteLength;if(S.isURLSearchParams(I)&&(I=I+""),S.isString(I))return(await Hi(I)).byteLength},YS=async(I,g)=>{const C=S.toFiniteNumber(I.getContentLength());return C??fS(g)},HS=So&&(async I=>{let{url:g,method:C,data:e,signal:t,cancelToken:l,timeout:n,onDownloadProgress:o,onUploadProgress:A,responseType:i,headers:s,withCredentials:c="same-origin",fetchOptions:a}=_Z(I);i=i?(i+"").toLowerCase():"text";let[r,m]=t||l||n?RS([t,l],n):[],b,G;const u=()=>{!b&&setTimeout(()=>{r&&r.unsubscribe()}),b=!0};let Z;try{if(A&&kS&&C!=="get"&&C!=="head"&&(Z=await YS(s,e))!==0){let V=new Request(g,{method:"POST",body:e,duplex:"half"}),W;S.isFormData(e)&&(W=V.headers.get("content-type"))&&s.setContentType(W),V.body&&(e=Pd(V.body,_d,Od(Z,On(A)),null,Hi))}S.isString(c)||(c=c?"cors":"omit"),G=new Request(g,{...a,signal:r,method:C.toUpperCase(),headers:s.normalize().toJSON(),body:e,duplex:"half",withCredentials:c});let h=await fetch(G);const B=vi&&(i==="stream"||i==="response");if(vi&&(o||B)){const V={};["status","statusText","headers"].forEach(R=>{V[R]=h[R]});const W=S.toFiniteNumber(h.headers.get("content-length"));h=new Response(Pd(h.body,_d,o&&Od(W,On(o,!0)),B&&u,Hi),V)}i=i||"text";let y=await _n[S.findKey(_n,i)||"text"](h,I);return!B&&u(),m&&m(),await new Promise((V,W)=>{PZ(V,W,{data:y,headers:Pg.from(h.headers),status:h.status,statusText:h.statusText,config:I,request:G})})}catch(h){throw u(),h&&h.name==="TypeError"&&/fetch/i.test(h.message)?Object.assign(new w("Network Error",w.ERR_NETWORK,I,G),{cause:h.cause||h}):w.from(h,h&&h.code,I,G)}}),Ni={http:OV,xhr:SS,fetch:HS};S.forEach(Ni,(I,g)=>{if(I){try{Object.defineProperty(I,"name",{value:g})}catch{}Object.defineProperty(I,"adapterName",{value:g})}});const qd=I=>`- ${I}`,vS=I=>S.isFunction(I)||I===null||I===!1,$Z={getAdapter:I=>{I=S.isArray(I)?I:[I];const{length:g}=I;let C,e;const t={};for(let l=0;l<g;l++){C=I[l];let n;if(e=C,!vS(C)&&(e=Ni[(n=String(C)).toLowerCase()],e===void 0))throw new w(`Unknown adapter '${n}'`);if(e)break;t[n||"#"+l]=e}if(!e){const l=Object.entries(t).map(([o,A])=>`adapter ${o} `+(A===!1?"is not supported by the environment":"is not available in the build"));let n=g?l.length>1?`since :
`+l.map(qd).join(`
`):" "+qd(l[0]):"as no adapter specified";throw new w("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return e},adapters:Ni};function WA(I){if(I.cancelToken&&I.cancelToken.throwIfRequested(),I.signal&&I.signal.aborted)throw new De(null,I)}function $d(I){return WA(I),I.headers=Pg.from(I.headers),I.data=pA.call(I,I.transformRequest),["post","put","patch"].indexOf(I.method)!==-1&&I.headers.setContentType("application/x-www-form-urlencoded",!1),$Z.getAdapter(I.adapter||rl.adapter)(I).then(function(e){return WA(I),e.data=pA.call(I,I.transformResponse,e),e.headers=Pg.from(e.headers),e},function(e){return jZ(e)||(WA(I),e&&e.response&&(e.response.data=pA.call(I,I.transformResponse,e.response),e.response.headers=Pg.from(e.response.headers))),Promise.reject(e)})}const gb="1.7.2",Cc={};["object","boolean","number","function","string","symbol"].forEach((I,g)=>{Cc[I]=function(e){return typeof e===I||"a"+(g<1?"n ":" ")+I}});const gr={};Cc.transitional=function(g,C,e){function t(l,n){return"[Axios v"+gb+"] Transitional option '"+l+"'"+n+(e?". "+e:"")}return(l,n,o)=>{if(g===!1)throw new w(t(n," has been removed"+(C?" in "+C:"")),w.ERR_DEPRECATED);return C&&!gr[n]&&(gr[n]=!0,console.warn(t(n," has been deprecated since v"+C+" and will be removed in the near future"))),g?g(l,n,o):!0}};function NS(I,g,C){if(typeof I!="object")throw new w("options must be an object",w.ERR_BAD_OPTION_VALUE);const e=Object.keys(I);let t=e.length;for(;t-- >0;){const l=e[t],n=g[l];if(n){const o=I[l],A=o===void 0||n(o,l,I);if(A!==!0)throw new w("option "+l+" must be "+A,w.ERR_BAD_OPTION_VALUE);continue}if(C!==!0)throw new w("Unknown option "+l,w.ERR_BAD_OPTION)}}const Fi={assertOptions:NS,validators:Cc},OI=Fi.validators;class UC{constructor(g){this.defaults=g,this.interceptors={request:new Dd,response:new Dd}}async request(g,C){try{return await this._request(g,C)}catch(e){if(e instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=new Error;const l=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?l&&!String(e.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(e.stack+=`
`+l):e.stack=l}catch{}}throw e}}_request(g,C){typeof g=="string"?(C=C||{},C.url=g):C=g||{},C=ge(this.defaults,C);const{transitional:e,paramsSerializer:t,headers:l}=C;e!==void 0&&Fi.assertOptions(e,{silentJSONParsing:OI.transitional(OI.boolean),forcedJSONParsing:OI.transitional(OI.boolean),clarifyTimeoutError:OI.transitional(OI.boolean)},!1),t!=null&&(S.isFunction(t)?C.paramsSerializer={serialize:t}:Fi.assertOptions(t,{encode:OI.function,serialize:OI.function},!0)),C.method=(C.method||this.defaults.method||"get").toLowerCase();let n=l&&S.merge(l.common,l[C.method]);l&&S.forEach(["delete","get","head","post","put","patch","common"],m=>{delete l[m]}),C.headers=Pg.concat(n,l);const o=[];let A=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(C)===!1||(A=A&&b.synchronous,o.unshift(b.fulfilled,b.rejected))});const i=[];this.interceptors.response.forEach(function(b){i.push(b.fulfilled,b.rejected)});let s,c=0,a;if(!A){const m=[$d.bind(this),void 0];for(m.unshift.apply(m,o),m.push.apply(m,i),a=m.length,s=Promise.resolve(C);c<a;)s=s.then(m[c++],m[c++]);return s}a=o.length;let r=C;for(c=0;c<a;){const m=o[c++],b=o[c++];try{r=m(r)}catch(G){b.call(this,G);break}}try{s=$d.call(this,r)}catch(m){return Promise.reject(m)}for(c=0,a=i.length;c<a;)s=s.then(i[c++],i[c++]);return s}getUri(g){g=ge(this.defaults,g);const C=OZ(g.baseURL,g.url);return LZ(C,g.params,g.paramsSerializer)}}S.forEach(["delete","get","head","options"],function(g){UC.prototype[g]=function(C,e){return this.request(ge(e||{},{method:g,url:C,data:(e||{}).data}))}});S.forEach(["post","put","patch"],function(g){function C(e){return function(l,n,o){return this.request(ge(o||{},{method:g,headers:e?{"Content-Type":"multipart/form-data"}:{},url:l,data:n}))}}UC.prototype[g]=C(),UC.prototype[g+"Form"]=C(!0)});class ec{constructor(g){if(typeof g!="function")throw new TypeError("executor must be a function.");let C;this.promise=new Promise(function(l){C=l});const e=this;this.promise.then(t=>{if(!e._listeners)return;let l=e._listeners.length;for(;l-- >0;)e._listeners[l](t);e._listeners=null}),this.promise.then=t=>{let l;const n=new Promise(o=>{e.subscribe(o),l=o}).then(t);return n.cancel=function(){e.unsubscribe(l)},n},g(function(l,n,o){e.reason||(e.reason=new De(l,n,o),C(e.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(g){if(this.reason){g(this.reason);return}this._listeners?this._listeners.push(g):this._listeners=[g]}unsubscribe(g){if(!this._listeners)return;const C=this._listeners.indexOf(g);C!==-1&&this._listeners.splice(C,1)}static source(){let g;return{token:new ec(function(t){g=t}),cancel:g}}}function FS(I){return function(C){return I.apply(null,C)}}function KS(I){return S.isObject(I)&&I.isAxiosError===!0}const Ki={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ki).forEach(([I,g])=>{Ki[g]=I});function Ib(I){const g=new UC(I),C=HZ(UC.prototype.request,g);return S.extend(C,UC.prototype,g,{allOwnKeys:!0}),S.extend(C,g,null,{allOwnKeys:!0}),C.create=function(t){return Ib(ge(I,t))},C}const mg=Ib(rl);mg.Axios=UC;mg.CanceledError=De;mg.CancelToken=ec;mg.isCancel=jZ;mg.VERSION=gb;mg.toFormData=Vo;mg.AxiosError=w;mg.Cancel=mg.CanceledError;mg.all=function(g){return Promise.all(g)};mg.spread=FS;mg.isAxiosError=KS;mg.mergeConfig=ge;mg.AxiosHeaders=Pg;mg.formToJSON=I=>TZ(S.isHTMLForm(I)?new FormData(I):I);mg.getAdapter=$Z.getAdapter;mg.HttpStatusCode=Ki;mg.default=mg;const wS="eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJDYXJsb3MgQWxiZXJ0byBIZXJuw6FuZGV6IEd1ZXJyYSIsImlhdCI6MTcxODU5ODc4OCwiZXhwIjoxNzE5ODk0Nzg4fQ.MeuFhh2quofoDYGR1RD6ENCZHoNPUg4XQb2rN8Xpvc-ECLHhPI2d0XySoHrEFW-P",tc=()=>{const[g,C]=p.useState(15),[e,t]=p.useState(""),l=async()=>{try{const o=await mg.get("http://localhost:8080/qr/generate",{headers:{Authorization:`Bearer ${wS}`}});console.log("QR string:",o.data),t(o.data)}catch(o){console.error("Error fetching QR string:",o)}};p.useEffect(()=>{l()},[]),p.useEffect(()=>{if(g<=0){C(15),l();return}const o=setInterval(()=>{C(A=>A-1)},1e3);return()=>clearInterval(o)},[g]);const n=o=>{const A=String(Math.floor(o/60)).padStart(2,"0"),i=String(o%60).padStart(2,"0");return`${A}:${i}`};return d.jsxs("div",{className:"bg-[#D9D9D9] bg-opacity-52 p-2 rounded-md flex flex-col justify-center items-center m-2 w-auto font-roboto_mono",children:[d.jsx("div",{className:"bg-white p-4 m-1",children:d.jsx(cV,{value:e,size:175})}),d.jsx("p",{className:"text-2xl mt-4 mb-1",children:n(g)}),d.jsx("p",{className:"text-2xl text-center m-1",children:"Pedro Orellana"}),d.jsx("p",{className:"text-2xl text-center m-1",children:"Residente"})]})},xS=()=>d.jsx("div",{className:"flex justify-center items-center min-h-screen flex-col  w-full ",children:d.jsx(tc,{})}),zS=()=>{const I=[{label:"Home",url:"home"},{label:"Crear permisos",url:"MPermissions"},{label:"Entradas",url:"QR"},{label:"Gestionar residentes",url:"addResidents"},{label:"Registro de visitas",url:"visits"}];return d.jsxs(d.Fragment,{children:[d.jsx(al,{menuItems:I}),d.jsxs(Ue,{children:[d.jsx(x,{path:"home",element:d.jsx(eV,{})}),d.jsx(x,{path:"MPermissions",element:d.jsx(IV,{})}),d.jsx(x,{path:"QR",element:d.jsx(xS,{})}),d.jsx(x,{path:"MultipleP",element:d.jsx(gV,{})}),d.jsx(x,{path:"UniqueP",element:d.jsx(CV,{})}),d.jsx(x,{path:"addResidents",element:d.jsx(tV,{})}),d.jsx(x,{path:"visits",element:d.jsx(lV,{})}),d.jsx(x,{path:"/",element:d.jsx(OC,{to:"home"})})]})]})},MS=()=>d.jsx("div",{children:d.jsx(Bo,{})}),Ir="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAACH0lEQVR4nO2ay0ocQRSGv1XGLBQFo+70OdSlKAFDXHp5hpBh3sLLQlEI2eYRkoyJbyDiWmdGV142oq694ZGCI8jQPd1TXTVd3fjDDw09030+6vTpOlUN7yqvhoAFYB2oAw3gFrhXm+NjPWd+8xUYJBBVgBVgD3gCpEub//wDlvVaPddHoAZcWgQf5wugCvT1CuIzcOoQoN0nwJxPADP0Wx4B2v1LR96pRoHDHkKI+gAYcQUxocMtObmlMWTSJy2jkrNPgTFbiL6c0kk6pJlVif4RQPDS5m2bEiuBejYthBm+ZgABS4xP0r40awEEKwn+nmY0LgIIVBJ8nvTgrwQQpKT0UieQPQ83nASmPFx3t1M/YTMVT/KrXF/3ERiIAlnwlAK+QASYjwLZKCDIWhRIvYAgv6NAWgUEaUSB3BQQ5CoK5D5jibVVltJ85xrEBGOradcgN2VJrWYBQY5LXX7XCwiyWuopymDBJo0PcZNGo/8ebjiVscRKjP/SQcueUsCHF8vS6n4gQdUAApUEf0uCeB2VEJZJJcatblYc5wIIWCL8DMzQpXYCCFzavImFKrpwLIF4P80DHqfhgLYVRsmoCY9tcBo3gXEcaSSnNNvXzSYvm6HPPYL46XvvfdZzqjVsSqytKrq0f+4Q4Ezf2Ll8AVHRVfG6rsV2G/yjzmIXs5RW1zK9wRddxvyj/fT1m49qzPGRtqer2hT1O4/iXYShFwEYOqh4OPqjAAAAAElFTkSuQmCC",ES=()=>{const I=SC(),g=C=>{I(C)};return d.jsxs("div",{className:" p-4",children:[d.jsx("h1",{className:"text-3xl font-bold font-roboto_mono mb-4 text-center text-azul-claro mt-5 md:mt-8",children:" Crear solicitudes de visita "}),d.jsx("p",{className:"text-2xl font-medium mb-6 text-center text-black mt-5",children:"Selecciona la opcion que desees"}),d.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-10",children:[d.jsxs("button",{className:"bg-amarillo-principal font-roboto_mono font-bold p-3 sm:p-5 md:p-6 lg:p-8 flex items-center justify-center space-x-2 rounded-md w-full sm:w-auto border border-gray-200 hover:shadow-lg transition-shadow duration-300",onClick:()=>g("/normal/unique"),children:[d.jsx("span",{className:"text-sm sm:text-base md:text-lg lg:text-xl",children:"Única vez"}),d.jsx("img",{src:Ir,alt:"Añadir",className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 lg:h-8 lg:w-8"})]}),d.jsxs("button",{className:"bg-amarillo-principal font-roboto_mono font-bold p-3 sm:p-5 md:p-6 lg:p-8 flex items-center justify-center space-x-2 rounded-md w-full sm:w-auto border border-gray-200 hover:shadow-lg transition-shadow duration-300",onClick:()=>g("/normal/frequent"),children:[d.jsx("span",{className:"text-sm sm:text-base md:text-lg lg:text-xl",children:"Frecuente"}),d.jsx("img",{src:Ir,alt:"Añadir",className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 lg:h-8 lg:w-8"})]})]})]})},QS=()=>d.jsx("div",{children:d.jsxs("div",{className:"flex pt-10 items-center min-h-screen flex-col  w-full ",children:[d.jsx("h1",{className:"text-4xl text-[#6185A9] text-center mt-2 mb-2",children:"Qr de entrada"}),d.jsx(tc,{})]})}),US=()=>{const{showPopup:I}=RC(),[g,C]=p.useState({email:"",dateVisit:"",timeVisit:""}),e=n=>{const{name:o,value:A}=n.target;C({...g,[o]:A})},t=n=>{n.preventDefault(),console.log("Formulario enviado:",g),I("Solicitud enviada exitosamente",!0)},l=n=>{n.preventDefault(),I("Solicitud cancelado",!1)};return d.jsxs("div",{className:"flex  items-center h-screen flex-col  w-full  font-roboto_mono ",children:[d.jsx("h1",{className:"text-2xl text-[#6185A9] text-center pt-4 pb-1",children:"Detalles de la solicitud"}),d.jsxs("form",{onSubmit:t,children:[d.jsxs("div",{className:"flex flex-col mt-4 mb-4 width-auto",children:[d.jsx("label",{className:"text-xl mb-2",children:"Correo electrónico:"}),d.jsx("input",{type:"email",name:"email",placeholder:"Correo electrónico",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.email,onChange:e})]}),d.jsxs("div",{className:" flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-xl mb-2",children:"Fecha de visita:"}),d.jsx("input",{type:"date",name:"date",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.date,onChange:e})]}),d.jsxs("div",{className:" flex flex-col mt-4 mb-8",children:[d.jsx("label",{className:"text-xl mb-2",children:"Hora de llegada:"}),d.jsx("input",{type:"time",name:"time",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.time,onChange:e})]}),d.jsxs("div",{className:"flex flex-row pt-2",children:[d.jsx("div",{className:"p-4 mr-4 rounded-lg bg-[#F8BD0D] bg-opacity-70",children:d.jsx("button",{type:"submit",children:"Aceptar"})}),d.jsx("div",{className:"p-4 rounded-lg bg-[#F79E9E]",children:d.jsx("button",{type:"button",onClick:l,children:"Cancelar"})})]})]})]})},LS=()=>{const{showPopup:I}=RC(),[g,C]=p.useState({email:"",dateVisit:"",timeVisit:""}),e=n=>{const{name:o,value:A}=n.target;C({...g,[o]:A})},t=n=>{n.preventDefault(),console.log("Formulario enviado:",g),I("Solicitud enviada exitosamente",!0)},l=n=>{n.preventDefault(),I("Solicitud cancelado",!1)};return d.jsxs("div",{className:"flex  items-center h-screen flex-col  w-full  font-roboto_mono ",children:[d.jsx("h1",{className:"text-2xl text-[#6185A9] text-center m-2 ",children:"Detalles de la solicitud"}),d.jsx("h2",{className:"text-center text-xl text-[#6185A9] pb-2",children:"Acceso Frecuente"}),d.jsxs("form",{onSubmit:t,className:"max-w-md mx-auto",children:[d.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Correo electrónico:"}),d.jsx("input",{type:"email",name:"email",placeholder:"Correo electrónico",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.email,onChange:e})]}),d.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Fecha inicial de visita:"}),d.jsx("input",{type:"date",name:"date1",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.date,onChange:e})]}),d.jsxs("div",{className:"flex flex-col mt-4 mb-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Fecha final de visita:"}),d.jsx("input",{type:"date",name:"date2",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.date,onChange:e})]}),d.jsxs("div",{className:"flex flex-col mt-4",children:[d.jsx("label",{className:"text-lg mb-2",children:"Permiso habilitado desde:"}),d.jsx("input",{type:"time",name:"time1",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.time,onChange:e})]}),d.jsxs("div",{className:"flex flex-col mt-4 mb-8",children:[d.jsx("label",{className:"text-lg mb-2",children:"Hasta:"}),d.jsx("input",{type:"time",name:"time2",className:"border border-black rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.time,onChange:e})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("button",{type:"submit",className:"p-2 rounded-lg bg-[#F8BD0D] bg-opacity-70 w-full md:w-1/2 lg:w-1/3 mx-2",children:"Aceptar"}),d.jsx("button",{type:"button",className:"p-2 rounded-lg bg-[#F79E9E] w-full md:w-1/2 lg:w-1/3 mx-2",onClick:l,children:"Cancelar"})]})]})]})},DS=()=>{const I=[{label:"Mi perfil",url:"perfil"},{label:"Solicitud de visita",url:"solicitud"},{label:"Generar QR",url:"generar-qr"}];return d.jsxs(d.Fragment,{children:[d.jsx(al,{menuItems:I}),d.jsxs(Ue,{children:[d.jsx(x,{path:"perfil",element:d.jsx(MS,{})}),d.jsx(x,{path:"solicitud",element:d.jsx(ES,{})}),d.jsx(x,{path:"generar-qr",element:d.jsx(QS,{})}),d.jsx(x,{path:"/unique",element:d.jsx(US,{})}),d.jsx(x,{path:"/frequent",element:d.jsx(LS,{})}),d.jsx(x,{path:"/",element:d.jsx(OC,{to:"perfil"})})]})]})},TS=({profile:I})=>d.jsx("div",{children:d.jsx(Bo,{})}),jS=()=>{const[I,g]=p.useState([]);return p.useEffect(()=>{(async()=>{const e=await new Promise(t=>setTimeout(()=>t([{host:"Peter Parker",date:"27/04/2024",time:"1:00 pm"},{host:"Natasha Romanoff",date:"27/04/2024",time:"10:00 pm"},{host:"Tony Stark",date:"27/04/2024",time:"8:00 am"},{host:"Bruce Banner",date:"27/04/2024",time:"1:00 pm"},{host:"Wanda Maximoff",date:"27/04/2024",time:"10:00 pm"},{host:"Steve Rogers",date:"27/04/2024",time:"8:00 am"},{host:"Bucky Barnes",date:"27/04/2024",time:"1:00 pm"},{host:"Thor Odinson",date:"27/04/2024",time:"10:00 pm"},{host:"Jane Foster",date:"27/04/2024",time:"8:00 am"}]),1e3));g(e)})()},[]),d.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4",children:[d.jsx("h1",{className:"mb-6 text-center text-2xl md:text-2xl lg:text-4xl  font-bold font-roboto_mono text-azul-claro",children:"Historial de invitaciones"}),d.jsx("div",{className:"overflow-y-auto w-full max-w-4xl max-h-96",children:d.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[d.jsx("thead",{children:d.jsxs("tr",{className:"bg-amarillo-principal",children:[d.jsx("th",{className:"px-2 py-3 text-left text-xs font-roboto_mono font-medium text-white uppercase tracking-wider md:px-6",children:"Anfitrión"}),d.jsx("th",{className:"px-2 py-3 text-left text-xs font-roboto_mono font-medium text-white uppercase tracking-wider md:px-6",children:"Fecha"}),d.jsx("th",{className:"px-2 py-3 text-left text-xs font-roboto_mono font-medium text-white uppercase tracking-wider md:px-6",children:"Hora"})]})}),d.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:I.map((C,e)=>d.jsxs("tr",{children:[d.jsx("td",{className:"px-2 py-4 whitespace-nowrap font-roboto_mono text-xs md:text-base md:px-6",children:C.host}),d.jsx("td",{className:"px-2 py-4 whitespace-nowrap font-roboto_mono text-xs md:text-base md:px-6",children:C.date}),d.jsx("td",{className:"px-2 py-4 whitespace-nowrap font-roboto_mono text-xs md:text-base md:px-6",children:C.time})]},e))})]})})]})},PS=()=>{const I=SC(),g=t=>{I(t)},[C,e]=p.useState([]);return p.useEffect(()=>{(async()=>{const l=await new Promise(n=>setTimeout(()=>n([{anfitrion:"Tony Stark",fecha:"25/05/2024",hora:"7:00 am"},{anfitrion:"Peter Parker",fecha:"26/05/2024",hora:"8:00 am"},{anfitrion:"Natasha Romanoff",fecha:"27/05/2024",hora:"9:00 am"},{anfitrion:"Steve Rogers",fecha:"27/05/2024",hora:"9:00 am"},{anfitrion:"Thor Odinson",fecha:"27/05/2024",hora:"9:00 am"},{anfitrion:"Nick Fury",fecha:"27/05/2024",hora:"9:00 am"}]),1e3));e(l)})()},[]),d.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4",children:[d.jsx("h1",{className:"mb-6 text-3xl font-bold font-roboto_mono text-azul-claro",children:"Mis invitaciones"}),d.jsx("div",{className:"w-full max-w-4xl h-96 overflow-y-auto md:h-auto md:overflow-y-visible",children:d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map((t,l)=>d.jsx("div",{className:"w-full max-w-md p-6 bg-white shadow-md rounded-lg",children:d.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4 border",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-black text-sm font-bold font-roboto_mono mb-2",htmlFor:`anfitrion-${l}`,children:"Anfitrión:"}),d.jsx("input",{className:"font-roboto_mono shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`anfitrion-${l}`,type:"text",value:t.anfitrion,readOnly:!0})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-black text-sm font-roboto_mono font-bold mb-2",htmlFor:`fecha-${l}`,children:"Fecha programada:"}),d.jsx("input",{className:"font-roboto_mono shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`fecha-${l}`,type:"text",value:t.fecha,readOnly:!0})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-black text-sm font-roboto_mono font-bold mb-2",htmlFor:`hora-${l}`,children:"Hora:"}),d.jsx("input",{className:"font-roboto_mono shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`hora-${l}`,type:"text",value:t.hora,readOnly:!0})]}),d.jsx("div",{className:"flex items-center justify-center",children:d.jsx("button",{className:"bg-amarillo-principal hover:bg-yellow-600 text-white font-roboto_mono font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"button",onClick:()=>g("/visits/qr"),children:"Validar"})})]})},l))})})]})},OS=()=>d.jsx("div",{className:"flex justify-center items-center min-h-screen flex-col  w-full ",children:d.jsx(tc,{})}),_S=()=>{const I=[{label:"Mi perfil",url:"home"},{label:"Historial",url:"historial"},{label:"Invitaciones",url:"invitaciones"}];return d.jsxs(d.Fragment,{children:[d.jsx(al,{menuItems:I}),d.jsxs(Ue,{children:[d.jsx(x,{path:"home",element:d.jsx(TS,{})}),d.jsx(x,{path:"historial",element:d.jsx(jS,{})}),d.jsx(x,{path:"invitaciones",element:d.jsx(PS,{})}),d.jsx(x,{path:"/qr",element:d.jsx(OS,{})}),d.jsx(x,{path:"/",element:d.jsx(OC,{to:"home"})})]})]})},qS=()=>d.jsx("div",{children:d.jsx(Bo,{})}),$S=()=>{const{showPopup:I}=RC(),[g,C]=p.useState({identifier:"",motive:""}),e=l=>{l.preventDefault(),mg.get("http://localhost:8080/mqtt/publish",{params:{message:"open"}}).then(n=>{console.log(n)}),(g.identifier==""||g.motive=="")&&I("Campos vacios",!1)},t=l=>{const{name:n,value:o}=l.target;C({...g,[n]:o})};return d.jsx(d.Fragment,{children:d.jsxs("div",{className:"max-w-4xl mx-auto mt-5 px-4 font-roboto_mono",children:[d.jsx("h1",{className:"text-3xl mb-4 text-center mt-8 text-sky-700",children:"Crear entrada anónima"}),d.jsx("section",{className:"shadow-md rounded p-6 mb-8 font-roboto_mono",children:d.jsxs("div",{className:"justify-center mb-6 md:container md:mx-auto container mx-auto px-4 font-roboto_mono",children:[d.jsx("p",{className:"font-bold text-center mb-4",children:"Complete los siguientes campos"}),d.jsxs("form",{className:"mt-5",onSubmit:e,children:[d.jsx("label",{className:"block text-gray-700 text-sm font-semibold mb-5",children:"Identificador:"}),d.jsx("input",{type:"text",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.identifier,onChange:t,name:"identifier"}),d.jsx("label",{className:"mt-3 block text-gray-700 text-sm font-semibold mb-5",children:"Motivo de ingreso:"}),d.jsx("textarea",{type:"text",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:g.motive,onChange:t,name:"motive"}),d.jsx("button",{type:"submit",className:"bg-yellow-400 hover:bg-sky-700 font-roboto_mono font-semibold py-2 px-4 mt-5 rounded-md w-full sm:w-auto border border-stone-950",children:d.jsx("span",{className:"hover:text-black font-regular text-gray-500 p-3",children:"Enviar Solicitud"})})]})]})})]})})};function wi(){return wi=Object.assign?Object.assign.bind():function(I){for(var g=1;g<arguments.length;g++){var C=arguments[g];for(var e in C)({}).hasOwnProperty.call(C,e)&&(I[e]=C[e])}return I},wi.apply(null,arguments)}function Cl(I){"@babel/helpers - typeof";return Cl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},Cl(I)}function gR(I,g){if(Cl(I)!="object"||!I)return I;var C=I[Symbol.toPrimitive];if(C!==void 0){var e=C.call(I,g||"default");if(Cl(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(I)}function IR(I){var g=gR(I,"string");return Cl(g)=="symbol"?g:g+""}function CR(I,g,C){return(g=IR(g))in I?Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}):I[g]=C,I}function eR(I){if(Array.isArray(I))return I}function tR(I,g){var C=I==null?null:typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(C!=null){var e,t,l,n,o=[],A=!0,i=!1;try{if(l=(C=C.call(I)).next,g!==0)for(;!(A=(e=l.call(C)).done)&&(o.push(e.value),o.length!==g);A=!0);}catch(s){i=!0,t=s}finally{try{if(!A&&C.return!=null&&(n=C.return(),Object(n)!==n))return}finally{if(i)throw t}}return o}}function Cr(I,g){(g==null||g>I.length)&&(g=I.length);for(var C=0,e=Array(g);C<g;C++)e[C]=I[C];return e}function lR(I,g){if(I){if(typeof I=="string")return Cr(I,g);var C={}.toString.call(I).slice(8,-1);return C==="Object"&&I.constructor&&(C=I.constructor.name),C==="Map"||C==="Set"?Array.from(I):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?Cr(I,g):void 0}}function nR(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oR(I,g){return eR(I)||tR(I,g)||lR(I,g)||nR()}function AR(I,g){if(I==null)return{};var C={};for(var e in I)if({}.hasOwnProperty.call(I,e)){if(g.indexOf(e)>=0)continue;C[e]=I[e]}return C}function iR(I,g){if(I==null)return{};var C,e,t=AR(I,g);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(I);for(e=0;e<l.length;e++)C=l[e],g.indexOf(C)>=0||{}.propertyIsEnumerable.call(I,C)&&(t[C]=I[C])}return t}var Cb={exports:{}},O={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wg=typeof Symbol=="function"&&Symbol.for,lc=Wg?Symbol.for("react.element"):60103,nc=Wg?Symbol.for("react.portal"):60106,Ro=Wg?Symbol.for("react.fragment"):60107,Xo=Wg?Symbol.for("react.strict_mode"):60108,Jo=Wg?Symbol.for("react.profiler"):60114,ko=Wg?Symbol.for("react.provider"):60109,fo=Wg?Symbol.for("react.context"):60110,oc=Wg?Symbol.for("react.async_mode"):60111,Yo=Wg?Symbol.for("react.concurrent_mode"):60111,Ho=Wg?Symbol.for("react.forward_ref"):60112,vo=Wg?Symbol.for("react.suspense"):60113,sR=Wg?Symbol.for("react.suspense_list"):60120,No=Wg?Symbol.for("react.memo"):60115,Fo=Wg?Symbol.for("react.lazy"):60116,cR=Wg?Symbol.for("react.block"):60121,aR=Wg?Symbol.for("react.fundamental"):60117,dR=Wg?Symbol.for("react.responder"):60118,rR=Wg?Symbol.for("react.scope"):60119;function tI(I){if(typeof I=="object"&&I!==null){var g=I.$$typeof;switch(g){case lc:switch(I=I.type,I){case oc:case Yo:case Ro:case Jo:case Xo:case vo:return I;default:switch(I=I&&I.$$typeof,I){case fo:case Ho:case Fo:case No:case ko:return I;default:return g}}case nc:return g}}}function eb(I){return tI(I)===Yo}O.AsyncMode=oc;O.ConcurrentMode=Yo;O.ContextConsumer=fo;O.ContextProvider=ko;O.Element=lc;O.ForwardRef=Ho;O.Fragment=Ro;O.Lazy=Fo;O.Memo=No;O.Portal=nc;O.Profiler=Jo;O.StrictMode=Xo;O.Suspense=vo;O.isAsyncMode=function(I){return eb(I)||tI(I)===oc};O.isConcurrentMode=eb;O.isContextConsumer=function(I){return tI(I)===fo};O.isContextProvider=function(I){return tI(I)===ko};O.isElement=function(I){return typeof I=="object"&&I!==null&&I.$$typeof===lc};O.isForwardRef=function(I){return tI(I)===Ho};O.isFragment=function(I){return tI(I)===Ro};O.isLazy=function(I){return tI(I)===Fo};O.isMemo=function(I){return tI(I)===No};O.isPortal=function(I){return tI(I)===nc};O.isProfiler=function(I){return tI(I)===Jo};O.isStrictMode=function(I){return tI(I)===Xo};O.isSuspense=function(I){return tI(I)===vo};O.isValidElementType=function(I){return typeof I=="string"||typeof I=="function"||I===Ro||I===Yo||I===Jo||I===Xo||I===vo||I===sR||typeof I=="object"&&I!==null&&(I.$$typeof===Fo||I.$$typeof===No||I.$$typeof===ko||I.$$typeof===fo||I.$$typeof===Ho||I.$$typeof===aR||I.$$typeof===dR||I.$$typeof===rR||I.$$typeof===cR)};O.typeOf=tI;/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var er=Object.getOwnPropertySymbols,mR=Object.prototype.hasOwnProperty,uR=Object.prototype.propertyIsEnumerable;function ZR(I){if(I==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(I)}function bR(){try{if(!Object.assign)return!1;var I=new String("abc");if(I[5]="de",Object.getOwnPropertyNames(I)[0]==="5")return!1;for(var g={},C=0;C<10;C++)g["_"+String.fromCharCode(C)]=C;var e=Object.getOwnPropertyNames(g).map(function(l){return g[l]});if(e.join("")!=="0123456789")return!1;var t={};return"abcdefghijklmnopqrst".split("").forEach(function(l){t[l]=l}),Object.keys(Object.assign({},t)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}bR();var hR="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",GR=hR;Function.call.bind(Object.prototype.hasOwnProperty);var BR=GR;function tb(){}function lb(){}lb.resetWarningCache=tb;var yR=function(){function I(e,t,l,n,o,A){if(A!==BR){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}I.isRequired=I;function g(){return I}var C={array:I,bigint:I,bool:I,func:I,number:I,object:I,string:I,symbol:I,any:I,arrayOf:g,element:I,elementType:I,instanceOf:g,node:I,objectOf:g,oneOf:g,oneOfType:g,shape:g,exact:g,checkPropTypes:lb,resetWarningCache:tb};return C.PropTypes=C,C};Cb.exports=yR();var Ae=Cb.exports;function pR(I,g){var C=atob(I);return C}function WR(I,g,C){var e=pR(I),t=e.indexOf(`
`,10)+1,l=e.substring(t)+"",n=new Blob([l],{type:"application/javascript"});return URL.createObjectURL(n)}function VR(I,g,C){var e;return function(l){return e=e||WR(I),new Worker(e,l)}}var SR=VR("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg=="),RR=["constraints","onError","onLoad","onScan","resolution","qrArea"];function tr(I,g){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(I);g&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(I,t).enumerable})),C.push.apply(C,e)}return C}function lr(I){for(var g=1;g<arguments.length;g++){var C=arguments[g]!=null?arguments[g]:{};g%2?tr(Object(C),!0).forEach(function(e){CR(I,e,C[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(C)):tr(Object(C)).forEach(function(e){Object.defineProperty(I,e,Object.getOwnPropertyDescriptor(C,e))})}return I}var XR=function(){return new SR},nr=function(g){g&&(g.getVideoTracks&&g.getAudioTracks?(g.getVideoTracks().forEach(function(C){g.removeTrack(C),C.stop()}),g.getAudioTracks().forEach(function(C){g.removeTrack(C),C.stop()})):g.stop())},Ac=function(g){var C=g.constraints,e=g.onError,t=g.onLoad,l=g.onScan,n=g.resolution,o=g.qrArea,A=iR(g,RR),i=p.useRef(null),s=p.useRef(null),c=p.useRef(document.createElement("canvas")),a=p.useRef(null),r=p.useRef(),m=p.useState(null),b=oR(m,2),G=b[0],u=b[1],Z=p.useRef(!1),h=p.useRef();p.useEffect(function(){h.current=XR();var W=h.current;return W.onmessage=function(R){l&&l(R.data?lr(lr({},R.data),{},{canvas:c.current}):null),Z.current=!1},function(){W.terminate()}},[l]);var B=JSON.stringify(o),y=p.useCallback(function(){var W=JSON.parse(B),R=h.current,f=s.current&&s.current.readyState===s.current.HAVE_ENOUGH_DATA;if(!Z.current&&f){Z.current=!0;var J=s.current.videoWidth,H=s.current.videoHeight,K=J>H?J:H,T=Math.floor(n/K*100)/100;H=Math.floor(T*H),J=Math.floor(T*J),c.current.width=J,c.current.height=H,a.current=c.current.getContext("2d"),a.current.drawImage(s.current,0,0,J,H);var Ag;W&&W.length===2&&W[0]>0&&W[1]>0?Ag=a.current.getImageData(Math.floor((J-W[0])/2),Math.floor((H-W[1])/2),W[0],W[1]):Ag=a.current.getImageData(0,0,J,H),R.postMessage(Ag)}r.current=requestAnimationFrame(y)},[n,B]),V=JSON.stringify(C);return p.useEffect(function(){var W=JSON.parse(V),R=!0;return navigator.mediaDevices.getUserMedia(W).then(function(f){if(!R)nr(f);else{i.current=f;try{s.current&&(s.current.srcObject=f,s.current.setAttribute("playsinline",!0))}catch{u(window.URL.createObjectURL(f))}t&&t(),r.current=requestAnimationFrame(y)}}).catch(function(f){return R?e(f):null}),function(){cancelAnimationFrame(r.current),R=!1,nr(i.current),G&&window.URL.revokeObjectURL(G)}},[y,V,e,t,G]),p.createElement("video",wi({autoPlay:!0,playsInline:!0,src:G,ref:s},A))};Ac.propTypes={constraints:Ae.object,onError:Ae.func.isRequired,onLoad:Ae.func,onScan:Ae.func.isRequired,resolution:Ae.number,qrArea:Ae.array};Ac.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]};const JR=()=>{const{showPopup:I}=RC(),[g,C]=p.useState(""),e=l=>{console.log(l)},t=l=>{l!=null&&(C(l.text),console.log(l.text),I("QR validado",!0),I("QR incorrecto",!1))};return d.jsx(d.Fragment,{children:d.jsxs("div",{class:"max-w-4xl mx-auto mt-5 px-4",children:[d.jsx("h1",{className:"text-3xl font-roboto_mono mb-4 text-center mt-8  text-sky-700",children:"Escanear QR"}),d.jsx("section",{className:"bg-gray-300 shadow-md rounded p-6 mb-8 flex flex-col items-center",children:d.jsx(Ac,{delay:2e3,onError:e,onScan:t,className:"outline outline-4 outline-slate-600 rounded justify-center"})})]})})},kR=()=>{const I=[{label:"Perfil",url:"home"},{label:"Entrada anónima",url:"anonentry"},{label:"Escanear QR",url:"scan"}];return d.jsxs(d.Fragment,{children:[d.jsx(al,{menuItems:I}),d.jsxs(Ue,{children:[d.jsx(x,{path:"home",element:d.jsx(qS,{})}),d.jsx(x,{path:"anonentry",element:d.jsx($S,{})}),d.jsx(x,{path:"scan",element:d.jsx(JR,{})}),d.jsx(x,{path:"/",element:d.jsx(OC,{to:"home"})})]})]})},fR=()=>{const I=localStorage.getItem("access_token");return d.jsx(d.Fragment,{children:d.jsxs(Ue,{children:[d.jsx(x,{path:"/",element:d.jsx(K0,{})}),d.jsx(x,{element:d.jsx(It,{canActivate:I,requiredRole:1}),children:d.jsx(x,{path:"/admon/*",element:d.jsx($W,{})})}),d.jsx(x,{element:d.jsx(It,{canActivate:I,requiredRole:2}),children:d.jsx(x,{path:"/resident/*",element:d.jsx(zS,{})})}),d.jsx(x,{element:d.jsx(It,{canActivate:I,requiredRole:3}),children:d.jsx(x,{path:"/normal/*",element:d.jsx(DS,{})})}),d.jsx(x,{element:d.jsx(It,{canActivate:I,requiredRole:4}),children:d.jsx(x,{path:"/visits/*",element:d.jsx(_S,{})})}),d.jsx(x,{element:d.jsx(It,{canActivate:I,requiredRole:5}),children:d.jsx(x,{path:"/security/*",element:d.jsx(kR,{})})})]})})},YR=()=>d.jsx(d.Fragment,{children:d.jsx(PW,{children:d.jsx(fR,{})})});VA.createRoot(document.getElementById("root")).render(d.jsx(Hb,{clientId:"927856352370-jlatbrbc93vf8so236e2c8u5kqaipttd.apps.googleusercontent.com",children:d.jsx(Fb,{children:d.jsx(Fg.StrictMode,{children:d.jsx(v0,{children:d.jsx(YR,{})})})})}));
